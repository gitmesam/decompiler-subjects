// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_text.h"

// 00401000: void fn00401000()
// Called from:
//      Win32CrtStartup
void fn00401000()
{
	Eq_2 edx_12 = g_t402104;
	cu8 bl_23 = 0x00;
	do
	{
		if (bl_23 >= 0x80)
			*edx_12 = bl_23 << 0x01;
		struct Eq_7 * edx_15 = (word32) edx_12 + 1;
		edx_15->b0000 = bl_23 << 0x01;
		edx_15->b0001 = bl_23 << 0x01;
		edx_12 = &edx_15->b0001 + 2;
		++bl_23;
	} while (bl_23 != 0x00);
}

// 00401020: void fn00401020()
// Called from:
//      Win32CrtStartup
void fn00401020()
{
	Eq_31 Top_3 = 0;
	--g_w40213C;
	word16 eax_16_16_228 = 0x00;
	byte bl_310 = 0x00;
	byte bh_317 = 0x00;
	do
	{
		byte al_42 = bl_310;
		word16 dx_43 = 0xF400;
		do
		{
			int16 ax_46 = (int16) (al_42 - 0x80);
			g_w40213E = ax_46;
			bi8 al_48 = (byte) ax_46;
			--Top_3;
			*Top_3 = (real64) g_w40213E;
			dx_43 -= al_48 *s al_48;
			ptr32 ebx_129 = SEQ(0x00, bh_317, bl_310);
			cu8 dh_72 = SLICE(dx_43, byte, 8);
			al_42 = bh_317;
			word16 bx_139 = (word16) ebx_129;
		} while (P);
		*((word32) Top_3 + 1) = atan(*((word32) Top_3 + 2), *((word32) Top_3 + 1));
		*((word32) Top_3 + 1) *= (real64) g_w40213A;
		g_w40213E = (int16) *((word32) Top_3 + 1);
		byte ah_69 = SLICE(g_w40213E + g_w40213B, byte, 8);
		cui16 ax_74 = SEQ(ah_69, dh_72);
		Top_3 = (word32) Top_3 + 2;
		byte cl_100 = 0x00;
		byte dh_104 = (byte) (ax_74 & 0x0707) + SLICE(ax_74 & 0x0707, byte, 8) + dh_72;
		if (dh_72 >= ~0x10)
			cl_100 = 0x50;
		if (dh_72 <= ~0x15)
		{
			word16 cx_101 = SEQ(ah_69 & 0x1F, cl_100);
			if ((ah_69 & 0x1F) <= 0x03)
			{
				if (dh_72 >= 233)
				{
					dh_104 = __ror(dh_72, 0x03) + 155;
					--cx_101;
				}
				dh_104 -= 0x14;
			}
			cl_100 = (byte) cx_101;
			if (dh_72 <= 0xB4)
				cl_100 = (byte) (cx_101 - 0x01);
		}
		*((char *) g_t40211C + ebx_129) = (Eq_126) cl_100;
		Eq_129 ebp_137 = g_t402120;
		*((char *) ebp_137 + ebx_129) = (Eq_129) (dh_104 + 0x80);
		word16 ebp_16_16_335 = SLICE(ebp_137, word16, 16);
		bl_310 = (byte) (bx_139 + 0x01);
		bh_317 = SLICE(bx_139 + 0x01, byte, 8);
	} while (bx_139 != 0x01);
	ptr32 edi_143 = 0x0003E800;
	word16 si_144;
	for (si_144 = ~0x63; si_144 != 100; ++si_144)
	{
		word32 ebp_148 = SEQ(ebp_16_16_335, ~0x9F);
		do
		{
			int32 dx_ax_158 = (int32) (int16) (byte) (g_w40213C << 0x01);
			bi8 al_163 = ((byte) dx_ax_158 & 0x7F) - 0x40;
			int16 ax_164 = al_163 *s al_163;
			ui16 ax_169 = SEQ(SLICE(ax_164, byte, 8) - 0x10, (byte) ax_164);
			ui16 dx_170 = SLICE(dx_ax_158, word16, 16) ^ ax_169;
			word16 bp_343 = (word16) ebp_148;
			word16 cx_153 = 0x7F40;
			word16 di_180 = SEQ(SLICE(ax_169 * 0x02, byte, 8) - 0x01, (byte) (ax_169 * 0x02));
			word16 dx_184 = SEQ(SLICE(dx_170, byte, 8) + 0x24, (byte) dx_170);
			do
			{
				cx_153 += bp_343;
				di_180 -= 0xA0;
				ptr32 ebx_200 = SEQ(0x00, SLICE(di_180, byte, 8), SLICE(cx_153, byte, 8));
				dx_184 += si_144;
				char ah_201 = *((char *) g_t40211C + ebx_200);
				byte al_203 = *((char *) g_t402120 + ebx_200);
				char dh_210 = SLICE(dx_184, byte, 8);
				ui32 eax_226 = SEQ(eax_16_16_228, ah_201, al_203);
				if (ah_201 < 0x00)
					break;
				word16 ax_231 = SEQ(ah_201, al_203);
				if (ah_201 != 0x00)
				{
					if (dh_210 < ah_201)
						continue;
					ax_231 = SEQ(ah_201, al_203);
					if (dh_210 >= ah_201)
						ax_231 = SEQ(ah_201, al_203 + ah_201);
				}
				eax_226 = SEQ(eax_16_16_228, ax_231);
			} while (dh_210 <= 0x46);
			word32 eax_239 = *((word32) g_t402104 + (eax_226 & 0xFF) * 0x04);
			*((word32) g_t402100 + edi_143) = eax_239;
			word16 bp_244 = (word16) ebp_148;
			ebp_16_16_335 = SLICE(ebp_148, word16, 16);
			eax_16_16_228 = SLICE(eax_239, word16, 16);
			edi_143 -= 0x04;
			ebp_148 = SEQ(ebp_16_16_335, bp_244 + 0x01);
		} while (bp_244 != 0x9F);
	}
	GetClientRect(g_t4020CC, &g_t4020F0);
	StretchDIBits(g_t4020D0, 0x00, 0x00, g_dw4020F8, g_dw4020FC, 0x00, 0x00, 0x0140, 200, g_t402100, &g_t40206C, 0x00, 0x00CC0020);
}

// 004011C5: Register Eq_307 Win32CrtStartup()
Eq_307 Win32CrtStartup()
{
	Eq_2 eax_8 = GlobalAlloc(0x00, 1000000);
	if (eax_8 != 0x00)
	{
		g_t40210C = eax_8;
		g_t402104 = eax_8;
		Mem16[0x00402100<p32>:word32] = eax_8 + 2000;
		Mem18[0x0040211C<p32>:word32] = eax_8 + 402000;
		Mem20[0x00402120<p32>:word32] = eax_8 + 602000;
		g_t4020B4 = GetModuleHandleW(null);
		g_t4020B8 = LoadIconW(0x00, (WCHAR *) 0x7F00);
		Eq_383 eax_37 = LoadCursorW(0x00, (WCHAR *) 0x7F00);
		g_t4020BC = eax_37;
		if (SEQ(SLICE(eax_37, word16, 16), RegisterClassW(&g_t4020A4)) != 0x00)
		{
			Eq_287 eax_74 = CreateWindowExW(0x00, &g_t402000, &g_t402012, 0x10CF0000, 0x8000, 0x8000, 0x021C, 400, null, null, g_t4020B4, null);
			if (eax_74 != null)
			{
				g_t4020CC = eax_74;
				g_t4020D0 = GetDC(eax_74);
				fn00401000();
				fn00401020();
				SetStretchBltMode(g_t4020D0, 0x04);
				while (true)
				{
					PeekMessageW(&g_t4020D4, null, 0x00, 0x00, 0x01);
					if (g_dw4020D8 == 0x12)
						break;
					TranslateMessage(&g_t4020D4);
					DispatchMessageW(&g_t4020D4);
					fn00401020();
					++g_dw402108;
				}
l004012FA:
				ReleaseDC(g_t4020CC, g_t4020D0);
				GlobalFree(g_t40210C);
				ExitProcess(g_t4020DC);
			}
		}
	}
	MessageBoxW(null, &g_t40204C, null, 0x10);
	goto l004012FA;
}

