// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register word16 ax, Register byte cl, Register Eq_4 dx, Register Eq_5 bx, Register (ptr16 Eq_6) es)
void fn0C00_0100(word16 ax, byte cl, Eq_4 dx, Eq_5 bx, struct Eq_6 * es)
{
	word16 Eq_6::* di_201 = Eq_6::a0200;
	word16 cx_204 = SEQ(0x10, cl);
	while (true)
	{
		byte ah_217 = SLICE(ax, byte, 8);
		byte ch_222 = SLICE(cx_204, byte, 8);
		if (cx_204 == 0x00)
			break;
		es->*di_201 = ax;
		++di_201;
		--cx_204;
	}
	__syscall(0x10);
	word16 si_13 = *((word16) bx + 1132);
	word16 ax_218 = SEQ(ah_217, 0x03);
	word16 cx_274 = SEQ(ch_222, ~0x00);
	do
	{
		do
		{
			ax_220 = SEQ(ah_219, 0x01);
			uint32 dx_ax_34 = (uint32) (uint16) ((word16) dx + __rcl(si_13 + 0x01, (byte) cx_286, C));
			dx.u0 = (uint16) (dx_ax_34 % 0x06D1);
			si_13 = ax_218;
			byte dh_228 = SLICE(dx, byte, 8);
			byte ah_219 = SLICE((uint16) (dx_ax_34 /u 0x06D1), byte, 8);
			C = SLICE(cond(cs->*((word16) dx.u0 + 593) - 0x01), bool, 1);
			cx_274 = cx_286;
			ax_218 = ax_220;
			cx_286 = cx_274;
		} while (cs->*((word16) dx.u0 + 593) == 0x01);
		es->*((word16) dx.u0 + 593) = 0x01;
		ax_218 = SEQ(ah_219, 0x01);
		byte ch_223 = SLICE(cx_286 - 0x01, byte, 8);
		cx_274 = cx_286 - 0x01;
		cx_287 = cx_274;
	} while (cx_286 != 0x01);
	word16 Eq_101::* di_195 = &Eq_101::w0000;
	ptr16 dx_227;
	do
	{
		word16 cx_198 = SEQ(ch_223, 0x50);
		while (true)
		{
			ch_223 = SLICE(cx_198, byte, 8);
			if (cx_198 == 0x00)
				break;
			0xB800->*di_195 = 0x072D;
			++di_195;
			--cx_198;
		}
		--dx_227;
	} while (dx_227 != 0x00);
	do
	{
		byte Eq_67::* si_137;
		byte Eq_101::* di_136;
		ptr16 dx_281;
		fn0C00_01E8(dx_227, out dx_281, out si_137, out di_136);
		bios_video_set_cursor_position(SLICE(bx, byte, 8), SLICE(dx_281, byte, 8), (byte) dx_281);
		int16 ax_83 = (int16) msdos_character_input_without_echo();
		byte al_84 = (byte) ax_83;
		word16 ax_92 = SEQ(SLICE(ax_83, byte, 8), al_84 - 0x31);
		if (al_84 == 0x31)
			--dx_281;
		byte dl_105 = (byte) dx_281;
		byte dh_96 = SLICE(dx_281, byte, 8);
		ptr16 dx_104 = dx_281;
		if (ax_92 == 0x01)
			dx_104 = SEQ(dh_96 + 0x01, dl_105);
		if (ax_92 == 0x02)
			++dx_104;
		cui16 ax_112 = ax_92 - 0x03;
		Eq_5 bx_133 = bx;
		if (ax_92 == 0x03)
			ax_112 = fn0C00_0181(dx_104, bx, 0x06D1, 0xB800, cs, out dx_104, out bx_133, out si_137, out di_136);
		byte dl_231 = (byte) dx_104;
		byte dh_146 = SLICE(dx_104, byte, 8);
		word16 ax_143 = ax_112 - 0x01;
		dx_227 = dx_104;
		if (ax_143 == 0x00)
			dx_227 = SEQ(dh_146 - 0x01, dl_231);
		byte al_178 = (byte) (ax_143 - 0x01);
		if (ax_143 == 0x01)
		{
			bci8 al_168 = cs->*si_137;
			struct Eq_211 Eq_67::* si_169 = si_137 + 1;
			bx = bx_133;
			if ((al_168 & 0x40) != 0x00)
				continue;
			(cs->*si_169).bFFFFFFFF = (cs->*si_169).bFFFFFFFF ^ 0x80;
			byte al_177 = al_168 >> 0x07 & 0x0A;
			0xB800->*di_136 = al_177 + 0x23;
			al_178 = al_177 + 0x23;
		}
		bx = bx_133;
	} while (al_178 != 229);
	msdos_terminate_program20();
}

// 0C00:0181: Register cui16 fn0C00_0181(Register ptr16 dx, Register Eq_5 bh, Register word16 bp, Register (ptr16 Eq_101) es, Register (ptr16 Eq_67) ds, Register out ptr16 dxOut, Register out (ptr16 Eq_188) bxOut, Register out Eq_189 siOut, Register out Eq_190 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0181
cui16 fn0C00_0181(ptr16 dx, Eq_5 bh, word16 bp, struct Eq_101 * es, struct Eq_67 * ds, ptr16 & dxOut, struct Eq_188 & bxOut, union Eq_189 & siOut, union Eq_190 & diOut)
{
	cu8 dl = (byte) dx;
	cu8 dh = SLICE(dx, byte, 8);
	Eq_5 bh = SLICE(bx, byte, 8);
	struct Eq_188 * bx_135 = bx;
	if (dl < 0x50)
	{
		bx_135 = bx;
		if (dh < 0x19)
		{
			word16 dx_16;
			struct Eq_255 Eq_67::* si_17;
			cui16 ax_26 = SEQ(SLICE((uint16) (uint8) fn0C00_01E8(dx, out dx_16, out si_17, out di), byte, 8), (ds->*si_17).b0000);
			si = &si_17->b0001;
			cui16 ax_134 = ax_26 & 0xFF;
			byte ah_147 = SLICE(ax_26 & 0xFF, byte, 8);
			bx_135 = bx;
			if ((ax_26 & 0xFF) == 0x00)
			{
				(ds->*si_17).b0000 |= 0x40;
				byte al_35 = (ds->*si_17).bFFFFFFFF + (ds->*si_17).b0001;
				bx_135 = SEQ(bh, 0x50);
				do
				{
					al_35 = al_35 + Mem32[ds:bx_135 + (si_17 + 1):byte] + Mem32[ds:(bx_135 - 0x01) + (si_17 + 1):byte] + Mem32[ds:(bx_135 - 0x02) + (si_17 + 1):byte];
					bx_135 = -bx_135;
				} while (bx_135 < 0x00);
				if ((al_35 & 0x0F) == 0x00)
				{
					es->*di = 0x20;
					word16 dx_71;
					word16 bx_236;
					word16 si_237;
					word16 di_238;
					fn0C00_0181(dx_16 - 0x01, bh, bp, es, ds, out dx_71, out bx_236, out si_237, out di_238);
					word16 dx_81;
					word16 bx_239;
					word16 si_240;
					word16 di_241;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_81, out bx_239, out si_240, out di_241);
					word16 dx_89;
					word16 bx_242;
					word16 si_243;
					word16 di_244;
					fn0C00_0181(dx_81 + 0x01, bh, bp, es, ds, out dx_89, out bx_242, out si_243, out di_244);
					word16 dx_97;
					word16 bx_245;
					word16 si_246;
					word16 di_247;
					fn0C00_0181(dx_89 + 0x01, bh, bp, es, ds, out dx_97, out bx_245, out si_246, out di_247);
					word16 dx_107;
					word16 bx_248;
					word16 si_249;
					word16 di_250;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_107, out bx_248, out si_249, out di_250);
					word16 dx_117;
					word16 bx_251;
					word16 si_252;
					word16 di_253;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_117, out bx_251, out si_252, out di_253);
					word16 dx_125;
					word16 bx_254;
					word16 si_255;
					word16 di_256;
					fn0C00_0181(dx_117 - 0x01, bh, bp, es, ds, out dx_125, out bx_254, out si_255, out di_256);
					word16 dx_257;
					word16 si_258;
					word16 di_259;
					ax_134 = fn0C00_0181(dx_125 - 0x01, bh, bp, es, ds, out dx_257, out bx_135, out si_258, out di_259);
				}
				else
				{
					byte al_54 = (al_35 & 0x0F) + 0x30;
					es->*di = al_54;
					ax_134 = SEQ(ah_147, al_54);
				}
				di = (word16) di + 1;
				if (bp == 0x01)
				{
l0C00_01E6:
					msdos_terminate_program20();
				}
			}
			ax = ax_134 - 0x01;
			if (ax == 0x00)
			{
				es->*di = 0x2A;
				goto l0C00_01E6;
			}
		}
	}
	dxOut = dx;
	bxOut = bx_135;
	siOut = si;
	diOut = di;
	return ax;
}

// 0C00:01E8: Register byte fn0C00_01E8(Register ptr16 dx, Register out ptr16 dxOut, Register out Eq_122 siOut, Register out Eq_123 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0181
byte fn0C00_01E8(ptr16 dx, ptr16 & dxOut, union Eq_122 & siOut, union Eq_123 & diOut)
{
	byte dh = SLICE(dx, byte, 8);
	dxOut = dx;
	int16 ax_6 = (int16) dh;
	siOut = ax_6 *s 0x50 + dx + 0x0251;
	diOut = (ax_6 *s ~0xAF + dx) * 0x02;
	return SLICE(si, byte, 8);
}

