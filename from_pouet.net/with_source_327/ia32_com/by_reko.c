// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) es, Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_2 * es, struct Eq_3 * ds)
{
	word16 bx_8;
	msdos_resize_memory_block(es, 0x01B5, out bx_8);
	bios_video_set_mode(0x13);
	msdos_allocate_memory_block(4020);
	struct Eq_23 * gs_21 = 18451;
	struct Eq_23 * fs_26 = 18451;
	if (msdos_allocate_memory_block(4020))
		fn0C00_0226(ds);
	else
	{
		msdos_display_string(&ds->b0234);
		word16 cx_31 = 0x7D00;
		word16 Eq_23::* di_32 = Eq_23::a0000;
		while (true)
		{
			byte ch_440 = SLICE(cx_31, byte, 8);
			if (cx_31 == 0x00)
				break;
			gs_21->*di_32 = 0x00;
			++di_32;
			--cx_31;
		}
		byte Eq_23::* di_111 = Eq_23::a0000;
		int16 si_110 = 0x00;
		word16 cx_113 = SEQ(ch_440, 0x08);
		do
		{
			word16 cx_103 = SEQ(SLICE(cx_514, byte, 8), 0x35);
			di_71 = di_111;
			si_452 = si_110;
			do
			{
				int16 si_452;
				byte Eq_23::* di_71;
				byte al_72 = 0xA000->*di_71;
				word16 cx_446 = SEQ(SLICE(cx_515, byte, 8), 0x06);
				do
				{
					<type-error> Eq_23::* bx_80 = Eq_23::a2BD4;
					word16 cx_455 = SEQ(SLICE(cx_516, byte, 8), 0x12);
					do
					{
						gs_21->*((char *) bx_80 + si_452) = al_72;
						bx_80 = (<type-error> Eq_23::*) ((char *) bx_80 + 320);
						byte bh_458 = SLICE(bx_80, byte, 8);
						--cx_455;
					} while (cx_455 != 0x00);
					++si_452;
					cx_446 = cx_516 - 0x01;
					cx_516 = cx_446;
				} while (cx_516 != 0x01);
				++di_71;
				cx_103 = cx_515 - 0x01;
				cx_515 = cx_103;
			} while (cx_515 != 0x01);
			si_110 += 0x1680;
			di_111 += 320;
			cx_113 = cx_514 - 0x01;
			cx_514 = cx_113;
		} while (cx_514 != 0x01);
		fn0C00_02B8(gs_21, fs_26);
		Eq_120 ax_130 = (uint16) (byte) gs_21;
		do
		{
			Eq_123 cl_133 = <invalid>;
			ci8 bl_131;
			fn0C00_0298(SEQ(SLICE(ax_130, byte, 8), bh_458), cl_133, fn0C00_02AB(ax_130, out bl_131), bl_131, out ax_130);
			Eq_123 O_145 = <invalid>;
			Eq_123 Z_144 = <invalid>;
			Eq_123 S_143 = <invalid>;
			byte ah_147 = SLICE(ax_130, byte, 8);
			byte al_459 = (byte) ax_130;
		} while (O_145 | Z_144 | S_143);
		Eq_120 ax_151 = SEQ(ah_147 - 0x01, al_459);
		do
		{
			Eq_123 cl_154 = <invalid>;
			ci8 bl_152;
			fn0C00_0298(SEQ(SLICE(ax_151, byte, 8), bh_458), -cl_154 - 0x01, -fn0C00_02AB(ax_151, out bl_152), bl_152, out ax_151);
			Eq_123 Z_170 = <invalid>;
		} while (Z_170);
		fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(200, 0x01, 0xA000, ds, gs_21), byte, 8), 0x78), ~0x14, 0xA000, ds, gs_21), byte, 8), 0x78), 0x28, 0xA000, ds, gs_21), byte, 8), 0x28), 0x78, 0xA000, ds, gs_21), byte, 8), 0x32), 0x80, 0xA000, ds, gs_21), byte, 8), ~0x00), 0x01, 0xA000, ds, gs_21);
		struct Eq_216 Eq_229::* sp_274 = fp - 59988;
		byte Eq_23::* bx_275 = &Eq_23::b0001;
		word16 cx_276 = 0x0104;
		do
		{
			struct Eq_230 Eq_229::* sp_278 = sp_274 - 2;
			(ss->*sp_278).ptr0000 = bx_275;
			fn0C00_0271(0x09, 0xA000, ds, fs_26, gs_21);
			word16 bx_298 = (ss->*sp_278).w0002;
			(ss->*sp_278).w0002 = cx_276;
			word16 cx_303 = bx_298;
			byte Eq_23::* di_304 = Eq_23::a0000;
			do
			{
				(ss->*sp_278).ptr0000 = di_304;
				fn0C00_02EE(cx_303, di_304, 0xA000, fs_26);
				di_304 = (ss->*sp_278).ptr0000 + 320;
				--cx_303;
			} while (cx_303 != 0x00);
			word16 cx_327 = bx_298;
			word16 di_328 = 0xFA00;
			do
			{
				di_328 = fn0C00_02EE(cx_327, di_328 - cx_327, 0xA000, fs_26) - 0x0140;
				--cx_327;
			} while (cx_327 != 0x00);
			word16 cx_347 = (ss->*sp_278).w0002;
			sp_274 = (struct Eq_216 Eq_229::*) (&sp_278->w0002 + 1);
			bx_275 = bx_298 + 0x01;
			cx_276 = cx_347 - 0x01;
			byte ch_469 = SLICE(cx_347 - 0x01, byte, 8);
		} while (cx_347 != 0x01);
		word16 cx_371 = SEQ(ch_469, 0x32);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, fs_26, gs_21);
			--cx_371;
			sp_274 = (struct Eq_216 Eq_229::*) &sp_274->w0002;
			byte ch_488 = SLICE(cx_371, byte, 8);
		} while (cx_371 != 0x00);
		ci8 bh_391 = 0x00;
		word16 cx_394 = SEQ(ch_488, ~0x00);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, fs_26, gs_21);
			struct Eq_216 Eq_229::* sp_390 = &sp_274->w0002;
			(ss->*sp_390).wFFFFFFFE = cx_394;
			++bh_391;
			__outb(0x03C8, bh_391);
			word16 cx_401 = 0x0300;
			do
			{
				__inb(969);
				--cx_401;
				byte ch_491 = SLICE(cx_401, byte, 8);
			} while (cx_401 != 0x00);
			word16 cx_417 = SEQ(ch_491, 0x03);
			do
			{
				ci8 al_408 = __inb(969);
				ci8 al_409 = al_408 - 0x01;
				if (al_408 < 0x01)
					al_409 = al_408;
				__outb(969, al_409);
				--cx_417;
			} while (cx_417 != 0x00);
			word16 cx_428 = (ss->*sp_390).wFFFFFFFE;
			sp_274 = sp_390;
			cx_394 = cx_428 - 0x01;
		} while (cx_428 != 0x01);
		fn0C00_0226(ds);
	}
}

// 0C00:0226: void fn0C00_0226(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_0226(struct Eq_3 * ds)
{
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->b023B);
	msdos_terminate_program20();
}

// 0C00:0251: Register byte fn0C00_0251(Register word16 cx, Register byte bl, Register (ptr16 Eq_23) es, Register (ptr16 Eq_3) ds, Register (ptr16 Eq_23) gs)
// Called from:
//      fn0C00_0100
byte fn0C00_0251(word16 cx, byte bl, struct Eq_23 * es, struct Eq_3 * ds, struct Eq_23 * gs)
{
	do
	{
		byte Eq_23::* di_14 = Eq_23::a0000;
		word16 cx_12;
		for (cx_12 = 0xFA00; cx_12 != 0x00; --cx_12)
		{
			es->*di_14 = (byte) (uint16) fn0C00_02CA(&(gs->*di_14), bl);
			++di_14;
		}
		fn0C00_02B8(es, gs);
		byte al_40;
		byte ah_41;
		if (bios_kbd_check_keystroke(out al_40, out ah_41))
			fn0C00_0226(ds);
		cx = cx_64 - 0x01;
		cx_64 = cx;
	} while (cx_64 != 0x01);
	return SLICE(cx, byte, 8);
}

// 0C00:0271: void fn0C00_0271(Register byte bl, Register (ptr16 Eq_23) es, Register (ptr16 Eq_3) ds, Register (ptr16 Eq_23) fs, Register (ptr16 Eq_23) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0271(byte bl, struct Eq_23 * es, struct Eq_3 * ds, struct Eq_23 * fs, struct Eq_23 * gs)
{
	byte Eq_23::* di_11 = Eq_23::a2BD4;
	word16 cx_33;
	for (cx_33 = 0xA280; cx_33 != 0x00; --cx_33)
	{
		byte dl_26 = (byte) (uint16) fn0C00_02CA(&(gs->*di_11), bl);
		if (fs->*di_11 != 0x00)
			es->*di_11 = dl_26;
		++di_11;
	}
	fn0C00_02B8(es, gs);
	byte al_47;
	byte ah_48;
	if (!bios_kbd_check_keystroke(out al_47, out ah_48))
		return;
	fn0C00_0226(ds);
}

// 0C00:0298: FlagGroup Eq_123 fn0C00_0298(Sequence word16 ah_bh, Register Eq_123 cl, Register ci8 ch, Register ci8 bl, Register out Eq_132 axOut)
// Called from:
//      fn0C00_0100
Eq_123 fn0C00_0298(word16 ah_bh, Eq_123 cl, ci8 ch, ci8 bl, union Eq_132 & axOut)
{
	byte ah = SLICE(ah_bh, byte, 16);
	__outb(0x03C8, bl);
	__outw(969, ah_bh);
	__outw(969, SEQ(ah, cl));
	__outb(969, ch);
	axOut = SEQ(ah + 0x01, ch);
	return <invalid>;
}

// 0C00:02AB: Register ui8 fn0C00_02AB(Register Eq_120 ah, Register out Eq_120 blOut)
// Called from:
//      fn0C00_0100
ui8 fn0C00_02AB(Eq_120 ah, union Eq_120 & blOut)
{
	Eq_120 ah = SLICE(ax, byte, 8);
	blOut = ah;
	return ah >> 0x01 << 0x01;
}

// 0C00:02B8: void fn0C00_02B8(Register (ptr16 Eq_23) ax, Register (ptr16 Eq_23) bp)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_02B8(struct Eq_23 * ax, struct Eq_23 * bp)
{
	word16 cx_11;
	word16 Eq_23::* di_12 = Eq_23::a0000;
	word16 Eq_23::* si_13 = Eq_23::a0000;
	for (cx_11 = 0x7D00; cx_11 != 0x00; --cx_11)
	{
		bp->*di_12 = ax->*si_13;
		++si_13;
		++di_12;
	}
}

// 0C00:02CA: Register byte fn0C00_02CA(Sequence (ptr32 Eq_398) gs_di, Register byte bl)
// Called from:
//      fn0C00_0251
//      fn0C00_0271
byte fn0C00_02CA(struct Eq_398 * gs_di, byte bl)
{
	Eq_519 dx_20 = gs_di->b0002 + gs_di->bFFFFFFFF + (uint16) gs_di->b0140 + (uint16) gs_di->bFFFFFEC0;
	return (byte) (dx_20 >> 0x02) - bl;
}

// 0C00:02EE: Register (memptr (ptr16 Eq_23) byte) fn0C00_02EE(Register word16 cx, Register (memptr (ptr16 Eq_23) byte) di, Register (ptr16 Eq_23) es, Register (ptr16 Eq_23) fs)
// Called from:
//      fn0C00_0100
byte Eq_23::* fn0C00_02EE(word16 cx, byte Eq_23::* di, struct Eq_23 * es, struct Eq_23 * fs)
{
	do
	{
		if (fs->*di == 0x00)
			es->*di = ~0x00;
		++di;
		--cx;
	} while (cx != 0x00);
	return di;
}

