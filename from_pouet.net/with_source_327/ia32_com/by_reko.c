// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) es, Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_2 * es, struct Eq_3 * ds)
{
	word16 bx_8;
	msdos_resize_memory_block(es, 0x01B5, out bx_8);
	bios_video_set_mode(0x13);
	msdos_allocate_memory_block(4020);
	if (msdos_allocate_memory_block(4020))
		fn0C00_0226(ds);
	else
	{
		msdos_display_string(&ds->b0234);
		word16 cx_29 = 0x7D00;
		word16 di_30 = 0x00;
		while (true)
		{
			byte ch_438 = SLICE(cx_29, byte, 8);
			if (cx_29 == 0x00)
				break;
			0x13->*di_30 = 0x00;
			++di_30;
			--cx_29;
		}
		word16 di_109 = 0x00;
		int16 si_108 = 0x00;
		word16 cx_111 = SEQ(ch_438, 0x08);
		do
		{
			word16 cx_101 = SEQ(SLICE(cx_510, byte, 8), 0x35);
			di_69 = di_109;
			si_450 = si_108;
			do
			{
				int16 si_450;
				byte Eq_47::* di_69;
				byte al_70 = 0xA000->*di_69;
				word16 cx_444 = SEQ(SLICE(cx_511, byte, 8), 0x06);
				do
				{
					word16 bx_78 = 11220;
					word16 cx_453;
					do
					{
						0x13->*((char *) bx_78 + si_450) = al_70;
						bx_78 = (<type-error> Eq_47::*) ((char *) bx_78 + 320);
						byte bh_454 = SLICE(bx_78, byte, 8);
						--cx_453;
					} while (cx_453 != 0x00);
					++si_450;
					cx_444 = cx_512 - 0x01;
					cx_512 = cx_444;
				} while (cx_512 != 0x01);
				++di_69;
				cx_101 = cx_511 - 0x01;
				cx_511 = cx_101;
			} while (cx_511 != 0x01);
			si_108 += 0x1680;
			di_109 += 320;
			cx_111 = cx_510 - 0x01;
			cx_510 = cx_111;
		} while (cx_510 != 0x01);
		fn0C00_02B8(0x13, 0x13);
		Eq_47 ax_112 = 0x13;
		do
		{
			Eq_118 cl_131 = <invalid>;
			ci8 bl_129;
			fn0C00_0298(SEQ(SLICE(ax_112, byte, 8), bh_454), cl_131, fn0C00_02AB(ax_112, out bl_129), bl_129, out ax_112);
			Eq_118 O_143 = <invalid>;
			Eq_118 Z_142 = <invalid>;
			Eq_118 S_141 = <invalid>;
			byte ah_145 = SLICE(ax_112, byte, 8);
			byte al_455 = (byte) ax_112;
		} while (O_143 | Z_142 | S_141);
		Eq_47 ax_149 = SEQ(ah_145 - 0x01, al_455);
		do
		{
			Eq_118 cl_152 = <invalid>;
			ci8 bl_150;
			fn0C00_0298(SEQ(SLICE(ax_149, byte, 8), bh_454), -cl_152 - 0x01, -fn0C00_02AB(ax_149, out bl_150), bl_150, out ax_149);
			Eq_118 Z_168 = <invalid>;
		} while (Z_168);
		fn0C00_0251(SEQ(SLICE((uint16) (uint8) fn0C00_0251(SEQ(SLICE((uint16) (uint8) fn0C00_0251(SEQ(SLICE((uint16) (uint8) fn0C00_0251(SEQ(SLICE((uint16) (uint8) fn0C00_0251(SEQ(SLICE((uint16) (uint8) fn0C00_0251(200, 0x01, 0xA000, ds, 0x13), byte, 8), 0x78), ~0x14, 0xA000, ds, 0x13), byte, 8), 0x78), 0x28, 0xA000, ds, 0x13), byte, 8), 0x28), 0x78, 0xA000, ds, 0x13), byte, 8), 0x32), 0x80, 0xA000, ds, 0x13), byte, 8), ~0x00), 0x01, 0xA000, ds, 0x13);
		struct Eq_216 Eq_229::* sp_272 = fp - 59988;
		word16 bx_273 = 0x01;
		word16 cx_274 = 0x0104;
		do
		{
			struct Eq_230 Eq_229::* sp_276 = sp_272 - 2;
			(ss->*sp_276).ptr0000 = bx_273;
			fn0C00_0271(0x09, 0xA000, ds, 0x13, 0x13);
			word16 bx_296 = (ss->*sp_276).w0002;
			(ss->*sp_276).w0002 = cx_274;
			word16 cx_301;
			word16 di_302 = 0x00;
			do
			{
				(ss->*sp_276).ptr0000 = di_302;
				fn0C00_02EE(cx_301, di_302, 0xA000, 0x13);
				di_302 = (ss->*sp_276).ptr0000 + 320;
				--cx_301;
			} while (cx_301 != 0x00);
			word16 cx_325;
			word16 di_326 = 0xFA00;
			do
			{
				di_326 = fn0C00_02EE(cx_325, di_326 - cx_325, 0xA000, 0x13) - 0x0140;
				--cx_325;
			} while (cx_325 != 0x00);
			word16 cx_345 = (ss->*sp_276).w0002;
			sp_272 = (struct Eq_216 Eq_229::*) (&sp_276->w0002 + 1);
			bx_273 = bx_296 + 0x01;
			cx_274 = cx_345 - 0x01;
			byte ch_465 = SLICE(cx_345 - 0x01, byte, 8);
		} while (cx_345 != 0x01);
		word16 cx_369 = SEQ(ch_465, 0x32);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, 0x13, 0x13);
			--cx_369;
			sp_272 = (struct Eq_216 Eq_229::*) &sp_272->w0002;
			byte ch_484 = SLICE(cx_369, byte, 8);
		} while (cx_369 != 0x00);
		ci8 bh_389 = 0x00;
		word16 cx_392 = SEQ(ch_484, ~0x00);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, 0x13, 0x13);
			struct Eq_216 Eq_229::* sp_388 = &sp_272->w0002;
			(ss->*sp_388).wFFFFFFFE = cx_392;
			++bh_389;
			__outb(0x03C8, bh_389);
			word16 cx_399 = 0x0300;
			do
			{
				__inb(969);
				--cx_399;
				byte ch_487 = SLICE(cx_399, byte, 8);
			} while (cx_399 != 0x00);
			word16 cx_415;
			do
			{
				ci8 al_406 = __inb(969);
				ci8 al_407 = al_406 - 0x01;
				if (al_406 < 0x01)
					al_407 = al_406;
				__outb(969, al_407);
				--cx_415;
			} while (cx_415 != 0x00);
			word16 cx_426 = (ss->*sp_388).wFFFFFFFE;
			sp_272 = sp_388;
			cx_392 = cx_426 - 0x01;
		} while (cx_426 != 0x01);
		fn0C00_0226(ds);
	}
}

// 0C00:0226: void fn0C00_0226(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_0226(struct Eq_3 * ds)
{
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->b023B);
	msdos_terminate_program20();
}

// 0C00:0251: Register byte fn0C00_0251(Register word16 cx, Register byte bl, Register Eq_47 es, Register (ptr16 Eq_3) ds, Register Eq_47 gs)
// Called from:
//      fn0C00_0100
byte fn0C00_0251(word16 cx, byte bl, Eq_47 es, struct Eq_3 * ds, Eq_47 gs)
{
	do
	{
		word16 di_14 = 0x00;
		word16 cx_12;
		for (cx_12 = 0xFA00; cx_12 != 0x00; --cx_12)
		{
			es->*di_14 = (byte) (uint16) (uint8) fn0C00_02CA(SEQ(gs, di_14), bl);
			++di_14;
		}
		fn0C00_02B8(es, gs);
		byte al_40;
		byte ah_41;
		if (bios_kbd_check_keystroke(out al_40, out ah_41))
			fn0C00_0226(ds);
		cx = cx_64 - 0x01;
		cx_64 = cx;
	} while (cx_64 != 0x01);
	return SLICE(cx, byte, 8);
}

// 0C00:0271: void fn0C00_0271(Register byte bl, Register Eq_47 es, Register (ptr16 Eq_3) ds, Register Eq_47 fs, Register Eq_47 gs)
// Called from:
//      fn0C00_0100
void fn0C00_0271(byte bl, Eq_47 es, struct Eq_3 * ds, Eq_47 fs, Eq_47 gs)
{
	word16 di_11 = 11220;
	word16 cx_33;
	for (cx_33 = 0xA280; cx_33 != 0x00; --cx_33)
	{
		byte dl_26 = (byte) (uint16) (uint8) fn0C00_02CA(SEQ(gs, di_11), bl);
		if ((fs->*di_11 & ~0x00) != 0x00)
			es->*di_11 = dl_26;
		++di_11;
	}
	fn0C00_02B8(es, gs);
	byte al_47;
	byte ah_48;
	if (!bios_kbd_check_keystroke(out al_47, out ah_48))
		return;
	fn0C00_0226(ds);
}

// 0C00:0298: FlagGroup Eq_118 fn0C00_0298(Sequence word16 ah_bh, Register Eq_118 cl, Register ci8 ch, Register ci8 bl, Register out (ptr16 Eq_127) axOut)
// Called from:
//      fn0C00_0100
Eq_118 fn0C00_0298(word16 ah_bh, Eq_118 cl, ci8 ch, ci8 bl, struct Eq_127 & axOut)
{
	byte ah = SLICE(ah_bh, byte, 16);
	__outb(0x03C8, bl);
	__outw(969, ah_bh);
	__outw(969, SEQ(ah, cl));
	__outb(969, ch);
	axOut = SEQ(ah + 0x01, ch);
	return <invalid>;
}

// 0C00:02AB: Register ui8 fn0C00_02AB(Register Eq_47 ah, Register out Eq_47 blOut)
// Called from:
//      fn0C00_0100
ui8 fn0C00_02AB(Eq_47 ah, union Eq_47 & blOut)
{
	Eq_47 ah = SLICE(ax, byte, 8);
	blOut = ah;
	return ah >> 0x01 << 0x01;
}

// 0C00:02B8: void fn0C00_02B8(Register Eq_47 ax, Register Eq_47 bp)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_02B8(Eq_47 ax, Eq_47 bp)
{
	word16 cx_11;
	word16 di_12 = 0x00;
	word16 si_13 = 0x00;
	for (cx_11 = 0x7D00; cx_11 != 0x00; --cx_11)
	{
		bp->*di_12 = ax->*si_13;
		++si_13;
		++di_12;
	}
}

// 0C00:02CA: Register byte fn0C00_02CA(Sequence (ptr32 Eq_398) gs_di, Register byte bl)
// Called from:
//      fn0C00_0251
//      fn0C00_0271
byte fn0C00_02CA(struct Eq_398 * gs_di, byte bl)
{
	uint16 dx_20 = (uint16) (uint8) (gs_di->b0002 + gs_di->bFFFFFFFF + gs_di->b0140 + gs_di->bFFFFFEC0);
	return (byte) (dx_20 >> 0x02) - bl;
}

// 0C00:02EE: Register (memptr Eq_47 byte) fn0C00_02EE(Register word16 cx, Register (memptr Eq_47 byte) di, Register Eq_47 es, Register Eq_47 fs)
// Called from:
//      fn0C00_0100
byte Eq_47::* fn0C00_02EE(word16 cx, byte Eq_47::* di, Eq_47 es, Eq_47 fs)
{
	do
	{
		if ((fs->*di & ~0x00) == 0x00)
			es->*di = ~0x00;
		++di;
		--cx;
	} while (cx != 0x00);
	return di;
}

