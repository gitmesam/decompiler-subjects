// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	bios_video_set_mode(0x13);
	byte Eq_17::* di_11 = &Eq_17::b0000;
	word16 cx_14;
	for (cx_14 = 0x0140; cx_14 != 0x00; --cx_14)
	{
		0xA000->*di_11 = 0x00;
		++di_11;
	}
	word16 cx_17;
	byte al_18 = 0x12;
	for (cx_17 = 63800; cx_17 != 0x00; --cx_17)
	{
		0xA000->*di_11 = 0x12;
		++di_11;
	}
	do
	{
		ds->w023A = 0x00;
		__syscall(22);
		if ((al_18 & 0x04) != 0x00)
			++ds->w023A;
		if ((al_18 & 0x08) != 0x00)
			--ds->w023A;
		Eq_58 bx_42 = ds->t0238;
		if (ds->t023C >= 0xE6)
		{
			Eq_58 ax_44 = ds->t023E;
			if (ax_44 - 0x05 >= bx_42)
			{
				if (ax_44 - 0x05 > bx_42)
					bx_42 = (word16) bx_42.u0 + 1;
			}
			else
				--bx_42;
		}
		ds->t0238 = fn0C00_029C(bx_42);
		Eq_58 bx_64 = fn0C00_029C((word16) ds->t0236 + ds->w023A);
		ds->t0236 = bx_64;
		if (ds->w0248 != 0x00)
			--ds->w0248;
		else
		{
			Eq_58 ax_73 = (word16) ds->t023E + ds->w0242;
			ds->t023E = ax_73;
			if (ax_73 == 0x02)
				ds->w0242 = 0x01;
			if (ax_73 == 0xC6)
				ds->w0242 = ~0x00;
			Eq_62 cx_87 = (word16) ds->t023C + ds->w0240;
			ds->t023C = cx_87;
			fn0C00_02AE(ax_73, cx_87, 0x01, bx_64, ds);
			fn0C00_02AE(ax_73, cx_87, 0x013E, ds->t0238, ds);
			if (cx_87 == 0x00)
				fn0C00_0275(ax_73, &Eq_2::w024C, ds);
			else if (cx_87 == 0x013F)
				fn0C00_0275(ax_73, &Eq_2::w024A, ds);
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		fn0C00_0250(ds->t0246, 0x0312, ds->t0244, 0xA000, ds);
		Eq_58 ax_160 = ds->t023E;
		ds->t0246 = ax_160;
		Eq_62 bx_162 = ds->t023C;
		ds->t0244 = bx_162;
		fn0C00_0250(ax_160, 0x030E, bx_162, 0xA000, ds);
		byte dh_249 = SLICE((uint16) (uint8) fn0C00_0260(ds->t0238, SEQ(SLICE((uint16) (uint8) fn0C00_0260(ds->t0236, 778, 0x01, 0xA000, ds), byte, 8), 0x0C), 0x013E, 0xA000, ds), byte, 8);
		Eq_62 bx_195 = 0x00;
		word16 cx_198;
		Eq_136 dx_250 = SEQ(dh_249, 0x0F);
		do
		{
			fn0C00_0250(0x00, dx_250, bx_195, 0xA000, ds);
			bx_195 = (word16) bx_195 + 2;
			--cx_198;
		} while (cx_198 != 0x00);
		Eq_62 bx_213 = 0x013F;
		word16 cx_215;
		do
		{
			fn0C00_0250(0x00, dx_250, bx_213, 0xA000, ds);
			bx_213 -= 0x02;
			--cx_215;
		} while (cx_215 != 0x00);
		byte ah_232;
	} while (bios_kbd_check_keystroke(out al_18, out ah_232));
	msdos_terminate_program20();
}

// 0C00:0250: void fn0C00_0250(Register Eq_58 ax, Register Eq_136 dl, Register Eq_62 bx, Register (ptr16 Eq_17) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_0260
void fn0C00_0250(Eq_58 ax, Eq_136 dl, Eq_62 bx, struct Eq_17 * es, struct Eq_2 * ds)
{
	es->*((word16) bx + (word16) (ds->w024E * ax)) = (byte) dx;
}

// 0C00:0260: Register byte fn0C00_0260(Register Eq_58 ax, Register Eq_136 dx, Register Eq_62 bx, Register (ptr16 Eq_17) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0260(Eq_58 ax, Eq_136 dx, Eq_62 bx, struct Eq_17 * es, struct Eq_2 * ds)
{
	word16 cx_16;
	for (cx_16 = 0x0A; cx_16 != 0x00; --cx_16)
	{
		fn0C00_0250(ax, dx, bx, es, ds);
		byte dh_19 = SLICE(dx, byte, 8);
		ax = (word16) ax + 1;
	}
	Eq_136 dx_20 = SEQ(dh_19, 0x12);
	fn0C00_0250(ax, dx_20, bx, es, ds);
	fn0C00_0250(ax - 11, dx_20, bx, es, ds);
	return dh_19;
}

// 0C00:0275: void fn0C00_0275(Register Eq_58 ax, Register (memptr (ptr16 Eq_2) ci16) bx, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0275(Eq_58 ax, ci16 Eq_2::* bx, struct Eq_2 * ds)
{
	if (ds->*bx < 0x50)
		++ds->*bx;
	Mem23[ds:0x023E:word16] = (SLICE(Mem16[ds:14033:word16] *u (ax + Mem16[ds:566:word16]), word16, 0) & 0x7F) + 0x24;
	ds->t023C.u0 = 0xA0;
	ds->w0248 = 0x1E;
}

// 0C00:029C: Register Eq_58 fn0C00_029C(Register Eq_58 bx)
// Called from:
//      fn0C00_0100
Eq_58 fn0C00_029C(Eq_58 bx)
{
	if (bx <= 0x02)
		bx.u0 = 0x02;
	if (bx >= 0xBD)
		bx.u0 = 0xBD;
	return bx;
}

// 0C00:02AE: void fn0C00_02AE(Register Eq_58 ax, Register Eq_62 cx, Register Eq_62 dx, Register Eq_58 bx, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
void fn0C00_02AE(Eq_58 ax, Eq_62 cx, Eq_62 dx, Eq_58 bx, struct Eq_2 * ds)
{
	if (cx == dx && (ax >= bx && ax < (word16) bx.u0 + 0x0A))
		ds->w0240 = -ds->w0240;
}

