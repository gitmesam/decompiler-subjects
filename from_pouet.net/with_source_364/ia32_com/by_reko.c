// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	bios_video_set_mode(0x03);
	__syscall(0x10);
	__syscall(0x10);
	byte ah_8;
	byte bh_9;
	if (bios_video_get_current_video_mode(out ah_8, out bh_9) != 0x07)
		ds->w013A = 0xB800;
	Eq_27 bx_345 = msdos_get_interrupt_vector(0x08);
	ds->t0501 = (word16) bx_345;
	ds->ptr0503 = SLICE(bx_345, selector, 16);
	byte Eq_2::* si_106 = fn0C00_033E(&ds->w013A + 438);
	uint16 bp_31 = 0x00;
	word16 cx_32;
	struct Eq_50 Eq_62::* di_107 = Eq_62::a0000;
	ui8 dl_108 = 0x00;
	for (cx_32 = 6000; cx_32 != 0x00; --cx_32)
	{
		(0xB000->*di_107).w0000 = 0x00;
		++di_107;
	}
	while (true)
	{
		byte bl_63 = (byte) bx_345;
		if (bp_31 == 0x20)
		{
			si_106 = &Eq_2::b05AD;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0000;
			dl_108 |= 0x08;
		}
		if (bp_31 == 0x60)
			dl_108 |= 0x04;
		Eq_27 bx_74 = bx_345;
		if (bp_31 == 0x80)
		{
			bx_74.u0 = (uint16) fn0C00_0362(bl_63 & ~0x01, 0xB000, ds);
			si_106 = &Eq_2::b05DC;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 = dl_108 ^ 0x04 | 0x88;
		}
		byte bl_90 = (byte) bx_74;
		Eq_27 bx_865 = bx_74;
		if (bp_31 == 0x0100)
		{
			bx_865.u0 = (uint16) fn0C00_0362(bl_90 | 0x01, 0xB000, ds);
			si_106 = &Eq_2::b0625;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 |= 0x08;
		}
		if (bp_31 == 0x011E)
			si_106 = &Eq_2::b0644;
		if (bp_31 == 0x0140)
			dl_108 = dl_108 ^ 0x84;
		Eq_27 bx_144 = bx_865;
		if (bp_31 == 0x0160)
		{
			ui8 dl_128 = dl_108 ^ 0x04;
			word16 Eq_62::* di_129 = Eq_62::a0FA0;
			word16 cx_130;
			for (cx_130 = 2000; cx_130 != 0x00; --cx_130)
			{
				0xB000->*di_129 = 0x00;
				++di_129;
			}
			bx_144.u0 = (uint16) fn0C00_0949(0x01AD, 0x0BB2, 0x1180, 0xB000, ds, out si_106, out di_107);
			dl_108 = dl_128 | 0x20;
		}
		byte bl_159 = (byte) bx_144;
		Eq_27 bx_177 = bx_144;
		if (bp_31 == 0x0180)
		{
			bx_177.u0 = (uint16) fn0C00_0362(bl_159 & ~0x01, 0xB000, ds);
			si_106 = &Eq_2::b065C;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 = dl_108 ^ 0x30 | 0x08;
		}
		byte bl_198 = (byte) bx_177;
		if (bp_31 == 464)
			si_106 = &Eq_2::b06DE;
		Eq_27 bx_208 = bx_177;
		if (bp_31 == 0x0200)
		{
			bx_208.u0 = (uint16) fn0C00_0362(bl_198 | 0x01, 0xB000, ds);
			si_106 = &Eq_2::b0625;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 |= 0x08;
		}
		if (bp_31 == 0x021E)
			si_106 = &Eq_2::b06AC;
		Eq_27 bx_257 = bx_208;
		if (bp_31 == 0x0280)
		{
			word16 Eq_62::* di_231 = Eq_62::a0000;
			word16 cx_234;
			for (cx_234 = 6000; cx_234 != 0x00; --cx_234)
			{
				0xB000->*di_231 = 0x20;
				++di_231;
			}
			word16 si_870;
			word16 di_871;
			fn0C00_0949(0xEB, 0x0AC7, 0x1CC0, 0xB000, ds, out si_870, out di_871);
			bx_257.u0 = (uint16) fn0C00_0949(161, 3665, 4000, 0xB000, ds, out si_106, out di_107);
			dl_108 = 0x40;
		}
		byte bl_267 = (byte) bx_257;
		Eq_27 bx_282 = bx_257;
		if (bp_31 == 0x02C0)
		{
			bx_282.u0 = (uint16) fn0C00_0362(bl_267 & ~0x01, 0xB000, ds);
			si_106 = &Eq_2::b070C;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 |= 0x08;
		}
		byte bl_301 = (byte) bx_282;
		Eq_27 bx_309 = bx_282;
		if (bp_31 == 0x0300)
		{
			bx_309.u0 = (uint16) fn0C00_0362(bl_301 | 0x01, 0xB000, ds);
			si_106 = &Eq_2::b0625;
			di_107 = (struct Eq_50 Eq_62::*) Eq_62::a0FA0;
			dl_108 |= 0x08;
		}
		if (bp_31 == 0x031E)
			si_106 = &Eq_2::b0739;
		bx_345 = bx_309;
		if (bp_31 == 0x0340)
		{
			word16 Eq_62::* di_330 = Eq_62::a0FA0;
			word16 cx_331;
			for (cx_331 = 2000; cx_331 != 0x00; --cx_331)
			{
				0xB000->*di_330 = 0x00;
				++di_330;
			}
			bx_345.u0 = (uint16) fn0C00_0949(242, 3423, 0x1180, 0xB000, ds, out si_106, out di_107);
			dl_108 = 0x20;
		}
		if (bp_31 == 0x0360)
			dl_108 = 0x11;
		if (bp_31 == 0x0380)
		{
			di_107 = &Eq_62::t08C0;
			si_106 = &Eq_2::b0758;
			dl_108 |= 0x0A;
		}
		if (bp_31 == 0x0440)
		{
			di_107 = &Eq_62::t0DC0;
			si_106 = &Eq_2::b0905;
			dl_108 |= 0x08;
		}
		if (bp_31 == 0x0480)
			dl_108 = ~0x00;
		if (dl_108 == ~0x00)
			break;
		if ((dl_108 & 0x08) != 0x00)
		{
			word16 cx_390 = 0x01;
			if ((dl_108 & 0x02) != 0x00)
			{
				cx_390 = 0x03;
				if ((bp_31 & 0x03) == 0x00)
					cx_390 = 0x02;
			}
			do
			{
				byte al_404 = ds->*si_106;
				++si_106;
				if (al_404 == 0x00)
					dl_108 = dl_108 ^ 0x08;
				(0xB000->*di_107).w0000 = SEQ(0x0E, al_404);
				++di_107;
				--cx_390;
			} while (cx_390 != 0x00);
			(0xB000->*di_107).bFFFFFFFD = 0x0F;
			(0xB000->*di_107).bFFFFFFFB = 0x07;
			(0xB000->*di_107).bFFFFFFF7 = 0x0E;
			(0xB000->*di_107).bFFFFFFF5 = 0x0C;
			(0xB000->*di_107).bFFFFFFF1 = 0x0E;
		}
		if ((dl_108 & 0x20) != 0x00)
		{
			int16 ax_578 = (int16) (byte) (bp_31 << 0x03);
			uint16 ax_583 = (uint16) ((byte) ax_578 ^ SLICE(ax_578, byte, 8));
			ui16 ax_588 = ax_583 * 0x08 + ax_583 * 0x04;
			uint16 bx_591 = (ax_588 & ~0x3F) >> 0x01;
			cui16 ax_593 = (ax_588 & ~0x3F) + (bx_591 >> 0x01);
			word16 Eq_62::* di_569 = Eq_62::a0000;
			word16 Eq_62::* si_595 = 4000 - ax_593 - ax_593;
			word16 cx_597;
			for (cx_597 = 2000; cx_597 != 0x00; --cx_597)
			{
				0xB000->*di_569 = 0xB000->*si_595;
				++si_595;
				++di_569;
			}
			bx_345 = bx_591 >> 0x01;
		}
		while (bp_31 >= ds->w04AB)
		{
			if ((0000:0417 & 0x07) != 0x00)
				goto l0C00_033A;
			bx_345.u0 = <invalid>;
			byte bl_872;
			dl_108 = (byte) (uint16) fn0C00_038D(dl_108, bp_31, 0xB000, out bl_872, out di_107);
		}
		++bp_31;
	}
l0C00_033A:
	Eq_33 ds_dx_673 = ds->t0501;
	fn0C00_033E(ds_dx_673);
}

// 0C00:033E: Register (memptr (ptr16 Eq_482) byte) fn0C00_033E(Sequence Eq_33 ds_dx)
// Called from:
//      fn0C00_0100
byte Eq_482::* fn0C00_033E(Eq_33 ds_dx)
{
	__cli();
	msdos_set_interrupt_vector(0x08, ds_dx);
	word16 ax_10 = 244;
	do
	{
		fn0C00_0505(ax_10);
		--ax_10;
		byte al_28 = (byte) ax_10;
	} while (ax_10 != 0x00);
	byte Eq_482::* si_17 = Eq_482::a08FD;
	do
	{
		++si_17;
		word16 ax_23 = SEQ(0x0C00->*si_17, al_28);
		do
		{
			fn0C00_0505(ax_23);
			++ax_23;
			al_28 = (byte) ax_23;
		} while ((al_28 & 0x1F) != 0x00);
	} while (al_28 != 0x00);
	__sti();
	return si_17;
}

// 0C00:0362: Register byte fn0C00_0362(Register byte bl, Register (ptr16 Eq_62) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0362(byte bl, struct Eq_62 * es, struct Eq_2 * ds)
{
	word16 Eq_62::* di_10 = Eq_62::a0FA0;
	word16 cx_42;
	for (cx_42 = 0xA0; cx_42 != 0x00; --cx_42)
	{
		es->*di_10 = 0x00;
		++di_10;
	}
	word16 cx_17;
	Eq_137 si_16;
	Eq_138 di_11 = di_10 + 730;
	if ((bl & 0x01) == 0x00)
	{
		&si_16.u0->b0000 = 0x099B;
		cx_17 = 0x5F;
	}
	else
	{
		&si_16.u0->b0000 = 2554;
		cx_17 = 0xCD;
		di_11 = (word16) di_11 + 70;
	}
	word16 di_51;
	word16 si_50;
	return (byte) (uint16) fn0C00_0949(cx_17, si_16, di_11, es, ds, out si_50, out di_51);
}

// 0C00:038D: Register ui8 fn0C00_038D(Register ui8 dl, Register uint16 bp, Register (ptr16 Eq_62) es, Register out Eq_27 blOut, Register out Eq_438 diOut)
// Called from:
//      fn0C00_0100
ui8 fn0C00_038D(ui8 dl, uint16 bp, struct Eq_62 * es, union Eq_27 & blOut, union Eq_438 & diOut)
{
	if ((dl & 0x04) != 0x00)
	{
		di.u0 = 0x00;
		word16 cx_17 = 2000;
		word16 ax_10 = 177;
		if ((bp & 0x01) == 0x00)
			ax_10 = SEQ(~0x00, 177);
		for (; cx_17 != 0x00; --cx_17)
		{
			es->*di.u0 = ax_10;
			++di.u0;
		}
	}
	if ((dl & 0x40) != 0x00)
	{
		word16 Eq_62::* di_364 = Eq_62::a0000;
		Eq_557 si_357 = 4000;
		uint16 bx_63 = (uint16) (uint8) (bp % 0x50);
		for (dh = 0x19; dh != 0x00; --dh)
		{
			uint16 cx_68;
			for (cx_68 = 0x50; cx_68 != 0x00; --cx_68)
			{
				word16 ax_72 = es->*si_357;
				byte ah_77 = SLICE(ax_72, byte, 8);
				si_357 = (word16) si_357 + 2;
				if ((byte) ax_72 == 0x20 && (ah_77 & 0xF0) == 0x00)
				{
					if (cx_68 >= bx_63)
						ax_72 = es->*((word16) si_357 + ((word16) (bx_63 * 0x02) + 3998));
					else
						ax_72 = es->*((word16) si_357 + ((word16) (bx_63 * 0x02) + 0x0EFE));
				}
				es->*di_364 = ax_72;
				++di_364;
			}
		}
	}
	if ((dl & 0x80) != 0x00)
	{
		word16 Eq_62::* si_140 = Eq_62::a0FA0;
		Eq_602 di_141 = 0x00;
		byte bh_153 = 0x00;
		for (dh = 0x19; dh != 0x00; --dh)
		{
			int16 ax_160 = (int16) (byte) (SEQ(SLICE(bp * 0x04, byte, 8), (byte) (bp * 0x04) + dh + bh_153) * 0x04);
			uint8 al_163 = (byte) ax_160 ^ SLICE(ax_160, byte, 8);
			uint16 ax_168 = (uint16) (al_163 - (al_163 >> 0x01));
			uint16 ax_169 = ax_168 + 0x08;
			Eq_607 bx_182 = SEQ(bh_153, bh_153 + dh + (byte) bp & 0x19);
			if (ax_168 >= 0x48)
				ax_169 = 0x50;
			Eq_607 bx_211 = SEQ(bh_153, ~(bh_153 + dh + (byte) bp) & 0x19);
			Eq_615 dx_221 = SEQ(dh, dl);
			Eq_602 di_192;
			si_140 = fn0C00_0EF2(0x50 - ax_169, bx_211, fn0C00_0EF2(ax_169, bx_182, si_140, di_141, es, es, out di_192), di_192, es, es, out di_141);
			bh_153 = SLICE(bx_211 + dx_221 + dx_221, byte, 8);
		}
	}
	word16 dx_456 = SEQ(dh, dl);
	if ((dl & 0x10) != 0x00)
	{
		word16 Eq_62::* di_260 = Eq_62::a0000;
		word16 Eq_62::* si_261 = Eq_62::a0FA0;
		cui16 cx_262 = 2000;
		byte ch_375 = 0x07;
		word16 dx_272 = SEQ(dh, dl);
		if ((dl & 0x01) == 0x00)
		{
			do
			{
				word16 ax_318 = es->*si_261;
				++si_261;
				es->*di_260 = SEQ(SLICE(ax_318, byte, 8) | (byte) (((si_261 + bp | cx_262) + bp) * 0x02) & 0x1B, (byte) ax_318);
				++di_260;
				--cx_262;
			} while (cx_262 != 0x00);
		}
		else
		{
			struct Eq_659 Eq_62::* di_274 = &Eq_62::t0001;
			word16 dx_275 = 0x4E;
			do
			{
				ui16 ax_278 = bp * 0x02;
				word16 bx_281 = dx_275;
				word16 cx_307 = SEQ(ch_375, 0x50);
				do
				{
					ui16 ax_287 = ax_278 + bx_281 + bp;
					(es->*di_274).b0000 = SLICE(ax_287, byte, 8) & 0x19 ^ 0x0F;
					--cx_307;
					byte dl_309 = (byte) dx_275;
					byte dh_369 = SLICE(dx_275, byte, 8);
					bx_281 += dx_275;
					ax_278 = ax_287;
					++di_274;
					ch_375 = SLICE(cx_307, byte, 8);
				} while (cx_307 != 0x00);
				dx_275 = SEQ(dh_369, dl_309 - 0x03);
			} while (dl_309 != 0x03);
		}
		dx_456 = dx_272;
	}
	blOut.u0 = <invalid>;
	diOut = di;
	return (byte) dx_456;
}

// 0C00:0505: void fn0C00_0505(Register word16 ax)
// Called from:
//      fn0C00_033E
void fn0C00_0505(word16 ax)
{
	byte al_15 = (byte) ax;
	byte ah_22 = SLICE(ax, byte, 8);
	__outb(0x0388, al_15);
	word16 cx_16 = 0x06;
	do
	{
		__inb(0x0388);
		--cx_16;
		byte ch_44 = SLICE(cx_16, byte, 8);
	} while (cx_16 != 0x00);
	__outb(0x0389, ah_22);
	word16 cx_30 = SEQ(ch_44, 0x23);
	do
	{
		__inb(0x0388);
		--cx_30;
	} while (cx_30 != 0x00);
}

// 0C00:0949: Register byte fn0C00_0949(Register word16 cx, Register Eq_137 si, Register Eq_138 di, Register (ptr16 Eq_62) es, Register (ptr16 Eq_2) ds, Register out Eq_137 siOut, Register out Eq_138 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0362
byte fn0C00_0949(word16 cx, Eq_137 si, Eq_138 di, struct Eq_62 * es, struct Eq_2 * ds, union Eq_137 & siOut, union Eq_138 & diOut)
{
	Eq_138 dx_105 = di;
	byte ah_115 = 0x00;
	do
	{
		word16 ax_166;
		uint8 al_16 = ds->*si;
		si = (word16) si + 1;
		word16 ax_74 = SEQ(ah_115, al_16);
		if (al_16 >= 0x20)
		{
			es->*di = ax_74;
			di = (word16) di + 2;
			ax_166 = SEQ(ah_115, al_16);
		}
		else if (al_16 < 0x10)
			ax_166 = SEQ(ah_115 & 0xF0 | al_16, al_16);
		else if (al_16 != 0x18)
		{
			if (al_16 >= 0x18)
			{
				bx = cx;
				byte al_32 = ds->*si;
				si = (word16) si + 1;
				word16 ax_110 = SEQ(ah_115, 0x20);
				if (al_16 != 0x19)
				{
					si = (word16) si + 2;
					bx = cx - 0x01;
					ax_110 = SEQ(ah_115, ds->*((word16) si + 1));
				}
				ah_115 = SLICE(ax_110, byte, 8);
				uint16 cx_45;
				for (cx_45 = (uint16) al_32 + 0x01; cx_45 != 0x00; --cx_45)
				{
					es->*di = ax_110;
					di = (word16) di + 2;
				}
				word16 cx_50 = bx - 0x01;
				cx = cx_50 - 0x01;
				if (cx_50 == 0x00 || cx_50 == 0x01)
					break;
				continue;
			}
			ui8 al_63 = (al_16 - 0x10) * 0x02;
			ax_166 = SEQ(ah_115 & ~0x70 | al_63 * 0x08, al_63 * 0x08);
		}
		else
		{
			dx_105 = (word16) dx_105 + 0x00A0;
			di = dx_105;
			ax_166 = SEQ(ah_115, al_16);
		}
		ah_115 = SLICE(ax_166, byte, 8);
		--cx;
	} while (cx != 0x00);
	siOut = si;
	diOut = di;
	return (byte) bx;
}

// 0C00:0EF2: Register (memptr (ptr16 Eq_62) word16) fn0C00_0EF2(Register uint16 cx, Register Eq_607 bl, Register (memptr (ptr16 Eq_62) word16) si, Register Eq_602 di, Register (ptr16 Eq_62) es, Register (ptr16 Eq_62) ds, Register out Eq_602 diOut)
// Called from:
//      fn0C00_038D
word16 Eq_62::* fn0C00_0EF2(uint16 cx, Eq_607 bl, word16 Eq_62::* si, Eq_602 di, struct Eq_62 * es, struct Eq_62 * ds, union Eq_602 & diOut)
{
	byte bl_38 = (byte) bx;
	for (; cx != 0x00; --cx)
	{
		word16 ax_15 = ds->*si;
		es->*di = SEQ(SLICE(ax_15, byte, 8) | bl_38, (byte) ax_15);
		++si;
		di = (word16) di + 2;
	}
	diOut = di;
	return si;
}

