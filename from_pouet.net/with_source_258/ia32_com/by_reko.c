// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register word16 cx, Register word16 si, Register (ptr16 Eq_4) ds)
void fn0C00_0100(word16 cx, word16 si, struct Eq_4 * ds)
{
	bios_video_set_mode(0x13);
	cui16 ax_16 = 0x86;
	do
	{
		fn0C00_01E3();
		byte Eq_16::* di_196 = Eq_16::a0000;
		--cx;
		byte al_248 = (byte) (ax_303 - 0x01);
		while (true)
		{
			ax_16 = ax_303 - 0x01;
			byte ch_223 = SLICE(cx, byte, 8);
			if (cx == 0x00)
				break;
			0xA000->*di_196 = al_248;
			++di_196;
			--cx;
		}
		ax_303 = ax_16;
	} while (ax_303 != 0x01);
	word16 dx_31 = 0x01;
	Eq_40 bx_32 = 0x0140;
	Eq_42 cx_300 = SEQ(ch_223, 0x09);
	do
	{
		if (((byte) cx_300 & 0x0D) != 0x00 && !P)
			si = 0x01EC;
		word16 cx_60 = fn0C00_01A1(si, cx_300, dx_31, bx_32, 0xA000, out dx_31, out bx_32, out si, out ds);
		cx_300 = cx_60 - 0x01;
	} while (cx_60 != 0x01);
	do
	{
		fn0C00_01E3();
		word32 eax_82 = (word32) (ds->dw0200 * ~0x21520F52);
		ds->dw0200 = eax_82 + 0x01;
		0xA000->a0003[(word16) SLICE(eax_82 + 0x01, byte, 8)] = (byte) (eax_82 + 0x01) & 0x1F | 0x1C;
		struct Eq_99 Eq_16::* bx_163 = Eq_16::a0000;
		do
		{
			struct Eq_99 Eq_16::* bx_99 = bx_163 - 0x01;
			if ((0xA000->*bx_99).b0000 != 0x00)
			{
				struct Eq_99 Eq_16::* bx_121;
				cu8 al_150;
				cu8 v24_106 = (0xA000->*bx_99).b0000;
				(0xA000->*bx_99).b0000 = 0x00;
				if (v24_106 < 0x20)
				{
					bx_121 = &bx_99->b0000 + 320;
					if (((byte) (&bx_99->b0000 + 320) & 0xC0) == 0x00 && !P)
						bx_121 = &bx_99->b0000 + 0x0141;
					al_150 = v24_106;
					if ((0xA000->*bx_121).b0000 >= 0x01)
					{
						bx_121 = &bx_121->b0000 + 1;
						if ((0xA000->*bx_121).b0000 >= 0x01)
						{
							bx_121 -= 0x02;
							if ((0xA000->*bx_121).bFFFFFFFE >= 0x01)
								bx_121 = bx_99;
						}
					}
				}
				else
				{
					word16 ax_115 = SEQ(0x01, v24_106);
					if (v24_106 == 0x20)
						ax_115 = SEQ(0x01, v24_106 + 0x18);
					al_150 = (byte) (ax_115 - 0x01);
					bx_121 = bx_99;
				}
				(0xA000->*bx_121).b0000 = al_150;
			}
			bx_163 = bx_99;
		} while (bx_99 != Eq_16::a0000);
		ds = cs;
		byte al_189;
		byte ah_190;
	} while (bios_kbd_check_keystroke(out al_189, out ah_190));
	bios_video_set_mode(0x03);
	__syscall(22);
}

// 0C00:01A1: Register Eq_42 fn0C00_01A1(Sequence (ptr32 word16) ds_si, Register Eq_42 cx, Register word16 dx, Register Eq_40 bx, Register word16 bp, Register out ptr16 dxOut, Register out ptr16 bxOut, Register out ptr16 siOut, Register out (ptr16 Eq_56) dsOut)
// Called from:
//      fn0C00_0100
Eq_42 fn0C00_01A1(word16 * ds_si, Eq_42 cx, word16 dx, Eq_40 bx, word16 bp, ptr16 & dxOut, ptr16 & bxOut, ptr16 & siOut, struct Eq_56 & dsOut)
{
	struct Eq_186 * ds = SLICE(ds_si, selector, 16);
	word16 si = (word16) ds_si;
	*ds_si += 100;
	Eq_40 bx_27;
	word16 di_29;
	struct Eq_200 * ds_30;
	word16 dx_31;
	word16 si_60;
	Eq_42 cx_28 = fn0C00_01AB(SEQ(bp, *ds_si), si + 2, cx, dx, bx, out dx_31, out bx_27, out si_60, out di_29, out ds_30);
	ptr16 bx_43;
	struct Eq_56 * ds_46;
	ptr16 dx_47;
	ptr16 si_48;
	word16 di_61;
	Eq_42 cx_44 = fn0C00_01AB(SEQ(bp, di_29), wLoc04, cx_28, dx_31, bx_27, out dx_47, out bx_43, out si_48, out di_61, out ds_46);
	dxOut = dx_47;
	bxOut = bx_43;
	siOut = si_48;
	dsOut = ds_46;
	return cx_44;
}

// 0C00:01AB: Register Eq_42 fn0C00_01AB(Sequence Eq_206 bp_di, Sequence (ptr32 byte) ds_si, Register Eq_42 cx, Register word16 dx, Register Eq_40 bx, Register out ptr16 dxOut, Register out ptr16 bxOut, Register out ptr16 siOut, Register out ptr16 diOut, Register out (ptr16 Eq_215) dsOut)
// Called from:
//      fn0C00_01A1
Eq_42 fn0C00_01AB(Eq_206 bp_di, byte * ds_si, Eq_42 cx, word16 dx, Eq_40 bx, ptr16 & dxOut, ptr16 & bxOut, ptr16 & siOut, ptr16 & diOut, struct Eq_215 & dsOut)
{
	word16 bp = SLICE(bp_di, word16, 16);
	Eq_40 bx_16;
	word16 di_18;
	word16 dx_20;
	word16 si_49;
	struct Eq_251 * ds_50;
	Eq_42 cx_17 = fn0C00_01AE(bp_di, ds_si, cx, dx, bx, out dx_20, out bx_16, out si_49, out di_18, out ds_50);
	word32 ds_si_43 = <invalid>;
	ptr16 bx_30;
	ptr16 di_32;
	struct Eq_215 * ds_33;
	ptr16 dx_34;
	ptr16 si_35;
	Eq_42 cx_31 = fn0C00_01AE(SEQ(bp, di_18), ds_si_43, cx_17, dx_20, bx_16, out dx_34, out bx_30, out si_35, out di_32, out ds_33);
	dxOut = dx_34;
	bxOut = bx_30;
	siOut = si_35;
	diOut = di_32;
	dsOut = ds_33;
	return cx_31;
}

// 0C00:01AE: Register word16 fn0C00_01AE(Sequence Eq_206 bp_di, Sequence (ptr32 byte) ds_si, Register Eq_42 ch, Register word16 dx, Register Eq_40 bx, Register out Eq_40 dxOut, Register out ptr16 bxOut, Register out ptr16 siOut, Register out Eq_263 diOut, Register out (ptr16 Eq_264) dsOut)
// Called from:
//      fn0C00_01AB
word16 fn0C00_01AE(Eq_206 bp_di, byte * ds_si, Eq_42 ch, word16 dx, Eq_40 bx, union Eq_40 & dxOut, ptr16 & bxOut, ptr16 & siOut, union Eq_263 & diOut, struct Eq_264 & dsOut)
{
	byte ch_15 = SLICE(cx, byte, 8);
	byte ch_90 = SLICE(cx, byte, 8);
	word16 si = (word16) ds_si;
	struct Eq_294 * bp = SLICE(bp_di, word16, 16);
	byte al_10 = *ds_si;
	word16 cx_62 = SEQ(ch_90, al_10);
	if (al_10 == 0x3C)
		cx_62 = SEQ(ch_15 + 0x01, al_10);
	Eq_263 di_37 = fn0C00_01DC(fn0C00_01DE(bp_di, 0x20, dx), 0x35, 0x20, dx, bx);
	struct Eq_323 Eq_358::* sp_43 = fp + ~0x03;
	do
	{
		word16 di_46 = di_37 + bx;
		bp->*((word16) bx + di_46) = 0x34;
		di_37 = fn0C00_01DC(di_46 - bx, 0x35, 0x20, dx, bx);
		sp_43 += 0x00007FFF;
		--cx_62;
	} while (cx_62 != 0x00);
	Eq_263 di_65 = fn0C00_01DC(di_37, 0x35, 0x20, dx, bx);
	bp->*di_65 = 0x20;
	(ss->*sp_43).ptrFFFFFFFC = cs;
	struct Eq_264 * ds_85 = (ss->*sp_43).ptrFFFFFFFC;
	word16 cx_87 = (ss->*sp_43).wFFFFFFFE;
	dxOut = bx;
	bxOut = -dx;
	siOut = si + 1;
	diOut = di_65;
	dsOut = ds_85;
	return cx_87;
}

// 0C00:01DC: Register word16 fn0C00_01DC(Sequence Eq_206 ds_di, Register byte ah, Register byte al, Register word16 dx, Register Eq_40 bx)
// Called from:
//      fn0C00_01AE
word16 fn0C00_01DC(Eq_206 ds_di, byte ah, byte al, word16 dx, Eq_40 bx)
{
	Mem8[bx + ds_di:byte] = ah;
	return fn0C00_01DE(ds_di, al, dx);
}

// 0C00:01DE: Register word16 fn0C00_01DE(Sequence Eq_206 ds_di, Register byte al, Register word16 dx)
// Called from:
//      fn0C00_01AE
//      fn0C00_01DC
word16 fn0C00_01DE(Eq_206 ds_di, byte al, word16 dx)
{
	word16 di = (word16) ds_di;
	*ds_di = al;
	return di + dx;
}

// 0C00:01E3: void fn0C00_01E3()
// Called from:
//      fn0C00_0100
void fn0C00_01E3()
{
	do
		;
	while ((__inb(0x03DA) & 0x08) == 0x00);
}

