// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	Eq_3 Top_111 = 0;
	bios_video_set_mode(0x13);
	byte ah_14 = 0x00;
	ui16 cx_11;
	for (cx_11 = 0x0800; cx_11 != 0x00; --cx_11)
	{
		word16 si_253;
		ah_14 = SLICE((uint16) (uint8) fn0C00_021B(ah_14, cx_11, ds, out si_253), byte, 8);
	}
	while (true)
	{
		ui16 cx_129;
		for (cx_129 = 0x0800; cx_129 != 0x00; --cx_129)
		{
			ds->t6301.u0 = 0x00;
			Eq_66 si_27 = cx_129 << 0x01;
			byte ah_53 = SLICE((uint16) (uint8) fn0C00_0277(si_27, 0xA000, ds), byte, 8);
			if (ds->b02F6 < 0x04)
			{
				Eq_36 v12_46 = ds->a22F7[cx_129] - 0x01;
				ds->a22F7[cx_129] = v12_46;
				if (v12_46 == 0x00)
					goto l0C00_013B;
			}
			else
			{
				ds->a22F7[cx_129] = (word16) ds->a22F7[cx_129] + 1;
				if (ds->a22F7[cx_129] >= 200)
				{
l0C00_013B:
					fn0C00_021B(ah_53, cx_129, ds, out si_27);
				}
			}
			if (ds->*((word16) si_27 + 0x000032F7) != 0x28)
				(ds->*((word16) si_27 + 0x000032F7)).u0 = (byte) (ds->*((word16) si_27 + 0x000032F7)).u0 + 1;
			ds->t6301 = ds->*((word16) si_27 + 0x000032F7);
			__fninit();
			struct Eq_84 * Top_91 = Top_111 - 1;
			Top_91->r0000 = 3.14159265358979;
			Top_91->r0000 *= (real64) ds->w02F4;
			Top_91->r0000 /= (real64) ds->w02F2;
			real64 v19_95 = Top_91->r0000;
			Top_91->r0000 = cos(v19_95);
			Top_91->rFFFFFFFF = sin(v19_95);
			Top_91->rFFFFFFFE = Top_91->rFFFFFFFF;
			Top_91->rFFFFFFFE *= (real64) (ds->*((word16) si_27 + 4855));
			Top_91->rFFFFFFFD = Top_91->rFFFFFFFE;
			Top_91->rFFFFFFFD *= (real64) (ds->*((word16) si_27 + 759));
			Top_91->rFFFFFFFD -= Top_91->rFFFFFFFE;
			ds->*((word16) si_27 + 17143) = (int16) Top_91->rFFFFFFFD;
			real64 v20_107 = Top_91->rFFFFFFFD;
			Top_91->rFFFFFFFD = Top_91->rFFFFFFFF;
			Top_91->rFFFFFFFF = v20_107;
			Top_91->rFFFFFFFD *= (real64) (ds->*((word16) si_27 + 4855));
			Top_91->rFFFFFFFC = Top_91->rFFFFFFFF;
			Top_91->rFFFFFFFC *= (real64) (ds->*((word16) si_27 + 759));
			Top_91->rFFFFFFFC += Top_91->rFFFFFFFD;
			ds->*((word16) si_27 + 21239) = (int16) Top_91->rFFFFFFFC;
			fn0C00_0277(si_27, 0xA000, ds);
			Top_111 = Top_91 - 4;
		}
		if (ds->b02F6 != 0x02 && ds->b02F6 != 0x03)
		{
			if (ds->b02F6 >= 0x06)
			{
				--ds->w02F4;
				if (ds->w02F4 == ~0x00)
					ds->w02F4 = 0x0168;
			}
		}
		else
		{
			++ds->w02F4;
			if (ds->w02F4 >= 0x0169)
				ds->w02F4 = 0x01;
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		byte al_160;
		byte ah_161;
		if (!bios_kbd_check_keystroke(out al_160, out ah_161))
		{
			byte al_163;
			bios_kbd_get_keystroke(out al_163);
			if (al_163 == 0x1B)
			{
				bios_video_set_mode(0x03);
				return;
			}
			++ds->b02F6;
			if (ds->b02F6 >= 0x02)
			{
				word16 cx_179;
				word16 Eq_241::* di_180 = Eq_241::a0000;
				for (cx_179 = 0x7D00; cx_179 != 0x00; --cx_179)
				{
					0xA000->*di_180 = 0x00;
					++di_180;
				}
				if (ds->b02F6 >= 0x08)
					ds->b02F6 = 0x00;
			}
		}
	}
}

// 0C00:0208: Register byte fn0C00_0208(Register byte ah, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_021B
byte fn0C00_0208(byte ah, struct Eq_2 * ds)
{
	byte ah_6 = ah + __inb(0x40);
	byte al_7 = __inb(0x40);
	Eq_36 bx_11 = ds->t6302;
	Eq_393 dx_ax_13 = (uint32) (uint16) SEQ(ah_6, al_7);
	ds->t6302.u0 = (int16) (dx_ax_13 % bx_11);
	return SLICE((int16) (dx_ax_13 / bx_11), byte, 8);
}

// 0C00:021B: Register byte fn0C00_021B(Register byte ah, Register ui16 cx, Register (ptr16 Eq_2) ds, Register out Eq_20 siOut)
// Called from:
//      fn0C00_0100
byte fn0C00_021B(byte ah, ui16 cx, struct Eq_2 * ds, union Eq_20 & siOut)
{
	(&ds->a32F7->b0000)[cx * 0x02] = 0x10;
	ds->t6302.u0 = 0xA0;
	byte ah_32 = SLICE((uint16) (uint8) fn0C00_0208(ah, ds), byte, 8);
	ds->t6302 -= 0x50;
	ds->a02F7[cx] = ds->t6302;
	ds->t6302.u0 = 100;
	byte ah_49 = SLICE((uint16) (uint8) fn0C00_0208(ah_32, ds), byte, 8);
	ds->t6302 -= 0x32;
	ds->a12F7[cx] = ds->t6302;
	ds->t6302.u0 = 100;
	uint16 ax_50 = (uint16) (uint8) fn0C00_0208(ah_49, ds);
	ds->t6302 = (word16) ds->t6302 + 100;
	byte ah_62 = SLICE(ax_50, byte, 8);
	if (ds->b02F6 >= 0x04)
	{
		ds->t6302.u0 = 0x0F;
		ax_50 = (uint16) (uint8) fn0C00_0208(ah_62, ds);
	}
	ds->a22F7[cx] = ds->t6302;
	siOut = cx << 0x01;
	return SLICE(ax_50, byte, 8);
}

// 0C00:0277: Register byte fn0C00_0277(Register Eq_66 si, Register (ptr16 Eq_241) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0277(Eq_66 si, struct Eq_241 * es, struct Eq_2 * ds)
{
	if (ds->*((word16) si + 0x000022F7) == 0x00)
		++ds->*((word16) si + 0x000022F7);
	ds->t62FD = (int16) (ds->*((word16) si + 17143) *s 100 / ds->*((word16) si + 0x000022F7)) + 0xA0;
	ds->t62FF = (int16) (ds->*((word16) si + 21239) *s 100 / ds->*((word16) si + 0x000022F7)) + 100;
	struct Eq_523 Eq_241::* ax_39 = (word16) ds->t62FD + (word16) (ds->t62FF *s 0x0140);
	byte ah_67 = SLICE(ax_39, byte, 8);
	if (ds->t62FD <= 0x013F && ds->t62FF <= 199)
	{
		Eq_69 al_45 = ds->t6301;
		(es->*ax_39).t0000 = al_45;
		ax_39 = SEQ(ah_67, al_45);
		if (ds->b02F6 != 0x00)
		{
			ax_39 = SEQ(ah_67, al_45);
			if (ds->b02F6 != 0x03)
			{
				ax_39 = SEQ(ah_67, al_45);
				if (ds->b02F6 != 0x04)
				{
					ax_39 = SEQ(ah_67, al_45);
					if (ds->b02F6 != 0x07)
					{
						(es->*ax_39).t0001 = al_45;
						(es->*ax_39).t0140 = al_45;
						(es->*ax_39).t0141 = al_45;
						ax_39 = SEQ(ah_67, al_45);
					}
				}
			}
		}
	}
	return SLICE(ax_39, byte, 8);
}

