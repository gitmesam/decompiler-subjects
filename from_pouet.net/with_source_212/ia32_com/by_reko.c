// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register word16 bp, Register (ptr16 Eq_4) ds)
void fn0C00_0100(byte ch, word16 bp, struct Eq_4 * ds)
{
	__syscall(0x10);
	__outb(0x03D4, 0x09);
	__outb(0x03D5, 0x00);
	__outb(0x03CE, 0x06);
	__outb(0x03CF, 0x01);
	__outb(0x03C8, 0x00);
	word16 ax_19 = 0x00;
	do
	{
		word16 cx_311 = SEQ(ch, 0x03);
		do
		{
			byte al_53 = (byte) ax_19;
			uint8 cl_58 = (byte) (cx_475 - 0x01);
			if ((al_53 & 0x40) != 0x00)
			{
				al_53 &= 0x3F;
				cl_58 = cl_58 >> 0x01 ^ 0x01;
			}
			uint8 al_65 = al_53 << cl_58;
			uint8 al_66 = al_65 >> 0x01;
			if (al_65 >> 0x01 > 0x3F)
				al_66 = 0x3F;
			__outb(969, al_66);
			word16 bp_278 = bp;
			ci8 al_95 = (byte) ax_19;
			byte ah_304 = SLICE(ax_19, byte, 8);
			cx_311 = cx_475 - 0x01;
			ch = SLICE(cx_475 - 0x01, byte, 8);
			cx_475 = cx_311;
		} while (cx_475 != 0x01);
		ax_19 = SEQ(ah_304, al_95 + 0x01);
	} while (al_95 >= 0x01);
	struct Eq_83 Eq_4::* di_105 = &Eq_4::t0000;
	real64 rLoc2_390 = (real64) ds->w01F8;
	word16 cx_169 = SEQ(ch, 200);
	do
	{
		real64 rLoc3_391 = (real64) ds->w01F6;
		word16 dx_127;
		for (dx_127 = 0x0140; dx_127 != 0x00; --dx_127)
		{
			real64 rLoc4_401 = sqrt(rLoc2_390 * rLoc2_390 + rLoc3_391 * rLoc3_391) / (real64) ds->w01F6 + (real64) ds->r01F2;
			(0x7000->*di_105).w0000 = (int16) (rLoc3_391 / rLoc4_401 + rLoc3_391);
			di_105[504] = (int16) (rLoc2_390 / rLoc4_401 + rLoc2_390);
			rLoc3_391 += 1.0;
			++di_105;
		}
		rLoc2_390 += 1.0;
		--cx_169;
	} while (cx_169 != 0x00);
	do
	{
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		struct Eq_150 * es_184 = 0xA000;
		struct Eq_152 Eq_4::* si_193 = &Eq_4::t0000;
		cu16 cx_469 = 400;
		uint8 * gs_di_472 = 8000:0000;
		do
		{
			cui16 dx_272 = 0x0140;
			uint8 * gs_di_465 = gs_di_472;
			if (((byte) cx_476 & 0x01) != 0x00)
			{
				si_193 -= 0x0140;
				dx_272 = 0x0140;
				gs_di_465 = gs_di_472;
			}
			do
			{
				word16 ax_212 = SEQ((ds->*si_193).b01F8, (0x7000->*si_193).b0000) + bp_278;
				byte ah_214 = SLICE(ax_212, byte, 8);
				uint8 Eq_150::* di_238 = (word16) gs_di_465;
				struct Eq_172 * gs_235 = SLICE(gs_di_465, selector, 16);
				byte dl_224 = (byte) dx_272;
				uint8 al_216 = ((byte) ax_212 | ah_214) >> 0x01;
				if ((cx_476 >= 0x018D || cx_476 <= 0x04) && (dl_224 & 0x04) == 0x00)
				{
					al_216 = 0x00;
					ah_214 = 0x00;
				}
				*gs_di_465 = al_216;
				es_184->*di_238 = al_216;
				if (di_238 == &Eq_150::b0001)
				{
					es_184 = 0xB000;
					gs_235 = 0x9000;
				}
				--dx_272;
				si_193 = &si_193->b0000 + 1;
				byte dl_285 = (byte) dx_272;
				gs_di_465 = &(gs_235->*(di_238 + 1));
			} while (dx_272 != 0x00);
			bp_278 = ~bp_278;
			cx_469 = cx_476 - 0x01;
			gs_di_472 = &(gs_235->*(di_238 + 1));
			cx_476 = cx_469;
		} while (cx_476 != 0x01);
		ds->b01AE = dl_285;
		bp_278 += 0x0101;
	} while (SEQ(ah_214, __inb(0x60)) != 0x01);
}

