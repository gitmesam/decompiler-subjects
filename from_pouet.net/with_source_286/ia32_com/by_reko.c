// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register byte ch, Register byte bh, Register (ptr16 Eq_5) es, Register (ptr16 Eq_6) ds)
void fn0C00_0100(byte ah, byte ch, byte bh, struct Eq_5 * es, struct Eq_6 * ds)
{
	__syscall(0x10);
	__outb(0x03C8, 0x00);
	word16 cx_392 = SEQ(ch, 0x40);
	do
	{
		__outb(969, 0x40 - (byte) cx_401 >> 0x01);
		__outb(969, 0x00);
		__outb(969, 0x00);
		byte ch_305 = SLICE(cx_401 - 0x01, byte, 8);
		cx_392 = cx_401 - 0x01;
		cx_401 = cx_392;
	} while (cx_401 != 0x01);
	word16 cx_395 = SEQ(ch_305, 0x40);
	do
	{
		bcu8 al_23 = 0x40 - (byte) cx_402;
		__outb(969, (al_23 >> 0x01) + 0x1F);
		__outb(969, al_23 >> 0x01);
		__outb(969, 0x00);
		byte ch_313 = SLICE(cx_402 - 0x01, byte, 8);
		cx_395 = cx_402 - 0x01;
		cx_402 = cx_395;
	} while (cx_402 != 0x01);
	word16 cx_398 = SEQ(ch_313, 0x40);
	do
	{
		__outb(969, 0x3F);
		__outb(969, (0x3F - (byte) cx_403 >> 0x01) + 0x1F);
		__outb(969, 0x00);
		word16 ax_364 = SEQ(ah, 0x00);
		cx_398 = cx_403 - 0x01;
		cx_403 = cx_398;
	} while (cx_403 != 0x01);
	word16 Eq_5::* di_299 = Eq_5::a0200;
	word16 cx_302;
	for (cx_302 = 16160; cx_302 != 0x00; --cx_302)
	{
		es->*di_299 = ax_364;
		++di_299;
	}
	byte ch_59;
	byte dh_60;
	byte dl_61;
	msdos_get_system_time(out ch_59, out dh_60, out dl_61);
	ds->w8040 = SEQ(dh_60, dl_61);
	while (true)
	{
		struct Eq_140 Eq_6::* si_115 = Eq_6::a0200;
		word16 cx_100;
		word16 Eq_149::* di_76 = Eq_149::a0000;
		word16 bx_335 = SEQ(bh, 0xA0);
		for (cx_100 = 0x7D00; cx_100 != 0x00; --cx_100)
		{
			byte al_83 = (ds->*si_115).t0000;
			0xA000->*di_76 = SEQ(al_83, al_83);
			++si_115;
			++di_76;
			--bx_335;
			if (bx_335 == 0x00)
			{
				si_115 -= 0xA0;
				bx_335 = 0x0140;
			}
			bh = SLICE(bx_335, byte, 8);
		}
		byte Eq_6::* di_110 = Eq_6::a0200;
		struct Eq_164 Eq_6::* si_117 = si_115 + 0x00A0;
		word16 cx_118;
		byte ah_130 = 0x00;
		for (cx_118 = 16000; cx_118 != 0x00; --cx_118)
		{
			++si_117;
			cu16 ax_140 = SEQ(ah_130, (ds->*si_117).b0000) + SEQ(bh, (ds->*si_117).b0000) + SEQ(bh, (ds->*si_117).bFFFFFFFE) + SEQ(bh, si_117[0x009F]);
			byte al_151 = (byte) (ax_140 >> 0x02);
			ah_130 = SLICE(ax_140 >> 0x02, byte, 8);
			if (ax_140 >> 0x02 != 0x00)
			{
				al_151 = (byte) ((ax_140 >> 0x02) - 0x01);
				ah_130 = SLICE((ax_140 >> 0x02) - 0x01, byte, 8);
				if (ax_140 >> 0x02 != 0x01)
				{
					al_151 = (byte) ((ax_140 >> 0x02) - 0x02);
					ah_130 = SLICE((ax_140 >> 0x02) - 0x02, byte, 8);
				}
			}
			ds->*di_110 = al_151;
			++di_110;
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		word16 cx_185 = 16000;
		struct Eq_140 Eq_6::* di_187 = si_115;
		byte Eq_6::* si_189 = Eq_6::a0200;
		while (true)
		{
			byte ch_195 = SLICE(cx_185, byte, 8);
			if (cx_185 == 0x00)
				break;
			(ds->*di_187).t0000 = ds->*si_189;
			++si_189;
			++di_187;
			--cx_185;
		}
		word16 cx_196 = SEQ(ch_195, 0x50);
		word16 Eq_6::* si_199 = Eq_6::a7FA0;
		cx_200 = cx_196;
		while (true)
		{
			word16 cx_200;
			if (cx_200 == 0x00)
				break;
			(ds->*di_187).t0000 = ds->*si_199;
			++si_199;
			di_187 += 2;
			--cx_200;
		}
		word16 cx_204 = cx_196;
		byte al_207;
		byte ah_208;
		if (!bios_kbd_check_keystroke(out al_207, out ah_208))
		{
			do
			{
				word16 ax_232 = ds->w8040;
				byte al_236 = (byte) ax_232;
				word16 ax_250 = SEQ(__rcr(al_236, 0x01, (SLICE(ax_232, byte, 8) & 0x02) != 0x00), __rcr(0x00, 0x01, (al_236 & 0x02) != 0x00)) + ax_232;
				cu8 ah_251 = SLICE(ax_250, byte, 8);
				word16 ax_257 = SEQ(ah_251 + 99, (bool) (ah_251 < 99) + ((byte) ax_250 + 0x36));
				ds->w8040 = ax_257;
				uint32 dx_ax_261 = (uint32) ax_257;
				uint16 bx_264 = SEQ(bh, 0xA0);
				uint16 ax_266 = (uint16) (dx_ax_261 /u bx_264);
				Eq_344 dx_265 = (uint16) (dx_ax_261 % bx_264);
				byte ah_269 = SLICE(ax_266, byte, 8);
				ds->*((word16) dx_265 + 32672) = (byte) (SEQ(ah_269, (byte) ax_266 | ah_269) >> 0x01);
				bh = SLICE(dx_265, byte, 8);
				--cx_204;
			} while (cx_204 != 0x00);
		}
		else
		{
			while (true)
			{
				byte ch_220 = SLICE(cx_204, byte, 8);
				if (cx_204 == 0x00)
					break;
				(ds->*di_187).t0000 = 0x00;
				di_187 += 2;
				--cx_204;
			}
			byte cl_216 = ds->b01FF;
			--ds->b01FF;
			if (SEQ(ch_220, cl_216) == 0x01)
			{
				bios_video_set_mode(0x03);
				msdos_terminate_program20();
			}
		}
	}
}

