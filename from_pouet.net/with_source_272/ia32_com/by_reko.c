// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register word16 cx, Register byte dh, Register byte dl, Register (memptr (ptr16 Eq_18) Eq_5) bx, Register (memptr (ptr16 Eq_230) byte) si, Register (ptr16 Eq_7) ds, FpuStack real64 rLoc4, FpuStack real64 rLoc3)
void fn0C00_0100(word16 cx, byte dh, byte dl, struct Eq_5 Eq_18::* bx, byte Eq_230::* si, struct Eq_7 * ds, real64 rLoc4, real64 rLoc3)
{
	__syscall(0x10);
	__fninit();
	struct Eq_18 * dx_14 = SEQ(dh + 0x10, dl);
	word16 cx_489 = cx;
	do
	{
		cu8 cl_17 = (byte) cx_493;
		__outb(0x03C8, cl_17);
		__outb(969, cl_17);
		cu8 al_20 = cl_17 - 0x80;
		if (cl_17 < 0x80)
			al_20 = cl_17 - 252;
		__outb(969, al_20);
		cu8 al_27 = al_20 - 0x40;
		if (al_27 < 0x00)
			al_27 += 0x44;
		__outb(969, al_27);
		cx_489 = cx_493 - 0x01;
		cx_493 = cx_489;
	} while (cx_493 != 0x01);
	real64 rLoc1_357 = (real64) ds->r01FC;
	real64 rLoc3_368 = rLoc3;
	do
	{
		Eq_64 rLoc4_378 = sqrt(rLoc4 * rLoc4 + rLoc3_368 * rLoc3_368) / rLoc1_357;
		real64 rLoc5_380 = rLoc4_378 * 3.14159265358979;
		if (rLoc4_378 * 3.14159265358979 >= rLoc4_378)
		{
			rLoc5_380 = 1.0;
			rLoc4_378 = (cos(rLoc4_378) + 1.0) * (real64) ds->w019D;
		}
		(dx_14->*bx).w0000 = (int16) rLoc4_378;
		rLoc4 = 1.0;
		if (rLoc3_368 == rLoc1_357)
			rLoc3_368 = -rLoc3_368;
		else
			rLoc3_368 += 1.0;
		struct Eq_86 Eq_18::* bx_104 = bx + 1;
		bx = (struct Eq_5 Eq_18::*) (bx_104 + 1);
	} while (bx_104 != &Eq_18::t0001);
	do
	{
		++ds->w01FE;
		struct Eq_111 Eq_7::* bx_117 = &Eq_7::w01FE;
		word16 cx_118 = 0x24;
		do
		{
			struct Eq_115 Eq_7::* bx_120 = &bx_117->w0001;
			rLoc5_380 = sin((rLoc5_380 + (real64) ds->w01FE) / rLoc1_357) * rLoc1_357;
			(ds->*bx_120).w0001 = (int16) rLoc5_380;
			(ds->*bx_120).w0001 += 0x60;
			--cx_118;
			bx_117 = (struct Eq_111 Eq_7::*) &bx_120->w0001;
			byte ch_327 = SLICE(cx_118, byte, 8);
		} while (cx_118 != 0x00);
		ui16 bx_143 = 0x0140;
		word16 cx_258 = SEQ(ch_327, 0x08);
		do
		{
			Eq_150 di_145;
			word16 ax_146 = 0x00;
			for (di_145 = 0x44; di_145 >= 0x00; di_145 -= 0x04)
			{
				cui16 bx_156 = bx_143 - ds->*((word16) di_145 + 0x0200);
				byte bl_171 = (byte) (bx_156 << 0x01);
				if (SLICE(bx_156 << 0x01, byte, 8) == 0x00)
					ax_146 += dx_14->*SEQ((byte) (cx_258 - ds->*((word16) di_145 + 0x0202)), bl_171);
			}
			cup16 ax_187 = ax_146 - 0x0600;
			if (ax_187 < 0x00)
				ax_187 = 0x00;
			cup16 v28_203 = ds->a0248[bx_143];
			ds->a0248[bx_143] = ax_187;
			wchar_t ax_208 = ax_187 - (ds->a0246)[bx_143];
			ci8 al_210 = (byte) (ax_208 >> 0x04);
			ci16 dx_207 = -v28_203 + ax_187;
			byte ah_270 = SLICE(ax_208 >> 0x04, byte, 8);
			cu8 al_211 = al_210 + 0x20;
			if (al_210 < 0x20)
				al_211 = 0x00;
			if (al_211 >= 55)
				al_211 = 55;
			40940->*si = al_211 | ((byte) ((dx_207 >> 0x05) + bx_143) & 0x60) << 0x01;
			--bx_143;
			if (bx_143 == 0x01)
			{
				--cx_258;
				bx_143 = 0x0140;
			}
			++si;
		} while (si != &Eq_230::b0000);
	} while (SEQ(ah_270, __inb(0x60)) != 0x01);
	__syscall(0x10);
}

