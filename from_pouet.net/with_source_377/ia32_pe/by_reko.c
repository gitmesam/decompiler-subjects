// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000()
void fn00401000()
{
	Eq_2 edx_13 = globals->t402104;
	byte bl_14 = 0x00;
	do
	{
		*edx_13 = bl_14;
		struct Eq_10 * edx_8 = (word32) edx_13 + 0x01;
		edx_8->b0000 = bl_14;
		edx_8->b0001 = bl_14;
		edx_13 = &edx_8->b0001 + 0x02;
		bl_14 = bl_14 + 0x01;
	} while (bl_14 != 0x00);
}

// 00401017: void fn00401017()
void fn00401017()
{
	word32 ecx_17 = 0x0F00;
	byte * esi_10 = globals->a402136;
	Eq_29 edi_14 = globals->t402118;
	do
	{
		*edi_14 = *esi_10;
		esi_10 = esi_10 + 0x01;
		edi_14 = (word32) edi_14 + 0x01;
		ecx_17 = ecx_17 - 0x01;
	} while (ecx_17 != 0x00);
	int32 ebx_20 = 0x00;
	cu8 bl_21 = 0x00;
	cui16 bx_22 = 0x00;
	do
	{
		byte dl_101 = ~0x04;
		byte SCZO_51 = cond(bl_21 - ~0x04);
		if (bl_21 <= ~0x04 && bl_21 >= 0x04)
		{
			ebx_20 = DPB(ebx_20, bx_22, 0);
			if (!DPB(SCZO_51, false, 0))
			{
				cui16 dx_94 = bx_22 & 0x0F0F;
				dl_101 = (byte) (DPB(dx_94, (byte) dx_94 + SLICE(dx_94, byte, 8), 0) << 0x02);
			}
		}
		*((char *) globals->t40211C + ebx_20) = (Eq_54) dl_101;
		bx_22 = bx_22 - 0x01;
		bl_21 = (byte) bx_22;
		ebx_20 = DPB(ebx_20, bx_22, 0);
	} while (bx_22 != 0x00);
}

// 00401088: void fn00401088(FpuStack real64 rArg0, FpuStack real64 rArg1)
void fn00401088(real64 rArg0, real64 rArg1)
{
	word32 * eax_107 = null;
	word16 cx_29 = 0x00;
	word16 bx_111 = 0x0400;
	struct Eq_92 * ebx_104 = (struct Eq_92 *) 0x0400;
	byte bl_39 = 0x00;
	do
	{
		cx_29 = cx_29 + 0x01;
		ebx_104->t402136 = (word32) ebx_104->t402136 + cx_29;
		real64 rLoc1_54 = (real64) ebx_104->t402136 / (real64) globals->w402130;
		real64 rLoc1_56 = cos(rLoc1_54);
		ebx_104->r402155 = (real32) sin(rLoc1_54);
		ebx_104->r402159 = (real32) rLoc1_56;
		bl_39 = bl_39 + 0x08;
		byte ch_239 = SLICE(cx_29, byte, 8);
		ebx_104 = DPB(ebx_104, bl_39, 0);
		bx_111 = DPB(bx_111, bl_39, 0);
	} while (P);
	ptr32 edx_105 = 0x00;
	byte dl_119 = 0x00;
	byte dh_120 = 0x00;
	word16 dx_118 = 0x00;
	do
	{
		Eq_100 bp_108 = 0x80;
l004010C6:
		word16 di_133 = 0x041D;
		struct Eq_149 * edi_134 = (struct Eq_149 *) 0x041D;
		byte al_135 = dl_119;
		eax_107 = DPB(eax_107, dl_119, 0);
		struct Eq_151 * ebx_139 = DPB(ebx_104, ch_239, 0);
		word16 bx_140 = DPB(bx_111, ch_239, 0);
		do
		{
			ebx_139->t402136 = (int16) (al_135 - 0x80);
			word16 bx_155 = bx_140 + 0x01;
			al_135 = dh_120;
			eax_107 = DPB(eax_107, dh_120, 0);
			bx_140 = bx_155 + 0x01;
			ebx_139 = DPB(ebx_139, bx_155 + 0x01, 0);
			if (!P)
			{
				ebx_139 = DPB(ebx_139, 0x00, 0);
				bx_140 = DPB(bx_155 + 0x01, 0x00, 0);
			}
			di_133 = di_133 + 0x01;
			edi_134 = DPB(edi_134, di_133, 0);
		} while (P);
		ebx_139->t402136 = bp_108;
		ebx_104 = DPB(ebx_139, 0x00, 0);
		bx_111 = DPB(bx_140, 0x00, 0);
		do
		{
			word16 bx_174 = bx_111 + 0x01;
			real64 rLoc1_173 = (real64) ebx_104->t402136;
			bx_111 = bx_174 + 0x01;
			ebx_104 = DPB(ebx_104, bx_174 + 0x01, 0);
		} while (P);
		do
		{
			real64 rLoc2_189 = rLoc1_331 * edi_134->t402136 + rArg0 * edi_134->t40213A;
			di_133 = di_133 + 0x08;
			rArg1 = rArg0 * edi_134->t40213A - rArg1 * edi_134->t402136;
			rLoc1_173 = rLoc2_189;
			rArg0 = rLoc1_331;
			edi_134 = DPB(edi_134, di_133, 0);
			real64 rLoc1_331 = rLoc1_173;
		} while (P);
		rArg0 = rLoc1_331 / (rArg1 / ((rLoc2_189 + (real64) globals->w402132) / (real64) globals->w402134));
		ebx_104->t402136 = (int32) rArg0;
		int32 edi_210 = ebx_104->t402136 *s 0x0140;
		ebx_104->t402136 = (int32) rArg1;
		int32 edi_212 = (word32) ebx_104->t402136 + edi_210;
		Eq_29 esi_216 = globals->t402118;
		(word32) esi_216 + 0x00007DA0 + edi_212 = (word32) esi_216 + 0x00007DA0 + edi_212 + (*((char *) globals->t40211C + edx_105) >> 0x05);
		do
		{
			dx_118 = dx_118 + 0x01;
			dl_119 = (byte) dx_118;
			dh_120 = SLICE(dx_118, byte, 8);
			edx_105 = DPB(edx_105, dx_118, 0);
			if (dx_118 != 0x00)
				goto l004010C6;
			bp_108 = -bp_108;
		} while (bp_108 < 0x00);
		ch_239 = ch_239 + 0x02;
	} while (P);
	word32 ecx_243 = 0xFA00;
	byte * esi_247 = (word32) globals->t402118 + 0x0500;
	word32 * edi_249 = (word32) globals->t402100 + 0x0500;
	do
	{
		ui32 eax_257 = DPB(eax_107, *esi_247, 0);
		*esi_247 = 0x00;
		eax_107 = (word32) globals->t402104 + ((eax_257 & 0xFF) << 0x02);
		*edi_249 = *eax_107;
		esi_247 = esi_247 + 0x01;
		edi_249 = edi_249 + 0x01;
		ecx_243 = ecx_243 - 0x01;
	} while (ecx_243 != 0x00);
	GetClientRect(globals->t4020CC, &globals->t4020F0);
	StretchDIBits(globals->t4020D0, 0x00, 0x00, globals->dw4020F8, globals->dw4020FC, 0x00, 0x00, 0x0140, 200, globals->t402100, &globals->t40206C, 0x00, 0x00CC0020);
}

// 004011F5: Register Eq_345 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_2 eax_6 = GlobalAlloc(0x00, 1000000);
	if (eax_6 != 0x00)
	{
		globals->t40210C = eax_6;
		globals->t402104 = eax_6;
		Mem78[0x00402100:word32] = eax_6 + 2000;
		Mem80[0x0040211C:word32] = eax_6 + 402000;
		Mem82[0x00402118:word32] = eax_6 + 602000;
		globals->t4020B4 = GetModuleHandleW(null);
		globals->t4020B8 = LoadIconW(0x00, (WCHAR *) 0x7F00);
		Eq_418 eax_99 = LoadCursorW(0x00, (WCHAR *) 0x7F00);
		globals->t4020BC = eax_99;
		if (DPB(eax_99, RegisterClassW(&globals->t4020A4), 0) != null)
		{
			Eq_325 eax_135 = CreateWindowExW(0x00, &globals->t402000, &globals->t402012, 0x10CF0000, 0x8000, 0x8000, 0x021C, 400, null, null, globals->t4020B4, null);
			if (eax_135 != null)
			{
				globals->t4020CC = eax_135;
				globals->t4020D0 = GetDC(eax_135);
				fn00401000();
				fn00401017();
				fn00401088(rArg0, rArg1);
				SetStretchBltMode(globals->t4020D0, 0x04);
				while (true)
				{
					PeekMessageW(&globals->t4020D4, null, 0x00, 0x00, 0x01);
					if (globals->dw4020D8 == 0x12)
						break;
					TranslateMessage(&globals->t4020D4);
					DispatchMessageW(&globals->t4020D4);
					fn00401088(rArg2, rArg3);
					globals->dw402108 = globals->dw402108 + 0x01;
				}
l0040132F:
				ReleaseDC(globals->t4020CC, globals->t4020D0);
				GlobalFree(globals->t40210C);
				ExitProcess(globals->t4020DC);
			}
		}
	}
	MessageBoxW(null, &globals->t40204C, null, 0x10);
	goto l0040132F;
}

