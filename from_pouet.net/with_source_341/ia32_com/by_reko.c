// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register (ptr16 Eq_3) ds)
void fn0C00_0100(byte ch, struct Eq_3 * ds)
{
	Eq_4 di_12;
	byte Eq_3::* si_14 = Eq_3::a045F;
	for (di_12 = 0x055E; di_12 >= ~0x04DE; --di_12)
	{
		ds->*di_12 = ds->*si_14;
		++si_14;
	}
	__syscall(0x10);
	fn0C00_038B();
	__outw(0x03D4, 0x5013);
	struct Eq_35 * es_28 = ds->ptr0415;
	Eq_38 di_29 = 0x00;
	uint16 bx_31;
	for (bx_31 = 0x00; bx_31 <= 33; ++bx_31)
	{
		do
		{
			word16 cx_36 = SEQ(ch, 0x08);
			while (true)
			{
				ch = SLICE(cx_36, byte, 8);
				if (cx_36 == 0x00)
					break;
				es_28->*di_29 = 2011;
				di_29 = (word16) di_29 + 2;
				--cx_36;
			}
			uint32 dx_ax_41 = bx_31 * 0x03C0;
			di_29 = (word16) di_29 + 16;
			word16 dx_45 = SLICE(dx_ax_41, word16, 16);
		} while (di_29 <= (word16) dx_ax_41);
		if (dx_45 == 0x00)
			di_29 = (word16) di_29 + 16;
	}
	word16 bx_126;
	struct Eq_35 * es_68 = ds->ptr0415;
	struct Eq_78 Eq_35::* di_102 = &Eq_35::t0518;
	Eq_80 si_111 = 0x0417;
	for (bx_126 = 0x00; bx_126 != 0x08; ++bx_126)
	{
		bool C_453 = SLICE(cond(si_111 - 0x0437), bool, 1);
		if (si_111 == 0x0437)
			di_102 = &Eq_35::t2458;
		byte dl_116 = 0x08;
		do
		{
			byte al_79 = ds->*si_111;
			byte dh_105 = 0x08;
			do
			{
				al_79 = __rcl(al_79, 0x01, C_453);
				if (Test(ULT,(al_79 & 0x80) != 0x00))
				{
					(es_68->*di_102).w0000 = 0x0FDB;
					(es_68->*di_102).w0002 = 0x0FDB;
					(es_68->*di_102).w0004 = 0x0FDB;
					(es_68->*di_102).w0006 = 0x0FDB;
					(es_68->*di_102).w0140 = 0x0FDB;
					(es_68->*di_102).w0142 = 0x0FDB;
					(es_68->*di_102).w0144 = 0x0FDB;
					(es_68->*di_102).w0146 = 0x0FDB;
					(es_68->*di_102).w0280 = 0x0FDB;
					(es_68->*di_102).w0282 = 0x0FDB;
					(es_68->*di_102).w0284 = 0x0FDB;
					(es_68->*di_102).w0286 = 0x0FDB;
				}
				di_102 = &di_102->w0006 + 1;
				--dh_105;
				C_453 = SLICE(cond(di_102), bool, 1);
				word16 dx_117 = SEQ(dh_105, dl_116);
			} while (dh_105 != 0x00);
			si_111 = (word16) si_111 + 1;
			++di_102;
			C_453 = SLICE(cond(di_102 + 1), bool, 1);
			dl_116 = (byte) (dx_117 - 0x01);
		} while (dx_117 != 0x01);
		di_102 -= 0x1A30;
	}
	fn0C00_02FB(ds);
	word16 cx_532;
	fn0C00_0365(ds, out cx_532);
	struct Eq_190 Eq_3::* bx_150 = &Eq_3::t0000;
	cui16 dx_526 = 0x0100;
	while (true)
	{
		cu8 dl_162 = (byte) dx_526;
		byte bl_179 = (byte) bx_150;
		byte bh_185 = SLICE(bx_150, byte, 8);
		uint16 ax_161 = (uint16) (uint8) (ds->*bx_150).b045F + 0x60;
		if (dl_162 > 0x05)
			ax_161 = 0x60;
		struct Eq_190 Eq_3::* bx_184;
		ds->w0410 = ax_161;
		bx_184 = bx_150;
		if (dl_162 > 0x01)
			bx_184 = SEQ(bh_185, bl_179 << 0x01);
		uint16 ax_201 = (uint16) (uint8) (ds->*bx_184).b045F;
		if (dl_162 != 0x01 && (dl_162 <= 0x03 || dl_162 > 0x05) && dl_162 != 0x07)
			ds->w040E = ax_201 + 0x01A0;
		else
			ds->w040E = 0x01A0 - ax_201;
		byte dh_245 = SLICE(dx_526, byte, 8);
		byte bl_246 = (byte) bx_150 + dh_245;
		cui16 dx_217 = dx_526;
		byte al_259 = (byte) (uint16) (uint8) fn0C00_02FB(ds);
		byte dl_250 = (byte) dx_526;
		bx_150 = SEQ(SLICE(bx_150, byte, 8), bl_246);
		if (bl_246 == ~0x00)
		{
			word16 dx_251 = SEQ(-dh_245, dl_250);
			byte dh_494 = SLICE(dx_251 + 0x01, byte, 8);
			dx_217 = dx_251 + 0x01;
			if ((byte) (dx_251 + 0x01) > 0x07)
				dx_217 = SEQ(dh_494, 0x00);
		}
		msdos_get_stdin_status();
		if (al_259 != 0x00)
			break;
		dx_526 = dx_217;
	}
	word16 cx_533;
	msdos_flush_buffer_and_read_stdin(fn0C00_0365(ds, out cx_533));
	bios_video_set_mode(0x03);
	bios_video_load_ROM_8x8_dbl_dot_patterns(0x00);
	fn0C00_038B();
	word16 bx_290 = 0x00;
	struct Eq_35 * es_294 = ds->ptr0415;
	struct Eq_296 Eq_35::* di_295 = &Eq_35::t066C;
	Eq_298 si_296 = 0x0417;
	do
	{
		bool C_309 = SLICE(cond(si_296 - 0x0437), bool, 1);
		if (si_296 == 0x0437)
			di_295 = &Eq_35::t0C02;
		byte dl_301 = 0x08;
		do
		{
			byte al_305 = ds->*si_296;
			byte dh_306 = 0x08;
			do
			{
				al_305 = __rcl(al_305, 0x01, C_309);
				if (Test(ULT,(al_305 & 0x80) != 0x00))
					(es_294->*di_295).w0000 = 0x0FDB;
				di_295 = &di_295->w0000 + 1;
				--dh_306;
				C_309 = SLICE(cond(di_295), bool, 1);
				word16 dx_332 = SEQ(dh_306, dl_301);
			} while (dh_306 != 0x00);
			si_296 = (word16) si_296 + 1;
			++di_295;
			C_309 = SLICE(cond(di_295 + 1), bool, 1);
			dl_301 = (byte) (dx_332 - 0x01);
		} while (dx_332 != 0x01);
		++bx_290;
		di_295 -= 1118;
		byte bh_514 = SLICE(bx_290, byte, 8);
	} while (bx_290 != 0x09);
	word16 Eq_3::* si_345 = Eq_3::a039E;
	struct Eq_35 * es_350 = ds->ptr0415;
	word16 Eq_35::* di_351 = &Eq_35::w11B4;
	word16 cx_352;
	for (cx_352 = 0x1B; cx_352 != 0x00; --cx_352)
	{
		es_350->*di_351 = ds->*si_345;
		++si_345;
		++di_351;
	}
	bios_video_set_cursor_position(bh_514, 0x32, 0x00);
	word16 cx_534;
	fn0C00_0365(ds, out cx_534);
	byte al_373;
	bios_kbd_get_keystroke(out al_373);
	word16 cx_379;
	fn0C00_0365(ds, out cx_379);
	__syscall(0x10);
	while (true)
	{
		byte ch_515 = SLICE(cx_379, byte, 8);
		if (cx_379 == 0x00)
			break;
		es_350->*di_351 = 0x00;
		++di_351;
		--cx_379;
	}
	word16 Eq_3::* si_392 = Eq_3::a03D4;
	struct Eq_35 * es_396 = ds->ptr0415;
	word16 Eq_35::* di_397 = Eq_35::a0066;
	word16 cx_399;
	for (cx_399 = SEQ(ch_515, 0x1D); cx_399 != 0x00; --cx_399)
	{
		es_396->*di_397 = ds->*si_392;
		++si_392;
		++di_397;
	}
	msdos_terminate(0x00);
}

// 0C00:02CE: Register byte fn0C00_02CE(Register byte cl, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0365
byte fn0C00_02CE(byte cl, struct Eq_3 * ds)
{
	__outb(0x03C7, cl);
	byte al_8 = __inb(969);
	byte al_10 = __inb(969);
	byte al_12 = __inb(969);
	byte ah_16 = al_8 + ds->b0414;
	byte bl_17 = al_10 + ds->b0414;
	byte bh_18 = al_12 + ds->b0414;
	__outb(0x03C8, cl);
	__outb(969, ah_16);
	__outb(969, bl_17);
	__outb(969, bh_18);
	return bh_18;
}

// 0C00:02FB: Register byte fn0C00_02FB(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_02FB(struct Eq_3 * ds)
{
	uint32 dx_ax_10 = (ds->w0410 >> 0x04) * 0xA0;
	ds->t0412 = (word16) dx_ax_10 + (uint16) (SEQ(SLICE(dx_ax_10, word16, 16), ds->w040E) /u 0x09);
	do
		;
	while ((__inb(0x03DA) & 0x08) != 0x00);
	__outw(0x03D4, SEQ(ds->b0413, 0x0C));
	__outw(0x03D4, SEQ(ds->t0412, 0x0D));
	do
		;
	while ((__inb(0x03DA) & 0x08) == 0x00);
	__outw(0x03D4, SEQ((byte) (uint16) ((uint32) (uint16) ds->w0410 % 0x10), 0x08));
	uint16 dx_65 = (uint16) ((uint32) (uint16) (ds->w040E - 0x01) % 0x09);
	__outb(0x03C0, 0x33);
	byte al_69 = (byte) dx_65;
	__outb(0x03C0, al_69 | 0x20);
	return al_69 | 0x20;
}

// 0C00:0365: Register byte fn0C00_0365(Register (ptr16 Eq_3) ds, Register out ptr16 cxOut)
// Called from:
//      fn0C00_0100
byte fn0C00_0365(struct Eq_3 * ds, ptr16 & cxOut)
{
	ptr16 cx_22 = 0x1F;
	do
	{
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		fn0C00_02CE(0x07, ds);
		fn0C00_02CE(0x3F, ds);
		byte al_51 = fn0C00_02CE(0x3F, ds);
		cx_22 = cx_76 - 0x01;
		cx_76 = cx_22;
	} while (cx_76 != 0x01);
	ds->b0414 = -ds->b0414;
	cxOut = cx_22;
	return al_51;
}

// 0C00:038B: void fn0C00_038B()
// Called from:
//      fn0C00_0100
void fn0C00_038B()
{
	byte bh_11;
	for (bh_11 = ~0x00; bh_11 != 0x00; --bh_11)
	{
		__outb(0x03C8, bh_11);
		__outb(969, 0x00);
		__outb(969, 0x00);
		__outb(969, 0x00);
	}
}

