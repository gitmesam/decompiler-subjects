// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	bios_video_set_mode(0x13);
	byte al_14 = 0x13;
	do
	{
		ds->w01C3 = 0x00;
		__syscall(22);
		if ((al_14 & 0x04) != 0x00)
			++ds->w01C3;
		if ((al_14 & 0x08) != 0x00)
			--ds->w01C3;
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		Eq_40 ax_44 = ds->t01C7;
		Eq_43 bx_45 = ds->t01C5;
		fn0C00_01CF(ax_44, 0x0300, bx_45, 0xA000, ds);
		Eq_40 bx_60 = ds->t01C1;
		byte al_62 = (byte) ax_44;
		byte ah_64 = SLICE(ax_44, byte, 8);
		byte bl_73 = (byte) bx_60;
		byte bh_82 = SLICE(bx_60, byte, 8);
		if (bx_45 >= 0xE6)
		{
			Eq_40 ax_65 = SEQ(ah_64, al_62 - 0x05);
			if (ax_65 != bx_60)
			{
				if (ax_65 <= bx_60)
				{
					bl_73 = (byte) (bx_60 - 0x01);
					bh_82 = SLICE(bx_60 - 0x01, byte, 8);
				}
				else
				{
					bl_73 = (byte) ((word16) bx_60.u0 + 1);
					bh_82 = SLICE((word16) bx_60.u0 + 1, byte, 8);
				}
			}
		}
		Eq_40 bx_86 = SEQ(bh_82, fn0C00_01F3(bl_73));
		ds->t01C1 = bx_86;
		Eq_40 ax_90 = (word16) ds->t01C7 + ds->w01CB;
		ds->t01C7 = ax_90;
		byte al_92 = (byte) ax_90;
		if (al_92 == 0x01)
			ds->w01CB = -ds->w01CB;
		if (al_92 == 0xC6)
			ds->w01CB = -ds->w01CB;
		Eq_43 cx_111 = (word16) ds->t01C5 + ds->w01C9;
		ds->t01C5 = cx_111;
		byte dh_190;
		Eq_40 ax_121 = fn0C00_0202(ax_90, cx_111, 0x013F, bx_86, ds, out dh_190);
		word16 bx_129 = (word16) ds->t01BF + ds->w01C3;
		Eq_40 bx_138 = SEQ(SLICE(bx_129, byte, 8), fn0C00_01F3((byte) bx_129));
		ds->t01BF = bx_138;
		Eq_128 dx_144 = <invalid>;
		Eq_49 dx_153 = SEQ(SLICE(dx_144, byte, 8), 0x0F);
		byte dh_191;
		fn0C00_01CF(fn0C00_0202(ax_121, cx_111, 0x00, bx_138, ds, out dh_191), dx_153, ds->t01C5, 0xA000, ds);
		fn0C00_01DF(ds->t01C1, SEQ(SLICE((uint16) fn0C00_01DF(ds->t01BF, dx_153, 0x00, 0xA000, ds), byte, 8), 0x0F), 0x013F, 0xA000, ds);
		byte ah_186;
	} while (bios_kbd_check_keystroke(out al_14, out ah_186));
	msdos_terminate_program20();
}

// 0C00:01CF: void fn0C00_01CF(Register Eq_40 ax, Register Eq_49 dl, Register Eq_43 bx, Register (ptr16 Eq_51) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_01DF
void fn0C00_01CF(Eq_40 ax, Eq_49 dl, Eq_43 bx, struct Eq_51 * es, struct Eq_2 * ds)
{
	es->*((word16) bx + (word16) (ds->w01CD * ax)) = (byte) dx;
}

// 0C00:01DF: Register byte fn0C00_01DF(Register Eq_40 ax, Register Eq_49 dx, Register Eq_43 bx, Register (ptr16 Eq_51) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_01DF(Eq_40 ax, Eq_49 dx, Eq_43 bx, struct Eq_51 * es, struct Eq_2 * ds)
{
	word16 cx_16;
	for (cx_16 = 0x0A; cx_16 != 0x00; --cx_16)
	{
		fn0C00_01CF(ax, dx, bx, es, ds);
		ax = (word16) ax + 1;
		byte dh_21 = SLICE(dx, byte, 8);
		byte al_27 = (byte) ax;
		byte ah_30 = SLICE(ax, byte, 8);
	}
	Eq_49 dx_22 = SEQ(dh_21, 0x00);
	fn0C00_01CF(ax, dx_22, bx, es, ds);
	fn0C00_01CF(SEQ(ah_30, al_27 - 11), dx_22, bx, es, ds);
	return dh_21;
}

// 0C00:01F3: Register byte fn0C00_01F3(Register byte bl)
// Called from:
//      fn0C00_0100
byte fn0C00_01F3(byte bl)
{
	if (bl == 0x00)
		bl = 0x01;
	if (bl == ~0x41)
		bl = ~0x42;
	return bl;
}

// 0C00:0202: Register Eq_40 fn0C00_0202(Register Eq_40 ax, Register Eq_43 cx, Register Eq_43 dx, Register Eq_40 bx, Register (ptr16 Eq_2) ds, Register out Eq_128 dhOut)
// Called from:
//      fn0C00_0100
Eq_40 fn0C00_0202(Eq_40 ax, Eq_43 cx, Eq_43 dx, Eq_40 bx, struct Eq_2 * ds, union Eq_128 & dhOut)
{
	byte bl_12 = (byte) bx;
	byte bh_14 = SLICE(bx, byte, 8);
	if (cx == dx)
	{
		if (ax >= bx)
		{
			bx = SEQ(bh_14, bl_12 + 0x0A);
			if (ax < bx)
			{
				ds->w01C9 = -ds->w01C9;
				dhOut.u0 = <invalid>;
				return ax;
			}
		}
		ax = (SLICE(Mem0[ds:14033:word16] *u (ax + bx), word16, 0) & 0x7F) + 0x24;
		ds->t01C7 = ax;
		ds->t01C5.u0 = 0xA0;
	}
	dhOut.u0 = <invalid>;
	return ax;
}

