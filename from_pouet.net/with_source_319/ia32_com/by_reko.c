// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	Eq_3 Top_101 = 0;
	bios_video_set_mode(0x13);
	uint8 ah_14 = 0x00;
	ui16 cx_11;
	for (cx_11 = 0x0800; cx_11 != 0x00; --cx_11)
	{
		word16 si_352;
		ah_14 = SLICE((uint16) (uint8) fn0C00_024A(ah_14, cx_11, ds, out si_352), byte, 8);
	}
	while (true)
	{
		ui16 cx_120;
		for (cx_120 = 0x0800; cx_120 != 0x00; --cx_120)
		{
			Eq_66 si_27 = cx_120 << 0x01;
			if (ds->b02F8 < 0x04)
			{
				cup16 v12_36 = ds->a22FC[cx_120] - 0x01;
				ds->a22FC[cx_120] = v12_36;
				if (v12_36 == 0x00)
					goto l0C00_0133;
			}
			else
			{
				++ds->a22FC[cx_120];
				if (ds->a22FC[cx_120] >= 200)
				{
l0C00_0133:
					fn0C00_024A(ah_14, cx_120, ds, out si_27);
				}
			}
			if (ds->*((word16) si_27 + 0x000032FC) != 0x28)
				(ds->*((word16) si_27 + 0x000032FC)).u0 = (byte) (ds->*((word16) si_27 + 0x000032FC)).u0 + 1;
			ds->t6306 = ds->*((word16) si_27 + 0x000032FC);
			__fninit();
			struct Eq_83 * Top_81 = Top_101 - 1;
			Top_81->r0000 = 3.14159265358979;
			Top_81->r0000 *= (real64) ds->w02F6;
			Top_81->r0000 /= (real64) ds->w02F4;
			real64 v19_85 = Top_81->r0000;
			Top_81->r0000 = cos(v19_85);
			Top_81->rFFFFFFFF = sin(v19_85);
			Top_81->rFFFFFFFE = Top_81->rFFFFFFFF;
			Top_81->rFFFFFFFE *= (real64) (ds->*((word16) si_27 + 4860));
			Top_81->rFFFFFFFD = Top_81->rFFFFFFFE;
			Top_81->rFFFFFFFD *= (real64) (ds->*((word16) si_27 + 764));
			Top_81->rFFFFFFFD -= Top_81->rFFFFFFFE;
			ds->*((word16) si_27 + 17148) = (int16) Top_81->rFFFFFFFD;
			real64 v20_97 = Top_81->rFFFFFFFD;
			Top_81->rFFFFFFFD = Top_81->rFFFFFFFF;
			Top_81->rFFFFFFFF = v20_97;
			Top_81->rFFFFFFFD *= (real64) (ds->*((word16) si_27 + 4860));
			Top_81->rFFFFFFFC = Top_81->rFFFFFFFF;
			Top_81->rFFFFFFFC *= (real64) (ds->*((word16) si_27 + 764));
			Top_81->rFFFFFFFC += Top_81->rFFFFFFFD;
			ds->*((word16) si_27 + 21244) = (int16) Top_81->rFFFFFFFC;
			Top_101 = Top_81 - 4;
			ah_14 = SLICE((uint16) (uint8) fn0C00_0279(si_27, 0x9000, ds), byte, 8);
		}
		if (ds->b02F8 != 0x02 && ds->b02F8 != 0x03)
		{
			if (ds->b02F8 >= 0x06)
			{
				cup16 v27_134 = ds->w02F6 - 0x01;
				ds->w02F6 = v27_134;
				if (v27_134 == 0x00)
					ds->w02F6 = 0x0168;
			}
		}
		else
		{
			++ds->w02F6;
			if (ds->w02F6 >= 0x0169)
				ds->w02F6 = 0x01;
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
		{
			byte al_146 = __inb(0x03DA);
		} while ((al_146 & 0x08) == 0x00);
		word16 bx_150;
		struct Eq_318 Eq_2::* di_151 = Eq_2::a0000;
		for (bx_150 = 0x00; bx_150 != 0x32; ++bx_150)
		{
			word16 cx_154;
			for (cx_154 = 0x28; cx_154 != 0x00; --cx_154)
			{
				ui8 al_160 = al_146 + (0x9000->*di_151).b7C60;
				ui16 al_ah_332 = SEQ(al_160, ah_14) + SEQ((ds->*di_151).b6307, C_163);
				cu8 al_168 = SLICE(al_ah_332, byte, 8);
				uint16 ax_175 = (SEQ((bool) (al_168 < 0x00) + (byte) al_ah_332, al_168) >> 0x01) - 0x01;
				al_146 = (byte) ax_175;
				(ds->*di_151).b61C6 = al_146;
				(0x9000->*di_151).b0000 = al_146;
				C_163.u1 = SLICE(cond(al_160), bool, 1);
				ah_14 = SLICE(ax_175, byte, 8);
				di_151 = &di_151->b0000 + 1;
			}
			++di_151;
		}
		word16 cx_215;
		word16 Eq_382::* di_216 = Eq_382::a0000;
		word16 Eq_2::* si_217 = Eq_2::a0000;
		for (cx_215 = 0x7D00; cx_215 != 0x00; --cx_215)
		{
			0xA000->*di_216 = 0x9000->*si_217;
			++si_217;
			++di_216;
		}
		word16 cx_235;
		word16 Eq_2::* di_236 = Eq_2::a0000;
		for (cx_235 = 0x7D00; cx_235 != 0x00; --cx_235)
		{
			0x9000->*di_236 = 0x00;
			++di_236;
		}
		byte al_242;
		if (!bios_kbd_check_keystroke(out al_242, out ah_14))
		{
			byte al_245;
			ah_14 = bios_kbd_get_keystroke(out al_245);
			if (al_245 == 0x1B)
			{
				bios_video_set_mode(0x03);
				return;
			}
			++ds->b02F8;
			if (ds->b02F8 >= 0x02 && ds->b02F8 >= 0x08)
				ds->b02F8 = 0x00;
		}
	}
}

// 0C00:023C: Register uint8 fn0C00_023C(Register uint8 ah, Register out Eq_445 dxOut)
// Called from:
//      fn0C00_024A
uint8 fn0C00_023C(uint8 ah, union Eq_445 & dxOut)
{
	Eq_446 dx_ax_11 = (uint32) (uint16) SEQ(ah + __inb(0x40), __inb(0x40));
	dxOut.u0 = (int16) (dx_ax_11 % 100);
	return SLICE((int16) (dx_ax_11 / 100), byte, 8);
}

// 0C00:024A: Register uint8 fn0C00_024A(Register uint8 ah, Register ui16 cx, Register (ptr16 Eq_2) ds, Register out Eq_20 siOut)
// Called from:
//      fn0C00_0100
uint8 fn0C00_024A(uint8 ah, ui16 cx, struct Eq_2 * ds, union Eq_20 & siOut)
{
	(&ds->a32FC->b0000)[cx * 0x02] = 0x0F;
	word16 dx_17;
	uint8 ah_25 = SLICE((uint16) (uint8) fn0C00_023C(ah, out dx_17), byte, 8);
	ds->a02FC[cx] = dx_17 - 0x32;
	word16 dx_28;
	uint8 ah_36 = SLICE((uint16) (uint8) fn0C00_023C(ah_25, out dx_28), byte, 8);
	ds->a12FC[cx] = dx_28 - 0x32;
	cup16 dx_39;
	uint16 ax_37 = (uint16) (uint8) fn0C00_023C(ah_36, out dx_39);
	if (ds->b02F8 < 0x04)
		dx_39 += 100;
	ds->a22FC[cx] = dx_39;
	siOut = cx << 0x01;
	return SLICE(ax_37, byte, 8);
}

// 0C00:0279: Register byte fn0C00_0279(Register Eq_66 si, Register (ptr16 Eq_2) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0279(Eq_66 si, struct Eq_2 * es, struct Eq_2 * ds)
{
	if (ds->*((word16) si + 0x000022FC) == 0x00)
		++ds->*((word16) si + 0x000022FC);
	ds->t6302 = (int16) (ds->*((word16) si + 17148) *s 100 / ds->*((word16) si + 0x000022FC)) + 0xA0;
	ds->t6304 = (int16) (ds->*((word16) si + 21244) *s 100 / ds->*((word16) si + 0x000022FC)) + 100;
	struct Eq_558 Eq_2::* ax_39 = (word16) ds->t6302 + (word16) (ds->t6304 *s 0x0140);
	byte ah_67 = SLICE(ax_39, byte, 8);
	if (ds->t6302 <= 0x013F && ds->t6304 <= 199)
	{
		Eq_69 al_45 = ds->t6306;
		(es->*ax_39).t0000 = al_45;
		ax_39 = SEQ(ah_67, al_45);
		if (ds->b02F8 != 0x00)
		{
			ax_39 = SEQ(ah_67, al_45);
			if (ds->b02F8 != 0x03)
			{
				ax_39 = SEQ(ah_67, al_45);
				if (ds->b02F8 != 0x04)
				{
					ax_39 = SEQ(ah_67, al_45);
					if (ds->b02F8 != 0x07)
					{
						(es->*ax_39).t0001 = al_45;
						(es->*ax_39).t0140 = al_45;
						(es->*ax_39).t0141 = al_45;
						ax_39 = SEQ(ah_67, al_45);
					}
				}
			}
		}
	}
	return SLICE(ax_39, byte, 8);
}

