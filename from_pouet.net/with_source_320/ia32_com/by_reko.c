// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register Eq_3 bx, Register (memptr (ptr16 Eq_5) Eq_4) bp, Register (ptr16 Eq_5) es, Register (ptr16 Eq_6) ds)
void fn0C00_0100(byte ch, Eq_3 bx, <type-error> Eq_5::* bp, struct Eq_5 * es, struct Eq_6 * ds)
{
	__syscall(33);
	ds->t0248 = bx;
	ds->ptr024A = es;
	__syscall(0x10);
	fn0C00_01B7(&ds->b0119 + 0x00CD, 0x40);
	byte ah_16 = 0x40;
	do
	{
		Eq_36 di_114 = ~0x8080 * 0x02 & 0x0F;
		uint16 bx_112 = 0x1010;
		do
		{
			Eq_76 bx_32 = bx_112 & 0x1F;
			int16 ax_52 = (int16) (byte) ((word16) di_114 + SEQ(ah_16, ds->b0119));
			cui16 cx_37 = SEQ(ch, ds->*((word16) bx_32 + 734));
			struct Eq_5 * ds_65 = ds->ptr02DC;
			__syscall(0x10);
			al_55 = (byte) ax_52 ^ SLICE(ax_52, byte, 8);
			word16 dx_100 = 0x32;
			ui24 si_bh_243 = SEQ(cx_37 << 0x03, 0x03);
			do
			{
				byte al_214 = es->*((char *) bp + SLICE(si_bh_243, word16, 8));
				struct Eq_43 Eq_5::* cx_74 = &Eq_5::t0008;
				do
				{
					int16 ax_76 = (int16) al_214;
					ds_65->*di_114 = SLICE(ax_76, byte, 8) & 0x03;
					Eq_40 di_82 = (word16) di_114 + 1;
					--cx_74;
					di_114 = (word16) di_82 + 1;
					ah_16 = SLICE(ax_76 << 0x01, byte, 8);
					al_214 = (byte) (ax_76 << 0x01);
					ch = SLICE(cx_74, byte, 8);
					byte ch_218 = SLICE(cx_74, byte, 8);
				} while (cx_74 != &Eq_5::t0000);
				--dx_100;
				di_114 = (word16) di_82 + 0x0091;
				si_bh_243 += SEQ(~0x00, al_55);
				byte dh_223 = SLICE(dx_100, byte, 8);
			} while (dx_100 != 0x00);
			es = ds_65;
			bx_112 = (word16) bx_32 + 1;
			di_114 = di_82 - 0x1E9F;
		} while (di_82 < 7999);
		struct Eq_43 Eq_5::* di_117 = cx_74;
		byte al_241 = (byte) cx_74;
		word16 cx_121 = SEQ(ch_218, 0x0F);
		word16 dx_125 = SEQ(dh_223, 0x99);
		while (true)
		{
			ch = SLICE(cx_121, byte, 8);
			if (cx_121 == 0x00)
				break;
			(ds_65->*di_117).t0000 = al_241;
			++di_117;
			--cx_121;
		}
		do
		{
			byte dl_239 = (byte) dx_125;
			word16 ax_124 = ds->w0118;
			word16 bx_126 = dx_125;
			struct Eq_5 * cx_150 = SEQ(ch, 0x40);
			do
			{
				word16 ax_130 = ax_124 + bx_126;
				(ds_65->*di_117).t0000 = SLICE(ax_130, byte, 8) & 0x49 ^ 0x0E;
				--cx_150;
				byte dh_226 = SLICE(dx_125, byte, 8);
				bx_126 += dx_125;
				ax_124 = ax_130;
				di_117 += 2;
				byte ch_237 = SLICE(cx_150, byte, 8);
			} while (cx_150 != 0x00);
			word16 cx_154 = SEQ(ch_237, 0x10);
			while (true)
			{
				ah_16 = SLICE(cx_150, byte, 8);
				ch = SLICE(cx_154, byte, 8);
				if (cx_154 == 0x00)
					break;
				(ds_65->*di_117).t0000 = cx_150;
				di_117 += 2;
				--cx_154;
			}
			dx_125 = SEQ(dh_226, dl_239 - 0x03);
		} while (dl_239 != 0x03);
		es = cx_150;
	} while ((cx_150->b0417 & 0x07) == 0x00);
	Eq_3 ds_dx_166 = ds->t0248;
	fn0C00_01B7(ds_dx_166, 0x00);
}

// 0C00:01B7: void fn0C00_01B7(Sequence Eq_3 ds_dx, Register byte ah)
// Called from:
//      fn0C00_0100
void fn0C00_01B7(Eq_3 ds_dx, byte ah)
{
	struct Eq_197 * ds = SLICE(ds_dx, selector, 16);
	__cli();
	__outb(0x43, 0x36);
	__outb(0x40, 0x00);
	__outb(0x40, ah);
	msdos_set_interrupt_vector(0x08, ds_dx);
	word16 ax_15 = 244;
	do
	{
		fn0C00_0253(ax_15);
		--ax_15;
		byte al_35 = (byte) ax_15;
	} while (ax_15 != 0x00);
	byte Eq_197::* si_23 = Eq_197::a026E;
	do
	{
		++si_23;
		word16 ax_30 = SEQ(ds->*si_23, al_35);
		do
		{
			fn0C00_0253(ax_30);
			++ax_30;
			al_35 = (byte) ax_30;
		} while ((al_35 & 0x1F) != 0x00);
	} while (al_35 != 0x00);
	__sti();
}

// 0C00:0253: void fn0C00_0253(Register word16 ax)
// Called from:
//      fn0C00_01B7
void fn0C00_0253(word16 ax)
{
	byte al_15 = (byte) ax;
	byte ah_22 = SLICE(ax, byte, 8);
	__outb(0x0388, al_15);
	word16 cx_16 = 0x06;
	do
	{
		__inb(0x0388);
		--cx_16;
		byte ch_44 = SLICE(cx_16, byte, 8);
	} while (cx_16 != 0x00);
	__outb(0x0389, ah_22);
	word16 cx_30;
	do
	{
		__inb(0x0388);
		--cx_30;
	} while (cx_30 != 0x00);
}

