// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (memptr (ptr16 Eq_13) real32) bx, Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds, Stack word16 wArg0A, FpuStack real64 rLoc4, FpuStack real64 rLoc2)
void fn0C00_0100(real32 Eq_13::* bx, struct Eq_3 * es, struct Eq_4 * ds, word16 wArg0A, real64 rLoc4, real64 rLoc2)
{
	__syscall(0x10);
	ds->ptr040C = cs;
	__wait();
	__fninit();
	do
	{
		rLoc2 = sin(rLoc2);
		cs->*bx = (real32) rLoc2;
		++bx;
	} while (bx != &Eq_13::r0000);
	struct Eq_34 Eq_4::* si_34 = Eq_4::a02EC;
	word16 Eq_3::* di_35 = &Eq_3::w040E;
	word16 bx_36 = 0x00;
	word16 dx_39;
	for (dx_39 = 0x07; dx_39 != 0x00; --dx_39)
	{
		uint16 cx_57;
		do
		{
			fn0C00_029A(fp, ds);
			es->*di_35 = bx_36 - 0x57;
			word16 Eq_3::* di_71 = di_35 + 1;
			es->*di_71 = wArg0A;
			++bx_36;
			di_35 = di_71 + 1;
			byte bl_125 = (byte) bx_36;
			--cx_57;
		} while (cx_57 != 0x00);
		++si_34;
	}
	__outb(0x03C8, 0x00);
	byte al_100;
	byte dl_133 = 0xC9;
	byte dh_134 = 0x03;
	for (al_100 = 0x00; al_100 != 0x40; ++al_100)
	{
		__outb(969, al_100);
		__outb(969, al_100);
		__outb(969, al_100);
	}
	do
	{
		--al_100;
		__outb(969, al_100);
		__outb(969, al_100);
		__outb(969, al_100);
	} while (al_100 != 0x00);
	struct Eq_13 * ax_109 = ds->ptr040C;
	struct Eq_129 Eq_13::* di_121 = &Eq_13::tFFFFFA00;
	word16 cx_122;
	do
	{
		bcu8 bl_131 = bl_125 + (0xA000->*di_121).bFFFFFEC2 + (0xA000->*di_121).bFFFFFEC1 + (0xA000->*di_121).bFFFFFD81;
		word16 dx_138 = __ror(SEQ(dh_134, dl_133 - dh_134), 0x03);
		byte al_149 = (byte) (SEQ(SLICE(dx_138 ^ 0x3A36, byte, 8), ((byte) (dx_138 ^ 0x3A36) >> 0x06) + (bl_131 >> 0x02)) - 0x01);
		(0xA000->*di_121).b0000 = al_149;
		(ax_109->*di_121).b0000 = al_149;
		dl_133 = (byte) (dx_138 ^ 0x3A36);
		dh_134 = SLICE(dx_138 ^ 0x3A36, byte, 8);
		bl_125 = al_149;
		++di_121;
		--cx_122;
	} while (cx_122 != 0x00);
	do
	{
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		word16 cx_178;
		struct Eq_13 * ax_184 = cs->ptr040C;
		struct Eq_129 Eq_13::* si_200 = di_121;
		for (cx_178 = cx_122 - 0x01; cx_178 != 0x00; --cx_178)
		{
			(cs->*di_121).b0000 = (ax_184->*si_200).b0000;
			++si_200;
			++di_121;
		}
		word16 cx_209 = 0xAF;
		word16 Eq_13::* si_210 = Eq_13::a040E;
		do
		{
			cs->w0406 = cs->*si_210;
			word16 Eq_13::* si_215 = si_210 + 1;
			cs->w0408 = cs->*si_215;
			word16 bx_244 = 0x00;
			do
			{
				cs->w0400 = cs->w0406;
				cs->w0402 = cs->w0408;
				cs->t0404.u1 = 0x00;
				fn0C00_02C0(bx_590, &Eq_13::w0402, &Eq_13::t0404, cs, rLoc4);
				word16 bx_288 = cs->w02E0;
				fn0C00_02C0(bx_288, &Eq_13::w0402, &Eq_13::t0404, cs, rLoc4);
				fn0C00_02C0(bx_288, &Eq_13::w0400, &Eq_13::t0404, cs, rLoc4);
				fn0C00_02C0(cs->w02E2, &Eq_13::w0400, &Eq_13::w0402, cs, rLoc4);
				Eq_236 dl_317 = cs->t0404;
				fn0C00_028B(fn0C00_028B(fn0C00_028B(fn0C00_028B(fn0C00_028B(fn0C00_028B((cs->w0402 + ~0x6B) *s 0x0140 + (cs->w0400 + 65446), dl_317, cs), dl_317, cs), dl_317, cs) + 0x013D, dl_317, cs), dl_317, cs), dl_317, cs);
				bx_244 = bx_590 + 0x80;
				bx_590 = bx_244;
			} while (bx_590 != 0x80);
			si_210 = si_215 + 1;
			cx_209 = cx_589 - 0x01;
			cx_589 = cx_209;
		} while (cx_589 != 0x01);
		cs->w02E0 += 0x0200;
		cs->w02E2 += 0x0160;
		cx_122 = cx_589 - 0x02;
		do
		{
			(cs->*di_121).b0000 = 0x7F;
			(0xA000->*di_121).b0000 = (cs->*di_121).b0000;
			++di_121;
			--cx_122;
		} while (cx_122 != 0x00);
	} while (__inb(0x60) != 0x01);
	bios_video_set_mode(0x03);
	msdos_terminate(0x00);
}

// 0C00:028B: Register (memptr (ptr16 Eq_13) byte) fn0C00_028B(Sequence (ptr32 Eq_236) ds_di, Register Eq_236 dl, Register (ptr16 Eq_13) fs)
// Called from:
//      fn0C00_0100
byte Eq_13::* fn0C00_028B(union Eq_236 * ds_di, Eq_236 dl, struct Eq_13 * fs)
{
	byte Eq_13::* di = (word16) ds_di;
	if (*ds_di >= dl)
	{
		*ds_di = (union Eq_236 *) dl;
		fs->*di = dl & 0x7F;
	}
	return di + 1;
}

// 0C00:029A: void fn0C00_029A(Sequence (ptr32 Eq_44) ss_bp, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_029A(struct Eq_44 * ss_bp, struct Eq_4 * ds)
{
	ss_bp->w000A = (int16) ((real64) ss_bp->w0004 * (1.0 - (1.0 - cos(((real64) ss_bp->w0006 / (real64) ss_bp->w0008) * 3.14159265358979)) * ds->r02E4) + (real64) ss_bp->w0002 * 1.0);
}

// 0C00:02C0: void fn0C00_02C0(Sequence (ptr32 Eq_241) gs_bx, Register (memptr (ptr16 Eq_13) int16) si, Register (memptr (ptr16 Eq_13) int16) di, Register (ptr16 Eq_13) ds, FpuStack real64 rLoc3)
// Called from:
//      fn0C00_0100
void fn0C00_02C0(struct Eq_241 * gs_bx, int16 Eq_13::* si, int16 Eq_13::* di, struct Eq_13 * ds, real64 rLoc3)
{
	real64 rLoc1_33 = (real64) gs_bx->r4000;
	real64 rLoc2_34 = (real64) (ds->*si);
	ds->*si = (int16) (rLoc3 * gs_bx->r0000 - (real64) (ds->*di) * rLoc1_33);
	ds->*di = (int16) (rLoc1_33 * rLoc2_34 + (real64) (ds->*di) * gs_bx->r0000);
}

