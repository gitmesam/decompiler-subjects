// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) es, Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_2 * es, struct Eq_3 * ds)
{
	byte Eq_2::* di_372 = Eq_2::a4D78;
	word16 cx_375;
	for (cx_375 = 0x2D; cx_375 != 0x00; --cx_375)
	{
		es->*di_372 = 0x00;
		++di_372;
	}
	__wait();
	__fninit();
	struct Eq_14 Eq_3::* di_10 = &Eq_3::t0000;
	word16 cx_11 = 0x00;
	do
	{
		ds->t4D66.u0 = 0x00;
		do
		{
			real64 rLoc1_419 = (real64) ds->t049E * (real64) ds->r04A2;
			ds->r4DB8 = (real32) rLoc1_419;
			real64 rLoc1_421 = sin(rLoc1_419) * (real64) ds->w04C5;
			real64 rLoc3_424 = (real64) ds->t4D66 * (real64) ds->r04A2;
			ds->r4DBC = (real32) rLoc3_424;
			di_10[650] = (int16) (rLoc1_421 * cos(rLoc3_424));
			di_10[0x0E42] = (int16) (rLoc1_421 * sin((real64) ds->r4DBC));
			di_10[6650] = (int16) (cos((real64) ds->r4DB8) * (real64) ds->w04C5);
			ds->t4D66 = (word16) ds->t4D66 + 0x0F;
			++di_10;
			++cx_11;
		} while (ds->t4D66 <= 0x0168);
		ds->t049E = (word16) ds->t049E + 0x0F;
	} while (ds->t049E <= 0xB4);
	ds->w4B64 = cx_11;
	int16 bx_64;
	word16 Eq_3::* di_68 = Eq_3::a4B66;
	for (bx_64 = 0x00; bx_64 != 0x0100; ++bx_64)
	{
		ds->w050A = bx_64;
		ds->w050A = (int16) (sin((real64) ds->w050A * (real64) ds->r04BC) * (real64) ds->r04C0);
		ds->*di_68 = -ds->w050A + 0x8C;
		Eq_148 Top_136 = 0;
		++di_68;
	}
	fn0C00_02D5(0x00, 0x9000);
	word32 ecx_114 = 0x00;
	do
	{
		word64 rRet1_134;
		real64 rRet0_135 = fn0C00_03FC(0x9000, ds, out rRet1_134);
		*((word32) Top_136 - 1) = rRet1_134;
		*((word32) Top_136 - 2) = rRet0_135;
		Top_136 -= 2;
		ecx_114 = ecx_527 + 0x01;
		ecx_527 = ecx_114;
	} while (ecx_527 != 199999);
	ds->w0506 = ~0x63;
	byte Eq_240::* di_153 = Eq_240::a0000;
	do
	{
		ds->w0504 = ~0x9F;
		do
		{
			Eq_193 Top_160 = Top_136 - 1;
			*Top_160 = (real64) ds->w0504;
			*((word32) Top_160 - 1) = (real64) ds->w0506;
			*Top_160 = atan(*((word32) Top_160 + 1), *Top_160);
			*Top_160 *= (real64) ds->r04A8;
			ds->t0500.u0 = (int32) *Top_160;
			0x8000->*di_153 = ds->t0500;
			*Top_160 = (real64) ds->w0506;
			*Top_160 *= *Top_160;
			*((word32) Top_160 - 1) = (real64) ds->w0504;
			*((word32) Top_160 - 1) *= *((word32) Top_160 - 1);
			*Top_160 += *((word32) Top_160 - 1);
			*Top_160 = sqrt(*Top_160);
			*Top_160 = (real64) ds->w04A6 / *Top_160;
			ds->t0500.u0 = (int32) *Top_160;
			0x7000->*di_153 = ds->t0500;
			++ds->w0504;
			Top_136 = (word32) Top_160 + 2;
			++di_153;
		} while (ds->w0504 != 0xA0);
		++ds->w0506;
	} while (ds->w0506 != 100);
	bios_video_set_mode(0x13);
	uint32 ebx_203 = 0x00;
	do
	{
		word16 cx_206;
		for (cx_206 = 0x04; cx_206 != 0x00; --cx_206)
		{
			fn0C00_02B6(ebx_203);
			ebx_203 = SEQ(SLICE(ebx_203, word24, 8), (byte) ebx_203 + 0x01);
		}
		ebx_203 += 0x01000100;
	} while ((byte) (ebx_203 + 0x01000100) != 0x00);
	fn0C00_02B6(0x1A1A00FD);
	fn0C00_02B6(0x252500FE);
	fn0C00_02B6(0x393900FF);
	int16 si_253 = 0x00;
	while (true)
	{
		int16 si_257 = si_253 + 0x0102;
		fn0C00_02F5(si_257);
		fn0C00_0366(ds);
		fn0C00_02C7();
		fn0C00_02E0();
		++ds->w04A0;
		while (true)
		{
l0C00_027B:
			if (ds->b04C4 != 0x00)
				break;
			if (ds->w04AC > 0x41)
			{
				--ds->w04AC;
				goto l0C00_02A9;
			}
			ds->b04C4 = 0x01;
		}
		if (ds->w04AC >= 0xFF)
			break;
		++ds->w04AC;
l0C00_02A9:
		si_253 = si_257;
		byte al_364;
		byte ah_365;
		if (!bios_kbd_check_keystroke(out al_364, out ah_365))
		{
			bios_video_set_mode(0x03);
			return;
		}
	}
	ds->b04C4 = 0x00;
	goto l0C00_027B;
}

// 0C00:02B6: void fn0C00_02B6(Register uint32 eax)
// Called from:
//      fn0C00_0100
void fn0C00_02B6(uint32 eax)
{
	byte ah = SLICE(eax, byte, 8);
	__outb(0x03C8, al);
	__outb(969, ah);
	__outb(969, (byte) (eax >> 0x10));
	__outb(969, SLICE(eax >> 0x10, byte, 8));
}

// 0C00:02C7: void fn0C00_02C7()
// Called from:
//      fn0C00_0100
void fn0C00_02C7()
{
	do
		;
	while ((__inb(0x03DA) & 0x08) != 0x00);
	do
		;
	while ((__inb(0x03DA) & 0x08) == 0x00);
}

// 0C00:02D5: void fn0C00_02D5(Register byte al, Register (ptr16 Eq_159) dx)
// Called from:
//      fn0C00_0100
void fn0C00_02D5(byte al, struct Eq_159 * dx)
{
	word16 cx_11;
	byte Eq_159::* di_14 = Eq_159::a0000;
	for (cx_11 = ~0x00; cx_11 != 0x00; --cx_11)
	{
		dx->*di_14 = al;
		++di_14;
	}
	dx->*di_14 = al;
}

// 0C00:02E0: void fn0C00_02E0()
// Called from:
//      fn0C00_0100
void fn0C00_02E0()
{
	word32 Eq_240::* si_16 = Eq_240::a0000;
	word32 Eq_511::* di_17 = Eq_511::a0000;
	word16 cx_20;
	for (cx_20 = 16000; cx_20 != 0x00; --cx_20)
	{
		0xA000->*di_17 = 0x6000->*si_16;
		++si_16;
		++di_17;
	}
}

// 0C00:02F5: void fn0C00_02F5(Register int16 si)
// Called from:
//      fn0C00_0100
void fn0C00_02F5(int16 si)
{
	byte Eq_240::* di_29 = Eq_240::a0000;
	word16 cx_27;
	for (cx_27 = 0xFA00; cx_27 != 0x00; --cx_27)
	{
		0x6000->*di_29 = 0x9000->*((char *) SEQ(0x8000->*di_29, 0x7000->*di_29) + si);
		++di_29;
	}
}

// 0C00:031B: void fn0C00_031B()
// Called from:
//      fn0C00_0366
void fn0C00_031B()
{
	0C00:033D();
	0C00:033D();
	0x033D();
}

// 0C00:0366: void fn0C00_0366(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0366(struct Eq_3 * ds)
{
	ds->r4D98 = (real32) ((real64) ds->r4D98 + (real64) ds->r04B0);
	ds->r4D9C = (real32) ((real64) ds->r4D9C + (real64) ds->r04B8);
	ds->r4DA0 = (real32) ((real64) ds->r4DA0 + (real64) ds->r04B8);
	struct Eq_578 Eq_3::* si_107 = &Eq_3::t0000;
	word16 cx_110 = ds->w4B64;
	do
	{
		ds->w0504 = si_107[650];
		ds->w0506 = si_107[0x0E42];
		ds->w0508 = si_107[6650];
		fn0C00_031B();
		int16 di_51 = ds->w0508 + ds->w04AE;
		Eq_587 di_79 = ((int16) (ds->w0506 *s 0x04E8 / di_51) + (ds->a4B66)[(uint16) ((byte) (ds->w04A0 << 0x01))] - 0x01) *s 0x0140 + ((int16) ((ds->w0504 *s 0x04E8) / di_51) + ds->w04AC) - 0x01;
		word16 Eq_3::* si_83 = Eq_3::a04C7;
		word16 cx_100;
		for (cx_100 = 0x03; cx_100 != 0x00; --cx_100)
		{
			0x6000->*di_79 = ds->*si_83;
			word16 Eq_3::* si_92 = si_83 + 1;
			word16 Eq_240::* di_93 = (word16) di_79 + 2;
			0x6000->*di_93 = ds->*si_92;
			si_83 = (word16 Eq_3::*) ((char *) si_92 + 1);
			di_79 = di_93 + 0x009F;
		}
		++si_107;
		cx_110 = cx_137 - 0x01;
		cx_137 = cx_110;
	} while (cx_137 != 0x01);
}

// 0C00:03FC: FpuStack real64 fn0C00_03FC(Register (ptr16 Eq_169) es, Register (ptr16 Eq_3) ds, FpuStack out Eq_171 rLoc1Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_03FC(struct Eq_169 * es, struct Eq_3 * ds, union Eq_171 & rLoc1Out)
{
	ds->a4D68[0] = 0x00;
	ds->a4D70[0] = 0x00;
	struct Eq_683 Eq_3::* si_7 = &Eq_3::t0000;
	struct Eq_685 Eq_3::* di_15 = &Eq_3::t0000;
	word16 cx_11 = 0x04;
	while (true)
	{
		Eq_171 rLoc1_109 = (real64) di_15[4958] + (real64) (ds->*di_15).r04D9;
		di_15[4958] = (real32) rLoc1_109;
		real64 rLoc2_111 = (real64) di_15[4962] + (real64) (ds->*di_15).r04E9;
		di_15[4962] = (real32) rLoc2_111;
		--cx_11;
		if (cx_11 == 0x00)
			break;
		real64 rLoc2_112 = rLoc2_111 * (real64) ds->r04A2;
		si_7[9909] = (int16) (cos(rLoc2_112) * rLoc1_109 + (real64) si_7[9908]);
		si_7[9913] = (int16) (rLoc1_109 * sin(rLoc2_112) + (real64) si_7[9912]);
		++di_15;
		++si_7;
	}
	__wait();
	__fninit();
	ci16 ax_28 = ds->w4D76;
	byte al_40 = (byte) (ax_28 + 0x80);
	if (ax_28 > 228 && ax_28 <= 222)
	{
		ci16 bx_34 = ds->w4D6E;
		byte bl_44 = (byte) (bx_34 + 0x80);
		if (bx_34 > 228 && bx_34 <= 222)
		{
			byte Eq_3::* si_107 = &Eq_3::b04D0;
			word16 dx_47;
			struct Eq_784 Eq_169::* bx_102 = SEQ(al_40 - 0x01, bl_44 - 0x01);
			for (dx_47 = 0x03; dx_47 != 0x00; --dx_47)
			{
				word16 cx_48;
				for (cx_48 = 0x03; cx_48 != 0x00; --cx_48)
				{
					cu8 al_55 = (es->*bx_102).b0000 + ds->*si_107;
					if (al_55 > ~0x05)
						al_55 = ~0x05;
					(es->*bx_102).b0000 = al_55;
					++si_107;
					bx_102 = &bx_102->b0000 + 1;
				}
				++bx_102;
			}
		}
	}
	rLoc1Out = rLoc1_109;
	return rLoc2_111;
}

