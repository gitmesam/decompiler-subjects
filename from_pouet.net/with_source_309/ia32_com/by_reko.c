// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register (ptr16 Eq_3) ds)
void fn0C00_0100(byte ah, struct Eq_3 * ds)
{
	Eq_4 Top_3 = 0;
	__syscall(0x10);
	cui16 cx_10;
	for (cx_10 = 0x04B0; cx_10 != 0x00; --cx_10)
		ah = SLICE((uint16) (uint8) fn0C00_0274(cx_10 << 0x01, ah), byte, 8);
	while (true)
	{
		ui16 cx_137 = 0x04B0;
		do
		{
			bool Z_40;
			Eq_338 si_29 = cx_137 << 0x01;
			if (ds->b029F < 0x04)
			{
				Eq_30 v11_37 = ds->a22A2[cx_137] - 0x01;
				ds->a22A2[cx_137] = v11_37;
				Z_40 = SLICE(cond(v11_37), bool, 2);
			}
			else
			{
				Eq_30 v14_34 = (word16) ds->a22A2[cx_137] + 1;
				ds->a22A2[cx_137] = v14_34;
				Z_40 = SLICE(cond(v14_34), bool, 2);
			}
			if (!Z_40)
				fn0C00_0274(cx_137 << 0x01, ah);
			(&ds->a32A2->b0000)[cx_137 * 0x02] = (cu8) ((bool) ((&ds->a32A2->b0000)[cx_137 * 0x02] < 0x28) + (&(ds->a32A2)->b0000)[cx_137 * 0x02]);
			__fninit();
			struct Eq_82 * Top_66 = Top_3 - 1;
			Top_66->r0000 = 3.14159265358979;
			Top_66->r0000 *= (real64) ds->w029D;
			Top_66->r0000 /= (real64) ds->w029B;
			real64 v17_70 = Top_66->r0000;
			Top_66->r0000 = cos(v17_70);
			Top_66->rFFFFFFFF = sin(v17_70);
			Top_66->rFFFFFFFE = Top_66->rFFFFFFFF;
			Top_66->rFFFFFFFE *= (real64) ds->a12A2[cx_137];
			Top_66->rFFFFFFFD = Top_66->rFFFFFFFE;
			Top_66->rFFFFFFFD *= (real64) ds->a02A2[cx_137];
			Top_66->rFFFFFFFD -= Top_66->rFFFFFFFE;
			ds->a42A2[cx_137] = (int16) Top_66->rFFFFFFFD;
			real64 v18_82 = Top_66->rFFFFFFFD;
			Top_66->rFFFFFFFD = Top_66->rFFFFFFFF;
			Top_66->rFFFFFFFF = v18_82;
			Top_66->rFFFFFFFD *= (real64) ds->a12A2[cx_137];
			Top_66->rFFFFFFFC = Top_66->rFFFFFFFF;
			Top_66->rFFFFFFFC *= (real64) ds->a02A2[cx_137];
			Top_66->rFFFFFFFC += Top_66->rFFFFFFFD;
			ds->a52A2[cx_137] = (int16) Top_66->rFFFFFFFC;
			ds->t62A2 = (int16) (ds->a42A2[cx_137] *s 100 / (ds->a22A2)[cx_137]) + 0xA0;
			ds->t62A4 = (int16) (ds->a52A2[cx_137] *s 100 / (ds->a22A2)[cx_137]) + 100;
			struct Eq_284 Eq_321::* ax_112 = (word16) ds->t62A2 + (word16) (ds->t62A4 *s 0x0140);
			Top_3 = Top_66 - 4;
			ah = SLICE(ax_112, byte, 8);
			if (ds->t62A2 <= 0x013F && ds->t62A4 <= 199)
			{
				cu8 al_118 = (&ds->a32A2->b0000)[cx_137 * 0x02];
				(0x9000->*ax_112).b0000 = al_118;
				if (ds->b02A1 == 0x01)
				{
					(0x9000->*ax_112).b0001 = al_118;
					(0x9000->*ax_112).b0140 = al_118;
					(0x9000->*ax_112).b0141 = al_118;
				}
			}
			--cx_137;
			byte ch_348 = SLICE(cx_137, byte, 8);
		} while (cx_137 != 0x00);
		if (ds->b029F != 0x02 && ds->b029F != 0x03)
		{
			if (ds->b029F >= 0x06)
			{
				cup16 v29_155 = ds->w029D - 0x01;
				ds->w029D = v29_155;
				if (v29_155 == 0x00)
					ds->w029D = 0x0168;
			}
		}
		else
		{
			++ds->w029D;
			if (ds->w029D >= 0x0169)
				ds->w029D = 0x01;
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		byte bl_166 = 0x1E;
		struct Eq_384 Eq_321::* di_168 = &Eq_321::t0000;
		cui16 dx_200 = 0x05;
		do
		{
			do
			{
				word16 cx_187 = SEQ(ch_348, 0x28);
				do
				{
					byte dl_178 = (byte) dx_401;
					byte al_175 = (0x9000->*di_168).b19AA;
					if (al_175 != 0x00)
						al_175 += dl_178;
					(0x9000->*di_168).b0000 = al_175;
					--cx_187;
					dx_200 = dx_401;
					di_168 = &di_168->b0000 + 1;
					ch_348 = SLICE(cx_187, byte, 8);
					ch_348 = SLICE(cx_187, byte, 8);
				} while (cx_187 != 0x00);
				di_168 = &di_168->b0000 + 0x0118;
				--bl_166;
				dx_401 = dx_200;
			} while (bl_166 != 0x00);
			bl_166 = 0x1E;
			++di_168;
			dx_200 = dx_401 - 0x01;
			dx_402 = dx_200;
		} while (dx_401 != 0x01);
		word16 cx_246;
		Eq_338 di_255 = si_29;
		for (cx_246 = cx_187 - 0x01; cx_246 != 0x00; --cx_246)
		{
			0xA000->*di_255 = 0x9000->*si_29;
			si_29 = (word16) si_29 + 2;
			di_255 = (word16) di_255 + 2;
		}
		word16 cx_266;
		for (cx_266 = cx_246 - 0x01; cx_266 != 0x00; --cx_266)
		{
			0x9000->*di_255 = 0x00;
			di_255 = (word16) di_255 + 2;
		}
		byte al_272;
		if (bios_kbd_check_keystroke(out al_272, out ah))
			break;
		byte v33_279 = ds->b02A0 + 0x01;
		ds->b02A0 = v33_279;
		if (v33_279 == 0x00)
		{
			++ds->b029F;
			ds->b02A1 = -ds->b02A1;
			if (ds->b029F >= 0x08)
				ds->b029F -= 0x08;
		}
	}
	bios_video_set_mode(0x03);
}

// 0C00:026C: Register byte fn0C00_026C(Register byte ah, Register int16 bx, Register out Eq_505 dxOut)
// Called from:
//      fn0C00_0274
byte fn0C00_026C(byte ah, int16 bx, union Eq_505 & dxOut)
{
	Eq_506 dx_ax_8 = (uint32) (uint16) SEQ(ah, __inb(0x40));
	dxOut = (int16) (dx_ax_8 % bx) + 0x01;
	return SLICE((int16) (dx_ax_8 / bx), byte, 8);
}

// 0C00:0274: Register byte fn0C00_0274(Sequence (ptr32 Eq_15) ds_si, Register byte ah)
// Called from:
//      fn0C00_0100
byte fn0C00_0274(struct Eq_15 * ds_si, byte ah)
{
	ds_si->b32A2 = 0x0F;
	word16 dx_10;
	byte ah_18 = SLICE((uint16) (uint8) fn0C00_026C(ah, 100, out dx_10), byte, 8);
	ds_si->w02A2 = dx_10 - 0x32;
	word16 dx_20;
	byte ah_29 = SLICE((uint16) (uint8) fn0C00_026C(ah_18, 100, out dx_20), byte, 8);
	ds_si->w12A2 = dx_20 - 0x32;
	word16 dx_31;
	uint16 ax_30 = (uint16) (uint8) fn0C00_026C(ah_29, 0xFE, out dx_31);
	ds_si->w22A2 = dx_31;
	return SLICE(ax_30, byte, 8);
}

