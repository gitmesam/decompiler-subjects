// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	Mem8[ds:1272:word16] = cs + 0x1000;
	bios_video_set_mode(0x13);
	__outb(0x03C8, 0x00);
	bcu8 ah_20 = 0x00;
	do
	{
		uint8 al_22 = ah_20 >> 0x02;
		__outb(969, al_22);
		__outb(969, al_22);
		__outb(969, -(al_22 >> 0x01) + al_22);
		++ah_20;
	} while (ah_20 != 0x00);
	__wait();
	__fninit();
	ds->r04EC = (real32) ((real64) ds->r0469 / (real64) ds->w0471);
	ds->r04F0 = (real32) ((real64) ds->r0469 / (real64) ds->w0473);
	ds->r04F4 = (real32) ((real64) ds->dw0475 / (3.14159265358979 + 3.14159265358979));
	fn0C00_0400(cs + 0x2000);
	Eq_84 Top_104 = 0;
	struct Eq_86 Eq_80::* di_63 = Eq_80::a0000;
	do
	{
		byte al_70 = Mem68[cs + 0x2000:di_63 + 0x01:byte] + Mem68[cs + 0x2000:di_63 + -1:byte];
		byte al_74 = __rcr(al_70, 0x01, SLICE(cond(al_70), bool, 1));
		byte bl_76 = Mem68[cs + 0x2000:di_63 + 0x0100:byte] + Mem68[cs + 0x2000:di_63 + -0x0100:byte];
		byte al_81 = al_74 + __rcr(bl_76, 0x01, SLICE(cond(bl_76), bool, 1));
		Mem87[cs + 0x2000:di_63 + 0x00:byte] = __rcr(al_81, 0x01, SLICE(cond(al_81), bool, 1));
		++di_63;
	} while (di_63 != Eq_80::a0000);
	do
	{
		word64 rRet1_102;
		real64 rRet0_103 = fn0C00_0233(ds, out rRet1_102);
		*((word32) Top_104 - 1) = rRet1_102;
		*((word32) Top_104 - 2) = rRet0_103;
		fn0C00_0312(cs + 0x1000, ds, cs + 0x2000);
		Eq_160 Top_107 = Top_104 - 2;
		struct Eq_5 * ds_126 = ds->ptr04F8;
		word16 cx_129;
		word32 Eq_5::* si_130 = Eq_5::a0000;
		word32 Eq_175::* di_131 = Eq_175::a0000;
		for (cx_129 = 16000; cx_129 != 0x00; --cx_129)
		{
			0xA000->*di_131 = ds_126->*si_130;
			++si_130;
			++di_131;
		}
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		word64 rRet1_164;
		real64 rRet0_165 = fn0C00_03CC(ds, out rRet1_164);
		*((word32) Top_107 - 1) = rRet1_164;
		*((word32) Top_107 - 2) = rRet0_165;
		ds->w047D += 0x0100;
		ds->w047F += 0x0300;
		Top_104 = Top_107 - 2;
		byte al_180;
		byte ah_181;
	} while (bios_kbd_check_keystroke(out al_180, out ah_181));
	byte al_186;
	bios_kbd_get_keystroke(out al_186);
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->b04A9);
	msdos_terminate(0x00);
}

// 0C00:01D3: void fn0C00_01D3(Register (memptr (ptr16 Eq_2) Eq_260) bx, Register (memptr (ptr16 Eq_2) Eq_261) si, Register (memptr (ptr16 Eq_2) Eq_262) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0233
void fn0C00_01D3(struct Eq_260 Eq_2::* bx, struct Eq_261 Eq_2::* si, struct Eq_262 Eq_2::* di, struct Eq_2 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 + (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 + (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 + (real64) (ds->*di).r0008);
}

// 0C00:01EC: void fn0C00_01EC(Register (memptr (ptr16 Eq_2) Eq_303) bx, Register (memptr (ptr16 Eq_2) Eq_304) si, Register (memptr (ptr16 Eq_2) Eq_305) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0233
void fn0C00_01EC(struct Eq_303 Eq_2::* bx, struct Eq_304 Eq_2::* si, struct Eq_305 Eq_2::* di, struct Eq_2 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 - (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 - (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 - (real64) (ds->*di).r0008);
}

// 0C00:0205: void fn0C00_0205(Register (memptr (ptr16 Eq_2) Eq_346) si, Register (memptr (ptr16 Eq_2) Eq_347) di, Register (ptr16 Eq_2) ds, FpuStack Eq_143 rArg0)
// Called from:
//      fn0C00_0233
void fn0C00_0205(struct Eq_346 Eq_2::* si, struct Eq_347 Eq_2::* di, struct Eq_2 * ds, Eq_143 rArg0)
{
	(ds->*di).r0000 = (real32) ((real64) (ds->*si).r0000 * rArg0);
	(ds->*di).r0004 = (real32) ((real64) (ds->*si).r0004 * rArg0);
	(ds->*di).r0008 = (real32) ((real64) (ds->*si).r0008 * rArg0);
}

// 0C00:021C: void fn0C00_021C(Register (memptr (ptr16 Eq_2) Eq_377) si, Register (memptr (ptr16 Eq_2) Eq_378) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0233
void fn0C00_021C(struct Eq_377 Eq_2::* si, struct Eq_378 Eq_2::* di, struct Eq_2 * ds)
{
	word32 ebx_8 = (ds->*si).dw0004;
	word32 ecx_9 = (ds->*si).dw0008;
	(ds->*di).dw0000 = (ds->*si).dw0000;
	(ds->*di).dw0004 = ebx_8;
	(ds->*di).dw0008 = ecx_9;
}

// 0C00:0233: FpuStack Eq_143 fn0C00_0233(Register (ptr16 Eq_2) ds, FpuStack out Eq_143 rLoc1Out)
// Called from:
//      fn0C00_0100
Eq_143 fn0C00_0233(struct Eq_2 * ds, union Eq_143 & rLoc1Out)
{
	fn0C00_01EC(&Eq_2::t04BC, &Eq_2::t048D, &Eq_2::t0481, ds);
	Eq_143 rLoc1_122 = (real64) ds->r04EC;
	fn0C00_0205(&Eq_2::t04BC, &Eq_2::t04BC, ds, rLoc1_122);
	__ffree(rLoc1_122);
	fn0C00_01EC(&Eq_2::t04C8, &Eq_2::t0499, &Eq_2::t0481, ds);
	Eq_143 rLoc2_123 = (real64) ds->r04F0;
	fn0C00_0205(&Eq_2::t04C8, &Eq_2::t04C8, ds, rLoc2_123);
	__ffree(rLoc2_123);
	fn0C00_021C(&Eq_2::t0481, &Eq_2::t04D4, ds);
	struct Eq_440 Eq_2::* bp_121 = &Eq_2::t0500;
	word16 cx_116 = 0x1A;
	do
	{
		fn0C00_021C(&Eq_2::t04D4, &Eq_2::r04E0, ds);
		word16 cx_110 = 0x29;
		do
		{
			real64 rLoc3_126 = (real64) ds->r04E0;
			real64 rLoc4_128 = (real64) ds->r04E4;
			ds->t04FA.u0 = (int32) ((real64) ds->r04A5 / sqrt(rLoc3_126 * rLoc3_126 + rLoc4_128 * rLoc4_128) * (real64) ds->r04E8 * (real64) ds->r046D);
			Eq_445 eax_61 = ds->t04FA;
			(ds->*bp_121).w0000 = (word16) eax_61 + ds->w047F;
			Eq_445 ebx_62 = eax_61;
			if (eax_61 < 0x00)
				ebx_62 = -eax_61;
			word16 bx_76 = (word16) ebx_62;
			if (ebx_62 >= 0x00010000)
				bx_76 = 0xFF00;
			(ds->*bp_121).w0004 = bx_76;
			ds->t04FA.u0 = (int32) (atan(rLoc2_123, (real64) ds->r04E0) * (real64) ds->r04F4);
			(ds->*bp_121).w0002 = (word16) ds->t04FA.u1 + ds->w047D;
			fn0C00_01D3(&Eq_2::r04E0, &Eq_2::r04E0, &Eq_2::t04BC, ds);
			++bp_121;
			cx_110 = cx_166 - 0x01;
			cx_166 = cx_110;
		} while (cx_166 != 0x01);
		fn0C00_01D3(&Eq_2::t04D4, &Eq_2::t04D4, &Eq_2::t04C8, ds);
		cx_116 = cx_165 - 0x01;
		cx_165 = cx_116;
	} while (cx_165 != 0x01);
	rLoc1Out = rLoc1_122;
	return rLoc2_123;
}

// 0C00:0312: void fn0C00_0312(Register (ptr16 Eq_154) es, Register (ptr16 Eq_2) ds, Register (ptr16 Eq_156) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0312(struct Eq_80 * es, struct Eq_2 * ds, struct Eq_80 * gs)
{
	struct Eq_547 Eq_2::* si_135 = &Eq_2::t0500;
	struct Eq_549 Eq_80::* di_105 = Eq_80::a0000;
	word16 cx_11 = 0x19;
	do
	{
		word16 cx_14 = 0x28;
		do
		{
			struct Eq_627 Eq_2::* si_23 = (char *) &si_135->dw0002 + 2;
			word32 ebx_125 = (ds->*si_23).dw0002;
			word32 eax_124 = (ds->*si_135).dw0000;
			word32 edx_28 = (ds->*si_23).dw00F8 - ebx_125;
			word32 ebp_30 = __rol((ds->*si_23).dw00F2 - eax_124, 0x10);
			word32 edx_32 = __rol(edx_28, 0x10);
			word32 ebp_40 = __rol(SEQ(SLICE(ebp_30, word16, 16), (word16) ebp_30 >> 0x03), 0x10);
			word32 edx_44 = __rol(SEQ(SLICE(edx_32, word16, 16), (word16) edx_32 >> 0x03), 0x10);
			ds->dw1DFC = SEQ(SLICE(ebp_40, word16, 16), (word16) ebp_40 >> 0x03);
			ds->dw1E00 = SEQ(SLICE(edx_44, word16, 16), (word16) edx_44 >> 0x03);
			byte dh_56 = (ds->*si_23).b0001;
			byte ch_128;
			for (ch_128 = 0x08; ch_128 != 0x00; --ch_128)
			{
				word32 ebx_68 = __rol(ebx_125 - eax_124, 0x10);
				word32 ebx_74 = __rol(SEQ(SLICE(ebx_68, word16, 16), (word16) ebx_68 >> 0x03), 0x10);
				word32 ebx_79 = SEQ(SLICE(ebx_74, word16, 16), (word16) ebx_74 >> 0x03);
				byte cl_111;
				eax_109 = eax_124;
				for (cl_111 = 0x08; cl_111 != 0x00; --cl_111)
				{
					word32 eax_109;
					word32 eax_88 = __rol(eax_109, 0x10);
					word32 eax_92 = __rol(eax_88, 0x10);
					cu8 bl_98 = gs->*SEQ(SLICE(eax_88, byte, 8), SLICE(eax_109, byte, 8)) - dh_56;
					(es->*di_105).b0000 = bl_98 & ~(0x00 - (bl_98 < 0x00));
					di_105 = &di_105->b0000 + 1;
					eax_109 = eax_92 + ebx_79;
				}
				di_105 = &di_105->b0000 + 312;
				eax_124 += ds->dw1DFC;
				ebx_125 += ds->dw1E00;
			}
			si_135 = (struct Eq_547 Eq_2::*) &si_23->dw0002;
			di_105 -= 0x08C0;
			cx_14 = cx_196 - 0x01;
			cx_196 = cx_14;
		} while (cx_196 != 0x01);
		si_135 = (struct Eq_547 Eq_2::*) ((char *) &si_23->dw0002 + 6);
		cx_11 = cx_195 - 0x01;
		cx_195 = cx_11;
	} while (cx_195 != 0x01);
}

// 0C00:03CC: FpuStack Eq_143 fn0C00_03CC(Register (ptr16 Eq_2) ds, FpuStack out Eq_143 rLoc1Out)
// Called from:
//      fn0C00_0100
Eq_143 fn0C00_03CC(struct Eq_2 * ds, union Eq_143 & rLoc1Out)
{
	real64 rLoc1_47 = (real64) ds->r0479;
	Eq_143 rLoc1_48 = cos(rLoc1_47);
	struct Eq_715 Eq_2::* si_17 = &Eq_2::t0481;
	Eq_143 rLoc2_49 = sin(rLoc1_47);
	word16 cx_13;
	for (cx_13 = 0x03; cx_13 != 0x00; --cx_13)
	{
		real64 rLoc4_51 = (real64) (ds->*si_17).r0004;
		real64 rLoc3_50 = (real64) (ds->*si_17).r0008;
		(ds->*si_17).r0004 = (real32) (rLoc4_51 * rLoc2_49 - rLoc3_50 * rLoc1_48);
		(ds->*si_17).r0008 = (real32) (rLoc4_51 * rLoc1_48 + rLoc3_50 * rLoc2_49);
		++si_17;
	}
	__ffree(rLoc2_49);
	__ffree(rLoc1_48);
	rLoc1Out = rLoc1_48;
	return rLoc2_49;
}

// 0C00:0400: void fn0C00_0400(Register (ptr16 Eq_80) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0400(struct Eq_80 * gs)
{
	gs->a0000[0] = 0x80;
	byte Eq_80::* bx_17 = Eq_80::a0000;
	Eq_763 cx_13 = 0x80;
	do
	{
		do
		{
			do
			{
				bx_77 = SEQ(bh_66, bl_63);
				byte Eq_80::* bx_32 = fn0C00_0431(cx_85, (byte) (cx_85 << 0x08), fn0C00_0431(SLICE(cx_85, byte, 8), cx_85, bx_17, gs), gs);
				fn0C00_0431(cx_85, -cx_85, SEQ(SLICE(bx_32, byte, 8), (word16) cx_85 + ((word16) cx_85 + (byte) bx_32)), gs);
				byte bh_66 = SLICE(bx_32, byte, 8);
				cx_13 = cx_85;
				byte ch_74 = SLICE(cx_85, byte, 8);
				cu8 bl_63 = (word16) cx_85 + ((word16) cx_85 + (byte) bx_32);
				cx_85 = cx_13;
				bx_17 = bx_77;
			} while (bl_63 >= 0x00);
			cu8 bh_68 = (word16) cx_85 + ((word16) cx_85 + bh_66);
			bx_17 = SEQ(bh_68, bl_63);
			cx_86 = cx_13;
		} while (bh_68 >= 0x00);
		cx_13 = SEQ(ch_74, cx_85 >> 0x01);
		cx_87 = cx_13;
	} while (cx_85 >> 0x01 != 0x00);
}

// 0C00:0431: Register (memptr (ptr16 Eq_80) byte) fn0C00_0431(Register Eq_763 ch, Register Eq_763 cl, Register (memptr (ptr16 Eq_80) byte) bx, Register (ptr16 Eq_80) gs)
// Called from:
//      fn0C00_0400
byte Eq_80::* fn0C00_0431(Eq_763 ch, Eq_763 cl, byte Eq_80::* bx, struct Eq_80 * gs)
{
	byte bh_9 = SLICE(bx, byte, 8);
	byte bl_13 = (byte) bx;
	byte bh_12 = (byte) ch.u1 + ((byte) ch.u1 + bh_9);
	byte bl_16 = (byte) cl.u1 + ((byte) cl.u1 + bl_13);
	Eq_824 dx_24 = gs->*SEQ(bh_12, bl_16) + gs->*bx;
	int16 ax_28 = (int16) __inb(0x40);
	Eq_840 dx_34 = (dx_24 >> 0x01) + (SEQ(SLICE(ax_28, byte, 8), (byte) ax_28 << cl) >> 0x03);
	byte dh_40 = SLICE(dx_34, byte, 8);
	byte dl_46 = (byte) dx_34;
	if (dx_34 < 0x00)
	{
		dh_40 = 0x00;
		dl_46 = 0x00;
	}
	if (dh_40 != 0x00)
		dl_46 = ~0x00;
	byte bh_51 = bh_12 - ch;
	byte bl_56 = bl_16 - cl;
	gs->*SEQ(bh_51, bl_56) = dl_46;
	return SEQ(bh_51 - ch, bl_56 - cl);
}

