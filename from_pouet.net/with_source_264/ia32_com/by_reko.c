// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) es, Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * es, struct Eq_2 * ds)
{
	__syscall(0x10);
	word16 cx_16 = 0x0100;
	do
	{
		bcu8 al_10 = (byte) -cx_16;
		__outb(969, al_10 >> 0x03);
		__outb(969, al_10 >> 0x04);
		__outb(969, al_10 >> 0x04 << 0x02);
		--cx_16;
		byte cl_206 = (byte) cx_16;
	} while (cx_16 != 0x00);
	real64 rLoc1_233 = 0.0;
	do
	{
		byte Eq_2::* di_21 = Eq_2::a0200;
		word16 cx_130 = SEQ(~0x05, cl_206);
		do
		{
			cu8 al_28;
			cu8 al_25 = ds->*di_21;
			if (al_25 > 0x08)
				al_28 = al_25 - 0x08;
			else
				al_28 = 0x00;
			es->*di_21 = al_28;
			++di_21;
			--cx_130;
		} while (cx_130 != 0x00);
		do
		{
			uint32 dx_ax_46 = (uint32) cx_130;
			uint32 dx_ax_56 = (uint32) (uint16) (dx_ax_46 /u 0x28);
			Eq_69 dx_58 = (uint16) (dx_ax_56 % 0x28);
			Eq_73 ax_59 = (uint16) (dx_ax_56 /u 0x28);
			Eq_77 dx_48 = (uint16) (dx_ax_46 % 0x28);
			Eq_81 ax_73 = (dx_48 - 0x14) *s (dx_48 - 0x14) + ((dx_58 - 0x14) *s (dx_58 - 0x14) + (ax_59 - 0x14) *s (ax_59 - 0x14));
			byte ah_114 = SLICE(ax_73, byte, 8);
			if (ax_73 < 133 || ax_73 >= 0x0280)
			{
				real64 rRet1_90;
				real64 rRet2_91;
				word64 rRet1_96;
				word64 rRet2_97;
				Eq_104 di_108 = ((int16) fn0C00_01D5(fn0C00_01D5((real64) (dx_58 - 0x14), (real64) (ax_59 - 0x14), (real64) (dx_48 - 0x14), rLoc1_233, out rRet1_90, out rRet2_91), rRet1_90, rRet2_91, rLoc1_233, out rRet1_96, out rRet2_97) + 100) *s 0x0140 + (int16) rRet1_96;
				cu8 al_117 = (byte) (SEQ(ah_114, 0x80) + (int16) rRet2_97);
				if (al_117 > ds->*((word16) di_108 + 688))
					es->*((word16) di_108 + 688) = al_117;
			}
			--cx_130;
		} while (cx_130 != 0x00);
		struct Eq_151 Eq_2::* di_131 = Eq_2::a0340;
		word16 cx_132;
		for (cx_132 = 0xF8C0; cx_132 != 0x00; --cx_132)
		{
			byte al_138 = (ds->*di_131).bFFFFFEC0 + (ds->*di_131).bFFFFFFFF;
			cu8 al_142 = al_138 + di_131[1];
			cu8 al_146 = al_142 + di_131[320];
			(es->*di_131).b0000 = (byte) (SEQ(SLICE(cond(al_138), bool, 1) + (al_142 < 0x00) + (al_146 < 0x00), al_146) >> 0x02);
			++di_131;
		}
		byte Eq_2::* si_165 = Eq_2::a0200;
		byte Eq_215::* di_166 = Eq_215::a0000;
		word16 cx_172 = cx_132 - 0x01;
		while (true)
		{
			cl_206 = (byte) cx_172;
			if (cx_172 == 0x00)
				break;
			0xA000->*di_166 = ds->*si_165;
			++si_165;
			++di_166;
			--cx_172;
		}
		rLoc1_233 += (real64) ds->w01D3;
	} while (__inw(0x60) != 0x01);
}

// 0C00:01D5: FpuStack real64 fn0C00_01D5(FpuStack real64 rArg0, FpuStack real64 rArg1, FpuStack real64 rArg2, FpuStack real64 rArg3, FpuStack out Eq_111 rArg1Out, FpuStack out Eq_112 rArg2Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_01D5(real64 rArg0, real64 rArg1, real64 rArg2, real64 rArg3, union Eq_111 & rArg1Out, union Eq_112 & rArg2Out)
{
	Eq_112 rLoc1_58 = sin(rArg3) * rArg0 + cos(rArg3) * rArg1;
	Eq_111 rArg1_66 = rArg1 * sin(rArg3) - rArg0 * cos(rArg3);
	real64 rLoc1_72 = cos(sin(rArg3));
	rArg1Out = rArg1_66;
	rArg2Out = rLoc1_58;
	return rArg2 * (((rLoc1_72 + rLoc1_72) * rLoc1_58) * rArg1_66);
}

