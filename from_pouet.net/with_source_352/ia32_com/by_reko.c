// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	__syscall(0x10);
	fn0C00_0289(0x00, 0x38);
	fn0C00_0289(0x0F, 0x00);
	fn0C00_029C(0x03, 0x0F);
	fn0C00_02A7(&ds->b0505);
	fn0C00_029C(0x07, 11);
	fn0C00_02A7(&ds->b051E);
	fn0C00_029C(0x09, 0x08);
	fn0C00_02A7(&ds->b052F);
	fn0C00_029C(0x0E, 0x0D);
	fn0C00_02A7(&ds->b0547);
	fn0C00_02AE(0x30, 0x40);
	fn0C00_029C(0x05, 0x0D);
	fn0C00_02A7(&ds->b050F);
	fn0C00_02AE(0x50, 0x40);
	word16 cx_349 = 0x7D00;
	word16 Eq_86::* di_346 = Eq_86::a0000;
	while (true)
	{
		byte ch_79 = SLICE(cx_349, byte, 8);
		if (cx_349 == 0x00)
			break;
		0xA000->*di_346 = 0x00;
		++di_346;
		--cx_349;
	}
	byte ch_115 = SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_79, 0x00), 0x00, &Eq_2::b02C2, &Eq_86::b4BE4, 0xA000, ds), byte, 8), 0x28), 0x40), byte, 8);
	fn0C00_029C(0x05, 0x0A);
	fn0C00_02A7(&ds->b055F);
	fn0C00_029C(0x06, 0x0A);
	fn0C00_02A7(&ds->b056E);
	byte ch_135 = SLICE(fn0C00_02AE(SEQ(ch_115, 0x38), 0x40), byte, 8);
	fn0C00_029C(0x05, 0x0A);
	fn0C00_02A7(&ds->b057D);
	fn0C00_029C(0x06, 0x0A);
	fn0C00_02A7(&ds->b058F);
	byte Eq_86::* di_144 = Eq_86::a3200;
	word16 cx_149 = SEQ(0x14, (byte) fn0C00_02AE(SEQ(ch_135, 0x38), 0x40));
	while (true)
	{
		byte ch_152 = SLICE(cx_149, byte, 8);
		if (cx_149 == 0x00)
			break;
		0xA000->*di_144 = 0x00;
		++di_144;
		--cx_149;
	}
	byte ch_166 = SLICE(fn0C00_02AE(SEQ(ch_152, 0x18), 0x40), byte, 8);
	ds->b02BF = 77;
	ds->w02C0 = 0xF3;
	byte ch_191 = SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_166, 0x00), 0x00, &Eq_2::b059E, &Eq_86::b5C16, 0xA000, ds), byte, 8), 0x12), 0x40), byte, 8);
	A000:5F91 = (byte *) 0x00;
	byte ch_204 = SLICE(fn0C00_02AE(SEQ(ch_191, 0x14), 0x40), byte, 8);
	ds->b02BF = 0xA9;
	ds->w02C0 = 151;
	struct Eq_204 Eq_86::* di_224 = &Eq_86::t7D99;
	word16 cx_228 = SEQ(SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_204, 0x00), 0x00, &Eq_2::b02C2, &Eq_86::b4BE4, 0xA000, ds), byte, 8), 0x40), 0x40), byte, 8), 0x09);
	do
	{
		do
		{
			word16 cx_236;
			(0xA000->*di_224).w0000 = 0x0F0F;
			di_224 -= 0x0140;
			--cx_236;
		} while (cx_236 != 0x00);
		fn0C00_02AE(cx_236 + 0x02, 0x40);
		cx_228 = cx_236 - 0x01;
		byte ch_362 = SLICE(cx_236 - 0x01, byte, 8);
		cx_236 = cx_228;
	} while (cx_236 != 0x01);
	struct Eq_256 Eq_86::* di_255 = Eq_86::a5097;
	word16 cx_259 = SEQ(ch_362, 0x02);
	do
	{
		(0xA000->*di_255).dw0000 = 0x28042804;
		word16 cx_266 = -cx_378;
		fn0C00_02AE(SEQ(SLICE(cx_266 + 0x06, byte, 8), (byte) (cx_266 + 0x06) << 0x01), 0x40);
		++di_255;
		cx_259 = cx_378 - 0x01;
		byte ch_365 = SLICE(cx_378 - 0x01, byte, 8);
		cx_378 = cx_259;
	} while (cx_378 != 0x01);
	word16 cx_373 = SEQ(ch_365, 55);
	do
	{
		byte cl_286 = (byte) cx_377;
		fn0C00_0289(0x00, (uint16) cl_286);
		fn0C00_02AE(SEQ(SLICE(cx_377, byte, 8), (cl_286 & 0x01) + 0x01), 0x40);
		cx_373 = cx_377 - 0x01;
		cx_377 = cx_373;
	} while (cx_377 != 0x01);
	fn0C00_029C(0x07, 0x0C);
	fn0C00_02A7(&ds->b0557);
	fn0C00_02AE(0x1E, 0x40);
	byte al_338;
	bios_kbd_get_keystroke(out al_338);
	msdos_terminate(al_338);
}

// 0C00:0268: Register byte fn0C00_0268(Sequence word16 ch_al, Register ui8 ah, Register (memptr (ptr16 Eq_2) byte) si, Register (memptr (ptr16 Eq_86) byte) di, Register (ptr16 Eq_86) es, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0268(word16 ch_al, ui8 ah, byte Eq_2::* si, byte Eq_86::* di, struct Eq_86 * es, struct Eq_2 * ds)
{
	word16 ch_al_74 = ch_al;
l0C00_0268:
	cu8 bh_22 = 0x00;
	di += ds->w02C0;
	word16 ch_al_71 = ch_al_74;
	while (true)
	{
		byte ch_53 = SLICE(ch_al_71, byte, 16);
		byte al_15 = ds->*si;
		++si;
		if (al_15 == 0x00)
			break;
		bh_22 += al_15;
		word16 cx_27 = SEQ(ch_53, al_15);
		while (true)
		{
			byte ch_56 = SLICE(cx_27, byte, 8);
			if (cx_27 == 0x00)
				break;
			es->*di = ah;
			++di;
			--cx_27;
		}
		ch_al_74 = SEQ(ch_56, ah);
		if (bh_22 >= ds->b02BF)
			goto l0C00_0268;
		ah = ah ^ 0x0F;
		ch_al_71 = SEQ(ch_56, ah);
	}
	return SLICE(ch_al_71, byte, 8);
}

// 0C00:0289: void fn0C00_0289(Register byte al, Register uint16 bx)
// Called from:
//      fn0C00_0100
void fn0C00_0289(byte al, uint16 bx)
{
	byte bl_14 = (byte) bx;
	byte bh_16 = SLICE(bx, byte, 8);
	__outb(0x03C8, al);
	__outb(969, bl_14 + bh_16);
	__outb(969, bl_14);
	__outb(969, bl_14);
}

// 0C00:029C: void fn0C00_029C(Register byte dh, Register byte dl)
// Called from:
//      fn0C00_0100
void fn0C00_029C(byte dh, byte dl)
{
	bios_video_set_cursor_position(0x00, dh, dl);
}

// 0C00:02A7: void fn0C00_02A7(Sequence (ptr32 char) ds_dx)
// Called from:
//      fn0C00_0100
void fn0C00_02A7(char * ds_dx)
{
	msdos_display_string(ds_dx);
}

// 0C00:02AE: Register word16 fn0C00_02AE(Register word16 cx, Register (ptr16 Eq_59) fs)
// Called from:
//      fn0C00_0100
word16 fn0C00_02AE(word16 cx, struct Eq_59 * fs)
{
	do
	{
		byte dh_6 = fs->b006C;
		do
			;
		while (fs->b006C == dh_6);
		--cx;
	} while (cx != 0x00);
	return cx;
}

