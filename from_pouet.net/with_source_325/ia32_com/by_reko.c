// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (memptr (ptr16 Eq_22) real32) bx, Register (ptr16 Eq_3) ds, FpuStack real64 rLoc4, FpuStack real64 rLoc2)
void fn0C00_0100(real32 Eq_22::* bx, struct Eq_3 * ds, real64 rLoc4, real64 rLoc2)
{
	__syscall(0x10);
	__wait();
	__fninit();
	do
	{
		rLoc2 = sin(rLoc2);
		cs->*bx = (real32) rLoc2;
		++bx;
	} while (bx != &Eq_22::r0000);
	__outb(0x03C8, 0x00);
	byte al_35 = 0x00;
	byte dl_287 = 0xC9;
	byte dh_289 = 0x03;
	Eq_43 cx_100;
	for (cx_100 = 0x40; cx_100 != 0x00; --cx_100)
	{
		__outb(969, al_35);
		__outb(969, al_35);
		__outb(969, al_35);
		++al_35;
	}
	fn0C00_02C9(969);
	ds->b02CF = 0xC3;
	ds->b02E0 = 0xC0;
	byte bl_286 = (byte) (uint16) (uint8) fn0C00_02C9(969);
	struct Eq_78 Eq_141::* sp_102 = fp;
	struct Eq_80 Eq_22::* di_128 = &Eq_22::tFFFFFA00;
	do
	{
		bcu8 bl_76 = bl_286 + (0xA000->*di_128).bFFFFFEC0 + (0xA000->*di_128).bFFFFFEC1 + (0xA000->*di_128).bFFFFFEC2;
		word16 dx_83 = __ror(SEQ(dh_289, dl_287 - dh_289), 0x03);
		byte al_94 = (byte) (SEQ(SLICE(dx_83 ^ 0x3636, byte, 8), ((byte) (dx_83 ^ 0x3636) >> 0x06) + (bl_76 >> 0x02)) - 0x01);
		(0xA000->*di_128).b0000 = al_94;
		(cs->*di_128).b0000 = al_94;
		struct Eq_22 * dx_104 = dx_83 ^ 0x3636;
		dl_287 = (byte) (dx_83 ^ 0x3636);
		dh_289 = SLICE(dx_83 ^ 0x3636, byte, 8);
		bl_286 = al_94;
		++di_128;
		--cx_100;
	} while (cx_100 != 0x00);
	do
	{
		struct Eq_138 Eq_141::* sp_103 = sp_102 - 2;
		(ss->*sp_103).ptr0000 = dx_104;
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		(ss->*sp_103).ptrFFFFFFFE = cs;
		struct Eq_22 * ds_119 = (ss->*sp_103).ptrFFFFFFFE;
		(ss->*sp_103).ptrFFFFFFFE = cs;
		struct Eq_22 * es_125 = (ss->*sp_103).ptrFFFFFFFE;
		struct Eq_80 Eq_22::* si_129 = di_128;
		for (--cx_100; cx_100 != 0x00; --cx_100)
		{
			(es_125->*di_128).b0000 = (ds_119->*si_129).b0000;
			++si_129;
			++di_128;
		}
		(ss->*sp_103).ptrFFFFFFFE = cs;
		struct Eq_22 * ds_140 = (ss->*sp_103).ptrFFFFFFFE;
		byte v28_142 = ds_140->b02FF - 0x01;
		ds_140->b02FF = v28_142;
		if (v28_142 == 0x00)
		{
			__outb(0x0330, 0xC9);
			__outb(0x0330, 0x01);
			__outb(0x0330, 0x99);
			byte al_151 = ds_140->b02F2;
			if (al_151 == 0x00)
				al_151 = ds_140->b02F2;
			ds_140->w01A3 = 755;
			__outb(0x0330, al_151);
			__outb(0x0330, 0x7F);
			ds_140->b02FF = 0x03;
		}
		struct Eq_22 * dx_171 = (ss->*sp_103).ptr0000;
		struct Eq_204 Eq_141::* sp_172 = (char *) &sp_103->ptr0000 + 2;
		do
		{
			do
			{
				ds_140->t0370.u1 = 0x00;
				ds_140->w0374 = 0x3C;
				fn0C00_02A9(&cs->r0000, &Eq_22::t0370, &Eq_22::w0374, ds_140, rLoc4);
				word16 di_405;
				fn0C00_0299(cx_100, dx_171, &Eq_22::t0370, &Eq_22::w0372, ds_140, rLoc4, out di_405);
				ds_140->w0376 = 0x80;
				ds_140->dw0378 = 0x00;
				byte dh_226 = SLICE(dx_171, byte, 8);
				byte dl_296 = (byte) dx_171;
				sp_172 = (struct Eq_204 Eq_141::*) ((char *) &sp_406->ptr0000 + 0x0000FFFC);
				struct Eq_285 Eq_22::* di_207;
				ds_140 = fn0C00_0235(0x00, cx_100, fn0C00_0299(cx_100, dx_171, &Eq_22::w0376, &Eq_22::dw0378, ds_140, rLoc4, out di_207), di_207, ds_140, cs);
				sp_406 = sp_172;
			} while (true);
			cx_100.u1 = (word16) cx_100 + 0x0080;
			sp_407 = sp_172;
		} while (cx_100 != 0x00);
		di_128 = &Eq_22::r0000;
		dx_104 = SEQ(dh_226 - 0x02, dl_296);
		do
		{
			struct Eq_78 Eq_141::* sp_232 = (char *) &sp_406->ptr0000 + 0x0000FFFC;
			(ss->*sp_232).ptrFFFFFFFE = cs;
			struct Eq_22 * es_237 = (ss->*sp_232).ptrFFFFFFFE;
			if ((ds_140->*di_128).b0000 != 0x7F && di_128[0x0A10] == 0x7F)
				di_128[0x0A10] = (es_237->*di_128).b0000 - 0x08;
			(ds_140->*di_128).b0000 = 0x7F;
			byte al_256 = (cs->*di_128).b0000;
			(ss->*sp_232).ptrFFFFFFFE = 0xA000;
			((sp_232 - 2)->*di_128).b0000 = al_256;
			sp_102 = sp_232;
			++di_128;
			--cx_100;
		} while (cx_100 != 0x00);
	} while (__inb(0x60) != 0x01);
	bios_video_set_mode(0x03);
}

// 0C00:0235: Register (ptr16 Eq_22) fn0C00_0235(Register Eq_288 ah, Register Eq_43 ch, Register (memptr (ptr16 Eq_22) ci16) si, Register (memptr (ptr16 Eq_22) Eq_285) di, Register (ptr16 Eq_22) ds, Register (ptr16 Eq_22) fs)
// Called from:
//      fn0C00_0100
struct Eq_22 * fn0C00_0235(Eq_288 ah, Eq_43 ch, ci16 Eq_22::* si, struct Eq_285 Eq_22::* di, struct Eq_22 * ds, struct Eq_22 * fs)
{
	byte ah_30 = SLICE(ax, byte, 8);
	byte ch_29 = SLICE(cx, byte, 8);
	Eq_239 ax_47 = ds->t0370;
	int16 ax_51 = ds->w0372;
	ci8 bl_67 = (byte) ((ds->*di).wFFFFFFFA + (ds->*di).w0000 >> 0x01);
	byte al_59 = (byte) ((~(word16) (ax_51 *s ax_51 + ax_47 *s ax_47) >> 0x06) + 0x80) + ((ch_29 ^ ah_30) & 0x20) * 0x02;
	fn0C00_028E(fn0C00_028E(fn0C00_028E(fn0C00_028E((ds->w0372 + ds->*si >> 0x01) *s 0x0140 + (((word32) ds->t0370 + ds->w0376 >> 0x01) + 0x7DA0), al_59, bl_67, fs), al_59, bl_67, fs) + 0x013E, al_59, bl_67, fs), al_59, bl_67, fs);
	return fs;
}

// 0C00:028E: Register (memptr (ptr16 Eq_22) byte) fn0C00_028E(Sequence (ptr32 ci8) ds_di, Register byte al, Register ci8 bl, Register (ptr16 Eq_22) fs)
// Called from:
//      fn0C00_0235
byte Eq_22::* fn0C00_028E(ci8 * ds_di, byte al, ci8 bl, struct Eq_22 * fs)
{
	byte Eq_22::* di = (word16) ds_di;
	if (*ds_di >= bl)
	{
		*ds_di = bl;
		fs->*di = al;
	}
	return di + 1;
}

// 0C00:0299: Register (memptr (ptr16 Eq_22) int16) fn0C00_0299(Sequence (ptr32 Eq_247) gs_cx, Register (ptr16 Eq_22) dx, Register (memptr (ptr16 Eq_22) int16) si, Register (memptr (ptr16 Eq_22) int16) di, Register (ptr16 Eq_22) ds, FpuStack real64 rLoc3, Register out ptr16 diOut)
// Called from:
//      fn0C00_0100
int16 Eq_22::* fn0C00_0299(struct Eq_247 * gs_cx, struct Eq_22 * dx, int16 Eq_22::* si, int16 Eq_22::* di, struct Eq_22 * ds, real64 rLoc3, ptr16 & diOut)
{
	struct Eq_469 * gs = SLICE(gs_cx, selector, 16);
	fn0C00_02A9(gs_cx, si, di, ds, rLoc3);
	fn0C00_02A9(&&(gs->*(gs->*dx).r0000), si, di + 1, ds, rLoc3);
	fn0C00_02A9(&&(gs->*(gs->*dx).r0000), si + 1, di + 1, ds, rLoc3);
	diOut = di + 1;
	return si + 1;
}

// 0C00:02A9: void fn0C00_02A9(Sequence (ptr32 Eq_247) gs_bx, Register (memptr (ptr16 Eq_22) int16) si, Register (memptr (ptr16 Eq_22) int16) di, Register (ptr16 Eq_22) ds, FpuStack real64 rLoc3)
// Called from:
//      fn0C00_0100
//      fn0C00_0299
void fn0C00_02A9(struct Eq_247 * gs_bx, int16 Eq_22::* si, int16 Eq_22::* di, struct Eq_22 * ds, real64 rLoc3)
{
	real64 rLoc1_33 = (real64) gs_bx->r4000;
	real64 rLoc2_34 = (real64) (ds->*si);
	ds->*si = (int16) (rLoc3 * gs_bx->r0000 - (real64) (ds->*di) * rLoc1_33);
	ds->*di = (int16) (rLoc1_33 * rLoc2_34 + (real64) (ds->*di) * gs_bx->r0000);
}

// 0C00:02C9: Register byte fn0C00_02C9(Register word16 dx)
// Called from:
//      fn0C00_0100
byte fn0C00_02C9(word16 dx)
{
	byte bl_13;
	byte bh_18 = 0x00;
	for (bl_13 = 0x00; bl_13 != 0x40; bl_13 += 0x02)
	{
		__outb(dx, bl_13);
		__outb(dx, 0x00);
		__outb(dx, 0x00);
	}
	do
	{
		__outb(dx, 0x3F);
		__outb(dx, bh_18);
		__outb(dx, bh_18);
		bh_18 += 0x02;
	} while (bh_18 != 0x40);
	return bl_13;
}

