// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * ds)
{
	Mem8[ds:0x04F6:word16] = cs + 0x1000;
	bios_video_set_mode(0x13);
	__outb(0x03C8, 0x00);
	bcu8 ah_127 = 0x00;
	do
	{
		uint8 al_22 = ah_127 >> 0x02;
		__outb(969, al_22);
		__outb(969, al_22);
		__outb(969, al_22);
		++ah_127;
	} while (ah_127 != 0x00);
	__wait();
	__fninit();
	ds->r04EA = (real32) ((real64) ds->r0467 / (real64) ds->w046F);
	ds->r04EE = (real32) ((real64) ds->r0467 / (real64) ds->w0471);
	ds->r04F2 = (real32) ((real64) ds->dw0473 / (3.14159265358979 + 3.14159265358979));
	fn0C00_03C8(cs + 0x2000);
	Eq_80 Top_49 = 0;
	do
	{
		fn0C00_0186(cs + 0x1000);
		word64 rRet3_80;
		word64 rRet2_81;
		word64 rRet1_82;
		word64 rRet0_83 = fn0C00_01CF(cs + 0x1000, ds, cs + 0x2000, out rRet1_82, out rRet2_81, out rRet3_80);
		*((word32) Top_49 - 1) = rRet3_80;
		*((word32) Top_49 - 2) = rRet2_81;
		*((word32) Top_49 - 3) = rRet1_82;
		*((word32) Top_49 - 4) = rRet0_83;
		fn0C00_0192(ds);
		fn0C00_01AA();
		ds->w047B += 0x0100;
		ds->w047D += 0x0100;
		Top_49 -= 4;
		byte al_112;
		byte ah_113;
	} while (bios_kbd_check_keystroke(out al_112, out ah_113));
	byte al_118;
	bios_kbd_get_keystroke(out al_118);
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->b04A7);
	msdos_terminate(0x00);
}

// 0C00:0186: void fn0C00_0186(Register (ptr16 Eq_84) es)
// Called from:
//      fn0C00_0100
void fn0C00_0186(struct Eq_76 * es)
{
	word16 cx_15;
	word32 Eq_76::* di_12 = Eq_76::a0000;
	for (cx_15 = 16000; cx_15 != 0x00; --cx_15)
	{
		es->*di_12 = 0x00;
		++di_12;
	}
}

// 0C00:0192: void fn0C00_0192(Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0192(struct Eq_2 * ds)
{
	struct Eq_5 * ds_11 = ds->ptr04F6;
	word16 cx_14;
	word32 Eq_5::* si_15 = Eq_5::a0000;
	word32 Eq_193::* di_16 = Eq_193::a0000;
	for (cx_14 = 16000; cx_14 != 0x00; --cx_14)
	{
		0xA000->*di_16 = ds_11->*si_15;
		++si_15;
		++di_16;
	}
}

// 0C00:01AA: void fn0C00_01AA()
// Called from:
//      fn0C00_0100
void fn0C00_01AA()
{
	do
		;
	while ((__inb(0x03DA) & 0x08) == 0x00);
	do
		;
	while ((__inb(0x03DA) & 0x08) != 0x00);
}

// 0C00:01CF: FpuStack real64 fn0C00_01CF(Register (ptr16 Eq_93) es, Register (ptr16 Eq_2) ds, Register (ptr16 Eq_95) gs, FpuStack out Eq_96 rLoc3Out, FpuStack out Eq_97 rLoc2Out, FpuStack out Eq_98 rLoc1Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_01CF(struct Eq_76 * es, struct Eq_2 * ds, struct Eq_76 * gs, union Eq_96 & rLoc3Out, union Eq_97 & rLoc2Out, union Eq_98 & rLoc1Out)
{
	Eq_98 rRet1_11;
	Eq_97 rLoc2_43 = fn0C00_0433(ds, out rRet1_11);
	Eq_96 rRet1_25;
	real64 rLoc4_45 = fn0C00_01D9(ds, out rRet1_25);
	fn0C00_0300(es, ds, gs);
	rLoc3Out = rRet1_25;
	rLoc2Out = rLoc2_43;
	rLoc1Out = rRet1_11;
	return rLoc4_45;
}

// 0C00:01D9: FpuStack Eq_227 fn0C00_01D9(Register (ptr16 Eq_2) ds, FpuStack out Eq_227 rLoc1Out)
// Called from:
//      fn0C00_01CF
Eq_227 fn0C00_01D9(struct Eq_2 * ds, union Eq_227 & rLoc1Out)
{
	fn0C00_0268(&Eq_2::t04BA, &Eq_2::t048B, &Eq_2::t047F, ds);
	Eq_227 rLoc1_68 = (real64) ds->r04EA;
	fn0C00_0281(&Eq_2::t04BA, &Eq_2::t04BA, ds, rLoc1_68);
	__ffree(rLoc1_68);
	fn0C00_0268(&Eq_2::t04C6, &Eq_2::t0497, &Eq_2::t047F, ds);
	Eq_227 rLoc2_69 = (real64) ds->r04EE;
	fn0C00_0281(&Eq_2::t04C6, &Eq_2::t04C6, ds, rLoc2_69);
	__ffree(rLoc2_69);
	fn0C00_0298(&Eq_2::t047F, &Eq_2::t04D2, ds);
	ds->ptr04FC = &Eq_2::t04FE;
	word16 cx_26 = 0x33;
	do
	{
		fn0C00_0298(&Eq_2::t04D2, &Eq_2::r04DE, ds);
		word16 cx_38 = 0x51;
		do
		{
			fn0C00_02AF(ds, rLoc2_69);
			fn0C00_024F(&Eq_2::r04DE, &Eq_2::r04DE, &Eq_2::t04BA, ds);
			cx_38 = cx_84 - 0x01;
			cx_84 = cx_38;
		} while (cx_84 != 0x01);
		fn0C00_024F(&Eq_2::t04D2, &Eq_2::t04D2, &Eq_2::t04C6, ds);
		cx_26 = cx_83 - 0x01;
		cx_83 = cx_26;
	} while (cx_83 != 0x01);
	rLoc1Out = rLoc1_68;
	return rLoc2_69;
}

// 0C00:024F: void fn0C00_024F(Register (memptr (ptr16 Eq_2) Eq_307) bx, Register (memptr (ptr16 Eq_2) Eq_308) si, Register (memptr (ptr16 Eq_2) Eq_309) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_024F(struct Eq_307 Eq_2::* bx, struct Eq_308 Eq_2::* si, struct Eq_309 Eq_2::* di, struct Eq_2 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 + (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 + (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 + (real64) (ds->*di).r0008);
}

// 0C00:0268: void fn0C00_0268(Register (memptr (ptr16 Eq_2) Eq_247) bx, Register (memptr (ptr16 Eq_2) Eq_248) si, Register (memptr (ptr16 Eq_2) Eq_249) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_0268(struct Eq_247 Eq_2::* bx, struct Eq_248 Eq_2::* si, struct Eq_249 Eq_2::* di, struct Eq_2 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 - (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 - (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 - (real64) (ds->*di).r0008);
}

// 0C00:0281: void fn0C00_0281(Register (memptr (ptr16 Eq_2) Eq_261) si, Register (memptr (ptr16 Eq_2) Eq_262) di, Register (ptr16 Eq_2) ds, FpuStack Eq_227 rArg0)
// Called from:
//      fn0C00_01D9
void fn0C00_0281(struct Eq_261 Eq_2::* si, struct Eq_262 Eq_2::* di, struct Eq_2 * ds, Eq_227 rArg0)
{
	(ds->*di).r0000 = (real32) ((real64) (ds->*si).r0000 * rArg0);
	(ds->*di).r0004 = (real32) ((real64) (ds->*si).r0004 * rArg0);
	(ds->*di).r0008 = (real32) ((real64) (ds->*si).r0008 * rArg0);
}

// 0C00:0298: void fn0C00_0298(Register (memptr (ptr16 Eq_2) Eq_289) si, Register (memptr (ptr16 Eq_2) Eq_290) di, Register (ptr16 Eq_2) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_0298(struct Eq_289 Eq_2::* si, struct Eq_290 Eq_2::* di, struct Eq_2 * ds)
{
	word32 ebx_8 = (ds->*si).dw0004;
	word32 ecx_9 = (ds->*si).dw0008;
	(ds->*di).dw0000 = (ds->*si).dw0000;
	(ds->*di).dw0004 = ebx_8;
	(ds->*di).dw0008 = ecx_9;
}

// 0C00:02AF: void fn0C00_02AF(Register (ptr16 Eq_2) ds, FpuStack Eq_227 rArg0)
// Called from:
//      fn0C00_01D9
void fn0C00_02AF(struct Eq_2 * ds, Eq_227 rArg0)
{
	real64 rLoc1_41 = (real64) ds->r04DE;
	real64 rLoc2_43 = (real64) ds->r04E2;
	ds->t04F8.u0 = (int32) ((real64) ds->r04A3 / sqrt(rLoc1_41 * rLoc1_41 + rLoc2_43 * rLoc2_43) * (real64) ds->r04E6 * (real64) ds->r046B);
	struct Eq_295 Eq_2::* di_20 = ds->ptr04FC;
	(ds->*di_20).w0000 = (word16) ds->t04F8.u1 + ds->w047D;
	ds->t04F8.u0 = (int32) (atan(rArg0, (real64) ds->r04DE) * (real64) ds->r04F2);
	(ds->*di_20).w0002 = (word16) ds->t04F8.u1 + ds->w047B;
	ds->ptr04FC = &ds->ptr04FC->w0002 + 1;
}

// 0C00:0300: void fn0C00_0300(Register (ptr16 Eq_93) es, Register (ptr16 Eq_2) ds, Register (ptr16 Eq_95) gs)
// Called from:
//      fn0C00_01CF
void fn0C00_0300(struct Eq_76 * es, struct Eq_2 * ds, struct Eq_76 * gs)
{
	struct Eq_530 Eq_2::* si_126 = &Eq_2::t04FE;
	struct Eq_532 Eq_76::* di_112 = Eq_76::a0000;
	word16 cx_11 = 0x32;
	do
	{
		word16 cx_130 = 0x50;
		do
		{
			word32 ebx_116 = si_126[1];
			word32 eax_115 = (ds->*si_126).dw0000;
			word32 edx_27 = si_126[82] - ebx_116;
			word32 ebp_29 = __rol(si_126[81] - eax_115, 0x10);
			word32 edx_31 = __rol(edx_27, 0x10);
			word32 ebp_39 = __rol(SEQ(SLICE(ebp_29, word16, 16), (word16) ebp_29 >> 0x02), 0x10);
			word32 edx_43 = __rol(SEQ(SLICE(edx_31, word16, 16), (word16) edx_31 >> 0x02), 0x10);
			ds->dw0500 = SEQ(SLICE(ebp_39, word16, 16), (word16) ebp_39 >> 0x02);
			ds->dw0504 = SEQ(SLICE(edx_43, word16, 16), (word16) edx_43 >> 0x02);
			byte ch_119;
			for (ch_119 = 0x04; ch_119 != 0x00; --ch_119)
			{
				word32 ebx_66 = __rol(ebx_116 - eax_115, 0x10);
				word32 ebx_72 = __rol(SEQ(SLICE(ebx_66, word16, 16), (word16) ebx_66 >> 0x02), 0x10);
				word32 ebx_77 = SEQ(SLICE(ebx_72, word16, 16), (word16) ebx_72 >> 0x02);
				byte cl_102;
				eax_100 = eax_115;
				for (cl_102 = 0x04; cl_102 != 0x00; --cl_102)
				{
					word32 eax_100;
					word32 eax_86 = __rol(eax_100, 0x10);
					word32 eax_90 = __rol(eax_86, 0x10);
					(es->*di_112).b0000 = gs->*SEQ(SLICE(eax_86, byte, 8), SLICE(eax_100, byte, 8));
					di_112 = &di_112->b0000 + 1;
					eax_100 = eax_90 + ebx_77;
				}
				di_112 = &di_112->b0000 + 316;
				eax_115 += ds->dw0500;
				ebx_116 += ds->dw0504;
			}
			di_112 -= 0x03C0;
			++si_126;
			cx_130 = cx_184 - 0x01;
			cx_184 = cx_130;
		} while (cx_184 != 0x01);
		++si_126;
		cx_11 = cx_183 - 0x01;
		cx_183 = cx_11;
	} while (cx_183 != 0x01);
}

// 0C00:03B1: Register byte fn0C00_03B1(Register Eq_674 cl, Register Eq_675 dx)
// Called from:
//      fn0C00_040E
byte fn0C00_03B1(Eq_674 cl, Eq_675 dx)
{
	int16 ax_6 = (int16) __inb(0x40);
	ci16 dx_14 = (word16) dx.u1 + (SEQ(SLICE(ax_6, byte, 8), (byte) ax_6 << cl) >> 0x03);
	if (dx_14 < 0x00)
		dx_14 = 0x00;
	byte dh_20 = SLICE(dx_14, byte, 8);
	ci16 dx_30 = dx_14;
	if (dh_20 != 0x00)
		dx_30 = SEQ(dh_20, ~0x00);
	return (byte) dx_30;
}

// 0C00:03C8: void fn0C00_03C8(Register (ptr16 Eq_76) gs)
// Called from:
//      fn0C00_0100
void fn0C00_03C8(struct Eq_76 * gs)
{
	gs->a0000[0].b0000 = (Eq_702) 0x80;
	gs->b0080 = 0x80;
	gs->b8000 = 0x80;
	gs->b8080 = 0x80;
	bcu8 Eq_76::* bx_19 = Eq_76::a0000;
	Eq_674 cx_12 = 0x80;
	do
	{
		do
		{
			do
			{
				bx_79 = SEQ(bh_68, bl_65);
				bcu8 Eq_76::* bx_34 = fn0C00_040E(cx_87, (byte) (cx_87 << 0x08), fn0C00_040E(SLICE(cx_87, byte, 8), cx_87, bx_19, gs), gs);
				fn0C00_040E(cx_87, -cx_87, SEQ(SLICE(bx_34, byte, 8), (word16) cx_87 + ((word16) cx_87 + (byte) bx_34)), gs);
				byte bh_68 = SLICE(bx_34, byte, 8);
				cx_12 = cx_87;
				byte ch_76 = SLICE(cx_87, byte, 8);
				cu8 bl_65 = (word16) cx_87 + ((word16) cx_87 + (byte) bx_34);
				cx_87 = cx_12;
				bx_19 = bx_79;
			} while (bl_65 >= 0x00);
			cu8 bh_70 = (word16) cx_87 + ((word16) cx_87 + bh_68);
			bx_19 = SEQ(bh_70, bl_65);
			cx_88 = cx_12;
		} while (bh_70 >= 0x00);
		cx_12 = SEQ(ch_76, cx_87 >> 0x01);
		cx_89 = cx_12;
	} while (cx_87 >> 0x01 != 0x00);
}

// 0C00:040E: Register (memptr (ptr16 Eq_76) bcu8) fn0C00_040E(Register Eq_674 ch, Register Eq_674 cl, Register (memptr (ptr16 Eq_76) bcu8) bx, Register (ptr16 Eq_76) gs)
// Called from:
//      fn0C00_03C8
bcu8 Eq_76::* fn0C00_040E(Eq_674 ch, Eq_674 cl, bcu8 Eq_76::* bx, struct Eq_76 * gs)
{
	byte bh_9 = SLICE(bx, byte, 8);
	byte bl_13 = (byte) bx;
	byte bh_12 = (byte) ch.u1 + ((byte) ch.u1 + bh_9);
	byte bl_16 = (byte) cl.u1 + ((byte) cl.u1 + bl_13);
	byte bh_33 = bh_12 - ch;
	byte bl_34 = bl_16 - cl;
	gs->*SEQ(bh_33, bl_34) = (byte) (uint16) fn0C00_03B1(cl, gs->*SEQ(bh_12, bl_16) + gs->*bx >> 0x01);
	return SEQ(bh_33 - ch, bl_34 - cl);
}

// 0C00:0433: FpuStack Eq_227 fn0C00_0433(Register (ptr16 Eq_2) ds, FpuStack out Eq_227 rLoc1Out)
// Called from:
//      fn0C00_01CF
Eq_227 fn0C00_0433(struct Eq_2 * ds, union Eq_227 & rLoc1Out)
{
	real64 rLoc1_47 = (real64) ds->r0477;
	Eq_227 rLoc1_48 = cos(rLoc1_47);
	struct Eq_813 Eq_2::* si_17 = &Eq_2::t047F;
	Eq_227 rLoc2_49 = sin(rLoc1_47);
	word16 cx_13;
	for (cx_13 = 0x03; cx_13 != 0x00; --cx_13)
	{
		real64 rLoc4_51 = (real64) (ds->*si_17).r0004;
		real64 rLoc3_50 = (real64) (ds->*si_17).r0008;
		(ds->*si_17).r0004 = (real32) (rLoc4_51 * rLoc2_49 - rLoc3_50 * rLoc1_48);
		(ds->*si_17).r0008 = (real32) (rLoc4_51 * rLoc1_48 + rLoc3_50 * rLoc2_49);
		++si_17;
	}
	__ffree(rLoc2_49);
	__ffree(rLoc1_48);
	rLoc1Out = rLoc1_48;
	return rLoc2_49;
}

