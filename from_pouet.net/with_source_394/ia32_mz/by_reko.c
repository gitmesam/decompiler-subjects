// subject_1676.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_1676.h"

// 1676:0061: void fn1676_0061()
// Called from:
//      fn1676_0340
void fn1676_0061()
{
	bios_video_set_mode(0x13);
}

// 1676:0068: void fn1676_0068()
// Called from:
//      fn1676_0442
void fn1676_0068()
{
	bios_video_set_mode(0x03);
}

// 1676:006F: void fn1676_006F()
// Called from:
//      fn1676_0340
void fn1676_006F()
{
	bios_video_set_block_of_DAC_registers(0x00, 0xFF, seg0800, 0xD5C0);
}

// 1676:0084: Register (ptr16 Eq_2) fn1676_0084()
// Called from:
//      fn1676_0340
struct Eq_2 * fn1676_0084()
{
	byte Eq_2::* si_14 = Eq_2::a08C0;
	byte Eq_33::* di_18 = Eq_33::a3200;
	word16 cx_10;
	for (cx_10 = 0x9100; cx_10 != 0x00; --cx_10)
	{
		0xA000->*di_18 = seg0800->*si_14;
		++si_14;
		++di_18;
	}
	return seg0800;
}

// 1676:009B: Register (ptr16 Eq_2) fn1676_009B()
// Called from:
//      fn1676_0442
struct Eq_2 * fn1676_009B()
{
	byte Eq_2::* bx_14 = seg0800->wFFFFDB62 + 1120 + (word16) ((seg0800->wFFFFDB64 - 0x28) * 0x0140);
	byte Eq_33::* bx_23 = seg0800->wFFFFDB62 + (word16) (seg0800->wFFFFDB64 * 0x0140);
	seg0800->ptrFFFFDB6C = (byte *) bx_14;
	seg0800->ptrFFFFDB6E = (byte *) bx_23;
	seg0800->wFFFFDB5E = (word16 *) 0x00;
	byte Eq_2::* si_15 = bx_14;
	byte Eq_33::* di_25 = bx_23;
	do
	{
		word16 cx_29;
		for (cx_29 = 0x39; cx_29 != 0x00; --cx_29)
		{
			0xA000->*di_25 = seg0800->*si_15;
			++si_15;
			++di_25;
		}
		seg0800->wFFFFDB5E = (word16 *) ((char *) seg0800->wFFFFDB5E + 1);
		word16 ax_40 = (word16) (seg0800->wFFFFDB5E * 0x0140);
		si_15 = (byte Eq_2::*) (seg0800->ptrFFFFDB6C + ax_40);
		di_25 = (byte Eq_33::*) (seg0800->ptrFFFFDB6E + ax_40);
	} while (seg0800->wFFFFDB5E != 0x06);
	seg0800->wFFFFDB5E = (word16 *) 0x00;
	return seg0800;
}

// 1676:0104: void fn1676_0104()
// Called from:
//      fn1676_0442
void fn1676_0104()
{
	byte Eq_33::* bx_15 = seg0800->wFFFFDB62 + (word16) (seg0800->wFFFFDB64 * 0x0140);
	seg0800->ptrFFFFDB6C = (word16 *) 0x00;
	seg0800->ptrFFFFDB6E = (byte *) bx_15;
	seg0800->wFFFFDB5E = (word16 *) 0x00;
	byte Eq_2::* si_23 = &Eq_2::b0000;
	byte Eq_33::* di_17 = bx_15;
	do
	{
		word16 cx_21;
		for (cx_21 = 0x39; cx_21 != 0x00; --cx_21)
		{
			byte al_25 = seg0800->*si_23;
			if (al_25 != 0x00)
				0xA000->*di_17 = al_25;
			++si_23;
			++di_17;
		}
		seg0800->wFFFFDB5E = (word16 *) ((char *) seg0800->wFFFFDB5E + 1);
		word16 ax_48 = (word16) (seg0800->wFFFFDB5E * 0x0140);
		si_23 = (byte Eq_2::*) (seg0800->ptrFFFFDB6C + ax_48);
		di_17 = (byte Eq_33::*) (seg0800->ptrFFFFDB6E + ax_48);
	} while (seg0800->wFFFFDB5E != 0x06);
	seg0800->wFFFFDB5E = (word16 *) 0x00;
}

// 1676:0165: Register (ptr16 Eq_182) fn1676_0165()
// Called from:
//      fn1676_0442
struct Eq_182 * fn1676_0165()
{
	struct Eq_183 Eq_33::* di_16 = &Eq_33::tFFFFD840;
	struct Eq_185 Eq_33::* si_18 = &Eq_33::tFFFFD842;
	byte ah_13;
	for (ah_13 = 0x08; ah_13 != 0x00; --ah_13)
	{
		word16 cx_14;
		for (cx_14 = 0x013E; cx_14 != 0x00; --cx_14)
		{
			(0xA000->*di_16).b0000 = (0xA000->*si_18).b0000;
			si_18 = &si_18->b0000 + 1;
			di_16 = &di_16->b0000 + 1;
		}
		++di_16;
		++si_18;
	}
	return fn1676_0186();
}

// 1676:0186: Register (ptr16 Eq_216) fn1676_0186()
// Called from:
//      fn1676_0165
//      fn1676_0198
struct Eq_216 * fn1676_0186()
{
	word16 ax_9 = seg0800->*seg0800->ptrFFFFDB6A;
	byte al_10 = (byte) ax_9;
	if (al_10 != 0x00)
	{
		word16 bx_52;
		if (al_10 == 0x20)
			bx_52 = 0x0A00;
		else if (al_10 == 0x30)
			bx_52 = 0xD0;
		else if (al_10 == 0x31)
			bx_52 = 0xD8;
		else if (al_10 == 0x32)
			bx_52 = 0xE0;
		else if (al_10 == 0x33)
			bx_52 = 232;
		else if (al_10 == 0x34)
			bx_52 = 0xF0;
		else if (al_10 == 0x35)
			bx_52 = 0xF8;
		else if (al_10 == 0x36)
			bx_52 = 0x0100;
		else if (al_10 == 55)
			bx_52 = 0x0108;
		else if (al_10 == 0x38)
			bx_52 = 0x0110;
		else if (al_10 == 0x39)
			bx_52 = 0x0118;
		else if (al_10 == 0x3F)
			bx_52 = 288;
		else if (al_10 == 33)
			bx_52 = 0x0128;
		else if (al_10 == 0x2E)
			bx_52 = 0x0130;
		else if (al_10 == 44)
			bx_52 = 0x0138;
		else
			bx_52 = (word16) ((uint16) (byte) (ax_9 - 0x41) * 0x08);
		struct Eq_231 Eq_2::* si_74 = seg0800->wFFFFDB60 + 0x00004CE0 + bx_52;
		struct Eq_237 Eq_33::* di_106 = &Eq_33::tFFFFD97E;
		byte al_108 = 0x00;
		si_116 = si_74;
		while (true)
		{
			struct Eq_231 Eq_2::* si_116;
			byte ah_82;
			for (ah_82 = 0x08; ah_82 != 0x00; --ah_82)
			{
				(0xA000->*di_106).b0000 = (seg0800->*si_116).b0000;
				++si_116;
				++di_106;
			}
			di_106 = &Eq_33::tFFFFD97F;
			if (al_108 == 0x01)
				break;
			fn1676_0287(seg0800);
			si_116 = &si_74->b0000 + 1;
			++al_108;
		}
		fn1676_0287(seg0800);
		return;
	}
	else
	{
		fn1676_0198(ds);
		return;
	}
}

// 1676:0198: void fn1676_0198(Register (ptr16 Eq_216) ds)
// Called from:
//      fn1676_0186
//      fn1676_0340
void fn1676_0198(struct Eq_216 * ds)
{
	ds->wDB60 = 0x00;
	ds->wDB6A = 0x00;
	fn1676_0186();
}

// 1676:0287: void fn1676_0287(Register (ptr16 Eq_2) ds)
// Called from:
//      fn1676_0198
void fn1676_0287(struct Eq_2 * ds)
{
	if (ds->wDB60 == 0x07)
	{
		ds->wDB60 = 0x00;
		++ds->wDB6A;
	}
	else
		++ds->wDB60;
}

// 1676:029E: void fn1676_029E(Register (ptr16 Eq_349) ds)
// Called from:
//      fn1676_0442
void fn1676_029E(struct Eq_349 * ds)
{
	while (true)
	{
		while (ds->bDB5D != 0x01)
		{
			__outb(0x03C8, ~0x01);
			byte al_21 = ds->bDB5C;
			__outb(969, al_21);
			__outb(969, al_21);
			__outb(969, al_21);
			if (ds->bDB5C != 0x3F)
			{
				++ds->bDB5C;
				return;
			}
			ds->bDB5D = 0x01;
		}
		__outb(0x03C8, ~0x01);
		byte al_11 = ds->bDB5C;
		__outb(969, al_11);
		__outb(969, al_11);
		__outb(969, al_11);
		if (ds->bDB5C != 0x0F)
			break;
		ds->bDB5D = 0x00;
	}
	--ds->bDB5C;
}

// 1676:02E7: void fn1676_02E7()
// Called from:
//      fn1676_0442
void fn1676_02E7()
{
	seg0800->wFFFFDB64 = (word16 *) (seg0800->*seg0800->ptrFFFFDB68 + 100);
	seg0800->wFFFFDB62 = (word16 *) (seg0800->*seg0800->ptrFFFFDB66 + 0x44);
	if (seg0800->ptrFFFFDB68 == 0x5E)
		seg0800->ptrFFFFDB68 = (word16 *) 0x00;
	else
	{
		seg0800->ptrFFFFDB68 = (word16 *) ((char *) seg0800->ptrFFFFDB68 + 1);
		seg0800->ptrFFFFDB68 = (word16 *) ((char *) seg0800->ptrFFFFDB68 + 1);
	}
	if (seg0800->ptrFFFFDB66 != 0xFE)
	{
		seg0800->ptrFFFFDB66 = (word16 *) ((char *) seg0800->ptrFFFFDB66 + 1);
		seg0800->ptrFFFFDB66 = (word16 *) ((char *) seg0800->ptrFFFFDB66 + 1);
		seg0800->wFFFFDB72 = (word16 *) 0x00;
	}
	else
		seg0800->ptrFFFFDB66 = (word16 *) 0x00;
}

// 1676:0340: void fn1676_0340()
// Called from:
//      fn1676_0442
void fn1676_0340()
{
	fn1676_0061();
	fn1676_006F();
	struct Eq_216 * ds_14 = fn1676_0084();
	fn1676_0198(ds_14);
	ds_14->wDB66 = 0x00;
	ds_14->wDB68 = 0x00;
	__outb(0x03C8, ~0x01);
	__outb(969, 0x00);
	__outb(969, 0x00);
	__outb(969, 0x00);
}

// 1676:0365: void fn1676_0365()
// Called from:
//      fn1676_0442
void fn1676_0365()
{
	do
		;
	while ((__inb(0x03DA) & 0x08) == 0x00);
}

// 1676:036E: void fn1676_036E(Register (ptr16 Eq_515) ds)
// Called from:
//      fn1676_037C
void fn1676_036E(struct Eq_515 * ds)
{
	__outb(0x03C8, ~0x02);
	byte al_10 = ds->bDB7C;
	__outb(969, al_10);
	__outb(969, al_10);
	__outb(969, al_10);
}

// 1676:037C: Register (ptr16 Eq_515) fn1676_037C(Register (ptr16 Eq_515) ds)
// Called from:
//      fn1676_0442
struct Eq_515 * fn1676_037C(struct Eq_515 * ds)
{
	if (ds->bDB77 == 0x01)
	{
		if (ds->bDB7C == 0x00)
			return fn1676_03BF();
		fn1676_036E(ds);
		--ds->bDB7C;
		return ds;
	}
	else if (ds->bDB7C == 0x3F)
	{
		if (ds->bDB76 == ~0x00)
		{
			ds->bDB77 = 0x01;
			ds->bDB76 = 0x00;
			return ds;
		}
		else
		{
			++ds->bDB76;
			return ds;
		}
	}
	else
	{
		++ds->bDB7C;
		fn1676_036E(ds);
		return ds;
	}
}

// 1676:03BF: Register (ptr16 Eq_578) fn1676_03BF()
// Called from:
//      fn1676_037C
struct Eq_578 * fn1676_03BF()
{
	uint16 bx_21;
	uint16 ax_9 = seg0800->*seg0800->ptrFFFFDB78;
	if ((byte) ax_9 == 0x20)
		bx_21 = 0x1400;
	else
		bx_21 = (uint16) (byte) ((ax_9 - 0x01) * 0x08);
	Eq_596 si_27 = bx_21 + 44480;
	struct Eq_599 Eq_33::* di_38 = (word16) ((uint16) seg0800->bFFFFDB7B * 0x08) + 0x0F00;
	word16 dx_40;
	for (dx_40 = 0x10; dx_40 != 0x00; --dx_40)
	{
		word16 cx_41;
		for (cx_41 = 0x08; cx_41 != 0x00; --cx_41)
		{
			(0xA000->*di_38).b0000 = seg0800->*si_27;
			si_27 = (word16) si_27 + 1;
			di_38 = &di_38->b0000 + 1;
		}
		si_27 = (word16) si_27 + 312;
		++di_38;
	}
	if (seg0800->bFFFFDB7B == 0x27)
	{
		seg0800->bFFFFDB7B = (byte *) 0x00;
		seg0800->bFFFFDB77 = (byte *) 0x00;
		if (seg0800->ptrFFFFDB78 > 0x04B0)
		{
			seg0800->ptrFFFFDB78 = (word16 *) 0x00;
			return;
		}
		else
		{
			seg0800->ptrFFFFDB78 = (word16 *) ((char *) seg0800->ptrFFFFDB78 + 1);
			return;
		}
	}
	else
	{
		++seg0800->bFFFFDB7B;
		seg0800->ptrFFFFDB78 = (word16 *) ((char *) seg0800->ptrFFFFDB78 + 1);
		return;
	}
}

// 1676:0442: void fn1676_0442(Register (ptr16 Eq_669) es)
void fn1676_0442(struct Eq_669 * es)
{
	word16 bx_7;
	msdos_resize_memory_block(es, 0x186A, out bx_7);
	fn1676_0068();
	word16 cx_13;
	for (cx_13 = 100; cx_13 != 0x00; --cx_13)
		fn1676_0365();
	fn1676_0068();
	fn1676_0340();
	__outb(33, 0x5E);
	do
	{
		fn1676_02E7();
		fn1676_0104();
		fn1676_0365();
		fn1676_029E(fn1676_037C(fn1676_0165()));
		struct Eq_720 * ds_110 = fn1676_009B();
	} while (__inb(0x60) != 0x01);
	__outb(33, 0x00);
	fn1676_0068();
	msdos_display_string(&ds_110->bFFFFE6B4);
	msdos_terminate(0x00);
}

