// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register Eq_3 bx, Register (ptr16 Eq_4) es, Register (ptr16 Eq_4) ds)
void fn0C00_0100(byte ch, Eq_3 bx, struct Eq_4 * es, struct Eq_4 * ds)
{
	Eq_6 Top_209 = 0;
	__syscall(0x10);
	byte al_326 = 0x13;
	do
	{
		word16 ax_8 = __aam(al_326);
		ds->*((word16) bx + 1667) = (byte) ax_8;
		word16 ax_15 = __aad((word16) bx + ax_8);
		bx = (word16) bx + 1;
		al_326 = (byte) ax_15;
		cu8 bh_17 = SLICE(bx, byte, 8);
	} while (bh_17 != 151);
	word16 cx_201 = SEQ(ch, 0x06);
	do
	{
		struct Eq_42 Eq_4::* di_45 = Eq_4::a0683;
		do
		{
			word16 cx_458;
			word16 ax_55 = Mem51[ds:di_45 + 0x00:word16] + Mem51[ds:bx + di_45:word16] + (bh_17 <u 151);
			(es->*di_45).t0000 = (bool) (ax_55 < 0x00) + ((byte) ax_55 + SLICE(ax_55, byte, 8)) >> 0x02;
			++di_45;
			--cx_458;
		} while (cx_458 != 0x00);
		byte bl_347 = (byte) bx;
		byte ah_106 = SLICE(ax_15, byte, 8);
		cx_201 = cx_458 - 0x01;
		cx_458 = cx_201;
	} while (cx_458 != 0x01);
	Eq_77 bx_126;
	do
	{
		Eq_45 al_92 = ds->*((word16) bx_126 + 1667);
		uint16 ax_97 = (al_92 & 0x03) * 0x03;
		byte bl_109 = (byte) bx_126;
		cu16 ax_95 = SEQ(ah_106, al_92 & 0x03);
		byte al_104 = (byte) ax_97;
		ah_106 = SLICE(ax_97, byte, 8);
		if (SLICE(bx_126, byte, 8) > 0x10 && ax_95 >> 0x01 >= 0x00)
			ah_106 = al_104 + 0x41;
		if ((bl_109 & 0x01) == 0x00)
			al_104 = 0x01;
		ds->*((word16) bx_126 + 40323) = ah_106;
		ds->*((word16) bx_126 + 0x0000CA83) = al_104;
		--bx_126;
	} while (bx_126 >= 0x00);
	__outb(0x0331, ~0x00);
	__outb(0x0331, 0x3F);
	do
	{
		__outb(0x0330, 0x90);
		__outb(0x0330, ah_106);
		__outb(0x0330, 0x7F);
		do
			;
		while ((__inb(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__inb(0x03DA) & 0x08) == 0x00);
		0040:004A = (byte *) 0x50;
		0040:0050 = (byte *) 0x0D;
		byte Eq_157::* di_179;
		do
		{
			byte v29_186 = cs->*di_179;
			cs->*di_179 = 0x10;
			0xA000->*di_179 = v29_186;
			--di_179;
		} while (di_179 != Eq_157::a0000);
		if (cx_201 != 0x00)
			msdos_display_string(&ds->b02E8);
		Eq_175 Top_210 = Top_209 - 1;
		*Top_210 = (real64) ss->w02FD;
		*Top_210 = fn0C00_0235(&ds->b02E8 + 0x0E, &ss->b02FF, cx_201, *Top_210);
		ss->t0301.u1 = 100;
		Eq_205 di_226 = ~0x0600;
		do
		{
			Eq_213 Top_229 = Top_210 - 1;
			*Top_229 = *Top_229;
			*Top_229 /= (real64) ss->t0301;
			*((word32) Top_229 - 1) = *((word32) Top_229 - 1);
			*((word32) Top_229 - 1) *= (real64) ss->w02FB;
			ds->w0307 = (int16) *((word32) Top_229 - 1);
			*Top_229 *= (real64) ss->w02FA;
			*Top_229 = fn0C00_0235(&ds->b02E8 + 16, &ss->b02FF, cx_201, *Top_229);
			ds->t0305.u0 = (int16) *Top_229;
			*((word32) Top_229 + 2) = *((word32) Top_229 + 1);
			Eq_279 ax_256 = ds->t0305;
			ds->w0303 = SEQ((byte) ax_256 - ds->b02FF, SLICE(ax_256, byte, 8));
			ds->w0581 = 0x0140;
			byte bl_457;
			word16 dx_456;
			word16 cx_455;
			ah_106 = SLICE((uint16) (uint8) fn0C00_0244(cx_201, 0x7FFF, &Eq_4::t0001, 0x02FF, &Eq_4::t1283, di_226, cs, ds, out cx_455, out dx_456, out bl_457, out di_226), byte, 8);
			Eq_202 v33_279 = ss->t0301 - 0x01;
			ss->t0301 = v33_279;
			Eq_315 bx_273 = <invalid>;
			byte cl_320 = (byte) cx_201;
			byte ch_384 = SLICE(cx_201, byte, 8);
			Top_210 = (word32) Top_229 + 2;
			byte bl_403 = (byte) bx_273;
		} while (v33_279 != 0x00);
		*((word32) Top_229 + 3) = *((word32) Top_229 + 2);
		Top_209 = (word32) Top_229 + 3;
		if (__inb(0x60) == 0x01)
			break;
		byte v34_289 = ss->b02FF + 0x01;
		ss->b02FF = v34_289;
		if (v34_289 != 0x00)
			continue;
		Eq_389 bx_295;
		do
		{
			byte bh_298 = SLICE(bx_295, byte, 8);
			byte bl_303 = (byte) bx_295;
			byte al_297 = ds->*((word16) bx_295 + 4758);
			if ((bh_298 & ~0x07) == 0x00)
			{
				al_297 = 0x08;
				if (bl_303 != 0x03 && bh_298 != 0x03)
					al_297 = 0x00;
			}
			ds->*((word16) bx_295 + 55171) = al_297;
			--bx_295;
		} while (bx_295 >= 0x00);
		cx_201 = SEQ(ch_384, cl_320 + 0x80);
	} while (cl_320 != 0x80);
	bios_video_set_mode(0x03);
}

// 0C00:0235: FpuStack real64 fn0C00_0235(Sequence (ptr32 word16) ds_si, Sequence (ptr32 int16) ss_bp, Register word16 cx, FpuStack real64 rArg0)
// Called from:
//      fn0C00_0100
real64 fn0C00_0235(word16 * ds_si, int16 * ss_bp, word16 cx, real64 rArg0)
{
	if (cx == 0x00)
		return rArg0 + sin((real64) (*ss_bp) / (real64) (*ds_si)) * (real64) (*ds_si);
	return rArg0;
}

// 0C00:0244: Register byte fn0C00_0244(Register word16 cx, Register cui16 dx, Register (memptr (ptr16 Eq_4) Eq_309) bx, Register word16 bp, Register (memptr (ptr16 Eq_4) Eq_311) si, Register Eq_205 di, Register (ptr16 Eq_157) es, Register (ptr16 Eq_4) ds, Register out Eq_315 cxOut, Register out Eq_315 dxOut, Register out Eq_315 blOut, Register out Eq_205 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0244
byte fn0C00_0244(word16 cx, cui16 dx, struct Eq_309 Eq_4::* bx, word16 bp, <type-error> Eq_4::* si, Eq_205 di, struct Eq_157 * es, struct Eq_4 * ds, union Eq_315 & cxOut, union Eq_315 & dxOut, union Eq_315 & blOut, union Eq_205 & diOut)
{
	do
	{
		byte ch_149 = SLICE(cx, byte, 8);
		cu16 ax_33 = (ds->*bx).w0303;
		if (es->*di == 0x10)
		{
			byte dl_39 = ds->*((char *) si + (ax_33 & dx));
			byte dl_40 = dl_39 + 0x10;
			ci8 bh_54 = SLICE(bx - 0x01, byte, 8);
			if (bx != &Eq_4::t0001)
			{
				byte al_55 = 0x0F;
				ci8 ah_63 = 0x0D;
				if (cx != 0x00)
				{
					if (fn0C00_02CA(bp, 0x00, 0x06, bh_54, ds, out al_55))
						goto l0C00_027D;
					ah_63 = 0x10;
					if (dl_39 == 0x00)
						goto l0C00_027A;
					--bh_54;
				}
				word16 dx_86 = SEQ(dh_78, dl_39 + 0x10);
				byte al_306;
				if (!fn0C00_02CA(bp, al_55, ah_63, bh_54, ds, out al_306))
					dl_40 = (byte) (dx_86 + 0x02);
			}
l0C00_027A:
			es->*di = dl_40;
l0C00_027D:
		}
		if (bx == &Eq_4::t0001)
		{
			byte al_126 = (ds->*SEQ(SLICE(ax_33 >> 0x04, byte, 8), (byte) (ax_33 >> 0x04) & 0x0F)).bAA83;
			byte bl_131 = (byte) ax_33;
			byte bh_138 = SLICE(ax_33, byte, 8);
			if (al_126 != 0x00)
			{
				word16 ax_143;
				if (cx != 0x00)
					ax_143 = SEQ(bl_131, 0x09);
				else
					ax_143 = SEQ(bl_131 + bh_138, al_126);
				ds->w0443 = ax_143;
				ds->b0442 = ch_149;
				word16 cx_162;
				cui16 dx_163;
				word16 di_308;
				byte bl_307;
				fn0C00_0244(cx_162, dx_163, &Eq_4::t0140, bp, &Eq_4::tFFFFD783, di, es, ds, out cx_162, out dx_163, out bl_307, out di_308);
			}
		}
		int16 ax_188 = ds->w0307;
		(ds->*bx).w0302 -= ax_188;
		struct Eq_517 Eq_4::* bx_193 = -bx;
		ci16 v25_195 = (ds->*bx_193).w0582 - 0x01;
		(ds->*bx_193).w0582 = v25_195;
		di -= bx;
	} while (v25_195 > 0x00);
	cxOut.u0 = <invalid>;
	dxOut.u0 = <invalid>;
	blOut.u0 = <invalid>;
	diOut = di;
	return SLICE(ax_188, byte, 8);
}

// 0C00:02CA: FlagGroup bool fn0C00_02CA(Sequence (ptr32 Eq_486) ss_bp, Register byte al, Register ci8 ah, Register ci8 bh, Register (ptr16 Eq_4) ds, Register out Eq_491 alOut)
// Called from:
//      fn0C00_0244
bool fn0C00_02CA(struct Eq_486 * ss_bp, byte al, ci8 ah, ci8 bh, struct Eq_4 * ds, union Eq_491 & alOut)
{
	Eq_577 dh_15 = (al + ss_bp->b0005 & 0x0F) > ah;
	Eq_585 al_22 = (ds->t0305 & 0x0F) > bh;
	if (fp - 2)
	{
		Eq_491 al_26 = al_22 | dh_15;
		alOut = al_26;
		return SLICE(cond(al_26), bool, 2);
	}
	else
	{
		Eq_491 al_29 = al_22 & dh_15;
		alOut = al_29;
		return SLICE(cond(al_29), bool, 2);
	}
}

