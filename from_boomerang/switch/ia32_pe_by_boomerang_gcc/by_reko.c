// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	if (globals->dw403000 != 0x00)
		int3();
	ui32 eax_17 = (word32) (word16) ((word32) __fstcw() & ~0x0F3F);
	__fldcw((word16) (eax_17 | 0x033F));
	fn00401470(fp - 0x04, edi, &globals->t401080);
	return eax_17 | 0x033F;
}

// 00401470: void fn00401470(Register ptr32 ebp, Register word32 edi, Stack (ptr32 Eq_27) dwArg04)
void fn00401470(ptr32 ebp, word32 edi, Eq_27 * dwArg04)
{
	ptr32 esp_30;
	ptr32 ebp_29;
	struct Eq_27 * esi_28;
	word32 edi_24;
	ptr32 ebp_5 = fp - 0x04;
	struct Eq_27 * esi_11 = dwArg04;
	word32 eax_17 = fn00401530(fp - 0x04, edi, dwArg04, null);
	ptr32 esp_19 = fp - 0x1C;
	edi_24 = edi;
	esi_28 = esi_11;
	ebp_29 = ebp_5;
	esp_30 = esp_19;
	if (eax_17 != 0x00)
	{
l0040149D:
		byte SCZO_46;
		word32 ebx_48;
		word32 eax_49;
		byte SZO_50;
		bool C_51;
		bool Z_52;
		cygwin1.dll!dll_crt0__FP11per_process();
	}
	struct Eq_62 * esp_31 = esp_30 - 0xB0;
	esp_31->dw0008 = 0x00;
	esp_31->ptr0004 = (word32 *) &esp_31->dw0008;
	esp_31->ptr0000 = esi_28;
	fn00401530(ebp_29, edi_24, dwArg00, dwArg04);
	esp_31->ptr0000 = (struct Eq_27 *) &esp_31->dw0008;
	goto l0040149D;
}

// 00401530: Register word32 fn00401530(Register ptr32 ebp, Register word32 edi, Stack (ptr32 Eq_27) dwArg04, Stack (ptr32 Eq_27) dwArg08)
word32 fn00401530(ptr32 ebp, word32 edi, Eq_27 * dwArg04, Eq_27 * dwArg08)
{
	word32 eax_27;
	word32 eax_100 = 0x00;
	LPCSTR * esp_10 = fp - 0x0C;
	struct Eq_27 * ebx_12 = dwArg08;
	if (dwArg08 == null)
	{
		word32 ebp_85;
		word32 eax_86;
		byte SZO_87;
		bool C_88;
		word32 ebx_89;
		byte SCZO_90;
		bool Z_91;
		word32 ecx_92;
		word32 edx_93;
		cygwin1.dll!cygwin_internal();
		eax_27 = 0x00;
		if (0x01 == 0x00)
			return eax_27;
		ebx_12 = null;
		eax_100 = 0x01;
	}
	ebx_12->dw0004 = 0xA8;
	ebx_12->dw0008 = 1005;
	ebx_12->dw000C = 0x09;
	ebx_12->dw0080 = 0x00;
	ebx_12->dw0084 = 0x70;
	ebx_12->dw002C = 0x004017A0;
	ebx_12->dw0030 = 4200364;
	ebx_12->dw0014 = 0x00403020;
	if (eax_100 != 0x00)
		globals->dw403024 = ebx_12->dw00A4;
	else
		ebx_12->dw0010 = 0x00403024;
	ebx_12->dw0078 = 0x00;
	ebx_12->dw0048 = 4200240;
	ebx_12->dw004C = 4200224;
	ebx_12->ptr0028 = dwArg04;
	ebx_12->dw0050 = 0x00401710;
	ebx_12->dw0054 = 0x00401700;
	ebx_12->dw0024 = 0x00403028;
	ebx_12->dw0000 = ebp;
	ebx_12->dw0018 = 0x00401510;
	ebx_12->dw001C = 0x004014F0;
	ebx_12->dw0020 = 0x004016F0;
	ebx_12->dw0044 = 0x004016E0;
	*esp_10 = (LPCSTR *) null;
	ebx_12->t007C = GetModuleHandleA(*esp_10);
	ebx_12->dw0034 = 0x00402000;
	ebx_12->dw0038 = 0x00402010;
	ebx_12->dw003C = 0x00403000;
	ebx_12->dw0040 = 0x00403080;
	fn004016B0(edi);
	eax_27 = 0x01;
	return eax_27;
}

// 00401670: void fn00401670(Register word32 edi, Stack (ptr32 Eq_245) dwArg04, Stack (ptr32 Eq_245) dwArg08, Stack word32 dwArg0C)
void fn00401670(word32 edi, Eq_245 * dwArg04, Eq_245 * dwArg08, word32 dwArg0C)
{
	struct Eq_245 * ecx_37 = dwArg04;
	if (dwArg04 < dwArg08)
	{
		do
		{
			word32 * edx_41 = dwArg0C + ecx_37->dw0004;
			*edx_41 += ecx_37->dw0000;
			++ecx_37;
		} while (ecx_37 < dwArg08);
	}
}

// 004016B0: void fn004016B0(Register word32 edi)
void fn004016B0(word32 edi)
{
	fn00401670(edi, &globals->dw403000, &globals->dw403000, 0x00400000);
}

