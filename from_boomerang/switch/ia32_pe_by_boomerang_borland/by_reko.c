// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401059: void _GetExceptDLLinfo(Stack (ptr Eq_2) dwArg04)
void _GetExceptDLLinfo(Eq_2 * dwArg04)
{
	globals->dw40A5CC = fn00401140() + 0x1C;
	dwArg04->dw0000 = 0x82727349;
	dwArg04->ptr0004 = 0x0040A5B8;
}

// 00401140: Register word32 fn00401140()
word32 fn00401140()
{
	return fs->ptr002C[globals->dw40A10F];
}

// 00401150: Register int32 main(Stack Eq_28 argc, Stack (ptr (ptr char)) argv)
int32 main(Eq_28 argc, char * * argv)
{
	if (argc > 0x07)
		goto l004011D0;
	switch (argc)
	{
	case 0x00:
	case 0x01:
l004011D0:
		fn004038E4(&globals->t40A152);
		break;
	case 0x02:
		fn004038E4(&globals->t40A128);
		break;
	case 0x03:
		fn004038E4(&globals->t40A12E);
		break;
	case 0x04:
		fn004038E4(&globals->t40A136);
		break;
	case 0x05:
		fn004038E4(&globals->t40A13D);
		break;
	case 0x06:
		fn004038E4(&globals->t40A144);
		break;
	case 0x07:
		fn004038E4(&globals->t40A14A);
		break;
	}
	return 0x00;
}

// 00402250: Register int32 fn00402250(Stack Eq_57 dwArg04)
int32 fn00402250(Eq_57 dwArg04)
{
	Eq_57 eax_14 = dwArg04;
	if (((byte) dwArg04 & 0x03) != 0x00)
	{
		eax_14 = (word32) dwArg04 + 0x04;
		if ((*dwArg04 & ~0x00) == 0x00)
			goto l0040229F;
		if ((*((word32) dwArg04 + 0x01) & ~0x00) == 0x00)
		{
l004022A0:
			eax_14 = eax_14 - 0x01;
			goto l004022A1;
		}
		if ((*((word32) dwArg04 + 0x02) & ~0x00) == 0x00)
		{
l004022A1:
			eax_14 = eax_14 - 0x01;
			return eax_14 - (struct Eq_109 *) 0x01 - dwArg04;
		}
		eax_14 = DPB(dwArg04 + 0x03, (byte) (dwArg04 + 0x03) & 252, 0);
	}
	do
	{
		do
		{
			ui32 edx_52 = *eax_14;
			eax_14 = (word32) eax_14 + 0x04;
			ui32 edx_57 = edx_52 - 0x01010101 & 0x80808080;
		} while (edx_57 == 0x00);
		ui32 edx_64 = edx_57 & ~edx_52;
		byte dl_65 = (byte) edx_64;
		byte dh_66 = SLICE(edx_64, byte, 8);
	} while (edx_64 == 0x00);
	if (dl_65 == 0x00)
	{
		if (dh_66 == 0x00)
		{
			if ((edx_64 & 0x00FF0000) == 0x00)
				return eax_14 - (struct Eq_109 *) 0x01 - dwArg04;
			goto l004022A1;
		}
		goto l004022A0;
	}
l0040229F:
	eax_14 = eax_14 - 0x01;
	goto l004022A0;
}

// 004038E4: void fn004038E4(Stack (ptr Eq_34) dwArg04)
void fn004038E4(Eq_34 * dwArg04)
{
	fn00403AD0(fp - 0x04, 0x004033C4, &globals->b40A6D0, dwArg04, 0x00);
}

// 00403A20: Register word32 fn00403A20(Stack Eq_57 dwArg04)
word32 fn00403A20(Eq_57 dwArg04)
{
	word32 eax_11 = 0x01;
	if (*((word32) dwArg04 + 0x0050) != 0x00)
	{
		up32 * edx_41 = *((word32) dwArg04 + 100);
		word32 esp_56;
		word32 ebp_57;
		struct Eq_164 * ebx_58;
		word32 eax_59;
		byte SCZO_60;
		byte Z_61;
		word32 edx_62;
		byte SZO_63;
		byte C_64;
		word32 ecx_65;
		byte CZ_66;
		(*((word32) dwArg04 + 0x0054))();
		if (eax_59 == 0x00)
			ebx_58->dw0060 = 0x01;
		ebx_58->dw0050 = 0x00;
		eax_11 = 0x00;
	}
	return eax_11;
}

// 00403A68: void fn00403A68(Stack Eq_57 dwArg08)
void fn00403A68(Eq_57 dwArg08)
{
	if (*((word32) dwArg08 + 0x0050) >= 0x50)
		fn00403A20(dwArg08);
	up32 * eax_19 = *((word32) dwArg08 + 100);
	if (eax_19 == null || *eax_19 > *((word32) dwArg08 + 0x005C))
	{
		Mem43[dwArg08 + Mem0[dwArg08 + 0x50:word32]:byte] = Mem0[fp + 0x04:byte];
		*((word32) dwArg08 + 0x0050) = (word32) *((word32) dwArg08 + 0x0050) + 0x01;
	}
	*((word32) dwArg08 + 0x005C) = (word32) *((word32) dwArg08 + 0x005C) + 0x01;
}

// 00403A9C: void fn00403A9C(Stack Eq_57 dwArg04, Stack Eq_57 dwArg08)
void fn00403A9C(Eq_57 dwArg04, Eq_57 dwArg08)
{
	int32 ecx_18 = 0x07;
	Eq_57 esi_13 = dwArg04;
	byte * eax_14 = (word32) dwArg08 + 0x07;
	do
	{
		int32 edx_24 = esi_13 & 0x0F;
		byte dl_25 = (byte) edx_24;
		if (edx_24 < 0x0A)
			*eax_14 = dl_25 + 0x30;
		else
			*eax_14 = dl_25 + 55;
		esi_13 = esi_13 >> 0x04;
		ecx_18 = ecx_18 - 0x01;
		eax_14 = eax_14 - 0x01;
	} while (ecx_18 >= 0x00);
}

// 00403AD0: void fn00403AD0(Register ptr32 ebp, Stack Eq_57 dwArg04, Stack (ptr byte) dwArg08, Stack (ptr Eq_34) dwArg0C, Stack word32 dwArg10)
void fn00403AD0(ptr32 ebp, Eq_57 dwArg04, byte * dwArg08, Eq_34 * dwArg0C, word32 dwArg10)
{
}

// 0040487C: Register int32 fn0040487C(Stack Eq_57 dwArg04, Stack cup16 wArg08)
int32 fn0040487C(Eq_57 dwArg04, cup16 wArg08)
{
	if (dwArg04 == 0x00)
		return 0x00;
	if (globals->ptr40B59C->dw0008 == 0x00)
	{
		int32 eax_97 = WideCharToMultiByte(globals->ptr40B59C->t0000, 0x0220, fp + 0x08, 0x01, dwArg04, 0x02, null, fp - 0x08);
		if (eax_97 == 0x00 || 0x00 != 0x00)
			return eax_97 | ~0x00;
		return eax_97;
	}
	else
	{
		if (wArg08 > 0xFF)
			return dwArg04 | ~0x00;
		*dwArg04 = bArg08;
		return 0x01;
	}
}

// 00404C97: Register Eq_57 fn00404C97(Register Eq_57 eax, Register Eq_57 edx, Stack Eq_57 dwArg04, Stack Eq_57 dwArg08, Register out ptr32 edxOut)
Eq_57 fn00404C97(Eq_57 eax, Eq_57 edx, Eq_57 dwArg04, Eq_57 dwArg08, ptr32 & edxOut)
{
	if (dwArg08 == 0x00)
	{
		uint64 edx_eax_104 = SEQ(edx, eax);
		if (edx == 0x00 || dwArg04 == 0x00)
		{
			eax = (uint32) (edx_eax_104 /u dwArg04);
			word32 edx_114;
			*edxOut = 0x00;
			return eax;
		}
	}
	Eq_57 edx_45 = edx;
	ui64 ebp_ebx_50 = SEQ(dwArg08, dwArg04);
	word32 ecx_51 = 0x40;
	Eq_57 edi_52 = 0x00;
	Eq_57 esi_53 = 0x00;
	do
	{
		eax = eax << 0x01;
		edx_45 = __rcl(edx_45, 0x01, cond(eax));
		*edxOut = edx_45;
		esi_53 = __rcl(esi_53, 0x01, (edx_45 & 0x80000000) != 0x00);
		edi_52 = __rcl(edi_52, 0x01, (esi_53 & 0x80000000) != 0x00);
		if (edi_52 >= dwArg08 && (edi_52 > dwArg08 || esi_53 >= dwArg04))
		{
			ui64 edi_esi_94 = SEQ(edi_52, esi_53 - dwArg04) - ebp_ebx_50;
			edi_52 = SLICE(edi_esi_94, word32, 32);
			esi_53 = (word32) edi_esi_94;
			eax = (word32) eax + 0x01;
		}
		ecx_51 = ecx_51 - 0x01;
	} while (ecx_51 != 0x00);
	return eax;
}

// 00404D5A: Register byte fn00404D5A(Register Eq_57 eax, Register Eq_57 edx, Stack Eq_57 dwArg04, Stack Eq_57 dwArg08)
byte fn00404D5A(Eq_57 eax, Eq_57 edx, Eq_57 dwArg04, Eq_57 dwArg08)
{
	byte al_123;
	if (dwArg08 == 0x00)
	{
		ui64 edx_eax_111 = SEQ(edx, eax);
		if (edx == 0x00 || dwArg04 == 0x00)
		{
			al_123 = (byte) (uint32) (edx_eax_111 % dwArg04);
			return al_123;
		}
	}
	Eq_57 edx_46 = edx;
	ui64 ebp_ebx_50 = SEQ(dwArg08, dwArg04);
	word32 ecx_51 = 0x40;
	Eq_57 edi_101 = 0x00;
	Eq_57 esi_102 = 0x00;
	do
	{
		eax = eax << 0x01;
		edx_46 = __rcl(edx_46, 0x01, cond(eax));
		esi_102 = __rcl(esi_102, 0x01, (edx_46 & 0x80000000) != 0x00);
		edi_101 = __rcl(edi_101, 0x01, (esi_102 & 0x80000000) != 0x00);
		if (edi_101 >= dwArg08 && (edi_101 > dwArg08 || esi_102 >= dwArg04))
		{
			ui64 edi_esi_100 = SEQ(edi_101, esi_102 - dwArg04) - ebp_ebx_50;
			edi_101 = SLICE(edi_esi_100, word32, 32);
			esi_102 = (word32) edi_esi_100;
			eax = (word32) eax + 0x01;
		}
		ecx_51 = ecx_51 - 0x01;
	} while (ecx_51 != 0x00);
	al_123 = (byte) esi_102;
	return al_123;
}

// 00404FC8: void fn00404FC8()
void fn00404FC8()
{
	word32 esp_3;
	globals->ptr40B780();
}

// 00404FCE: void fn00404FCE()
void fn00404FCE()
{
	word32 esp_3;
	globals->ptr40B784();
}

// 00405090: void fn00405090(Stack Eq_57 dwArg04, Stack Eq_57 dwArg08, Stack (ptr byte) dwArg0C, Stack (ptr Eq_34) dwArg10, Stack byte bArg14, Stack ci8 bArg18)
void fn00405090(Eq_57 dwArg04, Eq_57 dwArg08, byte * dwArg0C, Eq_34 * dwArg10, byte bArg14, ci8 bArg18)
{
	byte * esi_115 = dwArg0C;
	if (dwArg10 < (struct Eq_34 *) 0x02 || dwArg10 > (struct Eq_34 *) 0x24)
	{
l00405134:
		*esi_115 = 0x00;
		return;
	}
	if (dwArg08 == 0x00)
	{
		if (dwArg04 >= 0x00)
			goto l004050DE;
	}
	else if (dwArg08 >= null)
		goto l004050DE;
	if (bArg14 != 0x00)
	{
		*dwArg0C = 0x2D;
		Eq_57 eax_148 = -dwArg04;
		esi_115 = dwArg0C + 0x01;
		dwArg04 = eax_148;
		dwArg08 = -((word32) dwArg08 + (eax_148 == 0x00));
	}
l004050DE:
	byte * ebx_116 = fp - 0x48;
	do
	{
		int64 edx_eax_75 = (int64) dwArg10;
		*ebx_116 = fn00404D5A(dwArg04, dwArg08, (word32) edx_eax_75, SLICE(edx_eax_75, word32, 32));
		int64 edx_eax_88 = (int64) dwArg10;
		Eq_57 edx_99;
		Eq_57 eax_100 = fn00404C97(dwArg04, dwArg08, (word32) edx_eax_88, SLICE(edx_eax_88, word32, 32), out edx_99);
		ebx_116 = ebx_116 + 0x01;
		dwArg04 = eax_100;
		dwArg08 = edx_99;
	} while (edx_99 != 0x00 || eax_100 != 0x00);
	while (ebx_116 != fp - 0x48)
	{
		ebx_116 = ebx_116 - 0x01;
		ci8 al_121 = *ebx_116;
		eax_100 = DPB(eax_100, al_121, 0);
		if (al_121 < 0x0A)
		{
			*esi_115 = (byte) ((word32) eax_100 + 0x0030);
			eax_100 = (word32) eax_100 + 0x0030;
			esi_115 = esi_115 + 0x01;
		}
		else
		{
			*esi_115 = al_121 + bArg18 + ~0x09;
			esi_115 = esi_115 + 0x01;
		}
	}
	goto l00405134;
}

