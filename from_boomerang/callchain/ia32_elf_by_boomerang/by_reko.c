// subject_fini.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_fini.h"

// 080494A0: void _fini()
void _fini()
{
	__do_global_dtors_aux();
}

// subject_init.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_init.h"

// 08049470: Register word32 _init()
// Called from:
//      _start
word32 _init()
{
	word32 edx_5 = frame_dummy();
	__do_global_ctors_aux();
	return edx_5;
}

// subject_plt.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_plt.h"

// 080487E8: void _cleanup()
void _cleanup()
{
}

// 080487F8: void atexit()
void atexit()
{
}

// 08048808: void __fpstart()
void __fpstart()
{
}

// 08048818: void exit()
void exit()
{
}

// 08048828: void printf()
void printf()
{
}

// 08048838: void malloc()
void malloc()
{
}

// 08048848: void free()
void free()
{
}

// 08048858: void abort()
void abort()
{
}

// 08048868: void memset()
void memset()
{
}

// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_text.h"

// 08048878: void _start(Register (ptr32 Eq_2) edx, Stack ui32 dwArg00)
void _start(void (* edx)(), ui32 dwArg00)
{
	if (0x080487E8 != 0x00)
		atexit(&g_t80487E8);
	if (0x0804A500 != 0x00)
		atexit(edx);
	atexit(&g_t80494A0);
	g_ptr804AAC8 = fp + 0x08 + dwArg00 * 0x04;
	__fpstart();
	exit(main());
}

// 080488E7: void _mcount()
void _mcount()
{
}

// 080488E8: void __do_global_dtors_aux()
// Called from:
//      _fini
void __do_global_dtors_aux()
{
	while (true)
	{
		<anonymous> ** eax_16 = g_ptr804A598;
		if (*eax_16 == null)
			break;
		g_ptr804A598 = (<anonymous> **) ((char *) eax_16 + 4);
		(*eax_16)();
	}
	__deregister_frame_info(0x0804A5AC);
}

// 08048928: void fini_dummy()
void fini_dummy()
{
}

// 08048940: Register word32 frame_dummy()
// Called from:
//      _init
word32 frame_dummy()
{
	return __register_frame_info(&g_t804A5AC, &g_t804AAAC);
}

// 08048968: void init_dummy()
void init_dummy()
{
}

// 08048980: Register word32 add5(Stack word32 dwArg04)
// Called from:
//      main
word32 add5(word32 dwArg04)
{
	return dwArg04 + 0x05;
}

// 08048990: Register word32 add10(Stack word32 dwArg04)
// Called from:
//      main
word32 add10(word32 dwArg04)
{
	return dwArg04 + 0x0A;
}

// 080489A0: Register word32 add15(Stack word32 dwArg04)
// Called from:
//      main
word32 add15(word32 dwArg04)
{
	return dwArg04 + 0x0F;
}

// 080489B0: void printarg(Stack int32 dwArg04)
// Called from:
//      main
void printarg(int32 dwArg04)
{
	printf("Fifty five is %d\n", dwArg04);
}

// 080489C4: Register word32 main()
// Called from:
//      _start
word32 main()
{
	printarg(add5(add10(add15(0x19))));
	return 0x00;
}

// 080489E4: Register word32 decode_uleb128(Stack (ptr32 byte) dwArg04, Stack (ptr32 ui32) dwArg08)
// Called from:
//      extract_cie_info
//      execute_cfa_insn
//      __frame_state_for
word32 decode_uleb128(byte * dwArg04, ui32 * dwArg08)
{
	ui32 edi_14 = 0x00;
	word32 esi_17 = 0x00;
	while (true)
	{
		ui32 edx_21 = (word32) *dwArg04;
		++dwArg04;
		edi_14 |= (edx_21 & 0x7F) << (byte) esi_17;
		if ((byte) edx_21 >= 0x00)
			break;
		esi_17 += 0x07;
	}
	*dwArg08 = edi_14;
	return dwArg04 + 1;
}

// 08048A20: Register (ptr32 byte) decode_sleb128(Stack (ptr32 byte) dwArg04, Stack (ptr32 ui32) dwArg08)
// Called from:
//      extract_cie_info
byte * decode_sleb128(byte * dwArg04, ui32 * dwArg08)
{
	byte * edi_16 = dwArg04;
	ui32 dwLoc08_73 = 0x00;
	up32 ecx_106 = 0x00;
	do
	{
		ui32 esi_21 = (word32) *edi_16;
		ui32 v12_28 = dwLoc08_73 | (esi_21 & 0x7F) << (byte) ecx_109;
		++edi_16;
		dwLoc08_73 = v12_28;
		byte cl_45 = (byte) (ecx_109 + 0x07);
		ecx_106 = ecx_109 + 0x07;
		ecx_109 = ecx_106;
	} while ((byte) esi_21 < 0x00);
	if (ecx_109 <= 0x18 && (esi_21 & 0x40) != 0x00)
		dwLoc08_73 = v12_28 | ~0x00 << cl_45;
	*dwArg08 = dwLoc08_73;
	return edi_16;
}

// 08048A7C: void fde_insert(Stack (ptr32 Eq_60) dwArg04, Stack ui32 dwArg08, Stack (ptr32 Eq_60) dwArg0C)
// Called from:
//      add_fdes
void fde_insert(struct Eq_60 * dwArg04, ui32 dwArg08, struct Eq_60 * dwArg0C)
{
	dwArg04[dwArg08] = (struct Eq_60) dwArg0C;
	ui32 edx_15 = dwArg08;
	if (dwArg08 != 0x00)
	{
		word32 * ecx_22 = dwArg04 + dwArg08;
		do
		{
			struct Eq_182 * esi_30 = (dwArg04 - 0x04)[edx_15];
			struct Eq_186 * edi_25 = *ecx_22;
			if (edi_25->dw0008 - esi_30->dw0008 >= 0x00)
				return;
			*ecx_22 = esi_30;
			(dwArg04 - 0x04)[edx_15] = edi_25;
			ecx_22 += -1;
			--edx_15;
		} while (edx_15 != 0x00);
	}
}

// 08048AD4: Register word32 count_fdes(Stack (ptr32 Eq_60) dwArg04)
// Called from:
//      frame_init
word32 count_fdes(struct Eq_60 * dwArg04)
{
	struct Eq_60 * edx_12 = dwArg04;
	word32 ecx_18 = 0x00;
	if (dwArg04->t0000 != 0x00)
	{
		do
		{
			if (edx_12[1] != 0x00 && edx_12[2] != 0x00)
				++ecx_18;
			word32 eax_24 = edx_12 + Mem6[edx_12 + 0x00:word32];
			edx_12 = (struct Eq_60 *) &eax_24->dw0004;
		} while (eax_24->dw0004 != 0x00);
	}
	return ecx_18;
}

// 08048B04: void add_fdes(Stack (ptr32 Eq_60) dwArg04, Stack (ptr32 Eq_60) dwArg08, Stack (ptr32 ui32) dwArg0C, Stack (ptr32 up32) dwArg10, Stack (ptr32 up32) dwArg14)
// Called from:
//      frame_init
void add_fdes(struct Eq_60 * dwArg04, struct Eq_60 * dwArg08, ui32 * dwArg0C, up32 * dwArg10, up32 * dwArg14)
{
	struct Eq_60 * esi_20 = dwArg04;
	ui32 edi_22 = *dwArg0C;
	up32 dwLoc08_108 = *dwArg10;
	up32 dwLoc0C_110 = *dwArg14;
	if (dwArg04->t0000 != 0x00)
	{
		do
		{
			if (esi_20[1] != 0x00 && esi_20[2] != 0x00)
			{
				fde_insert(dwArg08, edi_22, esi_20);
				++edi_22;
				up32 eax_56 = esi_20[2];
				if (dwLoc08_108 > eax_56)
					dwLoc08_108 = eax_56;
				up32 eax_64 = (word32) esi_20[3].t0000 + eax_56;
				if (dwLoc0C_110 < eax_64)
					dwLoc0C_110 = eax_64;
			}
			word32 eax_72 = esi_20 + Mem71[esi_20 + 0x00:word32];
			esi_20 = (struct Eq_60 *) &eax_72->dw0004;
		} while (eax_72->dw0004 != 0x00);
	}
	*dwArg0C = edi_22;
	*dwArg10 = dwLoc08_108;
	*dwArg14 = dwLoc0C_110;
}

// 08048B94: void frame_init(Stack (ptr32 Eq_61) dwArg04)
// Called from:
//      find_fde
void frame_init(struct Eq_61 * dwArg04)
{
	uint32 dwLoc10_165;
	struct Eq_60 * eax_21 = dwArg04->ptr000C;
	if (eax_21 != null)
	{
		struct Eq_60 * esi_39 = eax_21;
		dwLoc10_165 = 0x00;
		if (eax_21->t0000 != 0x00)
		{
			do
			{
				dwLoc10_165 += count_fdes(esi_39->t0000);
				++esi_39;
			} while (esi_39->t0000 != 0x00);
		}
	}
	else
		dwLoc10_165 = count_fdes(dwArg04->ptr0008);
	dwArg04->dw0010 = dwLoc10_165;
	struct Eq_60 * eax_72 = malloc(dwLoc10_165 << 0x02);
	struct Eq_60 * eax_80 = dwArg04->ptr000C;
	if (eax_80 != null)
	{
		struct Eq_60 * esi_106 = eax_80;
		if (eax_80->t0000 != 0x00)
		{
			do
			{
				add_fdes(esi_106->t0000, eax_72, fp - 0x10, fp - 0x0C, fp - 0x08);
				++esi_106;
			} while (esi_106->t0000 != 0x00);
		}
	}
	else
		add_fdes(dwArg04->ptr0008, eax_72, fp - 0x10, fp - 0x0C, fp - 0x08);
	dwArg04->ptr000C = eax_72;
	dwArg04->dw0000 = ~0x00;
	dwArg04->dw0004 = 0x00;
}

// 08048C80: Register (ptr32 Eq_417) find_fde(Stack up32 dwArg04)
// Called from:
//      __frame_state_for
struct Eq_417 * find_fde(up32 dwArg04)
{
	struct Eq_417 * eax_163;
	struct Eq_61 * esi_20 = g_ptr804AAC4;
	if (esi_20 != null)
	{
		do
		{
			if (esi_20->dw0000 == 0x00)
				frame_init(esi_20);
			if (esi_20->dw0000 <= dwArg04 && esi_20->dw0004 > dwArg04)
				break;
			esi_20 = esi_20->ptr0014;
		} while (esi_20 != null);
		if (esi_20 != null)
		{
			uint32 ecx_61 = esi_20->dw0010;
			uint32 edi_59 = 0x00;
			uint32 dwLoc08_119 = ecx_61;
			if (ecx_61 > 0x00)
			{
				struct Eq_60 * esi_67 = esi_20->ptr000C;
				do
				{
					uint32 eax_72 = dwLoc08_119 + edi_59;
					struct Eq_417 * ecx_76 = esi_67[eax_72 >> 0x01];
					up32 eax_78 = ecx_76->dw0008;
					if (dwArg04 < eax_78)
						dwLoc08_119 = eax_72 >> 0x01;
					else
					{
						if (dwArg04 <= eax_78 + ecx_76->dw000C)
						{
							eax_163 = ecx_76;
							return eax_163;
						}
						edi_59 = (eax_72 >> 0x01) + 0x01;
					}
				} while (dwLoc08_119 > edi_59);
			}
		}
	}
	eax_163 = null;
	return eax_163;
}

// 08048D20: Register ptr32 extract_cie_info(Stack (ptr32 Eq_486) dwArg04, Stack (ptr32 Eq_487) dwArg08)
// Called from:
//      __frame_state_for
ptr32 extract_cie_info(struct Eq_486 * dwArg04, struct Eq_487 * dwArg08)
{
	struct Eq_488 * edx_23 = dwArg04 - (dwArg04->dw0004 + ~0x03);
	dwArg08->ptr0000 = &edx_23->b0009;
	byte al_34 = (byte) 0x080494CA;
	byte * esi_24 = &edx_23->b0009;
	word32 ecx_31 = 0x01;
	byte * edi_32 = &g_b80494CA;
	bool Z_45 = SLICE(cond(al_34 & 0x00), bool, 2);
	while (ecx_31 != 0x00)
	{
		Z_45 = SLICE(cond(*esi_377 - *edi_378), bool, 2);
		esi_24 = esi_377 + 1;
		edi_32 = edi_378 + 1;
		--ecx_31;
		esi_377 = esi_24;
		edi_378 = edi_32;
		if (*esi_377 == *edi_378)
			break;
	}
	ptr32 eax_222;
	if (!Z_45)
	{
		byte * esi_52 = &edx_23->b0009;
		byte * edi_55 = &g_b80494CB;
		word32 ecx_56 = 0x03;
		bool Z_70 = SLICE(cond(al_34 & 0x00), bool, 2);
		while (ecx_56 != 0x00)
		{
			Z_70 = SLICE(cond(*esi_379 - *edi_380), bool, 2);
			esi_52 = esi_379 + 1;
			edi_55 = edi_380 + 1;
			--ecx_56;
			esi_379 = esi_52;
			edi_380 = edi_55;
			if (*esi_379 == *edi_380)
				break;
		}
		if (!Z_70 && edx_23->b0009 != 122)
		{
			eax_222 = 0x00;
			return eax_222;
		}
	}
	byte * eax_86 = dwArg08->ptr0000;
	byte * edi_100 = eax_86;
	word32 ecx_101 = ~0x00;
	while (ecx_101 != 0x00)
	{
		edi_100 = edi_381 + 1;
		--ecx_101;
		edi_381 = edi_100;
		if (*edi_381 != 0x00)
			break;
	}
	struct Eq_591 * eax_110 = eax_86 - 0x01 + ~ecx_101;
	byte * edx_113 = &eax_110->dw0001;
	byte * esi_114 = eax_86;
	byte * edi_121 = &g_b80494CB;
	word32 ecx_123 = 0x03;
	bool Z_136 = SLICE(cond((byte) eax_110 & 0x00), bool, 2);
	while (ecx_123 != 0x00)
	{
		Z_136 = SLICE(cond(*esi_382 - *edi_383), bool, 2);
		esi_114 = esi_382 + 1;
		edi_121 = edi_383 + 1;
		--ecx_123;
		esi_382 = esi_114;
		edi_383 = edi_121;
		if (*esi_382 == *edi_383)
			break;
	}
	if (!Z_136)
	{
		dwArg08->dw0004 = eax_110->dw0001;
		edx_113 = (byte *) (&eax_110->dw0001 + 1);
	}
	else
		dwArg08->dw0004 = 0x00;
	byte * eax_190 = decode_sleb128(decode_uleb128(edx_113, &dwArg08->dw0004 + 1), &dwArg08->dw0004 + 2);
	dwArg08->dw0010 = (word32) *eax_190;
	ptr32 edx_201 = eax_190 + 1;
	if (*dwArg08->ptr0000 == 122)
		edx_201 = decode_uleb128(eax_190 + 1, fp - 0x08) + dwLoc08;
	eax_222 = edx_201;
	return eax_222;
}

// 08048E38: Register (ptr32 byte) execute_cfa_insn(Stack (ptr32 byte) dwArg04, Stack Eq_699 dwArg08, Stack (ptr32 Eq_700) dwArg0C, Stack (ptr32 word32) dwArg10, Register out (ptr32 Eq_702) ebpOut, Register out (ptr32 Eq_700) ediOut)
// Called from:
//      __frame_state_for
byte * execute_cfa_insn(byte * dwArg04, Eq_699 dwArg08, struct Eq_700 * dwArg0C, word32 * dwArg10, struct Eq_702 & ebpOut, struct Eq_700 & ediOut)
{
	uint32 eax_23 = (word32) *dwArg04;
	ci8 al_32 = (byte) eax_23;
	byte * dwArg04_111 = dwArg04 + 1;
	byte bLoc14_114 = (byte) (eax_23 & 0x40);
	if ((eax_23 & 0x40) != 0x00)
		*dwArg10 += (eax_23 & 0x3F) *s dwArg0C->dw0008;
	else if (al_32 < 0x00)
	{
		dwArg04_111 = decode_uleb128(dwArg04 + 1, fp - 0x08);
		int32 eax_77 = dwLoc08 *s dwArg0C->dw000C;
		*((word32) dwArg08.u0 + ((word32) (eax_23 & 0x3F) + 92)) = 0x01;
		Mem86[(eax_23 & 0x3F) * 0x04 + 0x10 + dwArg08:word32] = eax_77;
	}
	else
	{
		if ((al_32 & 0xC0) == 0x00)
		{
			if (eax_23 > 0x2E)
				abort();
			else
			{
				<anonymous> * ecx_44 = 0x0804A4D0 - g_a8048EF8[eax_23 * 0x04];
				byte * eax_48;
				ecx_44();
				ebpOut = fp - 4;
				ediOut = dwArg0C;
				return eax_48;
			}
		}
		Mem56[(eax_23 & 0x3F) + 0x5C + dwArg08:byte] = bLoc14_114;
	}
	ebpOut = ebp;
	ediOut = edi;
	return dwArg04_111;
}

// 080491C8: Register (ptr32 Eq_61) __register_frame_info(Stack (ptr32 Eq_60) dwArg04, Stack (ptr32 Eq_61) dwArg08)
// Called from:
//      frame_dummy
struct Eq_61 * __register_frame_info(struct Eq_60 * dwArg04, struct Eq_61 * dwArg08)
{
	dwArg08->ptr0008 = dwArg04;
	dwArg08->dw0004 = 0x00;
	dwArg08->dw0000 = 0x00;
	dwArg08->ptr000C = null;
	dwArg08->dw0010 = 0x00;
	dwArg08->ptr0014 = g_ptr804AAC4;
	g_ptr804AAC4 = dwArg08;
	return dwArg08;
}

// 08049210: void __register_frame_info_table(Stack (ptr32 Eq_60) dwArg04, Stack (ptr32 Eq_61) dwArg08)
void __register_frame_info_table(struct Eq_60 * dwArg04, struct Eq_61 * dwArg08)
{
	dwArg08->ptr0008 = dwArg04;
	dwArg08->ptr000C = dwArg04;
	dwArg08->dw0004 = 0x00;
	dwArg08->dw0000 = 0x00;
	dwArg08->dw0010 = 0x00;
	dwArg08->ptr0014 = g_ptr804AAC4;
	g_ptr804AAC4 = dwArg08;
}

// 08049254: void __deregister_frame_info(Stack ptr32 dwArg04)
// Called from:
//      __do_global_dtors_aux
void __deregister_frame_info(ptr32 dwArg04)
{
	struct Eq_843 * ecx_14 = &g_ptr804AAC4;
	if (g_ptr804AAC4 != null)
	{
		do
		{
			struct Eq_851 * edx_19 = ecx_14->dw0000;
			if (edx_19->ptr0008 == dwArg04)
			{
				ecx_14->dw0000 = edx_19->dw0014;
				if (edx_19->dw0000 != 0x00)
					free(edx_19->ptr000C);
				return;
			}
			ecx_14 = (struct Eq_843 *) &edx_19->dw0014;
		} while (edx_19->dw0014 != 0x00);
	}
	abort();
}

// 080492AC: void __frame_state_for(Stack up32 dwArg04)
void __frame_state_for(up32 dwArg04)
{
	struct Eq_885 * ebp_113 = fp - 4;
	struct Eq_486 * eax_24 = find_fde(dwArg04);
	if (eax_24 != null)
	{
		byte * eax_43 = extract_cie_info(eax_24, fp - 0x18);
		byte * esi_109 = eax_43;
		if (eax_43 != null)
		{
			memset(fp - 0x8C, 0x00, 116);
			up32 * ecx_74 = eax_24 - (eax_24->dw0004 + ~0x03);
			ptr32 esp_110 = fp - 0xB8;
			if (eax_43 < (ecx_74 + *ecx_74) + 1)
			{
				do
				{
					struct Eq_946 * esp_85 = esp_110 - 4;
					esp_85->ptr0000 = null;
					esp_85->ptrFFFFFFFC = ebp_113->ptrFFFFFF60;
					esp_85->tFFFFFFF8 = ebp_113->tFFFFFF5C;
					esp_85->ptrFFFFFFF4 = esi_109;
					byte * edi_101;
					byte * eax_97 = execute_cfa_insn(esp_85->ptrFFFFFFF4, esp_85->tFFFFFFF8, esp_85->ptrFFFFFFFC, esp_85->ptr0000, out ebp_113, out edi_101);
					word32 esp_104 = <invalid>;
					esi_109 = eax_97;
					esp_110 = esp_104 + 0x10;
				} while (eax_97 < edi_101);
			}
			struct Eq_931 * esi_115 = ebp_113->ptrFFFFFF6C;
			byte * esi_116 = &esi_115->dw0008 + 2;
			if (*ebp_113->ptrFFFFFFEC == 122)
			{
				struct Eq_1014 * esp_122 = esp_110 - 4;
				esp_122->ptr0000 = ebp_113 - 0x8C;
				esp_122->ptrFFFFFFFC = (byte *) (&esi_115->dw0008 + 2);
				esi_116 = decode_uleb128(esp_122->ptrFFFFFFFC, esp_122->ptr0000) + ebp_113->dwFFFFFF74;
			}
			struct Eq_931 * eax_139 = ebp_113->ptrFFFFFF6C;
			up32 eax_140 = eax_139 + eax_139->dw0000 / 0x0C;
			ebp_113->dwFFFFFF70 = ebp_113->ptrFFFFFF6C->dw0008;
			ptr32 esp_156 = esp_110;
			if (esi_116 < eax_140 + 0x04)
			{
				ebp_113->ptrFFFFFF58 = ebp_113 - 0x90;
				while (ebp_113->dwFFFFFF70 <= ebp_113->dw0008)
				{
					struct Eq_1052 * esp_157 = esp_156 - 4;
					esp_157->ptr0000 = ebp_113->ptrFFFFFF58;
					esp_157->ptrFFFFFFFC = ebp_113 - 0x14;
					esp_157->tFFFFFFF8 = ebp_113 - 0x88;
					esp_157->ptrFFFFFFF4 = esi_116;
					byte * edi_172;
					byte * eax_168 = execute_cfa_insn(esp_157->ptrFFFFFFF4, esp_157->tFFFFFFF8, esp_157->ptrFFFFFFFC, esp_157->ptr0000, out ebp_113, out edi_172);
					word32 esp_175 = <invalid>;
					esi_116 = eax_168;
					esp_156 = esp_175 + 0x10;
					if (eax_168 >= edi_172)
						break;
				}
			}
			word32 * edi_186 = ebp_113->ptr000C;
			word32 * esi_187 = ebp_113 - 0x88;
			word32 ecx_189;
			for (ecx_189 = 0x1C; ecx_189 != 0x00; --ecx_189)
			{
				*edi_186 = *esi_187;
				++esi_187;
				++edi_186;
			}
		}
	}
}

// 08049418: void __do_global_ctors_aux()
// Called from:
//      _init
void __do_global_ctors_aux()
{
	<anonymous> ** esi_17 = &g_dw804A5A4;
	if (g_dw804A5A4 != ~0x00)
	{
		do
		{
			(*esi_17)();
			esi_17 = (<anonymous> **) ((char *) esi_17 - 4);
		} while (*esi_17 != (<anonymous> *) ~0x00);
	}
}

// 0804944C: void init_dummy()
void init_dummy()
{
}

