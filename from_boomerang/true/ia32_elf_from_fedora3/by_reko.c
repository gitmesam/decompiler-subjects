// subject_plt.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_plt.h"

// 080488E4: void __fpending()
void __fpending()
{
}

// 080488F4: void __overflow()
void __overflow()
{
}

// 08048904: void fputs_unlocked()
void fputs_unlocked()
{
}

// 08048914: void fprintf()
void fprintf()
{
}

// 08048924: void getenv()
void getenv()
{
}

// 08048934: void dcgettext()
void dcgettext()
{
}

// 08048944: void setlocale()
void setlocale()
{
}

// 08048954: void __cxa_atexit()
void __cxa_atexit()
{
}

// 08048964: void __errno_location()
void __errno_location()
{
}

// 08048974: void malloc()
void malloc()
{
}

// 08048984: void abort()
void abort()
{
}

// 08048994: void vfprintf()
void vfprintf()
{
}

// 080489A4: void bindtextdomain()
void bindtextdomain()
{
}

// 080489B4: void mbrtowc()
void mbrtowc()
{
}

// 080489C4: void __libc_start_main()
void __libc_start_main()
{
}

// 080489D4: void realloc()
void realloc()
{
}

// 080489E4: void textdomain()
void textdomain()
{
}

// 080489F4: void printf()
void printf()
{
}

// 08048A04: void memcpy()
void memcpy()
{
}

// 08048A14: void fclose()
void fclose()
{
}

// 08048A24: void __ctype_get_mb_cur_max()
void __ctype_get_mb_cur_max()
{
}

// 08048A34: void exit()
void exit()
{
}

// 08048A44: void calloc()
void calloc()
{
}

// 08048A54: void iswprint()
void iswprint()
{
}

// 08048A64: void free()
void free()
{
}

// 08048A74: void memset()
void memset()
{
}

// 08048A84: void mbsinit()
void mbsinit()
{
}

// 08048A94: void error()
void error()
{
}

// 08048AA4: void __ctype_b_loc()
void __ctype_b_loc()
{
}

// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_text.h"

// 08048AC0: void fn08048AC0(Register (ptr32 Eq_2) edx, Stack int32 dwArg00)
void fn08048AC0(void (* edx)(), int32 dwArg00)
{
	__align((char *) fp + 4);
	__libc_start_main(&g_t8048C4A, dwArg00, (char *) fp + 4, &g_t804A008, &g_t804A05C, edx, fp);
	__hlt();
}

// 08048D81: void close_stdout()
void close_stdout()
{
	FILE ** edi_20 = g_ptr804B958;
	FILE * edx_21 = *edi_20;
	int32 esi_27 = 0x00 - ((edx_21->dw0000 >> 0x05 & 0x01) < 0x01);
	if (esi_27 != 0x00 && __fpending(edx_21) == null)
		return;
	if (fclose(*edi_20) != 0x00)
		esi_27 = *__errno_location();
	if (esi_27 < 0x00)
		return;
	dcgettext(null, "write error", 0x05);
	Eq_81 eax_61 = g_t804BA04;
	if (eax_61 == null)
		error(*g_ptr804B95C, esi_27, "%s", 0x00);
	else
	{
		fn08049A8B(eax_61);
		error(*g_ptr804B95C, esi_27, "%s: %s", 0x00);
	}
}

// 08048F36: void fn08048F36(Stack ptr32 dwArg04, Stack byte bArg08, Stack ui32 dwArg0C)
// Called from:
//      fn080499F0
void fn08048F36(ptr32 dwArg04, byte bArg08, ui32 dwArg0C)
{
	ui32 ecx_19 = (word32) bArg08;
	ui32 eax_25 = (word32) ((byte) ecx_19 >> 0x05);
	int32 * edi_29 = (eax_25 << 0x02) + 0x04 + dwArg04;
	if (dwArg04 == 0x00)
	{
		int32 * edi_31 = 0x0804BB24 + (eax_25 << 0x02);
		byte cl_36 = (byte) (ecx_19 & 0x1F);
		int32 edx_34 = *edi_31;
		*edi_31 = edx_34 ^ (dwArg0C & 0x01 ^ edx_34 >> cl_36 & 0x01) << cl_36;
	}
	else
	{
		int32 edx_53 = *edi_29;
		byte cl_57 = (byte) (ecx_19 & 0x1F);
		*edi_29 = edx_53 ^ (dwArg0C & 0x01 ^ edx_53 >> cl_57 & 0x01) << cl_57;
	}
}

// 08048FF6: Register Eq_172 fn08048FF6(Register Eq_172 eax, Register Eq_172 edx, Stack Eq_81 dwArg04, Stack Eq_172 dwArg08, Stack uint32 dwArg0C, Stack Eq_172 dwArg10, Register out ptr32 ebpOut, Register out Eq_172 esiOut)
// Called from:
//      fn080496C3
Eq_172 fn08048FF6(Eq_172 eax, Eq_172 edx, Eq_81 dwArg04, Eq_172 dwArg08, uint32 dwArg0C, Eq_172 dwArg10, ptr32 & ebpOut, size_t & esiOut)
{
	Eq_172 dwLoc38_603 = null;
	word32 eax_33 = (word32) (int8) (__ctype_get_mb_cur_max() == (void *) 0x01);
	if (dwArg0C <= 0x06)
	{
		<anonymous> * eax_576 = g_a804A2CC[dwArg0C * 0x04] + 0x0804B94C;
		Eq_172 eax_578;
		word32 ecx_580;
		eax_576();
		ebpOut = fp - 4;
		esiOut = esi;
		return eax_578;
	}
	Eq_172 esi_1235;
	Eq_172 edx_1232;
	ui24 edx_24_8_54;
	Eq_172 dwLoc34_609 = null;
	edx_1232 = edx;
	esi_1235 = esi;
	esi_1235 = esi;
	while (dwArg08 != (void *) ~0x00)
	{
		edx_24_8_54 = SLICE(dwArg08, word24, 8);
		if (dwLoc34_609 == dwArg08)
		{
l08049228:
			byte * dwLoc3C_837 = null;
			if (false)
			{
				while (true)
				{
					uint8 al_434 = (byte) (word32) *dwLoc3C_837;
					if (al_434 == 0x00)
						break;
					if (dwLoc38_603 < edx)
						Mem443[eax + dwLoc38_603:byte] = al_434;
					dwLoc38_603 = (Eq_172) ((char *) dwLoc38_603 + 1);
					++dwLoc3C_837;
				}
			}
			if (dwLoc38_603 < edx)
				Mem458[eax + dwLoc38_603:byte] = 0x00;
			ebpOut = ebp;
			esiOut = esi;
			return dwLoc38_603;
		}
l08049093:
		if ((SEQ(edx_24_8_54, (int8) false) & (uint32) ((int8) false)) != 0x00 && dwLoc34_609 <= dwArg08)
		{
			esi_1235 = dwArg04 + dwLoc34_609;
			word32 ecx_69 = 0x00;
			bool v44_593 = false;
			byte * edi_71 = null;
			while (ecx_69 != 0x00)
			{
				v44_593 = *esi_1235 != *edi_1236;
				esi_1235 = (Eq_172) ((char *) esi_1235 + 1);
				edi_71 = edi_1236 + 1;
				--ecx_69;
				edi_1236 = edi_71;
				if (*esi_1235 == *edi_1236)
					break;
			}
			if (!v44_593)
			{
				if (dwLoc38_603 < edx)
					Mem92[eax + dwLoc38_603:byte] = 0x5C;
				dwLoc38_603 = (Eq_172) ((char *) dwLoc38_603 + 1);
			}
		}
		byte al_103 = SLICE(CONVERT(Mem99[dwArg04 + dwLoc34_609:byte], byte, word32), byte, 0);
		byte bLoc5C_638 = al_103;
		uint32 eax_105 = (word32) al_103;
		if (eax_105 <= 0x7E)
		{
			<anonymous> * eax_524 = g_a804A2E8[eax_105 * 0x04] + 0x0804B94C;
			Eq_172 eax_570;
			word32 ecx_572;
			eax_524();
			ebpOut = fp - 4;
			esiOut = esi_1235;
			return eax_570;
		}
		ui32 dwLoc64_1135;
		Eq_299 dwLoc60_651;
		ui24 edx_24_8_231;
		if (eax_33 != 0x00)
		{
			ui32 edx_248 = (word32) *((char *) *__ctype_b_loc() + (word32) al_103 * 0x02);
			edx_24_8_231 = SLICE(edx_248 & 0x4000, word24, 8);
			dwLoc60_651 = (void *) 0x01;
			dwLoc64_1135 = edx_248 & 0x4000;
			if ((SEQ(edx_24_8_231, (int8) false) & (uint32) ((int8) ((edx_248 & 0x4000) == 0x00))) != 0x00)
				goto l08049142;
			goto l0804933E;
		}
		dwLoc60_651 = null;
		dwLoc64_1135 = 0x01;
		if (dwArg08 == (void *) ~0x00)
		{
			Eq_172 ecx_120 = dwArg08;
			Eq_81 edi_125 = dwArg04;
			while (ecx_120 != null)
			{
				edi_125 = (Eq_81) ((char *) edi_1237 + 1);
				--ecx_120;
				edi_1237 = edi_125;
				if (*edi_1237 != 0x00)
					break;
			}
			dwArg08 = ~ecx_120 - 0x01;
		}
		word32 edx_145 = dwLoc34_609 + dwArg04;
		edx_24_8_231 = SLICE(edx_145, word24, 8);
		do
		{
			esi_1235 = dwLoc34_609 + dwLoc60_651;
			word32 eax_164 = mbrtowc(fp - 0x28, esi_1235 + dwArg04, dwArg08 - esi_1235, fp - 0x24);
			if (eax_164 == null)
				break;
			if (eax_164 == (void *) ~0x00)
			{
				dwLoc64_1135 = 0x00;
				if (dwLoc60_651 > (void *) 0x01)
					goto l08049142;
				goto l08049325;
			}
			if (eax_164 == (void *) ~0x01)
			{
				dwLoc64_1135 = 0x00;
				if (esi_1235 >= dwArg08)
					break;
				edx_24_8_231 = SLICE(edx_145, word24, 8);
				if (Mem177[edx_145 + dwLoc60_651:byte] == 0x00)
					break;
				do
				{
					word32 v30_186 = dwLoc60_651 + 0x01;
					dwLoc60_651 = v30_186;
					if (dwLoc34_609 + v30_186 >=u dwArg08)
						goto l0804931A;
					esi_1235 = edx_145;
				} while (Mem187[edx_145 + v30_186:byte] != 0x00);
				if (v30_186 > (void *) 0x01)
					goto l08049142;
				goto l08049325;
			}
			dwLoc64_1135 &= -(word32) (int8) (iswprint(dwLoc28) != 0x00);
			dwLoc60_651 += eax_164;
		} while (mbsinit(fp - 0x24) == 0x00);
l0804931A:
		if (dwLoc60_651 <= (void *) 0x01)
		{
l08049325:
			if ((SEQ(edx_24_8_231, (int8) false) & (uint32) ((int8) (dwLoc64_1135 == 0x00))) != 0x00)
				goto l08049142;
l0804933E:
			edx_1232 = dwLoc34_609 + 0x01;
			if (0x00 != 0x00)
			{
				esi_1235 = dwArg10;
				if (((byte) (*((char *) dwArg10 + ((word32) ((byte) ((word32) al_103) >> 0x05) * 0x04 + 4)) >> (byte) ((word32) al_103 & 0x1F)) & 0x01) != 0x00)
				{
					if (dwLoc38_603 < edx)
						Mem292[eax + dwLoc38_603:byte] = 0x5C;
					esi_1235 = dwLoc34_609;
					++dwLoc38_603;
					edx_1232 = dwLoc34_609 + 0x01;
				}
			}
		}
		else
		{
l08049142:
			word32 ecx_303 = dwLoc34_609 + dwLoc60_651;
			while (true)
			{
				esi_1235 = null;
				if ((SEQ(edx_24_8_231, (int8) false) & (uint32) ((int8) (dwLoc64_1135 == 0x00))) != 0x00)
				{
					if (dwLoc38_603 < edx)
					{
						Mem327[eax + dwLoc38_603:byte] = 0x5C;
						esi_1235 = eax;
					}
					Eq_172 v25_330 = (char *) dwLoc38_603 + 1;
					if (v25_330 < edx)
					{
						Mem342[eax + v25_330:byte] = (SLICE(CONVERT(bLoc5C_638, byte, word32), byte, 0) >>u 0x06) + 0x30;
						esi_1235 = v25_330;
					}
					if (v25_330 + 0x01 <u edx)
					{
						Mem358[eax + (v25_330 + 0x01):byte] = (SLICE(CONVERT(bLoc5C_638, byte, word32), byte, 0) >>u 0x03 & 0x07) + 0x30;
						esi_1235 = v25_330 + 0x01;
					}
					dwLoc38_603 = v25_330 + 0x02;
					bLoc5C_638 = ((byte) (word32) bLoc5C_638 & 0x07) + 0x30;
				}
				edx_1232 = dwLoc34_609 + 0x01;
				edx_24_8_231 = SLICE(dwLoc34_609 + 0x01, word24, 8);
				if (dwLoc34_609 + 0x01 >=u ecx_303)
					break;
				if (dwLoc38_603 < edx)
					Mem387[eax + dwLoc38_603:byte] = SLICE(CONVERT(bLoc5C_638, byte, word32), byte, 0);
				++dwLoc38_603;
				++dwLoc34_609;
				bLoc5C_638 = SLICE(CONVERT(Mem394[dwLoc34_609 + 0x01 + dwArg04:byte], byte, word32), byte, 0);
			}
		}
		if (dwLoc38_603 < edx)
		{
			Mem408[eax + dwLoc38_603:byte] = SLICE(CONVERT(bLoc5C_638, byte, word32), byte, 0);
			esi_1235 = dwLoc38_603;
		}
		++dwLoc38_603;
		dwLoc34_609 = edx_1232;
	}
	edx_24_8_54 = SLICE(edx_1232, word24, 8);
	if (Mem419[dwArg04 + dwLoc34_609:byte] == 0x00)
		goto l08049228;
	goto l08049093;
}

// 080496C3: Register word32 fn080496C3(Stack Eq_172 dwArg04, Stack Eq_172 dwArg08, Stack Eq_81 dwArg0C, Stack Eq_172 dwArg10, Stack Eq_172 dwArg14)
// Called from:
//      fn08049721
word32 fn080496C3(Eq_172 dwArg04, Eq_172 dwArg08, Eq_81 dwArg0C, Eq_172 dwArg10, Eq_172 dwArg14)
{
	Eq_172 edi_20 = dwArg14;
	if (dwArg14 == null)
		edi_20 = (Eq_172) &g_v804BB20;
	__errno_location();
	struct Eq_563 * ebp_43;
	word32 * esi_48;
	word32 eax_42 = fn08048FF6(dwArg04, dwArg08, dwArg0C, dwArg10, *edi_20, edi_20, out ebp_43, out esi_48);
	*esi_48 = ebp_43->dwFFFFFFF0;
	return eax_42;
}

// 08049721: void fn08049721(Register Eq_580 eax, Register Eq_81 edx, Stack Eq_172 dwArg04, Stack Eq_172 dwArg08)
// Called from:
//      fn080499F0
void fn08049721(Eq_580 eax, Eq_81 edx, Eq_172 dwArg04, Eq_172 dwArg08)
{
	word32 eax_26 = *__errno_location();
	if (eax < 0x00)
		abort();
	else
	{
		if (g_t804B9DC <= eax)
		{
			if (eax > 0x1FFFFFFE)
				fn08049D10();
			Eq_172 esi_39 = g_t804B9E8;
			if (esi_39 == &g_t804B9E0)
			{
				Eq_172 eax_44 = fn08049DC5((void *) 0x08);
				Eq_632 edx_49 = g_t804B9E4.dw0000;
				g_t804B9E8 = eax_44;
				*eax_44 = (Eq_172) g_t804B9E0.dw0000;
				*((char *) eax_44 + 4) = (Eq_172) edx_49;
				esi_39 = eax_44;
			}
			Eq_172 eax_61 = fn08049E3F(esi_39, ((word32) eax + 1) * 0x08);
			Eq_580 edx_68 = g_t804B9DC;
			g_t804B9E8 = eax_61;
			memset((char *) eax_61 + edx_68 * 0x08, 0x00, (word32) eax + 1 - edx_68 << 0x03);
			g_t804B9DC = (word32) eax + 1;
		}
		Eq_172 eax_83 = g_t804B9E8;
		Eq_172 edx_87 = *((char *) eax_83 + eax * 0x08);
		Eq_172 edi_90 = *((char *) eax_83 + (eax * 0x08 + 4));
		Eq_172 eax_101 = fn080496C3(edi_90, edx_87, edx, dwArg04, dwArg08);
		if (edx_87 <= eax_101)
		{
			Eq_172 esi_112 = g_t804B9E8;
			*((char *) esi_112 + eax * 0x08) = (Eq_172) ((char *) eax_101 + 1);
			if (edi_90 != &g_v804BA20)
			{
				fn08049FE0(edi_90);
				esi_112 = g_t804B9E8;
			}
			Eq_172 eax_131 = fn08049DC5((char *) eax_101 + 1);
			*((char *) esi_112 + (eax * 0x08 + 4)) = eax_131;
			fn080496C3(eax_131, (char *) eax_101 + 1, edx, dwArg04, dwArg08);
		}
		*__errno_location() = eax_26;
	}
}

// 080499F0: void fn080499F0(Stack Eq_81 dwArg04, Stack byte bArg08)
// Called from:
//      fn08049A8B
void fn080499F0(Eq_81 dwArg04, byte bArg08)
{
	fn08048F36(fp - 0x3C, (byte) (int32) bArg08, 0x01);
	fn08049721(0x00, dwArg04, (void *) ~0x00, fp - 0x3C);
}

// 08049A8B: void fn08049A8B(Stack Eq_81 dwArg04)
// Called from:
//      close_stdout
void fn08049A8B(Eq_81 dwArg04)
{
	fn080499F0(dwArg04, 0x3A);
}

// 08049D10: void fn08049D10()
// Called from:
//      fn08049721
//      fn08049DC5
//      fn08049E3F
void fn08049D10()
{
	<anonymous> * eax_15 = *g_ptr804B970;
	if (eax_15 != null)
		eax_15();
	dcgettext(null, g_ptr804B954, 0x05);
	error(*g_ptr804B95C, 0x00, "%s", 0x00);
	abort();
}

// 08049DC5: Register (ptr32 void) fn08049DC5(Stack Eq_61 dwArg04)
// Called from:
//      fn08049721
//      fn08049E3F
void * fn08049DC5(Eq_61 dwArg04)
{
	void * eax_16 = malloc(dwArg04);
	if (eax_16 != null)
		return eax_16;
	fn08049D10();
}

// 08049E3F: Register (ptr32 void) fn08049E3F(Stack Eq_172 dwArg04, Stack Eq_61 dwArg08)
// Called from:
//      fn08049721
//      fn08049DC5
//      fn08049E3F
void * fn08049E3F(Eq_172 dwArg04, Eq_61 dwArg08)
{
	void * eax_18 = realloc(dwArg04, dwArg08);
	if (eax_18 != null)
		return eax_18;
	fn08049D10();
}

// 08049FE0: void fn08049FE0(Stack Eq_172 dwArg04)
// Called from:
//      fn08049721
void fn08049FE0(Eq_172 dwArg04)
{
	if (dwArg04 != null)
		free(dwArg04);
}

