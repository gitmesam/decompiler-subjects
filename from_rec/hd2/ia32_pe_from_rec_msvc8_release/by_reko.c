// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register word32 fn00401000(Register (ptr Eq_3) es, Register (ptr Eq_4) ds, Stack word32 dwArg04, Stack word32 dwArg08, Register out ptr32 edxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
word32 fn00401000(Eq_3 * es, Eq_4 * ds, word32 dwArg04, word32 dwArg08, ptr32 & edxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
}

// 00401140: Register word32 fn00401140(Register word32 ecx, Register word32 edx, Register (ptr Eq_309) es, Register (ptr Eq_310) ds, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
word32 fn00401140(word32 ecx, word32 edx, Eq_309 * es, Eq_310 * ds, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
}

// 00401200: Register word32 fn00401200(Register word32 edx, Register (ptr Eq_309) es, Register (ptr Eq_310) ds, Stack int32 dwArg04)
word32 fn00401200(word32 edx, Eq_309 * es, Eq_310 * ds, int32 dwArg04)
{
	__align(fp - 0x04);
	struct Eq_554 * ebp_44 = fp - 0x04;
	word32 edi_20 = 0x00;
	ui32 esi_21 = 0x01;
	if (dwArg04 > 0x01)
	{
		do
		{
			int32 ebx_50;
			word32 esi_52;
			word32 edi_53;
			word32 eax_54 = fn00401140(*((byte) ebp_44[0x0C] + esi_21 * 0x04), edx, es, ds, out edx, out ebx_50, out ebp_44, out esi_52, out edi_53);
			esi_21 = esi_52 + 0x01;
			edi_20 = edi_53 + eax_54;
		} while (esi_52 + 0x01 < ebx_50);
	}
	return edi_20;
}

// 0040123B: Register word32 fn0040123B(Register word32 eax, Register ui32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi, Register (ptr Eq_266) es, Register (ptr Eq_267) ds, Stack ui32 dwArg00)
word32 fn0040123B(word32 eax, ui32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi, Eq_266 * es, Eq_267 * ds, ui32 dwArg00)
{
	if (ecx == globals->dw403000)
		return eax;
	globals->dw403140 = eax;
	globals->dw40313C = ecx;
	globals->dw403138 = edx;
	globals->dw403134 = ebx;
	globals->dw403130 = esi;
	globals->dw40312C = edi;
	globals->ptr403158 = ss;
	globals->ptr40314C = cs;
	globals->ptr403128 = ds;
	globals->ptr403124 = es;
	globals->ptr403120 = fs;
	globals->ptr40311C = gs;
	Eq_616 SCZO_51 = cond(fp - 0x032C);
	globals->t403150 = SCZO_51;
	globals->dw403144 = ebp;
	globals->dw403148 = dwArg00;
	globals->ptr403154 = fp + 0x04;
	globals->dw403090 = 0x00010001;
	globals->dw403044 = globals->dw403148;
	globals->dw403038 = 0xC0000409;
	globals->dw40303C = 0x01;
	Eq_644 eax_87 = IsDebuggerPresent();
	globals->t403088 = eax_87;
	word32 esp_91;
	word32 ecx_92;
	byte SCZO_93;
	byte Z_94;
	word32 edi_95;
	word32 ebp_96;
	word32 eax_97;
	word32 edx_98;
	word32 ebx_99;
	word32 esi_100;
	struct Eq_660 * ss_101;
	struct Eq_661 * cs_102;
	struct Eq_662 * ds_103;
	struct Eq_663 * es_104;
	struct Eq_664 * fs_105;
	struct Eq_665 * gs_106;
	byte SCZDOP_107;
	crt_debugger_hook();
	SetUnhandledExceptionFilter(null);
	ptr32 esp_113 = fp - 0x0334;
	Eq_677 eax_115 = UnhandledExceptionFilter(&globals->t4020FC);
	if (globals->t403088 == 0x00)
	{
		*(fp - 0x0338) = 0x01;
		word32 esp_145;
		word32 ecx_146;
		byte SCZO_147;
		byte Z_148;
		word32 edi_149;
		word32 ebp_150;
		word32 eax_151;
		word32 edx_152;
		word32 ebx_153;
		word32 esi_154;
		struct Eq_730 * ss_155;
		struct Eq_731 * cs_156;
		struct Eq_732 * ds_157;
		struct Eq_733 * es_158;
		struct Eq_734 * fs_159;
		struct Eq_735 * gs_160;
		byte SCZDOP_161;
		crt_debugger_hook();
		esp_113 = esp_145 + 0x04;
	}
	UINT * esp_134 = esp_113 - 0x04;
	*esp_134 = (uint32) 0xC0000409;
	*(esp_134 - 0x04) = (HANDLE *) GetCurrentProcess();
	return TerminateProcess(*(esp_134 - 0x04), *esp_134);
}

// 004014EC: Register Eq_741 Win32CrtStartup()
DWORD Win32CrtStartup()
{
}

// 00401760: Register word32 fn00401760(Stack (ptr Eq_1127) dwArg04, Register out ptr32 edxOut)
word32 fn00401760(Eq_1127 * dwArg04, ptr32 & edxOut)
{
	*edxOut = edx;
	if (dwArg04->w0000 != 23117)
		return 0x00;
	struct Eq_1136 * eax_40 = dwArg04 + dwArg04->dw003C / 0x0040;
	if (eax_40->dw0000 != 0x4550)
		return 0x00;
	word32 edx_50 = (word32) (eax_40->w0018 == 0x010B);
	*edxOut = edx_50;
	return edx_50;
}

// 004017A0: Register (ptr Eq_1155) fn004017A0(Stack (ptr Eq_1156) dwArg04, Stack uint32 dwArg08, Register out ptr32 edxOut)
Eq_1155 * fn004017A0(Eq_1156 * dwArg04, uint32 dwArg08, ptr32 & edxOut)
{
}

// 004017F0: Register ui32 fn004017F0(Stack int32 dwArg04, Register out ptr32 edxOut)
ui32 fn004017F0(int32 dwArg04, ptr32 & edxOut)
{
	ptr32 eax_16 = fs->ptr0000;
	fs->ptr0000 = fp - 0x14;
	word32 edx_43;
	if (fn00401760(&globals->t400000, out edx_43) != 0x00)
	{
		word32 edx_96;
		struct Eq_1222 * eax_97 = fn004017A0(&globals->t400000, dwArg04 - 0x00400000, out edx_96);
		if (eax_97 != null)
		{
			uint32 eax_104 = ~(eax_97->dw0024 >> 0x1F);
			fs->ptr0000 = eax_16;
			return eax_104 & 0x01;
		}
	}
	fs->ptr0000 = eax_16;
	return 0x00;
}

// 004018BC: Register ptr32 fn004018BC(Register word32 ebx, Register word32 esi, Register word32 edi, Stack word32 dwArg00, Stack word32 dwArg04, Stack ui32 dwArg08)
ptr32 fn004018BC(word32 ebx, word32 esi, word32 edi, word32 dwArg00, word32 dwArg04, ui32 dwArg08)
{
	ptr32 esp_14 = fp - 0x08 - dwArg08;
	*(esp_14 - 0x04) = ebx;
	*(esp_14 - 0x08) = esi;
	*(esp_14 - 0x0C) = edi;
	*(esp_14 - 0x10) = globals->dw403000 ^ fp + 0x08;
	*(esp_14 - 0x14) = dwArg00;
	fs->ptr0000 = fp - 0x08;
	return fp + 0x08;
}

// 00401901: void fn00401901(Register (ptr word32) ebp, Stack word32 dwArg00, Stack int32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C, Stack word32 dwArg10)
void fn00401901(word32 * ebp, word32 dwArg00, int32 dwArg04, word32 dwArg08, word32 dwArg0C, word32 dwArg10)
{
	fs->dw0000 = *(ebp - 0x10);
	*ebp = dwArg00;
}

// 00401968: Register ptr32 fn00401968()
ptr32 fn00401968()
{
	ui32 eax_10 = globals->dw403000;
	if (eax_10 != 0xBB40E64E && (eax_10 & 0xFFFF0000) != 0x00)
		globals->dw403004 = ~eax_10;
	else
	{
		GetSystemTimeAsFileTime(fp - 0x0C);
		ui32 esi_60 = dwLoc08 & 0x00 ^ dwLoc0C & 0x00 ^ GetCurrentProcessId() ^ GetCurrentThreadId() ^ GetTickCount();
		QueryPerformanceCounter(fp - 0x14);
		ui32 esi_69 = esi_60 ^ (dwLoc10 ^ dwLoc14);
		if (esi_69 == 0xBB40E64E)
			esi_69 = ~0x44BF19B0;
		else if ((esi_69 & 0xFFFF0000) == 0x00)
			esi_69 = esi_69 | esi_69 << 0x10;
		globals->dw403000 = esi_69;
		globals->dw403004 = ~esi_69;
		esi = fp - 0x14;
	}
	return esi;
}

