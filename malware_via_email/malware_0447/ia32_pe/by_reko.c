// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 esp_13;
	byte SCZO_14;
	word32 esi_15;
	byte SZO_16;
	byte C_17;
	word32 eax_18;
	byte Z_19;
	word32 ebx_20;
	word32 ebp_21;
	word32 edi_22;
	word32 edx_23;
	word32 ecx_24;
	byte cl_25;
	word16 ax_26;
	byte S_27;
	SHLWAPI.dll!StrChrA();
	if (eax_18 != 0x00)
		return 0x00;
	*(esp_13 - 0x04) = ebx_20;
	*(esp_13 - 0x08) = ebp_21;
	*(esp_13 - 0x0C) = edi_22;
	*(esp_13 - 0x10) = 0x0040406C;
	*(esp_13 - 0x14) = 0x00404074;
	*(esp_13 - 0x18) = (HMODULE *) LoadLibraryA(*(esp_13 - 0x14));
	Eq_61 eax_50 = GetProcAddress(*(esp_13 - 0x18), *(esp_13 - 0x14));
	*(esp_13 - 0x1C) = 0x00;
	*(esp_13 - 0x20) = 0x00;
	*(esp_13 - 0x24) = 0x00;
	*(esp_13 - 0x28) = 0x00;
	*(esp_13 - 44) = 0x00;
	int32 eax_66 = eax_50();
	*(esp_13 - 0x30) = ~0x00;
	*(esp_13 - 0x34) = ~0x00;
	struct Eq_120 * ebp_314 = eax_66 + 0x1C;
	if (AreAllAccessesGranted(*(esp_13 - 0x34), *(esp_13 - 0x30)) == 0x00)
		ebp_314 = eax_66 + 0x1C ^ 0x0E;
	*(esp_13 - 0x38) = esp_13 - 0x24;
	*(esp_13 - 0x3C) = 0x40;
	*(esp_13 - 0x40) = 0x3000;
	*(esp_13 - 0x44) = 0x00401000;
	VirtualProtect(*(esp_13 - 0x44), *(esp_13 - 0x40), *(esp_13 - 0x3C), *(esp_13 - 0x38));
	struct Eq_191 * eax_111 = null;
	do
	{
		struct Eq_120 * esi_112;
		if (esi_112 == ebp_314)
			esi_112 = null;
		eax_111[4204008] = (struct Eq_191) (esi_112[0x00405000] ^ eax_111[4204008] ^ ~0x13);
		eax_111 = eax_111 + 0x01;
		esi_112 = esi_112 + 0x01;
	} while (eax_111 < (struct Eq_191 *) 5152);
	*(esp_13 - 44) = 0x00402368;
	*(esp_13 - 0x30) = 0x00;
	struct Eq_229 * ebx_130 = &globals->t4038C8;
	int32 edi_132 = 0x00402368;
	up32 ebp_133 = 0x00;
	struct Eq_235 * esp_139 = esp_13 - 0x44;
	do
	{
		Eq_239 eax_145 = ebx_130->t0004;
		cui16 * edx_153 = (char *) &ebx_130->t0004 + 0x04;
		if (eax_145 - 0x08 >> 0x01 > 0x00)
		{
			uint32 ebp_285 = eax_145 - 0x08 >> 0x01;
			do
			{
				if ((*edx_153 & 0xF000) == 0x3000)
				{
					struct Eq_265 * ecx_305 = ((word32) *edx_153 & 0x0FFF) + ebx_130->dw0000;
					ecx_305->dw402368 = ecx_305->dw402368 + 0xF0402368;
				}
				edx_153 = edx_153 + 0x01;
				ebp_285 = ebp_285 - 0x01;
			} while (ebp_285 != 0x00);
			ebp_133 = *(esp_13 - 0x30);
		}
		ebp_133 = (word32) ebx_130->t0004 + ebp_133;
		*(esp_13 - 0x30) = ebp_133;
		ebx_130 = ebx_130 + Mem161[ebx_130 + 0x04:word32];
	} while (ebp_133 < 228);
	*(esp_13 - 0x30) = 0x004030C4;
	struct Eq_299 * ebx_169 = &globals->t4030C4;
	if (globals->dw4030D4 != 0x00)
	{
		edi_192 = edi_132;
		ebx_194 = ebx_169;
		esp_196 = esp_139;
		do
		{
			int32 edi_192;
			struct Eq_299 * ebx_194;
			struct Eq_235 * esp_196;
			esp_196 = esp_196 - 0x04;
			esp_196->dw0000 = ebx_194->dw000C + edi_192;
			Eq_55 eax_202 = LoadLibraryA(esp_196->dw0000);
			esp_196[0x07] = (struct Eq_235) eax_202;
			Eq_55 ecx_203 = eax_202;
			if (eax_202 != null)
			{
				ptr32 ebp_226 = ebx_194->dw0000;
				if (ebp_226 == 0x00)
					ebp_226 = ebx_194->dw0010;
				Eq_354 eax_232 = ebp_226 + edi_192;
				struct Eq_357 * ebp_234 = ebp_226 + edi_192;
				word32 * esi_235 = ebx_194->dw0010 + edi_192;
				if (eax_232 != 0x00)
				{
					while (true)
					{
						Eq_61 eax_255;
						if (eax_232 < 0x00)
						{
							LPCSTR * esp_270 = esp_196 - 0x04;
							*esp_270 = (LPCSTR *) (word32) ebp_234->w0000;
							*(esp_270 - 0x04) = (HMODULE *) ecx_203;
							eax_255 = GetProcAddress(*(esp_270 - 0x04), *esp_270);
						}
						else
						{
							LPCSTR * esp_278 = esp_196 - 0x04;
							*esp_278 = (LPCSTR *) ((word32) eax_232 + 0x02 + edi_192);
							*(esp_278 - 0x04) = (HMODULE *) ecx_203;
							eax_255 = GetProcAddress(*(esp_278 - 0x04), *esp_278);
						}
						*esi_235 = (word32) eax_255;
						ebp_234 = ebp_234 + 0x01;
						esp_196 = esp_196 - 0x08;
						eax_232.u1 = ebp_234->w0000;
						edi_192 = (int32) esp_196[0x06];
						esi_235 = esi_235 + 0x01;
						if (eax_232 == 0x00)
							break;
						ecx_203 = (Eq_55) esp_196[0x07];
					}
					ebx_194 = (struct Eq_299 *) esp_196[0x05];
				}
			}
			ebx_194 = ebx_194 + 0x01;
			esp_196[0x05] = (struct Eq_235) ebx_194;
		} while (ebx_194->dw0010 != 0x00);
	}
	ptr32 esp_172;
	byte SCZO_173;
	word32 esi_174;
	byte SZO_175;
	byte C_176;
	word32 eax_177;
	byte Z_178;
	word32 ebx_179;
	word32 ebp_180;
	word32 edi_181;
	word32 edx_182;
	word32 ecx_183;
	byte cl_184;
	word16 ax_185;
	byte S_186;
	globals->t402DB8();
	*(esp_172 - 0x04) = 0x00;
	ExitProcess(*(esp_172 - 0x04));
}

