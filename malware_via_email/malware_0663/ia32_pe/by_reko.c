// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_3 esi_12 = null;
	Eq_3 edi_17 = (struct <anonymous> *) 0x1F;
	Eq_7 ebx_117 = eax + ebx * 0x04;
	Eq_2 eax_24 = AddUsersToEncryptedFile(&globals->t403020, null);
	if (eax_24 == 0x00)
		return eax_24;
	Eq_7 eax_34 = AreAllAccessesGranted(~0x00, ~0x00);
	if (eax_34 == 0x00)
		edi_17 = eax_34 + 0x11;
	Eq_7 eax_103 = VirtualProtect(&globals->v401000, 0x3000, 0x40, fp - 0x10);
	struct Eq_47 * ecx_100 = null;
	do
	{
		if (esi_12 == edi_17)
			esi_12 = null;
		ecx_100[4199880] = (struct Eq_47) (esi_12[0x00404000] ^ ecx_100[4199880] ^ 0x90);
		eax_103 = eax_103 * 0x02;
		ebx_117 = eax_103 + ebx_117 * 0x04;
		ecx_100 = ecx_100 + 0x01;
		esi_12 = (Eq_3) (esi_12 + 0x01);
	} while (ecx_100 < (struct Eq_47 *) 0x1440);
	Eq_7 ebp_126 = 0x00401348;
	struct Eq_78 * edx_105 = &globals->t4028C8;
	up32 edi_274 = 0x00;
	up32 dwLoc08_277 = 0x00;
	if (true)
	{
		do
		{
			eax_103 = edx_105->t0004 - 0x08 >> 0x01;
			ecx_100 = (struct Eq_47 *) ((char *) &edx_105->t0004 + 0x04);
			if (eax_103 > 0x00)
			{
				ebx_117 = eax_103;
				do
				{
					cui16 ax_307 = ecx_100->w0000;
					eax_103 = DPB(eax_103, ax_307 & 0xF000, 0);
					if ((ax_307 & 0xF000) == 0x3000)
					{
						struct Eq_125 * eax_324 = ((word32) ecx_100->w0000 & 0x0FFF) + edx_105->dw0000;
						eax_324->dw401348 = eax_324->dw401348 + 0xF0401348;
						eax_103 = &eax_324->dw401348;
					}
					ecx_100 = ecx_100 + 0x02;
					ebx_117 = ebx_117 - 0x01;
				} while (ebx_117 != 0x00);
				edi_274 = dwLoc08_277;
			}
			edi_274 = (word32) edx_105->t0004 + edi_274;
			dwLoc08_277 = edi_274;
			ebx_117 = ebx_117 * 0x03;
			edx_105 = edx_105 + Mem79[edx_105 + 0x04:word32];
		} while (edi_274 < 228);
	}
	Eq_7 edi_106 = 0x004020B4;
	Eq_7 dwLoc08_107 = 0x004020B4;
	Eq_7 esi_108 = (char *) edx_105 - 528472432;
	if (globals->dw4020C4 != 0x00)
	{
		do
		{
			word32 ecx_152 = *((word32) edi_106 + 0x0C);
			ecx_100 = ecx_152 + 0x00401348;
			eax_103 = LoadLibraryA(ecx_152 + 0x00401348);
			if (eax_103 != 0x00)
			{
				ecx_100 = (struct Eq_47 *) *edi_106;
				if (ecx_100 == null)
					ecx_100 = (struct Eq_47 *) *((word32) edi_106 + 0x0010);
				word32 * ebp_192 = ecx_100 + 4199240;
				ebx_117 = eax_103 + ebx_117 * 0x02;
				word32 * edi_195 = (word32) *((word32) edi_106 + 0x0010) + 4199240;
				if (*ebp_192 != 0x00)
				{
					do
					{
						Eq_7 edx_239;
						ecx_100 = *ebp_192;
						word16 cx_228 = (word16) ecx_100;
						if (ecx_100 < null)
						{
							Eq_179 edx_249 = (word32) cx_228;
							eax_103 = GetProcAddress(eax_103, edx_249);
							edx_239 = (word32) esi_108 + edx_249 * 0x08;
						}
						else
						{
							edx_239.u0 = 0x00401348;
							ecx_100 = ecx_100 + 4199242;
							eax_103 = GetProcAddress(eax_103, ecx_100 + 4199242);
						}
						*edi_195 = (word32) eax_103;
						ebp_192 = ebp_192 + 0x01;
						esi_108 = esi_108 + edx_239;
						edi_195 = edi_195 + 0x01;
					} while (*ebp_192 != 0x00);
				}
				ebp_126.u0 = 0x00401348;
				edi_106 = dwLoc08_107;
			}
			edi_106 = (word32) edi_106 + 0x0014;
			dwLoc08_107 = edi_106;
		} while (*((word32) edi_106 + 0x0010) != 0x00);
	}
	fn00401DA8(eax_103, ecx_100, &globals->t401DA8, ebx_117, ebp_126, esi_108, edi_106, rArg0);
	*(fp - 0x28) = 0x00;
	ExitProcess(*(fp - 0x28));
}

// 00401C3C: void fn00401C3C(Stack (ptr16 Eq_262) psegArg00)
void fn00401C3C(Eq_262 * psegArg00)
{
	word32 esp_5;
	struct Eq_264 * fs_6;
	fn26ED062D();
}

// 00401C96: void fn00401C96(Register (ptr32 Eq_47) ecx, Register Eq_7 edi)
void fn00401C96(Eq_47 * ecx, Eq_7 edi)
{
	*edi = -*edi;
	if (ecx == null)
		fn00401C3C(psegLoc04);
	else
	{
		word32 esp_21;
		word32 edi_22;
		byte SCZO_23;
		bool C_24;
		word32 ecx_25;
		struct Eq_287 * ss_26;
		ecx[0x4AE873F4]();
	}
}

// 00401D04: void fn00401D04(Register Eq_7 eax, Register (ptr32 Eq_47) ecx, Register Eq_7 ebx, Register Eq_7 ebp, Register Eq_7 esi, Register Eq_7 edi)
void fn00401D04(Eq_7 eax, Eq_47 * ecx, Eq_7 ebx, Eq_7 ebp, Eq_7 esi, Eq_7 edi)
{
	__wait();
	if ((*eax & 0x78) <= 0x00)
		fn00401C96(ecx, edi);
	else
	{
		word16 dx_43 = DPB(dx, 0xA4, 0);
		if ((*eax & 0x78) >= 0x00)
			fn00401D8D(edi);
		else
		{
			word16 ax_47 = __aad(ax);
			cu8 al_49 = (byte) ax_47;
			*((word32) esi + 0x09) = al_49;
			*(ebx - 0x5C) = *(ebx - 0x5C) - 0x01;
			*((word32) ebx + 0x0026) = *((word32) ebx + 0x0026) & SLICE(ax_47, byte, 8);
			byte * eax_63 = DPB(eax, al_49 + 223, 0);
			if (al_49 <= 223)
			{
				if (OVERFLOW(al_49 + 223))
					__syscall(0x04);
				if (OVERFLOW(al_49 + 223))
					fn00401D8F();
				else
					fn00401D7E(ecx, dx_43, ebx - 0x01, (word32) ebp + 0x01, 0xDD848875, 0x7C477B62, rArg0);
			}
			else if (al_49 >= 223)
			{
				(byte **) 0x1144481D = (byte **) DPB(eax_63, 0x14, 8);
				*((word32) ebx - 0x2BB2729F) = 0x06;
				fn00401D31(ecx, dx_43, ebx, (word32) ebp + 0x01, esi, 0x11444821);
			}
		}
	}
}

// 00401D31: void fn00401D31(Register (ptr32 Eq_47) ecx, Register word16 dx, Register Eq_7 ebx, Register Eq_7 ebp, Register Eq_7 esi, Register ptr32 edi)
void fn00401D31(Eq_47 * ecx, word16 dx, Eq_7 ebx, Eq_7 ebp, Eq_7 esi, ptr32 edi)
{
	ptr32 fp;
	selector es;
	word32 eax;
	Eq_7 ebx;
	struct Eq_47 * ecx;
	Eq_7 ebp;
	word16 dx;
	ptr32 edi;
	Eq_7 esi;
	<type-error> Mem0;
	selector ds;
	esp_1 = fp;
	__lock();
	esp_2 = fp - 0x02;
	wLoc02_4 = es;
	v4_6 = eax;
	eax_8 = ebx;
	ax_9 = (word16) eax_8;
	ebx_10 = v4_6;
	Z_14 = __cmpxchg(ecx, ebp, eax_8, out eax_13);
	ecx_15 = 0x00;
	__outw(dx, ax_9);
	edi_20 = edi - *((word32) esi - 1252935923);
	SCZO_21 = cond(edi_20);
	SCZDOP_22 = SCZO_21;
	esp_23 = fp - 0x06;
	dwLoc06_24 = SCZDOP_22;
	esp_25 = fp - 0x08;
	wLoc08_27 = ds;
	edx_28 = 2278900126;
	dl_29 = (byte) edx_28;
	esp_30 = fp - 0x0C;
	dwLoc0C_31 = 2278900126;
	dh_32 = 0x35;
	eax_33 = eax_13 | 0x985A8C70;
	ax_34 = (word16) eax_33;
	dl_35 = dl_29 - (byte *) ~0x00E2C6ED;
	SCZO_36 = cond(dl_35);
	C_37 = (bool) SCZO_36;
	cl_38 = 0x94;
	v23_39 = false;
	dh_40 = __rcl(0x35, 0x01, C_37);
	ax_41 = __aad(ax_34);
	al_42 = (byte) ax_41;
	ah_43 = SLICE(ax_41, byte, 8);
	v24_44 = ebp;
	ebp_45 = ebx_10;
	ebx_46 = v24_44;
	C_49 = __aaa(al_42, ah_43, &al_47, &ah_48);
}

// 00401D7A: void fn00401D7A(Register Eq_7 eax, Register (ptr32 Eq_47) ecx, Register word16 dx, Register Eq_7 ebx, Register Eq_7 ebp, Register Eq_7 esi, Register Eq_7 edi)
void fn00401D7A(Eq_7 eax, Eq_47 * ecx, word16 dx, Eq_7 ebx, Eq_7 ebp, Eq_7 esi, Eq_7 edi)
{
	if (Z)
		fn00401D04(eax, ecx, ebx, ebp, esi, edi);
	else
		fn00401D7E(ecx, dx, ebx, ebp, esi, edi, rArg0);
}

// 00401D7E: FpuStack Eq_410 fn00401D7E(Register (ptr32 Eq_47) ecx, Register word16 dx, Register Eq_7 ebx, Register Eq_7 ebp, Register Eq_7 esi, Register Eq_7 edi, FpuStack Eq_410 rArg0)
Eq_410 fn00401D7E(Eq_47 * ecx, word16 dx, Eq_7 ebx, Eq_7 ebp, Eq_7 esi, Eq_7 edi, Eq_410 rArg0)
{
	Eq_410 rArg0_5 = *(ecx - 0x46) / rArg0;
	uint8 al_6 = __inb(~0x41);
	*edi = __in(dx);
	__outb(~0x09, al_6);
	if (al_6 <= *((word32) edi + 0x05))
	{
		fn00401D31(ecx, dx, ebx, ebp - 0x01, (word32) esi + 0x01, (word32) edi + 0x06);
		return rArg0_5;
	}
	else
	{
		int3();
		fn00401D8D((word32) edi + 0x06);
		return rArg0_5;
	}
}

// 00401D8D: void fn00401D8D(Register Eq_7 edi)
void fn00401D8D(Eq_7 edi)
{
}

// 00401D8F: void fn00401D8F()
void fn00401D8F()
{
}

// 00401DA8: FpuStack real64 fn00401DA8(Register Eq_7 eax, Register (ptr32 Eq_47) ecx, Register (ptr32 Eq_148) edx, Register Eq_7 ebx, Register Eq_7 ebp, Register Eq_7 esi, Register Eq_7 edi, FpuStack real64 rArg0)
real64 fn00401DA8(Eq_7 eax, Eq_47 * ecx, Eq_148 * edx, Eq_7 ebx, Eq_7 ebp, Eq_7 esi, Eq_7 edi, real64 rArg0)
{
	esp = fp;
	if (Test(EQ,Z))
	{
		fn00401D7A(eax, ecx, dx, ebx, ebp, esi, edi);
		return rArg0;
	}
	else
	{
		ch = ch - *((word32) ebp + (edx * 0x08 + 1737374345)) - C;
		ecx = DPB(ecx, ch, 8);
		SCZO = cond(ch);
		Z = (bool) SCZO;
		ecx = ecx - 0x01;
		ch = SLICE(ecx, byte, 8);
		if (Test(NE,Z) || ecx == null)
		{
			v10 = (word32) ecx[0x1DD426CD];
			esp = fp - 0x04;
			dwLoc04 = v10;
			al = al & *((word32) ebx - 1166423881);
			edi_al = SEQ(edi, al);
			SZO = cond(al);
			C.u0 = false;
			al = __inb(~0x41);
			eax = DPB(eax, al, 0);
			ax = DPB(ax, al, 0);
			es_eax = DPB(es_eax, al, 0);
			edi_al = SEQ(edi, al);
		}
		else
		{
			v26 = *((word32) edi - 457541176) ^ ~0x41;
			*((word32) edi - 457541176) = v26;
			SZO = cond(*((word32) edi - 457541176));
			C.u0 = false;
		}
		ebx = *eax *s 0x4A;
		D = true;
		ebp = *esp;
		esp = (word32) esp + 0x04;
		rArg0 = rArg0 - (real64 *) 0x40844841;
		eax = (int32) ax;
		al = (byte) eax;
		es_eax = eax;
		bl = bl - dl;
		ebx = DPB(ebx, bl, 0);
		fs = *esp;
		esp = (word32) esp + 0x02;
		esp = esp - 0x02;
		*esp = ss;
		SCZO = cond(*((word32) ebx + (ecx * 0x08 + 1225637431)) - ah);
		C = (bool) SCZO;
		Z = (bool) SCZO;
		SZO = SCZO;
		O = (bool) SCZO;
		CZ = SCZO;
		SCZDOP = SCZO;
		v23 = ebp;
		ebp = ebx;
		ebx = v23;
		bl = (byte) ebx;
		bh = SLICE(ebx, byte, 8);
		esp = esp - 0x04;
		*esp = ebp;
		ebp = esp;
		esp = esp - 0x7BA1;
		if (Test(OV,O))
			__syscall(0x04);
		bh = bh + Mem0[eax + 0x57:byte] + C;
		ebx = DPB(ebx, bh, 8);
		v28 = *((word32) ebp + 0x0049) - 0x01;
		*((word32) ebp + 0x0049) = v28;
		dl = 0x00;
		edx = DPB(edx, dl, 0);
		dx = DPB(dx, dl, 0);
		C.u0 = false;
		esi = (word32) esi + 0x01;
		SZO = cond(esi);
		SCZO = SZO;
		Z = (bool) SZO;
		O = (bool) SZO;
		CZ = SZO;
		SCZDOP = SZO;
l00401DE9:
		es_eax = *(ecx - 0x10);
		ah = FPUF;
		fs = *esp;
		esp = (word32) esp + 0x02;
		if (Test(LE,SZO))
		{
			v39 = *((word32) ebx + 1467486774) ^ eax;
			*((word32) ebx + 1467486774) = v39;
			SZO = cond(*((word32) ebx + 1467486774));
			v40 = eax;
			ebp = v40;
			eax = __indw(dx);
			v41 = *esi;
			*edi = v41;
			esi = (word32) esi + 0x01;
			edi = (word32) edi + 0x01;
			eax = eax & 1409490070;
			v42 = ecx->w0000 >> ~0x61;
			ecx->w0000 = (word16) v42;
			ds = *esp;
			esp = (word32) esp + 0x02;
			ecx = ecx + 0x01;
			ds = *esp;
			esp = (word32) esp + 0x02;
			v44 = ecx[0x163A3358];
			esp = esp - 0x04;
			*esp = v44;
			eax = eax - 0x01;
			v45 = eax;
			eax = edi;
			edi = v45;
			esp = esp - 0x04;
			*esp = esi;
			*((word32) ebx + 0x51AE8EAB) = rArg0;
			v46 = edx->ptr006D;
			edx->ptr006D = edx;
			edx = v46;
			esi = (word32) esi + 0x01;
			dh = 0x35;
			*((word32) esi + 0x04) = __fstcw();
			ecx = __xadd(ecx, edi);
			__outb(dx, al);
			v47 = (word32) esp + ecx->dwA7AF7D16;
			ecx->dwA7AF7D16 = v47;
			al = al - 0x13;
			SCZO = cond(al);
			eax = eax - 0x01;
			v48 = *(edi - 0x3A);
			*(edi - 0x3A) = (union Eq_7 *) eax;
			eax = v48;
			edi = edi + Mem0[edx + 0x7803B026:word32] + C;
			SCZO = cond(edi);
		}
		else
		{
			al = ~0x58;
			ax = __aam(~0x58);
l00401DF7:
			bh = 0x92;
			ebx = (word32) ebx - 1092310509;
			D = false;
			*edi = __in(dx);
			edi = edi + 0x04;
			esi = esi & esi;
			ebp = ebp - 0x01;
			SCZO = cond(*esi - *edi);
			esi = (word32) esi + 0x01;
			edi = edi + 0x01;
			SCZO = cond(al - *edi);
			edi = edi + 0x01;
			ecx = ecx;
			ax = __aad(ax);
			ecx[719291502] = (struct Eq_47) dh;
			do
			{
				if (Test(EQ,Z))
					goto l00401DF7;
				if (Test(ULE,CZ))
					goto l00401DE9;
				ebp = *esp;
				esp = (word32) esp + 0x04;
				v35 = *((word32) edi - 1189885715) & al;
				*((word32) edi - 1189885715) = v35;
				SZO = cond(*((word32) edi - 1189885715));
				C.u0 = false;
			} while (Test(OV,O));
			esp = esp - 0x04;
			*esp = ebp;
			v36 = *((word32) eax + 633146856) - edi;
			*((word32) eax + 633146856) = v36;
			v37 = eax;
			eax = esi;
			esi = v37;
			*((word32) ebx - 1167190783) = 0x07;
			SCZDOP = *esp;
			esp = (word32) esp + 0x04;
		}
	}
}

