// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: void fn00401030(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401030(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	Mem6[0x0040B330:word32] = 0x00;
	while (Mem6[0x0040B330:word32] <u dwArg0C)
	{
		Mem25[dwArg04 + Mem6[0x0040B330:word32]:byte] = Mem6[dwArg08 + Mem6[0x0040B330:word32]:byte];
		Mem29[0x0040B330:word32] = Mem25[0x0040B330:word32] + 0x01;
	}
}

// 004010C0: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcAddress(LoadLibraryA(0x0040B204), 0x0040B204)();
	lstrcatA(fp - 116, 0x0040B214);
	word32 eax_70 = CreateFileA(fp - 116, 0x01, 0x03, 0x00, 0x03, 0x80, 0x00);
	if (eax_70 == ~0x00 || eax_70 == 0x00)
		return 0x00;
	if (GetProcAddress(LoadLibraryA(0x0040B230), 0x0040B230)() != 0x00 || (GetProcAddress)(LoadLibraryA(0x0040B254), 0x0040B254)() == 0x00)
		return 0x00;
	GetModuleHandleA(0x00);
	if ((dwArg04 & 0xFFFF) != 0x00)
		Mem324[4240200:word32] = 0x00;
	else
		Mem325[4240200:word32] = 0x01;
	if (dwArg04 == 0x00)
	{
		Mem319[4240200:word32] = 0x01;
		Mem323[4240200:word32] = Mem319[4240200:word32] - 0x01;
	}
	if (Mem195[4240200:word32] != 0x00)
		Mem318[4240184:word32] = dwArg04;
	word32 edx_216 = Mem195[0x00407000:word32];
	word32 dwLoc08_221 = 0x00;
	while (dwLoc08_221 <u edx_216)
	{
		Mem235[dwLoc08_221 + 0x00407008:word32] = Mem195[dwLoc08_221 + 0x00407008:word32] ^ 11152423;
		dwLoc08_221 = dwLoc08_221 + 0x08;
	}
	word32 ebp_270;
	Mem246[0x0040B344:word32] = fn00401990(dwArg00);
	fn00401B60(dwArg00, dwArg04, dwArg08);
	Mem260[0x0040B334:word32] = edi_180;
	Mem261[4240172:word32] = esi_179;
	Mem262[0x0040B340:word32] = ebx_178;
	Mem264[4240204:word32] = Mem262[fs_187:0x18:word32];
	Mem267[0x0040B33C:word32] = fp - 0x04;
	if (Mem267[4240200:word32] != 0x00)
		ebp_270 = fn004019C0(ebp_176, dwArg00, dwArg04);
	else
		ebp_270 = fn004019C0(ebp_176, dwArg00, dwArg04);
	word32 eax_275 = fn00401380(ebp_270, dwArg00);
	word32 esp_282;
	word32 ebp_283;
	byte SCZO_284;
	word32 ebx_285;
	word32 esi_286;
	word32 edi_287;
	word32 eax_288;
	word32 ecx_289;
	word32 edx_290;
	byte Z_291;
	byte SZO_292;
	byte C_293;
	selector fs_294;
	Mem274[4240208:word32]();
	return eax_288;
}

// 00401360: Register word32 fn00401360(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401360(word32 dwArg04, word32 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 00401380: Register word32 fn00401380(Register word32 ebp, Stack word32 dwArg04)
word32 fn00401380(word32 ebp, word32 dwArg04)
{
}

// 00401920: void fn00401920(Stack word32 dwArg04, Stack word32 dwArg08)
void fn00401920(word32 dwArg04, word32 dwArg08)
{
}

// 00401990: Register word32 fn00401990(Stack word32 dwArg04)
word32 fn00401990(word32 dwArg04)
{
	return VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 004019C0: Register word32 fn004019C0(Register word32 ebp, Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn004019C0(word32 ebp, word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc28_13;
	if (Mem0[4240200:word32] != 0x00)
		dwLoc28_13 = Mem0[4240184:word32];
	else
		dwLoc28_13 = dwArg08;
	word32 ecx_18 = dwLoc28_13 + Mem0[dwLoc28_13 + 0x3C:word32];
	Mem50[0x0040B328:word32] = GetProcAddress(GetModuleHandleA(4240152), 4240152)();
	if (Mem50[0x0040B328:word32] == 0x00)
		return ebp;
	fn00401030(dwArg00, dwArg04, dwArg08);
	word32 edx_93 = Mem87[0x0040B328:word32] - dwLoc28_13;
	if (Mem87[ecx_18 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_119 = dwLoc28_13 + Mem87[ecx_18 + 0xA0:word32];
		while (Mem87[dwLoc0C_119 + 0x04:word32] != 0x00)
		{
			word32 edx_134 = Mem87[dwLoc0C_119 + 0x04:word32] - 0x08 >>u 0x01;
			word32 eax_137 = dwLoc0C_119 + 0x08;
			word32 dwLoc08_140 = 0x00;
			while (dwLoc08_140 <u edx_134)
			{
				if ((word32) eax_137[dwLoc08_140 * 0x02] >> 0x0C == 0x03)
					Mem181[Mem87[0x0040B328:word32] + Mem87[dwLoc0C_119 + 0x00:word32] + ((word32) eax_137[dwLoc08_140 * 0x02] & 0x0FFF):word32] = Mem87[Mem87[0x0040B328:word32] + Mem87[dwLoc0C_119 + 0x00:word32] + ((word32) eax_137[dwLoc08_140 * 0x02] & 0x0FFF):word32] + edx_93;
				dwLoc08_140 = dwLoc08_140 + 0x01;
			}
			dwLoc0C_119 = dwLoc0C_119 + Mem87[dwLoc0C_119 + 0x04:word32];
		}
	}
	word32 ecx_103 = dwArg04 + Mem87[0x0040B328:word32];
	word32 esp_105;
	word32 ebp_106;
	byte SCZO_107;
	word32 esi_108;
	byte Z_109;
	word32 eax_110;
	word32 ecx_111;
	word32 edx_112;
	byte C_113;
	byte SZO_114;
	ecx_103();
	return ebp_106;
}

// 00401B30: void fn00401B30(Stack word32 dwArg04)
void fn00401B30(word32 dwArg04)
{
	Mem12[Mem0[Mem0[4240204:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 00401B60: void fn00401B60(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401B60(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc0C_112 = 0x01;
	byte cl_12 = Mem0[dwArg04 + 0x00:byte];
	word32 dwLoc18_118 = 0x00;
	do
	{
		word32 ecx_34 = dwLoc0C_112 + 0x01;
		byte al_31 = Mem0[dwArg04 + dwLoc0C_112:byte];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 == (word32) cl_12)
		{
			if ((word32) Mem0[dwArg04 + ecx_34:byte] == 0x00)
			{
				Mem80[dwArg08 + dwLoc18_118:byte] = cl_12;
				dwLoc18_118 = dwLoc18_118 + 0x01;
				dwLoc0C_112 = ecx_34 + 0x01;
			}
			else
			{
				word32 eax_98 = fn00401C60(fp - 0x10, dwArg04 + ecx_34) + ecx_34;
				dwLoc0C_112 = fn00401C60(fp - 0x20, dwArg04 + eax_98) + eax_98;
				word32 dwLoc1C_113 = 0x00;
				while (dwLoc1C_113 <u dwLoc10)
				{
					Mem130[dwArg08 + dwLoc18_118:byte] = Mem0[dwArg08 + (dwLoc18_118 - dwLoc20):byte];
					dwLoc18_118 = dwLoc18_118 + 0x01;
					dwLoc1C_113 = dwLoc1C_113 + 0x01;
				}
			}
		}
		else
		{
			Mem142[dwArg08 + dwLoc18_118:byte] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x01;
		}
	} while (dwLoc0C_112 <u dwArg0C);
}

// 00401C60: Register word32 fn00401C60(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401C60(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00;
	word32 dwLoc10_13 = 0x00;
	do
	{
		word32 ecx_16 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 ecx_26 = ecx_16 & 0x7F | dwLoc08_12 << 0x07;
		word32 edx_29 = dwLoc10_13 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x80) != 0x00);
	Mem39[dwArg04 + 0x00:word32] = ecx_26;
	return edx_29;
}

