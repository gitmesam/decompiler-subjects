// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register word32 fn00401024(Register bu8 al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi, Register out ptr32 ebpOut)
word32 fn00401024(bu8 al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi, ptr32 & ebpOut)
{
	__outb(dx, al);
	bu8 al_16;
	byte SZO_19;
	bool S_20;
	byte SCZO_21;
	byte C_24;
	byte ah_25;
	byte FPUF_26;
	word32 ebx_27;
	byte dh_29;
	word16 ax_30;
	byte bl_32;
	struct Eq_29 * ss_33;
	<type-error> Eq_34::* ecx_34;
	struct Eq_31 * es_35;
	byte SO_36;
	byte Z_37;
	struct Eq_34 * cs_38;
	byte ch_39;
	byte dl_40;
	struct Eq_37 * ds_41;
	int32 * ebp_23;
	word16 dx_15;
	struct Eq_40 * esi_18;
	struct Eq_41 * edi_22;
	Eq_42 edx_28;
	ptr32 esp_14;
	ui32 eax_17;
	byte cl_149;
	fn00400FB3();
	return eax_17;
}

// 004123A7: Register Eq_388 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcessHeap();
	GetProcessHeap();
	Eq_394 eax_11 = GetModuleHandleA(&globals->t433D5D);
	Eq_391 eax_27 = CreateFileA(&globals->t433D45, 0x40000000, 0x03, null, 0x03, 0x0127, null);
	GetACP();
	Eq_421 eax_35 = GetProcAddress(eax_11, &globals->t433D33);
	GetProcessHeap();
	GetProcessHeap();
	GetCurrentThreadId();
	GetProcessHeap();
	ptr32 esp_219 = fp - 0x8C;
	Eq_391 eax_61 = CreateFileA(&globals->t433D1A, 0x00, 0x06, null, 0x03, 131, null);
	if (eax_61 == (void *) ~0x00)
	{
		Eq_494 eax_128 = eax_35();
		GetVersion();
		Eq_388 eax_149 = GetVersion();
		ptr32 esp_151;
		word32 ebp_152;
		byte SCZO_153;
		word32 eax_154;
		byte Z_155;
		byte SZO_156;
		byte C_157;
		byte al_158;
		word32 ecx_159;
		word32 edx_160;
		word32 ebx_161;
		word32 esi_162;
		word32 edi_163;
		(*((word32) (eax_128 ^ 0xC0000005) + 0x0041249F))();
		*(esp_151 - 0x04) = 0x00;
		*(esp_151 - 0x08) = (HANDLE *) eax_61;
		GetFileSize(*(esp_151 - 0x08), *(esp_151 - 0x04));
		GetVersion();
		*(esp_151 - 0x0C) = fp - 0x08;
		GetCurrentProcessId();
		*(esp_151 - 0x10) = 0x40;
		*(esp_151 - 0x14) = (HANDLE *) eax_27;
		*(esp_151 - 0x18) = 0x00;
		SizeofResource(*(esp_151 - 0x18), *(esp_151 - 0x14));
		*(esp_151 - 0x1C) = 0x00011084;
		*(esp_151 - 0x20) = 0x00401000;
		GetCommandLineA();
		VirtualProtect(*(esp_151 - 0x20), *(esp_151 - 0x1C), *(esp_151 - 0x18), *(esp_151 - 0x14));
		GetProcessHeap();
		*(esp_151 - 0x24) = (union Eq_494 *) eax_128;
		*(esp_151 - 0x28) = 0x00;
		*(esp_151 - 44) = 0x0121;
		*(esp_151 - 0x30) = 0x03;
		*(esp_151 - 0x34) = 0x00;
		*(esp_151 - 0x38) = 0x07;
		*(esp_151 - 0x3C) = 0x80000000;
		*(esp_151 - 0x40) = 4406631;
		CreateFileA(*(esp_151 - 0x40), *(esp_151 - 0x3C), *(esp_151 - 0x38), *(esp_151 - 0x34), *(esp_151 - 0x30), *(esp_151 - 44), *(esp_151 - 0x28));
		*(esp_151 - 0x44) = 0x00011084;
		*(esp_151 - 0x48) = 0x00;
		*(esp_151 - 0x4C) = (FARPROC *) eax_35;
		GetFileSize(*(esp_151 - 0x4C), *(esp_151 - 0x48));
		*(esp_151 - 0x50) = 0x00401000;
		GetCurrentProcessId();
		esp_219 = esp_151 - 0x50;
		dwLoc1C = eax_128;
	}
	GetOEMCP();
	LPDWORD * esp_87 = esp_219 - 0x04;
	*esp_87 = (LPDWORD *) null;
	*(esp_87 - 0x04) = (FARPROC *) eax_35;
	Eq_388 eax_92 = GetFileSize(*(esp_87 - 0x04), *esp_87);
	word32 esp_93;
	word32 ebp_94;
	byte SCZO_95;
	word32 eax_96;
	byte Z_97;
	byte SZO_98;
	byte C_99;
	byte al_100;
	word32 ecx_101;
	word32 edx_102;
	word32 ebx_103;
	word32 esi_104;
	word32 edi_105;
	(dwLoc1C - ~0x4041235D)();
	GetVersion();
	word32 ebp_111;
	return fn00401024((byte) GetVersion(), ecx_101, edx_102, ebx_103, ebp_94, esi_104, edi_105, out ebp_111);
}

