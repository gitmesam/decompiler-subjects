// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register ui32 fn00401024(Register bu8 al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi, Register out ptr32 ebpOut)
ui32 fn00401024(bu8 al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi, ptr32 & ebpOut)
{
	__outb(dx, al);
	bu8 al_16;
	byte SZO_19;
	bool S_20;
	byte SCZO_21;
	bool C_24;
	byte ah_25;
	Eq_24 FPUF_26;
	byte * ebx_27;
	byte dh_29;
	word16 ax_30;
	byte bl_32;
	struct Eq_29 * ss_33;
	ptr32 ecx_34;
	struct Eq_31 * es_35;
	byte SO_36;
	bool Z_37;
	bool O_38;
	byte ch_39;
	byte dl_40;
	struct Eq_37 * ds_41;
	byte cl_130;
	int32 * ebp_23;
	word16 dx_15;
	struct Eq_41 * esi_18;
	struct Eq_42 * edi_22;
	Eq_43 edx_275;
	ptr32 esp_14;
	ui32 eax_17;
	fn00400FB3();
	return eax_17;
}

// 004123A7: Register Eq_434 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcessHeap();
	GetProcessHeap();
	Eq_440 eax_11 = GetModuleHandleA(&globals->t433D5D);
	Eq_437 eax_28 = CreateFileA(&globals->t433D45, 0x40000000, 0x03, null, 0x03, 0x0127, null);
	GetACP();
	Eq_467 eax_37 = GetProcAddress(eax_11, &globals->t433D33);
	GetProcessHeap();
	GetProcessHeap();
	GetCurrentThreadId();
	GetProcessHeap();
	Eq_437 eax_64 = CreateFileA(&globals->t433D1A, 0x00, 0x06, null, 0x03, 131, null);
	ptr32 esp_229 = fp - 0x48;
	if (eax_64 == (void *) ~0x00)
	{
		Eq_540 eax_133 = eax_37();
		GetVersion();
		Eq_434 eax_154 = GetVersion();
		ptr32 esp_156;
		word32 ebp_157;
		byte SCZO_158;
		word32 eax_159;
		bool Z_160;
		byte SZO_161;
		bool C_162;
		byte al_163;
		word32 ecx_164;
		word32 edx_165;
		word32 ebx_166;
		word32 esi_167;
		word32 edi_168;
		(*((word32) (eax_133 ^ 0xC0000005) + 0x0041249F))();
		*(esp_156 - 0x04) = 0x00;
		*(esp_156 - 0x08) = (HANDLE *) eax_64;
		GetFileSize(*(esp_156 - 0x08), *(esp_156 - 0x04));
		GetVersion();
		*(esp_156 - 0x04) = fp - 0x08;
		GetCurrentProcessId();
		*(esp_156 - 0x08) = 0x40;
		*(esp_156 - 0x0C) = (HANDLE *) eax_28;
		*(esp_156 - 0x10) = 0x00;
		SizeofResource(*(esp_156 - 0x10), *(esp_156 - 0x0C));
		*(esp_156 - 0x0C) = 0x00011084;
		*(esp_156 - 0x10) = 0x00401000;
		GetCommandLineA();
		VirtualProtect(*(esp_156 - 0x10), *(esp_156 - 0x0C), *(esp_156 - 0x08), *(esp_156 - 0x04));
		GetProcessHeap();
		*(esp_156 - 0x04) = (union Eq_540 *) eax_133;
		*(esp_156 - 0x08) = 0x00;
		*(esp_156 - 0x0C) = 0x0121;
		*(esp_156 - 0x10) = 0x03;
		*(esp_156 - 0x14) = 0x00;
		*(esp_156 - 0x18) = 0x07;
		*(esp_156 - 0x1C) = 0x80000000;
		*(esp_156 - 0x20) = 4406631;
		CreateFileA(*(esp_156 - 0x20), *(esp_156 - 0x1C), *(esp_156 - 0x18), *(esp_156 - 0x14), *(esp_156 - 0x10), *(esp_156 - 0x0C), *(esp_156 - 0x08));
		*(esp_156 - 0x08) = 0x00011084;
		*(esp_156 - 0x0C) = 0x00;
		*(esp_156 - 0x10) = (FARPROC *) eax_37;
		GetFileSize(*(esp_156 - 0x10), *(esp_156 - 0x0C));
		*(esp_156 - 0x0C) = 0x00401000;
		GetCurrentProcessId();
		esp_229 = esp_156 - 0x0C;
		dwLoc1C = eax_133;
	}
	GetOEMCP();
	LPDWORD * esp_91 = esp_229 - 0x04;
	*esp_91 = (LPDWORD *) null;
	*(esp_91 - 0x04) = (FARPROC *) eax_37;
	Eq_434 eax_96 = GetFileSize(*(esp_91 - 0x04), *esp_91);
	word32 esp_98;
	word32 ebp_99;
	byte SCZO_100;
	word32 eax_101;
	bool Z_102;
	byte SZO_103;
	bool C_104;
	byte al_105;
	word32 ecx_106;
	word32 edx_107;
	word32 ebx_108;
	word32 esi_109;
	word32 edi_110;
	(dwLoc1C - ~0x4041235D)();
	GetVersion();
	word32 ebp_116;
	return fn00401024((byte) GetVersion(), ecx_106, edx_107, ebx_108, ebp_99, esi_109, edi_110, out ebp_116);
}

