// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401020: void fn00401020(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401020(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	Mem6[4223020:word32] = 0x00;
	while (Mem6[4223020:word32] <u dwArg0C)
	{
		Mem25[dwArg04 + Mem6[4223020:word32]:byte] = Mem6[dwArg08 + Mem6[4223020:word32]:byte];
		Mem29[4223020:word32] = Mem25[4223020:word32] + 0x01;
	}
}

// 004010B0: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 eax_18 = GetModuleHandleA(0x00);
	if ((dwArg04 & 0xFFFF) != 0x00)
		Mem207[0x00407044:word32] = 0x00;
	else
		Mem208[0x00407044:word32] = 0x01;
	if (dwArg04 == 0x00)
		Mem206[0x00407044:word32] = 0x00;
	if (Mem0[0x00407044:word32] != 0x00)
		Mem205[0x00407034:word32] = dwArg04;
	word32 eax_42 = fn00401270(LoadLibraryA(4222872), 4222860);
	word32 esp_53;
	word32 ebp_54;
	byte SCZO_55;
	word32 ebx_56;
	word32 esi_57;
	word32 edi_58;
	word32 eax_59;
	byte SZO_60;
	bool C_61;
	bool Z_62;
	word32 ecx_63;
	word32 edx_64;
	selector fs_65;
	eax_42();
	if (eax_59 != 0x00)
		return 0x00;
	word32 ecx_103 = Mem0[0x00403000:word32];
	word32 eax_106 = Mem0[0x00403004:word32];
	word32 dwLoc08_108 = 0x00;
	while (dwLoc08_108 <u ecx_103)
	{
		Mem122[dwLoc08_108 + 0x00403008:word32] = Mem0[dwLoc08_108 + 0x00403008:word32] ^ 22222;
		dwLoc08_108 = dwLoc08_108 + 0x08;
	}
	word32 ebp_157;
	Mem129[esp_53 - 0x04 + 0x00:word32] = eax_106;
	Mem133[0x00407040:word32] = fn00401830(dwArg00);
	Mem136[esp_53 - 0x04 + 0x00:word32] = ecx_103;
	Mem139[esp_53 - 0x08 + 0x00:word32] = Mem136[0x00407040:word32];
	Mem144[esp_53 - 0x0C + 0x00:word32] = 0x00403008;
	fn004019E0(dwArg00, dwArg04, dwArg08);
	Mem147[0x00407030:word32] = edi_58;
	Mem148[0x00407028:word32] = esi_57;
	Mem149[0x0040703C:word32] = ebx_56;
	Mem151[0x00407048:word32] = Mem149[fs_65:0x18:word32];
	Mem154[4223032:word32] = fp - 0x04;
	if (Mem154[0x00407044:word32] != 0x00)
	{
		Mem184[esp_53 - 0x04 + 0x00:word32] = dwArg04;
		Mem189[esp_53 - 0x08 + 0x00:word32] = 0x00401234 - dwArg04;
		ebp_157 = fn00401860(dwArg00, dwArg04);
	}
	else
	{
		Mem195[esp_53 - 0x04 + 0x00:word32] = eax_18;
		Mem200[esp_53 - 0x08 + 0x00:word32] = 0x00401234 - eax_18;
		ebp_157 = fn00401860(dwArg00, dwArg04);
	}
	word32 edx_159 = Mem154[0x00407040:word32];
	Mem161[esp_53 - 0x04 + 0x00:word32] = edx_159;
	word32 eax_162 = fn00401290(ebp_157, dwArg00);
	word32 esp_169;
	word32 ebp_170;
	byte SCZO_171;
	word32 ebx_172;
	word32 esi_173;
	word32 edi_174;
	word32 eax_175;
	byte SZO_176;
	bool C_177;
	bool Z_178;
	word32 ecx_179;
	word32 edx_180;
	selector fs_181;
	Mem161[0x0040704C:word32]();
	return eax_175;
}

// 00401270: Register word32 fn00401270(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401270(word32 dwArg04, word32 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 00401290: Register word32 fn00401290(Register word32 ebp, Stack word32 dwArg04)
word32 fn00401290(word32 ebp, word32 dwArg04)
{
	word32 eax_233;
	word32 edx_16 = dwArg04 + Mem0[dwArg04 + 0x3C:word32];
	word32 dwLoc2C_139 = edx_16 + 0x18 + (word32) Mem0[edx_16 + 0x14:word16];
	word32 eax_33 = VirtualAlloc(0x00, Mem0[edx_16 + 0x50:word32], 0x3000, 0x40);
	if (eax_33 != 0x00)
	{
		fn00401020(eax_33, dwArg04, Mem0[dwArg04 + 0x3C:word32] + 0x0138 + (word32) Mem0[edx_16 + 0x06:word16] *s 0x28);
		word32 eax_119 = GetProcAddress(GetModuleHandleA(4222928), 4222912);
		word32 eax_130 = GetProcAddress(GetModuleHandleA(4222964), 4222944);
		word32 dwLoc10_133 = 0x00;
		while (dwLoc10_133 <u (word32) Mem0[edx_16 + 0x06:word16])
		{
			if (Mem0[dwLoc2C_139 + 0x14:word32] != 0x00 && Mem0[dwLoc2C_139 + 0x10:word32] != 0x00)
				fn00401020(eax_33 + Mem0[dwLoc2C_139 + 0x0C:word32], dwArg04 + Mem0[dwLoc2C_139 + 0x14:word32], (uint32) ((uint64) (uint32) (Mem0[dwLoc2C_139 + 0x10:word32] - 0x01 + Mem0[edx_16 + 0x3C:word32]) /u Mem0[edx_16 + 0x3C:word32]) *s Mem0[edx_16 + 0x3C:word32]);
			dwLoc2C_139 = dwLoc2C_139 + 0x28;
			dwLoc10_133 = dwLoc10_133 + 0x01;
		}
		word32 ecx_202 = eax_33 + Mem0[eax_33 + 0x3C:word32];
		word32 eax_224 = eax_130();
		if (eax_224 != 0x00)
		{
			word32 dwLoc50_241 = eax_33 + Mem0[ecx_202 + 0x80:word32];
			while (Mem0[dwLoc50_241 + 0x10:word32] != 0x00)
			{
				word32 dwLoc38_267;
				word32 dwLoc28_266;
				LoadLibraryA(eax_33 + Mem0[dwLoc50_241 + 0x0C:word32]);
				if (Mem259[dwLoc50_241 + 0x00:word32] != 0x00)
				{
					dwLoc28_266 = eax_33 + Mem259[dwLoc50_241 + 0x00:word32];
					dwLoc38_267 = eax_33 + Mem259[dwLoc50_241 + 0x10:word32];
				}
				else
				{
					dwLoc28_266 = eax_33 + Mem259[dwLoc50_241 + 0x10:word32];
					dwLoc38_267 = eax_33 + Mem259[dwLoc50_241 + 0x00:word32];
				}
				word32 dwLoc1C_270 = 0x00;
				if (Mem259[dwLoc50_241 + 0x10:word32] != 0x00 && Mem259[dwLoc50_241 + 0x00:word32] != 0x00)
					dwLoc1C_270 = 0x01;
				while (Mem259[dwLoc28_266 + 0x00:word32] != 0x00)
				{
					if ((Mem259[dwLoc28_266 + 0x00:word32] & 0x80000000) != 0x00)
						Mem332[dwLoc28_266 + 0x00:word32] = fn00401270(dwArg00, dwArg04);
					else
						Mem346[dwLoc28_266 + 0x00:word32] = fn00401270(dwArg00, dwArg04);
					if (Mem259[dwLoc28_266 + 0x00:word32] == 0x00)
					{
						eax_233 = 0x00;
						return eax_233;
					}
					if (dwLoc1C_270 != 0x00)
						Mem316[dwLoc38_267 + 0x00:word32] = Mem259[dwLoc28_266 + 0x00:word32];
					dwLoc28_266 = dwLoc28_266 + 0x04;
					dwLoc38_267 = dwLoc38_267 + 0x04;
				}
				dwLoc50_241 = dwLoc50_241 + 0x14;
			}
			if (Mem0[0x00407044:word32] != 0x00)
			{
				word32 edx_717 = Mem0[0x00407034:word32] - Mem0[ecx_202 + 0x34:word32];
				if (Mem0[ecx_202 + 0xA4:word32] != 0x00)
				{
					word32 dwLoc24_726 = eax_33 + Mem0[ecx_202 + 0xA0:word32];
					while (Mem0[dwLoc24_726 + 0x04:word32] != 0x00)
					{
						word32 edx_741 = Mem0[dwLoc24_726 + 0x04:word32] - 0x08 >>u 0x01;
						word32 eax_744 = dwLoc24_726 + 0x08;
						word32 dwLoc10_747 = 0x00;
						while (dwLoc10_747 <u edx_741)
						{
							if ((word32) eax_744[dwLoc10_747 * 0x02] >> 0x0C == 0x03)
								Mem788[eax_33 + Mem0[dwLoc24_726 + 0x00:word32] + ((word32) eax_744[dwLoc10_747 * 0x02] & 0x0FFF):word32] = Mem0[eax_33 + Mem0[dwLoc24_726 + 0x00:word32] + ((word32) eax_744[dwLoc10_747 * 0x02] & 0x0FFF):word32] + edx_717;
							dwLoc10_747 = dwLoc10_747 + 0x01;
						}
						dwLoc24_726 = dwLoc24_726 + Mem0[dwLoc24_726 + 0x04:word32];
					}
				}
			}
			word32 eax_392 = GetProcAddress(GetModuleHandleA(0x00407014), 0x00407004);
			if (Mem391[0x00407044:word32] != 0x00)
				Mem687[0x00407024:word32] = eax_392();
			else
				Mem714[0x00407024:word32] = eax_392();
			word32 esp_405 = fp - 0x84;
			if (Mem391[0x00407024:word32] == 0x00)
			{
				word32 esp_470;
				if (Mem391[0x00407044:word32] != 0x00)
				{
					word32 eax_572 = eax_119();
					esp_470 = fp - 0x88;
					if (eax_572 == 0x00)
					{
						word32 ebp_602;
						byte SCZO_603;
						word32 esi_604;
						word32 eax_605;
						word32 ecx_606;
						word32 edx_607;
						bool Z_608;
						byte SZO_609;
						bool C_610;
						dwLoc14();
						if (eax_605 == 0x00)
						{
							eax_233 = 0x00;
							return eax_233;
						}
					}
				}
				else
				{
					esp_470 = fp - 0x88;
					if (eax_119() == 0x00)
					{
						word32 ebp_646;
						byte SCZO_647;
						word32 esi_648;
						word32 eax_649;
						word32 ecx_650;
						word32 edx_651;
						bool Z_652;
						byte SZO_653;
						bool C_654;
						dwLoc14();
						if (eax_649 == 0x00)
						{
							eax_233 = 0x00;
							return eax_233;
						}
					}
				}
				if (Mem391[0x00407044:word32] != 0x00)
				{
					word32 esp_515 = esp_470 - 0x04;
					Mem516[esp_515 + 0x00:word32] = Mem391[0x00407034:word32];
					Mem518[esp_515 - 0x04 + 0x00:word32] = 0x00;
					Mem520[esp_515 - 0x08 + 0x00:word32] = 0x00;
					Mem522[esp_515 - 0x0C + 0x00:word32] = 0x00;
					Mem524[esp_515 - 0x10 + 0x00:word32] = 0x22;
					Mem527[esp_515 - 0x14 + 0x00:word32] = eax_224;
					Mem538[0x00407024:word32] = eax_392();
				}
				else
				{
					word32 esp_541 = esp_470 - 0x04;
					Mem542[esp_541 + 0x00:word32] = Mem391[ecx_202 + 0x34:word32];
					Mem544[esp_541 - 0x04 + 0x00:word32] = 0x00;
					Mem546[esp_541 - 0x08 + 0x00:word32] = 0x00;
					Mem548[esp_541 - 0x0C + 0x00:word32] = 0x00;
					Mem550[esp_541 - 0x10 + 0x00:word32] = 0x22;
					Mem553[esp_541 - 0x14 + 0x00:word32] = eax_224;
					Mem564[0x00407024:word32] = eax_392();
				}
				esp_405 = esp_470 - 0x18;
				if (Mem391[0x00407024:word32] == 0x00)
				{
					if (Mem391[0x00407044:word32] == 0x00)
					{
						Mem486[esp_405 - 0x04 + 0x00:word32] = 0x40;
						Mem488[esp_405 - 0x08 + 0x00:word32] = 0x3000;
						Mem492[esp_405 - 0x0C + 0x00:word32] = Mem488[ecx_202 + 0x50:word32];
						Mem496[esp_405 - 0x10 + 0x00:word32] = Mem492[ecx_202 + 0x34:word32];
						Mem499[0x00407024:word32] = VirtualAlloc(Mem496[esp_405 - 0x10 + 0x00:LPVOID], Mem496[esp_405 - 0x0C + 0x00:SIZE_T], Mem496[esp_405 - 0x08 + 0x00:DWORD], Mem496[esp_405 - 0x04 + 0x00:DWORD]);
					}
					else
					{
						Mem501[esp_405 - 0x04 + 0x00:word32] = 0x40;
						Mem503[esp_405 - 0x08 + 0x00:word32] = 0x3000;
						Mem507[esp_405 - 0x0C + 0x00:word32] = Mem503[ecx_202 + 0x50:word32];
						Mem510[esp_405 - 0x10 + 0x00:word32] = Mem507[0x00407034:word32];
						Mem513[0x00407024:word32] = VirtualAlloc(Mem510[esp_405 - 0x10 + 0x00:LPVOID], Mem510[esp_405 - 0x0C + 0x00:SIZE_T], Mem510[esp_405 - 0x08 + 0x00:DWORD], Mem510[esp_405 - 0x04 + 0x00:DWORD]);
					}
				}
			}
			word32 esp_415 = esp_405 - 0x04;
			Mem416[esp_415 + 0x00:word32] = eax_224;
			CloseHandle(Mem416[esp_415 + 0x00:HANDLE]);
			Mem422[esp_415 + 0x00:word32] = Mem416[ecx_202 + 0x50:word32];
			Mem425[esp_415 - 0x04 + 0x00:word32] = eax_33;
			Mem428[esp_415 - 0x08 + 0x00:word32] = Mem425[0x00407024:word32];
			fn00401020(dwArg00, dwArg04, dwArg08);
			if (Mem428[0x00407044:word32] != 0x00)
			{
				Mem449[esp_415 + 0x00:word32] = Mem428[0x00407024:word32] + Mem428[ecx_202 + 0x28:word32];
				Mem452[esp_415 - 0x04 + 0x00:word32] = Mem449[0x00407034:word32];
				fn004017C0(dwArg00, dwArg04);
			}
			else
			{
				Mem457[esp_415 + 0x00:word32] = Mem428[0x00407024:word32];
				fn004019B0(dwArg00);
			}
			Mem438[0x0040704C:word32] = Mem428[0x00407024:word32] + Mem428[ecx_202 + 0x28:word32];
			Mem441[ecx_202 + 0x28:word32] = Mem438[0x0040704C:word32];
			eax_233 = 0x01;
			return eax_233;
		}
		else
		{
			eax_233 = 0x00;
			return eax_233;
		}
	}
	else
	{
		eax_233 = 0x00;
		return eax_233;
	}
}

// 004017C0: void fn004017C0(Stack word32 dwArg04, Stack word32 dwArg08)
void fn004017C0(word32 dwArg04, word32 dwArg08)
{
	word32 ecx_14 = Mem0[Mem0[Mem0[Mem0[0x00407048:word32] + 0x30:word32] + 0x0C:word32] + 0x0C:word32];
	word32 dwLoc0C_15 = ecx_14;
	while (0x01 != 0x00 && dwLoc0C_15 != 0x00)
	{
		if (Mem0[dwLoc0C_15 + 0x18:word32] == dwArg04)
		{
			Mem50[dwLoc0C_15 + 0x1C:word32] = dwArg08;
			return;
		}
		word32 eax_53 = Mem0[dwLoc0C_15 + 0x00:word32];
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			return;
	}
}

// 00401830: Register word32 fn00401830(Stack word32 dwArg04)
word32 fn00401830(word32 dwArg04)
{
	return VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401860: Register word32 fn00401860(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401860(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc20_13;
	if (Mem0[0x00407044:word32] != 0x00)
		dwLoc20_13 = Mem0[0x00407034:word32];
	else
		dwLoc20_13 = dwArg08;
	word32 eax_16 = dwLoc20_13 + Mem0[dwLoc20_13 + 0x3C:word32];
	Mem30[0x00407024:word32] = VirtualAlloc(0x00, Mem0[eax_16 + 0x50:word32], 0x3000, 0x40);
	if (Mem30[0x00407024:word32] == 0x00)
		return ebp;
	word32 eax_70 = Mem30[0x00407024:word32];
	fn00401020(eax_70, dwLoc20_13, Mem30[eax_16 + 0x50:word32]);
	word32 ecx_75 = Mem30[0x00407024:word32] - dwLoc20_13;
	if (Mem30[eax_16 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_102 = dwLoc20_13 + Mem30[eax_16 + 0xA0:word32];
		while (Mem30[dwLoc0C_102 + 0x04:word32] != 0x00)
		{
			word32 ecx_117 = Mem30[dwLoc0C_102 + 0x04:word32] - 0x08 >>u 0x01;
			word32 edx_120 = dwLoc0C_102 + 0x08;
			word32 dwLoc08_123 = 0x00;
			while (dwLoc08_123 <u ecx_117)
			{
				if ((word32) edx_120[dwLoc08_123 * 0x02] >> 0x0C == 0x03)
					Mem164[Mem30[0x00407024:word32] + Mem30[dwLoc0C_102 + 0x00:word32] + ((word32) edx_120[dwLoc08_123 * 0x02] & 0x0FFF):word32] = Mem30[Mem30[0x00407024:word32] + Mem30[dwLoc0C_102 + 0x00:word32] + ((word32) edx_120[dwLoc08_123 * 0x02] & 0x0FFF):word32] + ecx_75;
				dwLoc08_123 = dwLoc08_123 + 0x01;
			}
			dwLoc0C_102 = dwLoc0C_102 + Mem30[dwLoc0C_102 + 0x04:word32];
		}
	}
	word32 edx_86 = dwArg04 + Mem30[0x00407024:word32];
	word32 esp_88;
	word32 ebp_89;
	byte SCZO_90;
	word32 esi_91;
	bool Z_92;
	word32 eax_93;
	word32 ecx_94;
	word32 edx_95;
	bool C_96;
	byte SZO_97;
	edx_86();
	return ebp_89;
}

// 004019B0: void fn004019B0(Stack word32 dwArg04)
void fn004019B0(word32 dwArg04)
{
	Mem12[Mem0[Mem0[0x00407048:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 004019E0: void fn004019E0(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn004019E0(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc0C_112 = 0x01;
	byte cl_12 = Mem0[dwArg04 + 0x00:byte];
	word32 dwLoc18_118 = 0x00;
	do
	{
		word32 ecx_34 = dwLoc0C_112 + 0x01;
		byte al_31 = Mem0[dwArg04 + dwLoc0C_112:byte];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 == (word32) cl_12)
		{
			if ((word32) Mem0[dwArg04 + ecx_34:byte] == 0x00)
			{
				Mem80[dwArg08 + dwLoc18_118:byte] = cl_12;
				dwLoc18_118 = dwLoc18_118 + 0x01;
				dwLoc0C_112 = ecx_34 + 0x01;
			}
			else
			{
				word32 eax_98 = fn00401AE0(fp - 0x10, dwArg04 + ecx_34) + ecx_34;
				dwLoc0C_112 = fn00401AE0(fp - 0x20, dwArg04 + eax_98) + eax_98;
				word32 dwLoc1C_113 = 0x00;
				while (dwLoc1C_113 <u dwLoc10)
				{
					Mem130[dwArg08 + dwLoc18_118:byte] = Mem0[dwArg08 + (dwLoc18_118 - dwLoc20):byte];
					dwLoc18_118 = dwLoc18_118 + 0x01;
					dwLoc1C_113 = dwLoc1C_113 + 0x01;
				}
			}
		}
		else
		{
			Mem142[dwArg08 + dwLoc18_118:byte] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x01;
		}
	} while (dwLoc0C_112 <u dwArg0C);
}

// 00401AE0: Register word32 fn00401AE0(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401AE0(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00;
	word32 dwLoc10_13 = 0x00;
	do
	{
		word32 ecx_16 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 ecx_26 = ecx_16 & 0x7F | dwLoc08_12 << 0x07;
		word32 edx_29 = dwLoc10_13 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x80) != 0x00);
	Mem39[dwArg04 + 0x00:word32] = ecx_26;
	return edx_29;
}

