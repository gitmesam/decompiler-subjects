// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: void fn00401027(Register Eq_2 eax, Register int32 ecx, Register word16 dx, Register (ptr32 Eq_5) ebp, Register word32 esi, Register (ptr32 Eq_7) edi, Stack word32 dwArg00, Stack word32 dwArg08, Stack word32 dwArg0C, Stack word32 dwArg10, Stack word32 dwArg14)
void fn00401027(Eq_2 eax, int32 ecx, word16 dx, Eq_5 * ebp, word32 esi, Eq_7 * edi, word32 dwArg00, word32 dwArg08, word32 dwArg0C, word32 dwArg10, word32 dwArg14)
{
	struct Eq_13 * es_ebx_4 = *((word32) eax + 0x7D3A3EED);
	edi->dw0000 = __in(dx);
	__syscall(~0x14);
	edi->dw0004 = __in(dx);
	byte bl_22 = (byte) es_ebx_4 - ebp->bB9EA4D5A - (dh < es_ebx_4->b006A);
	__bound(ecx, ebp->dw0028);
	int32 eax_12 = (int32) ax;
	struct Eq_57 * ebx_23 = DPB(es_ebx_4, bl_22, 0);
	__bound(DPB(eax_12, Mem14[ebx_23 + (uint32) ((byte) eax_12):byte], 0), Mem14[ebp + 0x04:word32]);
	byte al_34;
	byte ah_35;
	__aas(bl_22, SLICE(ebx_23, byte, 8), &al_34, &ah_35);
	byte al_42;
	byte ah_43;
	__aas((byte) (ebx_23 - (struct Eq_84 *) ~0x6B1DA800), SLICE(ebx_23 - (struct Eq_84 *) ~0x6B1DA800, byte, 8), &al_42, &ah_43);
}

// 004147C5: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	GetCommandLineA();
	GetCommandLineA();
	CreateFileA(&globals->t42FB31, 0x60000000, 0x02, 0x00, 0x03, 166, 0x00);
	Eq_115 eax_29 = GetModuleHandleA(&globals->t42FACF);
	GetCommandLineA();
	GetCommandLineA();
	GetCommandLineA();
	Eq_127 eax_40 = GetProcAddress(eax_29, &globals->t42FB00);
	ptr32 esp_100 = fp - 0x68;
l00414839:
	word32 * esp_101 = esp_100 - 0x04;
	*esp_101 = 0x03;
	*(esp_101 - 0x04) = 0x00;
	ptr32 esp_103 = esp_101 - 0x04;
l00414840:
	struct Eq_582 * esp_132 = esp_103 - 0x04;
	esp_132->t0000.u0 = 0x03;
	*(esp_132 - 0x04) = 0xA0000000;
	*(esp_132 - 0x08) = 0x0042FB8B;
	CreateFileW(*(esp_132 - 0x08), *(esp_132 - 0x04), esp_132->t0000, esp_132->t0004, esp_132->t0008, esp_132->t000C, esp_132->t0010);
	esp_132->t0010.u0 = 0x00;
	GetLastError();
	esp_132->t000C.u0 = 0x00;
	esp_132->t0008.u0 = 0x0107;
	esp_132->t0004.u0 = 0x03;
	ptr32 esp_148 = &esp_132->t0004;
l0041486D:
	union Eq_2 * esp_373;
	struct Eq_419 * esp_174 = esp_148 - 0x04;
	esp_174->t0000.u0 = 0x00;
	*(esp_174 - 0x04) = 0x01;
	*(esp_174 - 0x08) = 0xA0000000;
	*(esp_174 - 0x0C) = 0x0042FB3F;
	ptr32 esp_183 = (char *) &esp_174->t000C + 0x04;
	if (CreateFileA(*(esp_174 - 0x0C), *(esp_174 - 0x08), *(esp_174 - 0x04), esp_174->t0000, esp_174->t0004, esp_174->t0008, esp_174->t000C) == ~0x00)
	{
		esp_174->t000C.u0 = 0x00;
		esp_174->t0008.u0 = 0x00;
		esp_174->t0004.u0 = 0x23;
		esp_174->t0000.u0 = 0x03;
		*(esp_174 - 0x04) = 0x00;
		esp_373 = esp_174 - 0x04;
		do
		{
			struct Eq_445 * esp_463 = esp_373 - 0x04;
			esp_463->t0000.u0 = 0x03;
			*(esp_463 - 0x04) = 0xC0000000;
			*(esp_463 - 0x08) = 4389738;
			CreateFileW(*(esp_463 - 0x08), *(esp_463 - 0x04), esp_463->t0000, esp_463->t0004, esp_463->t0008, esp_463->t000C, esp_463->t0010);
			esp_463->t0010.u0 = 0x00;
			esp_463->t000C.u0 = 0x00;
			esp_463->t0008.u0 = 0xA7;
			esp_463->t0004.u0 = 0x03;
			esp_463->t0000.u0 = 0x00;
			*(esp_463 - 0x04) = 0x05;
			*(esp_463 - 0x08) = 0xC0000000;
			*(esp_463 - 0x0C) = 4389482;
			Eq_2 eax_488 = CreateFileW(*(esp_463 - 0x0C), *(esp_463 - 0x08), *(esp_463 - 0x04), esp_463->t0000, esp_463->t0004, esp_463->t0008, esp_463->t000C);
			do
			{
				esp_183 = &esp_463->t0010;
				if (eax_488 != ~0x00)
					goto l00414B05;
				esp_463->t000C.u0 = 0x00;
				esp_463->t0008.u0 = 0x0105;
				esp_463->t0004.u0 = 0x03;
				esp_463->t0000.u0 = 0x00;
				*(esp_463 - 0x04) = 0x04;
				*(esp_463 - 0x08) = 0x20000000;
				*(esp_463 - 0x0C) = 4389593;
				eax_488 = CreateFileA(*(esp_463 - 0x0C), *(esp_463 - 0x08), *(esp_463 - 0x04), esp_463->t0000, esp_463->t0004, esp_463->t0008, esp_463->t000C);
			} while (eax_488 != ~0x00);
			int32 eax_519 = eax_40();
			esp_463->t000C.u0 = 0x00;
			esp_463->t0008.u0 = 0x07;
			esp_463->t0004.u0 = 0x03;
			esp_463->t0000.u0 = 0x00;
			*(esp_463 - 0x04) = 0x06;
			*(esp_463 - 0x08) = 0x40000000;
			*(esp_463 - 0x0C) = 0x0042FAF1;
			dwLoc14 = eax_519;
			esp_103 = &esp_463->t0010;
			if (CreateFileW(*(esp_463 - 0x0C), *(esp_463 - 0x08), *(esp_463 - 0x04), esp_463->t0000, esp_463->t0004, esp_463->t0008, esp_463->t000C) != ~0x00)
				goto l00414840;
			GetLastError();
			GetCommandLineA();
			GetCommandLineA();
			GetLastError();
			esp_463->t000C.u0 = 0x00;
			esp_463->t0008.u0 = 0xA4;
			esp_463->t0004.u0 = 0x03;
			esp_463->t0000.u0 = 0x00;
			*(esp_463 - 0x04) = 0x01;
			*(esp_463 - 0x08) = 0x00;
			*(esp_463 - 0x0C) = 4389511;
			CreateFileA(*(esp_463 - 0x0C), *(esp_463 - 0x08), *(esp_463 - 0x04), esp_463->t0000, esp_463->t0004, esp_463->t0008, esp_463->t000C);
			Eq_95 eax_576 = GetCommandLineA();
			ptr32 esp_577;
			word32 ebp_578;
			byte SCZO_579;
			word32 eax_580;
			bool Z_581;
			byte SZO_582;
			bool C_583;
			word32 ecx_584;
			word16 dx_585;
			word32 esi_586;
			word32 edi_587;
			(*((word32) (eax_519 ^ 0xC0000005) + 0x004149D1))();
			GetCommandLineA();
			*(esp_577 - 0x04) = 0x00;
			*(esp_577 - 0x08) = 0x26;
			*(esp_577 - 0x0C) = 0x03;
			*(esp_577 - 0x10) = 0x00;
			*(esp_577 - 0x14) = 0x01;
			*(esp_577 - 0x18) = 0x80000000;
			*(esp_577 - 0x1C) = 4389843;
			esp_148 = esp_577;
			if (CreateFileW(*(esp_577 - 0x1C), *(esp_577 - 0x18), *(esp_577 - 0x14), *(esp_577 - 0x10), *(esp_577 - 0x0C), *(esp_577 - 0x08), *(esp_577 - 0x04)) != ~0x00)
				goto l0041486D;
l00414A05:
			union Eq_2 * esp_336 = esp_148 - 0x04;
			*esp_336 = 0x00;
			*(esp_336 - 0x04) = 0x01A4;
			*(esp_336 - 0x08) = 0x03;
			*(esp_336 - 0x0C) = 0x00;
			*(esp_336 - 0x10) = 0x05;
			*(esp_336 - 0x14) = 0x20000000;
			*(esp_336 - 0x18) = 0x0042FB4D;
			esp_100 = (char *) esp_336 + 0x04;
			if (CreateFileW(*(esp_336 - 0x18), *(esp_336 - 0x14), *(esp_336 - 0x10), *(esp_336 - 0x0C), *(esp_336 - 0x08), *(esp_336 - 0x04), *esp_336) != ~0x00)
				goto l00414839;
			*esp_336 = (union Eq_2 *) (fp - 0x28);
			*(esp_336 - 0x04) = 0x00;
			*(esp_336 - 0x08) = 0x86;
			*(esp_336 - 0x0C) = 0x03;
			*(esp_336 - 0x10) = 0x00;
			*(esp_336 - 0x14) = 0x06;
			*(esp_336 - 0x18) = 0x60000000;
			*(esp_336 - 0x1C) = 0x0042FBBC;
			esp_373 = esp_336;
		} while (CreateFileW(*(esp_336 - 0x1C), *(esp_336 - 0x18), *(esp_336 - 0x14), *(esp_336 - 0x10), *(esp_336 - 0x0C), *(esp_336 - 0x08), *(esp_336 - 0x04)) != ~0x00);
		*(esp_336 - 0x04) = 0x40;
		*(esp_336 - 0x08) = 0x00;
		*(esp_336 - 0x0C) = 0x86;
		*(esp_336 - 0x10) = 0x03;
		*(esp_336 - 0x14) = 0x00;
		*(esp_336 - 0x18) = 0x02;
		*(esp_336 - 0x1C) = 0x00;
		*(esp_336 - 0x20) = 0x0042FAB0;
		CreateFileA(*(esp_336 - 0x20), *(esp_336 - 0x1C), *(esp_336 - 0x18), *(esp_336 - 0x14), *(esp_336 - 0x10), *(esp_336 - 0x0C), *(esp_336 - 0x08));
		GetCommandLineA();
		*(esp_336 - 0x08) = 0x00013503;
		GetCommandLineA();
		*(esp_336 - 0x0C) = 0x00401000;
		*(esp_336 - 0x10) = 0x00;
		*(esp_336 - 0x14) = 288;
		*(esp_336 - 0x18) = 0x03;
		*(esp_336 - 0x1C) = 0x00;
		*(esp_336 - 0x20) = 0x04;
		*(esp_336 - 0x24) = 0x20000000;
		*(esp_336 - 0x28) = 4389518;
		CreateFileW(*(esp_336 - 0x28), *(esp_336 - 0x24), *(esp_336 - 0x20), *(esp_336 - 0x1C), *(esp_336 - 0x18), *(esp_336 - 0x14), *(esp_336 - 0x10));
		*(esp_336 - 0x10) = 0x00;
		*(esp_336 - 0x14) = 0x04;
		*(esp_336 - 0x18) = 0x03;
		*(esp_336 - 0x1C) = 0x00;
		*(esp_336 - 0x20) = 0x06;
		*(esp_336 - 0x24) = 0xA0000000;
		*(esp_336 - 0x28) = 4389656;
		CreateFileA(*(esp_336 - 0x28), *(esp_336 - 0x24), *(esp_336 - 0x20), *(esp_336 - 0x1C), *(esp_336 - 0x18), *(esp_336 - 0x14), *(esp_336 - 0x10));
		VirtualProtect(*(esp_336 - 0x0C), *(esp_336 - 0x08), *(esp_336 - 0x04), *esp_336);
		esp_183 = (char *) esp_336 + 0x04;
	}
l00414B05:
	GetLastError();
	int32 * esp_209 = esp_183 - 0x04;
	*esp_209 = dwLoc14;
	GetLastError();
	*(esp_209 - 0x04) = 0x00;
	*(esp_209 - 0x08) = 0x81;
	*(esp_209 - 0x0C) = 0x03;
	*(esp_209 - 0x10) = 0x00;
	*(esp_209 - 0x14) = 0x05;
	*(esp_209 - 0x18) = 0x00;
	*(esp_209 - 0x1C) = 0x0042FB12;
	CreateFileA(*(esp_209 - 0x1C), *(esp_209 - 0x18), *(esp_209 - 0x14), *(esp_209 - 0x10), *(esp_209 - 0x0C), *(esp_209 - 0x08), *(esp_209 - 0x04));
	*(esp_209 - 0x04) = 0x00013503;
	GetCommandLineA();
	*(esp_209 - 0x08) = 0x00;
	*(esp_209 - 0x0C) = 0x26;
	*(esp_209 - 0x10) = 0x03;
	*(esp_209 - 0x14) = 0x00;
	*(esp_209 - 0x18) = 0x06;
	*(esp_209 - 0x1C) = 0xC0000000;
	*(esp_209 - 0x20) = 0x0042FBAA;
	CreateFileW(*(esp_209 - 0x20), *(esp_209 - 0x1C), *(esp_209 - 0x18), *(esp_209 - 0x14), *(esp_209 - 0x10), *(esp_209 - 0x0C), *(esp_209 - 0x08));
	*(esp_209 - 0x08) = 0x00401000;
	GetCommandLineA();
	*(esp_209 - 0x0C) = 0x00;
	*(esp_209 - 0x10) = 0x0103;
	*(esp_209 - 0x14) = 0x03;
	*(esp_209 - 0x18) = 0x00;
	*(esp_209 - 0x1C) = 0x07;
	*(esp_209 - 0x20) = 0xA0000000;
	*(esp_209 - 0x24) = 0x0042FA94;
	ptr32 v13_253 = dwLoc14 - 0xC0000005;
	Eq_2 eax_270 = CreateFileW(*(esp_209 - 0x24), *(esp_209 - 0x20), *(esp_209 - 0x1C), *(esp_209 - 0x18), *(esp_209 - 0x14), *(esp_209 - 0x10), *(esp_209 - 0x0C));
	esp_148 = esp_209 - 0x08;
	if (eax_270 == ~0x00)
	{
		ptr32 esp_278;
		struct Eq_5 * ebp_279;
		byte SCZO_280;
		word32 eax_281;
		bool Z_282;
		byte SZO_283;
		bool C_284;
		int32 ecx_285;
		word16 dx_286;
		word32 esi_287;
		struct Eq_7 * edi_288;
		(v13_253 + 0x00414C17)();
		*(esp_278 - 0x04) = 0x00;
		*(esp_278 - 0x08) = 422;
		*(esp_278 - 0x0C) = 0x03;
		*(esp_278 - 0x10) = 0x00;
		*(esp_278 - 0x14) = 0x06;
		*(esp_278 - 0x18) = 0x60000000;
		*(esp_278 - 0x1C) = 0x0042FB76;
		Eq_2 eax_303 = CreateFileW(*(esp_278 - 0x1C), *(esp_278 - 0x18), *(esp_278 - 0x14), *(esp_278 - 0x10), *(esp_278 - 0x0C), *(esp_278 - 0x08), *(esp_278 - 0x04));
		fn00401027(eax_303, ecx_285, dx_286, ebp_279, esi_287, edi_288, ebp, dwArg04, dwArg08, dwArg0C, dwArg10);
		return eax_303;
	}
	goto l00414A05;
}

