// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401023: Register uint32 fn00401023(Register cu8 al, Register byte cl, Register (ptr32 Eq_5) edx, Register word32 ebx, Register (ptr32 word32) edi, Register out ptr32 ebpOut)
uint32 fn00401023(cu8 al, byte cl, Eq_5 * edx, word32 ebx, word32 * edi, ptr32 & ebpOut)
{
	*edi = __in(dx);
	(byte *) 3984151735 = (byte *) (al - 22);
	word32 v10_15 = Mem10[edx + 0x1D1154B7:word32] + fp + (al <u 22);
	edx->dw1D1154B7 = v10_15;
	edx->dw0000 = (word32) ((bool) (v10_15 < 0x00) + (edx->dw0000 + (ebx + 0x01)));
	ci8 al_27 = al - 22 & 0xC5;
	struct Eq_51 * esp_33;
	word16 dx_34;
	word32 edi_35;
	byte al_36;
	byte SCZO_37;
	byte ch_38;
	bool C_39;
	word32 edx_40;
	int8 * ebx_41;
	byte SZO_42;
	byte SO_43;
	word32 esi_44;
	byte cl_45;
	word32 ebp_46;
	word32 ecx_47;
	uint32 eax_48;
	fn00400FDC();
	return eax_48;
}

// 00410A79: Register Eq_97 Win32CrtStartup()
Eq_97 Win32CrtStartup()
{
	ptr32 esp_130;
	GetCurrentProcessId();
	Eq_97 eax_24 = CreateFileA(&globals->t435E88, 0x00, 0x06, null, 0x03, 0x02, 0x00);
	word32 * esp_137 = fp - 0x28;
	if (eax_24 == ~0x00)
	{
		GetCommandLineA();
		Eq_236 eax_140 = GetModuleHandleA(&globals->t435E7E);
		GetCurrentProcessId();
		GetCommandLineW();
		GetACP();
		Eq_249 eax_151 = GetProcAddress(eax_140, &globals->t435E93);
		GetProcessHeap();
		CloseHandle(eax_24);
		GetProcessHeap();
		Eq_138 eax_170 = eax_151();
		dwLoc0C = eax_170;
		<anonymous> * eax_182 = (eax_170 ^ 0xC0000005) + 0x00410B35;
		ptr32 esp_184;
		word32 ebp_185;
		byte SCZO_186;
		word32 eax_187;
		bool Z_188;
		byte SZO_189;
		bool C_190;
		byte al_191;
		byte cl_192;
		word32 edx_193;
		word32 ebx_194;
		word32 edi_195;
		eax_182();
		GetProcessHeap();
		*(esp_184 - 0x04) = (union Eq_97 *) eax_24;
		GetFileType(*(esp_184 - 0x04));
		*(esp_184 - 0x04) = fp - 0x14;
		GetProcessHeap();
		GetCommandLineW();
		*(esp_184 - 0x08) = 0x40;
		GetCurrentThreadId();
		esp_130 = esp_184 - 0x08;
l00410B59:
		word32 * esp_131 = esp_130 - 0x04;
		*esp_131 = 63314;
		*(esp_131 - 0x04) = (union Eq_97 *) eax_24;
		GetFileType(*(esp_131 - 0x04));
		esp_137 = esp_131;
	}
	struct Eq_126 * esp_55 = esp_137 - 0x04;
	esp_55->t0000.u0 = 0x00401000;
	VirtualProtect(esp_55->t0000, esp_55->t0004, esp_55->t0008, esp_55->t000C);
	GetCurrentProcessId();
	GetCurrentProcessId();
	esp_55->t000C = dwLoc0C;
	GetACP();
	esp_55->t0008.u0 = 0x00;
	esp_55->t0004.u0 = 0x0182;
	esp_55->t0000.u0 = 0x03;
	*(esp_55 - 0x04) = 0x00;
	*(esp_55 - 0x08) = 0x03;
	*(esp_55 - 0x0C) = 0x00;
	*(esp_55 - 0x10) = 4415087;
	esp_130 = &esp_55->t000C;
	if (CreateFileA(*(esp_55 - 0x10), *(esp_55 - 0x0C), *(esp_55 - 0x08), *(esp_55 - 0x04), esp_55->t0000, esp_55->t0004, esp_55->t0008) == ~0x00)
	{
		esp_55->t0008.u0 = 63314;
		GetVersion();
		esp_55->t0004.u0 = 0x00401000;
		word32 esp_94;
		word32 ebp_95;
		byte SCZO_96;
		word32 eax_97;
		bool Z_98;
		byte SZO_99;
		bool C_100;
		byte al_101;
		byte cl_102;
		struct Eq_5 * edx_103;
		word32 ebx_104;
		word32 * edi_105;
		(dwLoc0C - ~0x40410A16)();
		word32 ebp_108;
		return fn00401023((byte) GetACP(), cl_102, edx_103, ebx_104, edi_105, out ebp_108);
	}
	goto l00410B59;
}

