// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401023: Register word32 fn00401023(Register cu8 al, Register byte cl, Register (ptr Eq_5) edx, Register word32 ebx, Register word32 esi, Register (ptr word32) edi, Register out ptr32 ebpOut)
word32 fn00401023(cu8 al, byte cl, Eq_5 * edx, word32 ebx, word32 esi, word32 * edi, ptr32 & ebpOut)
{
	*edi = __in(dx);
	(byte *) 3984151735 = (byte *) (al - 22);
	up32 v10_15 = (byte) (al < 22) + (edx->dw1D1154B7 + fp);
	edx->dw1D1154B7 = v10_15;
	edx->dw0000 = (word32) ((byte) (v10_15 < 0x00) + (edx->dw0000 + (ebx + 0x01)));
	ci8 al_27 = al - 22 & 0xC5;
	struct Eq_52 * esp_33;
	word16 dx_34;
	word32 edi_35;
	byte al_36;
	byte SCZO_37;
	byte ch_38;
	byte C_39;
	word32 edx_40;
	int8 * ebx_41;
	byte SZO_42;
	byte SO_43;
	word32 esi_44;
	byte cl_45;
	word32 ebp_46;
	word32 ecx_47;
	word32 eax_48;
	fn00400FDC();
	return eax_48;
}

// 00410A79: Register Eq_98 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 esp_146;
	GetCurrentProcessId();
	ptr32 esp_150 = fp - 0x44;
	Eq_107 eax_24 = CreateFileA(&globals->t435E88, 0x00, 0x06, null, 0x03, 0x02, null);
	if (eax_24 == (void *) ~0x00)
	{
		GetCommandLineA();
		Eq_250 eax_155 = GetModuleHandleA(&globals->t435E88);
		GetCurrentProcessId();
		GetCommandLineW();
		GetACP();
		Eq_262 eax_165 = GetProcAddress(eax_155, &globals->t435E93);
		GetProcessHeap();
		CloseHandle(eax_24);
		GetProcessHeap();
		Eq_157 eax_182 = eax_165();
		dwLoc0C = eax_182;
		<anonymous> * eax_196 = (eax_182 ^ 0xC0000005) + 0x00410B35;
		ptr32 esp_198;
		word32 ebp_199;
		byte SCZO_200;
		word32 eax_201;
		byte Z_202;
		byte SZO_203;
		byte C_204;
		bcuisposr0 None_205;
		byte al_206;
		byte cl_207;
		word32 edx_208;
		word32 ebx_209;
		word32 esi_210;
		word32 edi_211;
		eax_196();
		GetProcessHeap();
		*(esp_198 - 0x04) = (HANDLE *) eax_24;
		GetFileType(*(esp_198 - 0x04));
		*(esp_198 - 0x08) = fp - 0x14;
		GetProcessHeap();
		GetCommandLineW();
		*(esp_198 - 0x0C) = 0x40;
		GetCurrentThreadId();
		esp_146 = esp_198 - 0x0C;
l00410B59:
		word32 * esp_147 = esp_146 - 0x04;
		*esp_147 = 63314;
		*(esp_147 - 0x04) = (HANDLE *) eax_24;
		GetFileType(*(esp_147 - 0x04));
		esp_150 = esp_147 - 0x04;
	}
	struct Eq_127 * esp_66 = esp_150 - 0x04;
	esp_66->t0000 = (Eq_130) &globals->v401000;
	VirtualProtect(esp_66->t0000, esp_66->t0004, esp_66->t0008, esp_66->t000C);
	GetCurrentProcessId();
	GetCurrentProcessId();
	*(esp_66 - 0x04) = (union Eq_157 *) dwLoc0C;
	GetACP();
	*(esp_66 - 0x08) = 0x00;
	*(esp_66 - 0x0C) = 0x0182;
	*(esp_66 - 0x10) = 0x03;
	*(esp_66 - 0x14) = 0x00;
	*(esp_66 - 0x18) = 0x03;
	*(esp_66 - 0x1C) = 0x00;
	*(esp_66 - 0x20) = 4415087;
	esp_146 = esp_66 - 0x20;
	if (CreateFileA(*(esp_66 - 0x20), *(esp_66 - 0x1C), *(esp_66 - 0x18), *(esp_66 - 0x14), *(esp_66 - 0x10), *(esp_66 - 0x0C), *(esp_66 - 0x08)) == (void *) ~0x00)
	{
		*(esp_66 - 0x24) = 63314;
		GetVersion();
		*(esp_66 - 0x28) = 0x00401000;
		word32 esp_103;
		word32 ebp_104;
		byte SCZO_105;
		word32 eax_106;
		byte Z_107;
		byte SZO_108;
		byte C_109;
		bcuisposr0 None_110;
		byte al_111;
		byte cl_112;
		struct Eq_5 * edx_113;
		word32 ebx_114;
		word32 esi_115;
		word32 * edi_116;
		(dwLoc0C - ~0x40410A16)();
		word32 ebp_119;
		return fn00401023((byte) GetACP(), cl_112, edx_113, ebx_114, esi_115, edi_116, out ebp_119);
	}
	goto l00410B59;
}

