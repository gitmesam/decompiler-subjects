// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425A46: Register uint32 fn00425A46(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out (ptr32 (ptr32 Eq_196)) ebpOut)
uint32 fn00425A46(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, Eq_196 * * & ebpOut)
{
	word32 * esi_17 = dwArg04;
	uint32 edx_20 = dwArg08 >> 0x02;
	do
	{
		*esi_17 = *esi_17 - dwArg0C;
		*esi_17 = *esi_17 + ~0x00505D15;
		*esi_17 = *esi_17 - dwArg0C;
		*esi_17 = *esi_17 + 3279938197;
		*esi_17 = *esi_17 - 2207242656;
		*esi_17 = *esi_17 ^ 3509854558;
		*esi_17 = *esi_17 ^ 1939200450;
		*esi_17 = *esi_17 ^ dwArg0C;
		*esi_17 = *esi_17 ^ dwArg0C;
		esi_17 = esi_17 + 0x01;
		edx_20 = edx_20 - 0x01;
	} while (edx_20 != 0x00);
	word32 ebp_60;
	*ebpOut = ebp;
	return edx_20;
}

// 00425AA8: Register Eq_88 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_196 ** ebp_106 = fp - 0x04;
	Eq_93 eax_39 = CreateFileA(&globals->t431000, 0xC0000000, 0x03, null, 0x03, 0x0101, 0x00);
	ptr32 esp_108 = fp - 0x24;
	eax_705 = eax_39;
	do
	{
		Eq_93 eax_705;
		if (eax_705 != ~0x00)
			goto l00425B59;
		LPDWORD * esp_653 = esp_108 - 0x04;
		*esp_653 = (LPDWORD *) null;
		*(esp_653 - 0x04) = (union Eq_93 *) eax_39;
		GetFileSize(*(esp_653 - 0x04), *esp_653);
		*esp_653 = (LPDWORD *) null;
		GetACP();
		Eq_125 eax_663 = GetACP();
		ptr32 esp_664;
		byte SCZO_666;
		word32 ebx_667;
		word32 edi_668;
		word32 esi_669;
		word32 eax_670;
		bool Z_671;
		byte SZO_672;
		bool C_673;
		byte bh_674;
		byte ah_675;
		byte bl_676;
		byte al_677;
		byte CZ_678;
		bool O_683;
		byte cl_684;
		bool D_686;
		bool S_687;
		byte SCZDOP_689;
		bool FPUF_690;
		byte SO_693;
		NTDLL.DLL!ZwReplaceKey();
		*(esp_664 - 0x04) = eax_670;
		*(esp_664 - 0x08) = (union Eq_93 *) eax_39;
		*(esp_664 - 0x0C) = 0x00;
		Eq_93 eax_702 = LoadResource(*(esp_664 - 0x0C), *(esp_664 - 0x08));
		esp_108 = esp_664 - 0x04;
		eax_705 = eax_702;
	} while (eax_702 != 0x00);
	*(esp_664 - 0x08) = (union Eq_93 *) eax_39;
	*(esp_664 - 0x0C) = 0x00;
	LoadResource(*(esp_664 - 0x0C), *(esp_664 - 0x08));
	*(esp_664 - 0x08) = 0x6328;
	GetOEMCP();
	*(esp_664 - 0x0C) = 4366336;
	GetCurrentThreadId();
	edx = fn00425A46(dwArg00, dwArg04, dwArg08, out ebp_106);
	GetOEMCP();
	dl = (byte) edx;
	dx = (word16) edx;
	dh = SLICE(edx, byte, 8);
	esp_108 = esp_664;
l00425B59:
	struct Eq_115 * esp_121 = esp_108 - 0x04;
	esp_121->t0000 = ebp_106 - 0x14;
	GetOEMCP();
	*(esp_121 - 0x04) = 0x40;
	*(ebp_106 - 0x0C) = (LPSTR *) GetCommandLineA();
	*(esp_121 - 0x08) = 0x6328;
	GetCurrentProcessId();
	*(esp_121 - 0x0C) = 4366336;
	VirtualProtect(*(esp_121 - 0x0C), *(esp_121 - 0x08), *(esp_121 - 0x04), esp_121->t0000);
	GetACP();
	Eq_182 esi_136 = esp_121->t0004;
	struct Eq_186 * edi_138 = esp_121->ptr0008;
	GetACP();
	word32 ebx_141 = esp_121->dw000C;
	struct Eq_196 * ebp_144 = *ebp_106;
	Eq_200 esp_145 = (char *) ebp_106 + 0x04;
	*(esp_145 - 0x04) = 0x00;
	*(esp_145 - 0x08) = *(ebp_144 - 0x04);
	GetFileSize(*(esp_145 - 0x08), *(esp_145 - 0x04));
	*(esp_145 - 0x04) = 0x00;
	*(esp_145 - 0x08) = *(ebp_144 - 0x04);
	Eq_88 eax_158 = GetFileSize(*(esp_145 - 0x08), *(esp_145 - 0x04));
	byte bl_142 = (byte) ebx_141;
	byte ah_160 = SLICE(eax_158, byte, 8);
	Eq_410 ecx_263;
	Eq_411 esp_250;
	byte bh_163 = edi_138->b004D;
	*(esp_145 - 0x04) = (struct Eq_186 **) edi_138;
	ci8 ah_169 = ah_160 + bl_142 + bl_142;
	ui32 ebx_164 = DPB(ebx_141, bh_163, 8);
	Eq_411 esp_166 = esp_145 - (struct Eq_795 *) 0x04;
	byte al_168 = (byte *) 0x4D7FE300;
	Eq_88 eax_170 = DPB(eax_158, ah_169, 8);
	byte SCZO_172 = cond(ah_169);
	if (ah_169 <= 0x00)
	{
		int32 ebx_268 = ebx_164 & esp_145 - (struct Eq_795 *) 0x04;
		byte bh_269 = SLICE(ebx_268, byte, 8);
		ci8 bl_270 = (byte) ebx_268;
		Eq_444 CZ_278 = DPB(SCZO_172, false, 0);
		if (ebx_268 <= 0x00)
		{
			if (!CZ_278)
			{
				bool C_300;
				Eq_460 al_292;
				if (ebx_268 <= 0x00)
				{
					if (false)
						return eax_170;
					*(esp_145 - 0x06) = cs;
					al_292.u0 = 0x6A;
					C_300 = (bool) cond(DPB(eax_170, 0x6A, 0) - (esi_136 + 0x01));
l0042A049:
					edi_138->t0000 = al_292;
					__outb(0x5C, al_292);
					if (!C_300)
						__cli();
				}
				Eq_463 SCZDOP_410;
				bool Z_359;
				struct Eq_186 * edi_328 = edi_138 - 0x01;
				DWORD eax_330 = DPB(eax_170, al_168 | 161, 0);
				bool S_335 = (bool) cond(al_168 | 161);
				byte ah_338;
				byte al_337;
				Eq_478 C_339 = __aas(al_168 | 161, ah_169, &al_337, &ah_338);
				if (OVERFLOW(al_168 | 161))
				{
					eax_330 = (Eq_468) ((word32) C_339 + ((word32) eax_330 + *(edi_138 - 0x3F)));
					Eq_463 SCZO_604 = cond(eax_330);
					ecx = ecx - 0x01;
					ah_338 = SLICE(eax_330, byte, 8);
					al_337 = (byte) eax_330;
					C_339 = (bool) SCZO_604;
					S_335 = (bool) SCZO_604;
					SCZDOP_410 = SCZO_604;
					*(esp_145 - 0x06) = ss;
					esp_166 = esp_145 - (struct Eq_795 *) 0x06;
					if (eax_330 != 0x00)
						goto l0042A0C0;
				}
				esp_166 = esp_166 - 0x02;
				*esp_166 = ss;
				if (S_335)
					;
				bl_270 = (ci8) ((word32) C_339 + (bl_270 + ah_338));
				Z_359 = (bool) cond(bl_270);
				if (bl_270 > 0x00)
					goto l0042A0FB;
				Eq_572 eax_567 = DPB(eax_330, al_337 | ~0x58, 0);
				eax_567->dw0065 = eax_567->dw0065 - ebp_144;
				Eq_463 ebp_572 = ebp_144->t0000;
				ah_338 = (byte) *((word32) ebp_572 + 0x0078);
				Mem577[ebp_144 + 0x02:word16] = ds;
				__wait();
				esp_166 = ebp_144 + 0x02;
				esi_136 = esi_136 - 0x01;
				ecx = (word32) ecx + 0x01;
				ebp_144 = (word32) ebp_572 + 0x01;
l0042A0BE:
				dl = dl + bh_269;
				Eq_463 SCZO_526 = cond(dl);
				edx = DPB(edx, dl, 0);
				dx = DPB(dx, dl, 0);
				C_339 = (bool) SCZO_526;
				SCZDOP_410 = SCZO_526;
l0042A0C0:
				Eq_604 esp_413 = esp_166 - 0x04;
				*esp_413 = SCZDOP_410;
				edi_328->t0000.u0 = esi_136->b0000;
				Eq_616 esi_417 = esi_136 - (struct <anonymous> *) 0x01;
				al_292.u0 = esi_417->b0000;
				*(esp_413 - 0x02) = ss;
				edi_138 = edi_328 - 0x01 - ebp_144 - C_339;
				esi_136 = esi_417 - (struct <anonymous> *) 0x01;
				bool C_429 = (bool) cond(edi_138);
				if (edi_138 != null)
				{
					ci8 ah_483 = ah_338 + bl_270;
					C_300 = (bool) cond(ah_483);
					if (ah_483 <= 0x00)
					{
						Eq_88 eax_495 = (DWORD *) 0xAB8D2B68;
						__outb(0x3F, (byte) eax_495);
						edi_138->t0000 = __in(dx);
						(DWORD *) 3757975243 = (DWORD *) eax_495;
						return eax_495;
					}
					goto l0042A049;
				}
				*(esp_413 - 0x06) = esi_417 - (struct <anonymous> *) 0x01;
				*ecx = __rcr(*ecx, 0x5C, C_429);
				*(esp_413 - 0x0A) = esp_413 - (struct Eq_795 *) 0x06;
				*(esp_413 - 0x0E) = 0x53;
				word32 eax_450 = __indw(dx);
				Eq_460 al_451 = (byte) eax_450;
				(union Eq_460 *) 0x6A0A01FA = (union Eq_460 *) al_451;
				__sti();
				edi_138->t0000 = al_451;
				int3();
				esp_166 = esp_413 - (struct Eq_795 *) 0x0E;
				ah_338 = 0x49;
				struct Eq_728 * eax_454 = DPB(eax_450, 0x49, 8);
				edi_328 = edi_138;
				do
				{
					word32 ebx_470 = eax_454->dw2DBCE215;
					__cli();
					bh_269 = SLICE(ebx_470, byte, 8);
					bl_270 = (byte) ebx_470;
					ebp_144 = edx;
					Z_359 = (bool) cond(al_451 & 0x4E);
				} while ((al_451 & 0x4E) >= 0x00);
l0042A0FB:
				ecx = ecx - 0x01;
				if (!Z_359 || ecx == 0x00)
				{
					*(ecx - 113) = *(ecx - 113) >> 0x01;
					null[edx].b0000 = dh;
				}
				goto l0042A0BE;
			}
			goto l0042A024;
		}
		*((word32) ecx - 0x4EAB41B9) = (int32) trunc(rArg0);
		esp_250 = esp_166;
		ecx_263 = ecx;
	}
	else
	{
		*(edi_138 - 66) = ebx_164;
		*(esp_145 - 0x08) = esp_145 - (struct Eq_795 *) 0x04;
		esp_250 = esp_145 - (struct Eq_795 *) 0x08;
		ecx_263 = DPB(ecx, 0x45, 0);
	}
	Mem265[esp_250 + ecx_263:word32] = Mem167[esp_250 + ecx_263:word32] - ecx_263;
l0042A024:
	word32 esp_214;
	word32 ebp_215;
	byte SCZO_216;
	word32 ebx_217;
	word32 edi_218;
	word32 esi_219;
	Eq_88 eax_220;
	bool Z_221;
	byte SZO_222;
	bool C_223;
	byte bh_224;
	byte ah_225;
	byte bl_226;
	byte al_227;
	byte CZ_228;
	struct Eq_653 * cs_229;
	word32 ecx_230;
	byte dl_231;
	real64 rArg0_232;
	bool O_233;
	byte cl_234;
	struct Eq_659 * ss_235;
	bool D_236;
	bool S_237;
	struct Eq_662 * ds_238;
	byte SCZDOP_239;
	bool FPUF_240;
	word32 edx_241;
	word16 dx_242;
	byte SO_243;
	byte dh_244;
	fn00429FD7();
	return eax_220;
}

