// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	globals->ptr4023C0 = &globals->t400000;
	fn004013DA();
	fn0040136C();
	fn00401164();
	return fn00401449();
}

// 00401084: void fn00401084(Stack Eq_18 dwArg04, Stack (ptr32 byte) dwArg08, Stack Eq_20 dwArg0C)
void fn00401084(Eq_18 dwArg04, byte * dwArg08, Eq_20 dwArg0C)
{
	Eq_18 edi_13 = dwArg04;
	byte * esi_15 = dwArg08;
	Eq_20 ecx_17 = dwArg0C;
	while (ecx_17 != 0x00)
	{
		*edi_13 = *esi_15;
		esi_15 = esi_15 + 0x01;
		edi_13 = (word32) edi_13 + 0x01;
		ecx_17 = ecx_17 - 0x01;
	}
}

// 0040109A: Register word32 fn0040109A()
word32 fn0040109A()
{
	uint64 edx_eax_18 = (uint64) (uint32) globals->dw4023C4;
	uint32 edx_26 = (uint32) (edx_eax_18 % 0x20);
	int32 v16_32 = globals->dw4023E0;
	byte dl_27 = (byte) edx_26;
	word32 * ebx_30 = (word32) globals->t4023C8 + ((uint32) (edx_eax_18 /u 0x20) << 0x02);
	int32 edi_35 = v16_32;
	word32 eax_39 = 0x00;
	do
	{
		edi_35 = edi_35 - 0x01;
		uint32 esi_53 = __bswap(*ebx_30) << dl_27;
		if (esi_53 >> 0x1F != 0x00)
			eax_39 = eax_39 + ((esi_53 >> 0x1F) << (byte) edi_35);
		edx_26 = edx_26 + 0x01;
		dl_27 = (byte) edx_26;
		if (edx_26 == 0x20)
		{
			ebx_30 = ebx_30 + 0x01;
			edx_26 = 0x00;
			dl_27 = 0x00;
		}
	} while (edi_35 != 0x00);
	globals->dw4023C4 = globals->dw4023C4 + v16_32;
	return eax_39;
}

// 00401164: void fn00401164()
void fn00401164()
{
	struct Eq_3 * eax_13 = globals->ptr4023C0;
	Eq_20 ecx_16 = eax_13->t4074;
	globals->t4023D0 = ecx_16;
	globals->dw4023D4 = ecx_16 << 0x03;
	Eq_112 eax_27 = HeapCreate(0x01, 0x00, 0x00);
	globals->t4023F0 = eax_27;
	Eq_18 eax_37 = HeapAlloc(eax_27, 0x08, globals->t4023D0);
	globals->t4023C8 = eax_37;
	Mem42[0x004023CC:word32] = eax_37 + Mem39[0x004023D0:word32];
	fn00401084(globals->t4023C8, (char *) &eax_13->t4074 + 0x0014, globals->t4023D0);
	Eq_18 edi_52 = globals->t4023C8;
	Eq_20 ecx_53 = globals->t4023D0;
	do
	{
		*edi_52 = *edi_52 - 0x33;
		edi_52 = (word32) edi_52 + 0x01;
		ecx_53 = ecx_53 - 0x01;
	} while (ecx_53 != 0x00);
	globals->t4023C8 = (word32) globals->t4023C8 + 0x01;
}

// 00401284: void fn00401284()
void fn00401284()
{
	struct Eq_175 * ebx_15 = (word32) globals->t4023D8 + 0x01;
	byte cl_13 = 0x00;
	Eq_182 ecx_12 = 0x0100;
	do
	{
		ebx_15->b0000 = 0x01;
		ebx_15->b0000 = cl_13;
		cl_13 = cl_13 + 0x01;
		ebx_15 = ebx_15 + 0x01;
		ecx_12 = DPB(ecx_12, cl_13, 0);
	} while (cl_13 != 0x00);
	globals->t4023DC = ecx_12;
}

// 004012A7: void fn004012A7()
void fn004012A7()
{
	word32 ecx_14 = (word32) globals->a4022CC;
	byte * ebx_11 = (word32) globals->t4023D8 + (word32) (globals->t4023DC * 0xA0);
	*ebx_11 = (byte) ecx_14;
	byte * esi_16 = globals->a4022CD;
	byte * edi_20 = ebx_11 + 0x01;
	while (ecx_14 != 0x00)
	{
		*edi_20 = *esi_16;
		esi_16 = esi_16 + 0x01;
		edi_20 = edi_20 + 0x01;
		ecx_14 = ecx_14 - 0x01;
	}
	globals->t4023DC = (word32) globals->t4023DC + 0x01;
	fn004012D9();
}

// 004012D9: void fn004012D9()
void fn004012D9()
{
	if (globals->t4023DC == 0x0200)
	{
		globals->t4023DC.u0 = 0x0100;
		globals->dw4023E0 = 0x09;
	}
}

// 004012FC: Register word32 fn004012FC()
word32 fn004012FC()
{
	byte al_6 = globals->a4022CD;
	globals->b402414 = al_6;
	return DPB(eax, al_6, 0);
}

// 0040130A: void fn0040130A(Stack Eq_261 dwArg04)
void fn0040130A(Eq_261 dwArg04)
{
	byte * ebx_37 = (word32) globals->t4023D8 + (word32) (dwArg04 * 0xA0);
	byte * edi_29 = globals->a4022CC;
	word32 ecx_40 = (word32) *ebx_37 + 0x01;
	byte * esi_42 = ebx_37;
	while (ecx_40 != 0x00)
	{
		*edi_29 = *esi_42;
		esi_42 = esi_42 + 0x01;
		edi_29 = edi_29 + 0x01;
		ecx_40 = ecx_40 - 0x01;
	}
}

// 00401332: void fn00401332()
void fn00401332()
{
	globals->a4022CC = globals->a4022CC + 0x01;
	((word32) globals->a4022CC)->b4022CC = globals->b402414;
}

// 00401348: void fn00401348()
void fn00401348()
{
	word32 ecx_33 = (word32) globals->a4022CC;
	byte * edi_31 = (word32) globals->t4023E8 + globals->dw4023EC;
	globals->dw4023EC = globals->dw4023EC + ecx_33;
	byte * esi_37 = globals->a4022CD;
	while (ecx_33 != 0x00)
	{
		*edi_31 = *esi_37;
		esi_37 = esi_37 + 0x01;
		edi_31 = edi_31 + 0x01;
		ecx_33 = ecx_33 - 0x01;
	}
}

// 0040136C: void fn0040136C()
void fn0040136C()
{
	Eq_112 eax_14 = CreateThread(null, 0x00, &globals->t4013D9, 0x00, 0x04, null);
	globals->t4023FC = eax_14;
	ptr32 esp_17;
	word32 eax_18;
	word32 esi_19;
	globals->t40240C();
	globals->dw4023F8 = eax_18;
	globals->dw402000 = 0x00010002;
	*(esp_17 - 0x04) = 0x00402000;
	*(esp_17 - 0x08) = (HANDLE *) globals->t4023FC;
	GetThreadContext(*(esp_17 - 0x08), *(esp_17 - 0x04));
	globals->dw4020B0 = 0x0040104C;
	*(esp_17 - 0x04) = 0x00402000;
	*(esp_17 - 0x08) = (HANDLE *) globals->t4023FC;
	SetThreadContext(*(esp_17 - 0x08), *(esp_17 - 0x04));
	*(esp_17 - 0x04) = (HANDLE *) globals->t4023FC;
	ResumeThread(*(esp_17 - 0x04));
	*(esp_17 - 0x04) = globals->dw4023F8;
	SuspendThread(*(esp_17 - 0x04));
}

// 004013DA: void fn004013DA()
void fn004013DA()
{
	Eq_452 eax_10 = fs->ptr0000->dw0004 & 0xFFFF0000;
	do
		eax_10 = eax_10 - 0x00010000;
	while (eax_10->unused != 23117);
	globals->t402404 = eax_10;
	globals->t402408 = GetProcAddress(eax_10, &globals->t401408);
	globals->t40240C = GetProcAddress(globals->t402404, &globals->t401415);
}

// 00401449: Register Eq_261 fn00401449()
Eq_261 fn00401449()
{
	Eq_112 eax_20 = HeapCreate(0x01, 0x00, 0x00);
	globals->t4023F4 = eax_20;
	globals->t4023E8 = HeapAlloc(eax_20, 0x08, 60000);
	Eq_112 eax_38 = HeapCreate(0x01, 0x00, 0x00);
	globals->t402400 = eax_38;
	globals->t4023D8 = HeapAlloc(eax_38, 0x08, 0x00C35000);
	fn00401284();
	globals->dw4023E0 = 0x09;
	Eq_261 eax_54 = fn0040109A();
	fn0040130A(eax_54);
	fn00401348();
	Eq_261 dwLoc0C_55 = eax_54;
	Eq_261 eax_59 = fn004012FC();
	while (globals->dw4023D4 - globals->dw4023C4 >= globals->dw4023E0)
	{
		Eq_261 eax_72 = fn0040109A();
		if (eax_72 > globals->t4023DC - 0x01)
		{
			fn0040130A(dwLoc0C_55);
			fn00401332();
		}
		else
			fn0040130A(eax_72);
		fn00401348();
		fn004012FC();
		fn0040130A(dwLoc0C_55);
		fn00401332();
		fn004012A7();
		eax_59 = eax_72;
		dwLoc0C_55 = eax_72;
	}
	return eax_59;
}

