// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 004160C6: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 ecx_10 = ~0x0001869F;
	do
		ecx_10 = ecx_10 - 0x01;
	while (ecx_10 != 0x00);
	ptr32 ebx_46 = globals->ptr4161D0;
	word32 * esi_47 = ebx_46 + 77286;
	while (true)
	{
		int32 eax_63 = *esi_47;
		word16 ax_64 = (word16) eax_63;
		int32 * esi_65 = esi_47 + 0x01;
		if (eax_63 == 0x00)
			break;
		word32 eax_72 = DPB(eax_63, ax_64, 0);
		byte * edi_81 = ebx_46 + *esi_65;
		fn00416290(eax_72, esi_65 + 0x01, esi_65 + 0x01);
		fn00416186(4284856, esi_65 + 0x01, edi_81);
		esi_47 = esi_65 + 0x01 + eax_63;
	}
	struct Eq_17 * esp_104;
	word32 ecx_105;
	byte SZO_106;
	bool C_107;
	word32 edx_108;
	byte SCZO_109;
	word16 dx_110;
	word32 eax_111;
	word32 ebx_112;
	word32 ebp_113;
	word32 esi_114;
	word32 edi_115;
	word16 ax_116;
	word16 cx_117;
	bool D_118;
	bool Z_119;
	(ebx_46 + 52712)();
	Eq_2 eax_133 = esp_104->t001C;
	esp_104->t001C = 0x00401272;
	return eax_133;
}

// 00416186: void fn00416186(Register Eq_64 ebp, Register (ptr32 byte) esi, Register (ptr32 byte) edi)
void fn00416186(Eq_64 ebp, byte * esi, byte * edi)
{
	struct Eq_80 * esp_110 = fp - 0x20;
	bui8 dl_112 = 0x80;
	word32 ebx_125 = 0x00;
	while (true)
	{
		*edi = *esi;
		byte * esi_109 = esi + 0x01;
		edi = edi + 0x01;
		ebx_125 = DPB(ebx_125, 0x02, 0);
		while (!fn00416200(dl_112, esi_109, out dl_112, out esi))
		{
			Eq_64 eax_121;
			Eq_102 ecx_102;
			Eq_64 eax_129;
			bui8 dl_79;
			byte * esi_80;
			if (fn00416200(dl_112, esi, out dl_79, out esi_80))
			{
				bui8 dl_226;
				byte * esi_227;
				uint32 ecx_229 = fn0041620C(0x00, dl_79, esi_80, out dl_226, out esi_227) - ebx_125;
				if (ecx_229 == 0x00)
				{
					ecx_102 = fn0041620A(dl_226, esi_227, out dl_112, out esi_109);
					esp_110 = (struct Eq_80 *) ((char *) esp_110 - 0x04);
					goto l004161F2;
				}
				eax_129 = DPB(ecx_229 - 0x01 << 0x08, *esi_227, 0);
				ecx_102 = fn0041620A(dl_226, esi_227 + 0x01, out dl_112, out esi_109);
				esp_110 = (struct Eq_80 *) ((char *) esp_110 - 0x04);
				if (eax_129 < 0x7D00)
				{
					if (ecx_229 >= 0x06)
						goto l004161F0;
					if (eax_129 <= 0x7F)
						goto l004161EF;
				}
				else
				{
l004161EF:
					ecx_102.u1 = (word32) ecx_102.u1 + 0x01;
l004161F0:
					ecx_102.u1 = (word32) ecx_102.u1 + 0x01;
				}
				ebp = eax_129;
l004161F2:
				eax_121 = ebp;
				ebx_125 = DPB(ebx_125, 0x01, 0);
l004161F6:
				byte ** esp_96 = esp_110 - 0x04;
				*esp_96 = (byte **) esi_109;
				byte * esi_101 = edi - eax_121;
				while (ecx_102 != 0x00)
				{
					*edi = *esi_101;
					esi_101 = esi_101 + 0x01;
					edi = edi + 0x01;
					ecx_102 = ecx_102 - 0x01;
				}
				esi_109 = (byte *) *esp_96;
				esp_110 = (struct Eq_80 *) ((char *) esp_96 + 0x04);
				continue;
			}
			if (fn00416200(dl_79, esi_80, out dl_112, out esi_109))
			{
				uint32 eax_196 = (word32) *esi_109;
				esi_109 = esi_109 + 0x01;
				eax_129 = eax_196 >> 0x01;
				if (eax_196 >> 0x01 == 0x00)
				{
					esp_110[0x07] = (struct Eq_80) (edi - esp_110[0x0A]);
					return;
				}
				ecx_102 = eax_196 >> 0x01 < 0x00;
				goto l004161EF;
			}
			ebx_125 = DPB(ebx_125, 0x02, 0);
			ecx_102.u1 = 0x01;
			uint8 al_177 = 0x10;
			eax_121.u0 = 0x10;
			do
			{
				al_177 = al_177 * 0x02 + fn00416200(dl_112, esi_109, out dl_112, out esi_109);
				eax_121 = DPB(eax_121, al_177, 0);
			} while (al_177 >= 0x00);
			if (al_177 != 0x00)
				goto l004161F6;
			*edi = al_177;
			edi = edi + 0x01;
		}
	}
}

// 00416200: FlagGroup bool fn00416200(Register bui8 dl, Register (ptr32 byte) esi, Register out Eq_110 dlOut, Register out (ptr32 byte) esiOut)
bool fn00416200(bui8 dl, byte * esi, Eq_110 & dlOut, byte * & esiOut)
{
	*esiOut = esi;
	byte dl_3;
	*dlOut = dl * 0x02;
	bool C_14 = (bool) cond(dl * 0x02);
	if (dl * 0x02 == 0x00)
	{
		ui8 dl_20 = *esi * 0x02 + (dl * 0x02 < 0x00);
		*dlOut = dl_20;
		word32 esi_19;
		*esiOut = esi + 0x01;
		C_14 = (bool) cond(dl_20);
	}
	return C_14;
}

// 0041620A: Register word32 fn0041620A(Register bui8 dl, Register (ptr32 byte) esi, Register out Eq_226 dlOut, Register out (ptr32 byte) esiOut)
word32 fn0041620A(bui8 dl, byte * esi, Eq_226 & dlOut, byte * & esiOut)
{
	byte dl_7;
	word32 esi_8;
	return fn0041620C(0x00, dl, esi, out dl_7, out esi_8);
}

// 0041620C: Register ui32 fn0041620C(Register ui32 ecx, Register bui8 dl, Register (ptr32 byte) esi, Register out Eq_123 dlOut, Register out ptr32 esiOut)
ui32 fn0041620C(ui32 ecx, bui8 dl, byte * esi, Eq_123 & dlOut, ptr32 & esiOut)
{
	ui32 ecx_13 = ecx + 0x01;
	do
	{
		bui8 dl_10;
		byte * esi_11;
		ecx_13 = ecx_13 * 0x02 + fn00416200(dl, esi, out dl_10, out esi_11);
	} while (fn00416200(dl_10, esi_11, out dl, out esi));
	return ecx_13;
}

// 00416290: void fn00416290(Register word32 ecx, Register (ptr32 byte) esi, Register (ptr32 byte) edi)
void fn00416290(word32 ecx, byte * esi, byte * edi)
{
	do
	{
		byte al_21 = *esi;
		byte * esi_23 = esi + 0x01;
		ui8 al_28 = al_21 ^ 0x6C ^ 0xA8;
		ui8 al_42 = al_28 ^ 0x4B ^ 0xE0 ^ 0x06 ^ 0x11;
		esi = esi_23;
		ui8 al_54 = al_42 ^ 0x23 ^ ~0x28;
		ui8 al_69 = al_54 ^ 0xA0 ^ 0x9A ^ 0x07 ^ ~0x41 ^ 0x2E ^ 0x5D;
		ui8 al_76 = al_69 ^ 0x7D ^ 0x5F;
		ui8 al_84 = al_76 ^ 66 ^ 222;
		*edi = al_84 ^ ~0x50;
		edi = edi + 0x01;
		ecx = ecx - 0x01;
	} while (ecx != 0x00);
}

