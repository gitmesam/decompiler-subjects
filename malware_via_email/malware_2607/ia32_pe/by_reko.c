// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401011: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineW();
	Eq_6 eax_24 = CreateFileA(&globals->t4327EC, 0x60000000, 0x02, null, 0x03, 0x0121, 0x00);
	if (eax_24 == ~0x00)
	{
		Eq_68 eax_122 = GetModuleHandleA(&globals->t4327C8);
		GetTickCount();
		Eq_6 eax_145 = CreateFileA(&globals->t432818, 0x60000000, 0x06, null, 0x03, 0x03, 0x00);
		Eq_87 eax_148 = GetProcAddress(eax_122, &globals->t43280C);
		Eq_6 eax_167 = CreateFileA(&globals->t4327D2, 0x20000000, 0x03, null, 0x03, 0x84, 0x00);
		dwLoc1C = eax_145;
		dwLoc18 = eax_167;
		if (eax_167 == ~0x00)
		{
			GetCurrentProcessId();
			CloseHandle(eax_145);
			int32 eax_193 = eax_148();
			GetCommandLineW();
			GetCurrentProcessId();
			<anonymous> * eax_210 = (eax_193 ^ 0xC0000005) + 0x00401126;
			word32 esp_212;
			word32 ebp_213;
			byte SCZO_214;
			Eq_2 eax_215;
			bool Z_216;
			byte SZO_217;
			bool C_218;
			byte cl_219;
			word32 edx_220;
			word32 ebx_221;
			bool O_222;
			word32 ecx_223;
			word32 edi_224;
			struct Eq_156 * es_225;
			byte al_226;
			eax_210();
			return eax_215;
		}
		CloseHandle(eax_145);
		GetCommandLineW();
		SizeofResource(null, eax_145);
		VirtualProtect(&globals->dw40127F, 55664, 0x40, eax_167);
		GetFileType(eax_24);
	}
	GetCurrentProcessId();
	GetCurrentThreadId();
	CloseHandle(eax_24);
	GetFileSize(dwLoc18, null);
	GetFileType(eax_24);
	CloseHandle(dwLoc1C);
	GetFileType(dwLoc18);
	word32 edx_82;
	byte cl_83 = fn00401205(&globals->dw40127F, 55664, dwLoc20, out edx_82);
	Eq_2 eax_89 = GetCurrentThreadId();
	(eax_89 - (struct <anonymous> *) ~0x3AE414E1)->t0000 = __rcr((eax_89 - (struct <anonymous> *) ~0x3AE414E1)->b0000, cl_83, (bool) cond(eax_89 - 3306941242));
	Eq_172 v26_105 = (eax_89 - (struct <anonymous> *) 3306941146)->t0000 - ebx;
	(eax_89 - (struct <anonymous> *) 3306941146)->t0000 = v26_105;
	if (OVERFLOW(v26_105))
		;
}

// 00401205: Register byte fn00401205(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 edxOut)
byte fn00401205(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & edxOut)
{
	word32 * edx_15 = dwArg04;
	uint32 ecx_10 = dwArg08 >> 0x02;
	do
	{
		*edx_15 = *edx_15 - dwArg0C;
		*edx_15 = *edx_15 ^ 1422211808;
		*edx_15 = -*edx_15;
		*edx_15 = __ror(*edx_15, 0x60);
		*edx_15 = *edx_15 - dwArg0C;
		*edx_15 = *edx_15 ^ dwArg0C;
		ecx_10 = ecx_10 - 0x01;
		edx_15 = edx_15 + 0x01;
		*edxOut = edx_15;
		byte cl_35 = (byte) ecx_10;
	} while (ecx_10 != 0x00);
	return cl_35;
}

