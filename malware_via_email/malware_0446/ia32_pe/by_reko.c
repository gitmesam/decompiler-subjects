// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 esp_13;
	byte SCZO_14;
	word32 esi_15;
	byte SZO_16;
	byte C_17;
	word32 eax_18;
	byte Z_19;
	word32 ebx_20;
	word32 ebp_21;
	word32 edi_22;
	word32 edx_23;
	byte cl_24;
	byte dl_25;
	word32 ecx_26;
	word16 ax_27;
	byte S_28;
	SHLWAPI.dll!StrChrA();
	if (eax_18 != 0x00)
		return 0x00;
	*(esp_13 - 0x04) = ebx_20;
	*(esp_13 - 0x08) = ebp_21;
	*(esp_13 - 0x0C) = edi_22;
	*(esp_13 - 0x10) = 0x0040406C;
	*(esp_13 - 0x14) = 0x00404074;
	*(esp_13 - 0x18) = (HMODULE *) LoadLibraryA(*(esp_13 - 0x14));
	Eq_62 eax_51 = GetProcAddress(*(esp_13 - 0x18), *(esp_13 - 0x14));
	*(esp_13 - 0x1C) = 0x00;
	*(esp_13 - 0x20) = 0x00;
	*(esp_13 - 0x24) = 0x00;
	*(esp_13 - 0x28) = 0x00;
	*(esp_13 - 44) = 0x00;
	int32 eax_67 = eax_51();
	*(esp_13 - 0x30) = ~0x00;
	*(esp_13 - 0x34) = ~0x00;
	struct Eq_121 * edi_348 = eax_67 + 0x1C;
	if (AreAllAccessesGranted(*(esp_13 - 0x34), *(esp_13 - 0x30)) == 0x00)
		edi_348 = eax_67 + 0x1C ^ 0x0E;
	*(esp_13 - 0x38) = esp_13 - 0x24;
	*(esp_13 - 0x3C) = 0x40;
	*(esp_13 - 0x40) = 0x3000;
	*(esp_13 - 0x44) = 0x00401000;
	VirtualProtect(*(esp_13 - 0x44), *(esp_13 - 0x40), *(esp_13 - 0x3C), *(esp_13 - 0x38));
	struct Eq_192 * esp_97 = esp_13 - 0x44;
	struct Eq_194 * eax_101 = null;
	do
	{
		struct Eq_121 * esi_112;
		if (esi_112 == edi_348)
			esi_112 = null;
		eax_101[1051014] = (struct Eq_194) (esi_112[0x00405000] ^ eax_101[1051014] ^ ~0x01);
		struct Eq_121 * esi_120 = esi_112 + 0x01;
		if (esi_120 == edi_348)
			esi_120 = null;
		eax_101->b402619 = esi_120[0x00405000] ^ eax_101->b402619 ^ ~0x01;
		struct Eq_121 * esi_130 = esi_120 + 0x01;
		if (esi_130 == edi_348)
			esi_130 = null;
		eax_101->b40261A = esi_130[0x00405000] ^ eax_101->b40261A ^ ~0x01;
		struct Eq_121 * esi_140 = esi_130 + 0x01;
		if (esi_140 == edi_348)
			esi_140 = null;
		eax_101 = eax_101 + 0x01;
		eax_101->b402617 = esi_140[0x00405000] ^ eax_101->b40261B ^ ~0x01;
		esi_112 = esi_140 + 0x01;
	} while (eax_101 < (struct Eq_194 *) 5152);
	*(esp_13 - 0x30) = 0x00;
	struct Eq_277 * edi_158 = &globals->t4038F8;
	up32 ebx_160 = 0x00;
	do
	{
		Eq_283 eax_171 = edi_158->t0004;
		cui16 * ecx_177 = (char *) &edi_158->t0004 + 0x04;
		if (eax_171 - 0x08 >> 0x01 > 0x00)
		{
			uint32 esi_310 = eax_171 - 0x08 >> 0x01;
			do
			{
				if ((*ecx_177 & 0xF000) == 0x3000)
				{
					struct Eq_309 * eax_331 = ((word32) *ecx_177 & 0x0FFF) + edi_158->dw0000;
					eax_331->dw402398 = eax_331->dw402398 + 0xF0402398;
				}
				ecx_177 = ecx_177 + 0x01;
				esi_310 = esi_310 - 0x01;
			} while (esi_310 != 0x00);
			ebx_160 = *(esp_13 - 0x30);
		}
		ebx_160 = (word32) edi_158->t0004 + ebx_160;
		*(esp_13 - 0x30) = ebx_160;
		edi_158 = edi_158 + Mem187[edi_158 + 0x04:word32];
	} while (ebx_160 < 228);
	*(esp_13 - 44) = 0x004030F4;
	struct Eq_342 * ebx_192 = &globals->t4030F4;
	ebx_221 = ebx_192;
	esp_223 = esp_97;
	if (globals->dw403104 != 0x00)
	{
		do
		{
			struct Eq_342 * ebx_221;
			struct Eq_192 * esp_223;
			esp_223 = esp_223 - 0x04;
			esp_223->dw0000 = ebx_221->dw000C + 0x00402398;
			Eq_56 eax_230 = LoadLibraryA(esp_223->dw0000);
			esp_223[0x05] = (struct Eq_192) eax_230;
			if (eax_230 != null)
			{
				word32 edi_253 = ebx_221->dw0000;
				if (edi_253 == 0x00)
					edi_253 = ebx_221->dw0010;
				word32 * edi_258 = edi_253 + 0x00402398;
				word32 * esi_262 = ebx_221->dw0010 + 0x00402398;
				if (*edi_258 != 0x00)
				{
					do
					{
						int32 eax_276 = *edi_258;
						word16 ax_277 = (word16) eax_276;
						if (eax_276 < 0x00)
						{
							word32 eax_296 = esp_223[0x05];
							word32 * esp_297 = esp_223 - 0x04;
							*esp_297 = (word32) ax_277;
							*(esp_297 - 0x04) = eax_296;
						}
						else
						{
							word32 edx_301 = esp_223[0x05];
							word32 * esp_305 = esp_223 - 0x04;
							*esp_305 = eax_276 + 0x0040239A;
							*(esp_305 - 0x04) = edx_301;
						}
						esp_223 = esp_223 - 0x08;
						*esi_262 = (word32) GetProcAddress(esp_223->dw0000, esp_223[0x01]);
						edi_258 = edi_258 + 0x01;
						esi_262 = esi_262 + 0x01;
					} while (*edi_258 != 0x00);
					ebx_221 = (struct Eq_342 *) esp_223[0x06];
				}
			}
			ebx_221 = ebx_221 + 0x01;
			esp_223[0x06] = (struct Eq_192) ebx_221;
		} while (ebx_221->dw0010 != 0x00);
	}
	ptr32 esp_199;
	byte SCZO_200;
	word32 esi_201;
	byte SZO_202;
	byte C_203;
	word32 eax_204;
	byte Z_205;
	word32 ebx_206;
	word32 ebp_207;
	word32 edi_208;
	word32 edx_209;
	byte cl_210;
	byte dl_211;
	word32 ecx_212;
	word16 ax_213;
	byte S_214;
	globals->t402DE8();
	*(esp_199 - 0x04) = 0x00;
	ExitProcess(*(esp_199 - 0x04));
}

