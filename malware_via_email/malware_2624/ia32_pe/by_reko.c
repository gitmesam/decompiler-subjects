// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: Register Eq_2 fn00401028(Register Eq_2 eax, Register word32 edx, Register word32 ebx, Register word32 edi)
DWORD fn00401028(DWORD eax, word32 edx, word32 ebx, word32 edi)
{
	word32 esp_3;
	byte SZO_4;
	Eq_2 eax_5;
	byte SCZO_6;
	DWORD * edi_7;
	struct Eq_12 * edx_8;
	bool Z_9;
	struct Eq_14 * ebx_10;
	word16 bx_11;
	byte al_12;
	fn00400FAC();
	return eax_5;
}

// 00412355: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcessHeap();
	ptr32 esp_51 = fp + ~0x2B;
	do
	{
		LPCSTR * esp_10 = esp_51 - 0x04;
		*esp_10 = (LPCSTR *) &globals->t434CF7;
		Eq_56 eax_12 = GetModuleHandleA(*esp_10);
		GetCommandLineW();
		*esp_10 = (LPCSTR *) &globals->t434D1D;
		GetCurrentThreadId();
		GetVersion();
		*(esp_10 - 0x04) = (HMODULE *) eax_12;
		Eq_82 eax_24 = GetProcAddress(*(esp_10 - 0x04), *esp_10);
		GetCommandLineW();
		GetVersion();
		*esp_10 = (LPCSTR *) null;
		*(esp_10 - 0x04) = 0x00;
		*(esp_10 - 0x08) = 0x00;
		*(esp_10 - 0x0C) = 0x00;
		*(esp_10 - 0x10) = 0x0102;
		*(esp_10 - 0x14) = 0x03;
		*(esp_10 - 0x18) = 0x00;
		*(esp_10 - 0x1C) = 0x03;
		*(esp_10 - 0x20) = 0x40000000;
		*(esp_10 - 0x24) = 0x00434D01;
		Eq_44 eax_50 = CreateFileA(*(esp_10 - 0x24), *(esp_10 - 0x20), *(esp_10 - 0x1C), *(esp_10 - 0x18), *(esp_10 - 0x14), *(esp_10 - 0x10), *(esp_10 - 0x0C));
		esp_51 = esp_10 - 0x08;
	} while (eax_50 != (void *) ~0x00);
	GetCurrentThreadId();
	Eq_208 eax_59 = eax_24();
	GetACP();
	GetCommandLineA();
	<anonymous> * eax_72 = (eax_59 ^ 0xC0000005) + 0x00412419;
	ptr32 esp_74;
	word32 ebp_75;
	byte SCZO_76;
	word32 eax_77;
	bool Z_78;
	byte SZO_79;
	bool C_80;
	word32 edx_81;
	word32 ebx_82;
	word32 edi_83;
	eax_72();
	GetCurrentProcessId();
	*(esp_74 - 0x04) = (FARPROC *) eax_24;
	*(esp_74 - 0x08) = 0x00;
	SizeofResource(*(esp_74 - 0x08), *(esp_74 - 0x04));
	do
	{
		*(esp_74 - 0x04) = fp - 0x0C;
		GetACP();
		*(esp_74 - 0x08) = 0x40;
		GetProcessHeap();
		*(esp_74 - 0x0C) = 0x0001106D;
		GetCommandLineA();
		*(esp_74 - 0x10) = 0x00401000;
		GetCurrentProcessId();
		VirtualProtect(*(esp_74 - 0x10), *(esp_74 - 0x0C), *(esp_74 - 0x08), *(esp_74 - 0x04));
		*(esp_74 - 0x04) = 0x00;
		*(esp_74 - 0x08) = 288;
		*(esp_74 - 0x0C) = 0x03;
		*(esp_74 - 0x10) = 0x00;
		*(esp_74 - 0x14) = 0x04;
		*(esp_74 - 0x18) = 0xE0000000;
		*(esp_74 - 0x1C) = 0x00434D07;
	} while (CreateFileA(*(esp_74 - 0x1C), *(esp_74 - 0x18), *(esp_74 - 0x14), *(esp_74 - 0x10), *(esp_74 - 0x0C), *(esp_74 - 0x08), *(esp_74 - 0x04)) != (void *) ~0x00);
	*(esp_74 - 0x04) = (union Eq_208 *) eax_59;
	GetCurrentThreadId();
	*(esp_74 - 0x08) = 0x0001106D;
	*(esp_74 - 0x0C) = 0x00401000;
	*(esp_74 - 0x10) = 0x00;
	*(esp_74 - 0x14) = (HANDLE *) eax_50;
	GetFileSize(*(esp_74 - 0x14), *(esp_74 - 0x10));
	*(esp_74 - 0x10) = (HANDLE *) eax_50;
	CloseHandle(*(esp_74 - 0x10));
	ptr32 esp_152;
	word32 ebp_153;
	byte SCZO_154;
	word32 eax_155;
	bool Z_156;
	byte SZO_157;
	bool C_158;
	word32 edx_159;
	word32 ebx_160;
	word32 edi_161;
	(eax_59 - ~0x40412505)();
	*(esp_152 - 0x04) = (HANDLE *) eax_50;
	return fn00401028(GetFileType(*(esp_152 - 0x04)), edx_159, ebx_160, edi_161);
}

