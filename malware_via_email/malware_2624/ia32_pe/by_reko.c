// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: Register Eq_2 fn00401028(Register Eq_2 eax, Register word32 edx, Register word32 ebx, Register word32 edi)
DWORD fn00401028(DWORD eax, word32 edx, word32 ebx, word32 edi)
{
	word32 esp_3;
	byte SZO_4;
	word32 eax_5;
	byte SCZO_6;
	word32 * edi_7;
	struct Eq_12 * edx_8;
	byte Z_9;
	struct Eq_14 * ebx_10;
	word16 bx_11;
	byte al_12;
	fn00400FAC();
	return eax_5;
}

// 00412355: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcessHeap();
	ptr32 esp_46 = fp + ~0x2B;
	do
	{
		LPCSTR * esp_10 = esp_46 - 0x04;
		*esp_10 = (LPCSTR *) &globals->t434CF7;
		Eq_56 eax_12 = GetModuleHandleA(*esp_10);
		GetCommandLineW();
		*(esp_10 - 0x04) = 0x00434D1D;
		GetCurrentThreadId();
		GetVersion();
		*(esp_10 - 0x08) = (HMODULE *) eax_12;
		Eq_84 eax_23 = GetProcAddress(*(esp_10 - 0x08), *(esp_10 - 0x04));
		GetCommandLineW();
		GetVersion();
		*(esp_10 - 0x0C) = 0x00;
		*(esp_10 - 0x10) = 0x00;
		*(esp_10 - 0x14) = 0x00;
		*(esp_10 - 0x18) = 0x00;
		*(esp_10 - 0x1C) = 0x0102;
		*(esp_10 - 0x20) = 0x03;
		*(esp_10 - 0x24) = 0x00;
		*(esp_10 - 0x28) = 0x03;
		*(esp_10 - 44) = 0x40000000;
		*(esp_10 - 0x30) = 0x00434D01;
		esp_46 = esp_10 - 0x30;
		Eq_44 eax_48 = CreateFileA(*(esp_10 - 0x30), *(esp_10 - 44), *(esp_10 - 0x28), *(esp_10 - 0x24), *(esp_10 - 0x20), *(esp_10 - 0x1C), *(esp_10 - 0x18));
	} while (eax_48 != (void *) ~0x00);
	GetCurrentThreadId();
	Eq_213 eax_56 = eax_23();
	GetACP();
	GetCommandLineA();
	<anonymous> * eax_70 = (eax_56 ^ 0xC0000005) + 0x00412419;
	ptr32 esp_72;
	word32 ebp_73;
	byte SCZO_74;
	word32 eax_75;
	byte Z_76;
	byte SZO_77;
	byte C_78;
	bcuisposr0 None_79;
	word32 edx_80;
	word32 ebx_81;
	word32 edi_82;
	eax_70();
	GetCurrentProcessId();
	*(esp_72 - 0x04) = (FARPROC *) eax_23;
	*(esp_72 - 0x08) = 0x00;
	SizeofResource(*(esp_72 - 0x08), *(esp_72 - 0x04));
	ptr32 esp_118 = esp_72 - 0x08;
	do
	{
		PDWORD * esp_92 = esp_118 - 0x04;
		*esp_92 = (PDWORD *) (fp - 0x0C);
		GetACP();
		*(esp_92 - 0x04) = 0x40;
		GetProcessHeap();
		*(esp_92 - 0x08) = 0x0001106D;
		GetCommandLineA();
		*(esp_92 - 0x0C) = 0x00401000;
		GetCurrentProcessId();
		VirtualProtect(*(esp_92 - 0x0C), *(esp_92 - 0x08), *(esp_92 - 0x04), *esp_92);
		*(esp_92 - 0x10) = 0x00;
		*(esp_92 - 0x14) = 288;
		*(esp_92 - 0x18) = 0x03;
		*(esp_92 - 0x1C) = 0x00;
		*(esp_92 - 0x20) = 0x04;
		*(esp_92 - 0x24) = 0xE0000000;
		*(esp_92 - 0x28) = 0x00434D07;
		esp_118 = esp_92 - 0x28;
	} while (CreateFileA(*(esp_92 - 0x28), *(esp_92 - 0x24), *(esp_92 - 0x20), *(esp_92 - 0x1C), *(esp_92 - 0x18), *(esp_92 - 0x14), *(esp_92 - 0x10)) != (void *) ~0x00);
	*(esp_92 - 44) = (union Eq_213 *) eax_56;
	GetCurrentThreadId();
	*(esp_92 - 0x30) = 0x0001106D;
	*(esp_92 - 0x34) = 0x00401000;
	*(esp_92 - 0x38) = 0x00;
	*(esp_92 - 0x3C) = (HANDLE *) eax_48;
	GetFileSize(*(esp_92 - 0x3C), *(esp_92 - 0x38));
	*(esp_92 - 0x40) = (HANDLE *) eax_48;
	CloseHandle(*(esp_92 - 0x40));
	ptr32 esp_146;
	word32 ebp_147;
	byte SCZO_148;
	word32 eax_149;
	byte Z_150;
	byte SZO_151;
	byte C_152;
	bcuisposr0 None_153;
	word32 edx_154;
	word32 ebx_155;
	word32 edi_156;
	(eax_56 - ~0x40412505)();
	*(esp_146 - 0x04) = (HANDLE *) eax_48;
	return fn00401028(GetFileType(*(esp_146 - 0x04)), edx_154, ebx_155, edi_156);
}

