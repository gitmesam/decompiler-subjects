// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401060: void fn00401060(Stack Eq_2 dwArg04, Stack Eq_3 dwArg08, Stack Eq_3 dwArg0C)
void fn00401060(Eq_2 dwArg04, Eq_3 dwArg08, Eq_3 dwArg0C)
{
	Eq_3 dwLoc08_16 = 0x00;
	while (dwLoc08_16 < dwArg0C)
	{
		Mem30[dwArg04 + dwLoc08_16:byte] = Mem0[dwArg08 + dwLoc08_16:byte];
		dwLoc08_16 = (word32) dwLoc08_16 + 0x01;
	}
}

// 004010A0: void fn004010A0(Stack Eq_3 dwArg04, Stack Eq_3 dwArg08, Stack Eq_16 dwArg0C)
void fn004010A0(Eq_3 dwArg04, Eq_3 dwArg08, Eq_16 dwArg0C)
{
	if (RegOpenKeyA((struct HKEY__ *) 0x80000002, 0x0040807C, fp - 0x20) != 0x00)
	{
		Eq_30 dl_56 = *dwArg04;
		Eq_16 dwLoc0C_114 = 0x01;
		int32 dwLoc18_112 = 0x00;
		do
		{
			Eq_16 edx_75 = (word32) dwLoc0C_114 + 0x01;
			byte cl_72 = Mem0[dwArg04 + dwLoc0C_114:byte];
			dwLoc0C_114 = edx_75;
			if ((word32) cl_72 == (word32) dl_56)
			{
				if ((word32) Mem0[dwArg04 + edx_75:byte] == 0x00)
				{
					*((word32) dwArg08 + dwLoc18_112) = dl_56;
					dwLoc18_112 = dwLoc18_112 + 0x01;
					dwLoc0C_114 = (word32) edx_75 + 0x01;
				}
				else
				{
					word32 eax_141 = fn004011D0(fp - 0x10, dwArg04 + edx_75) + edx_75;
					dwLoc0C_114 = fn004011D0(fp - 0x24, (word32) dwArg04 + eax_141) + eax_141;
					up32 dwLoc1C_158 = 0x00;
					while (dwLoc1C_158 < dwLoc10)
					{
						*((word32) dwArg08 + dwLoc18_112) = *((word32) dwArg08 + (dwLoc18_112 - dwLoc24));
						dwLoc18_112 = dwLoc18_112 + 0x01;
						dwLoc1C_158 = dwLoc1C_158 + 0x01;
					}
				}
			}
			else
			{
				*((word32) dwArg08 + dwLoc18_112) = cl_72;
				dwLoc18_112 = dwLoc18_112 + 0x01;
			}
		} while (dwLoc0C_114 < dwArg0C);
	}
}

// 004011D0: Register word32 fn004011D0(Stack (ptr ui32) dwArg04, Stack (ptr byte) dwArg08)
word32 fn004011D0(ui32 * dwArg04, byte * dwArg08)
{
	LoadIconA(null, 0x7F00);
	ui32 dwLoc08_14 = 0x00;
	word32 dwLoc10_15 = 0x00;
	do
	{
		ui32 ecx_22 = (word32) *dwArg08;
		ui32 eax_31 = dwLoc08_14 << 0x07 | ecx_22 & 0x7F;
		word32 edx_34 = dwLoc10_15 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_14 = eax_31;
		dwLoc10_15 = edx_34;
	} while ((ecx_22 & 0x80) != 0x00);
	*dwArg04 = eax_31;
	return edx_34;
}

// 00401300: Register Eq_128 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 esp_18;
	word32 ebp_19;
	byte SCZO_20;
	word32 ebx_21;
	word32 esi_22;
	word32 edi_23;
	word32 eax_24;
	byte SZO_25;
	byte C_26;
	byte Z_27;
	word32 ecx_28;
	word32 edx_29;
	struct Eq_141 * fs_30;
	COMCTL32.dll!Ordinal_17();
	LoadCursorA(null, 0x7F00);
	GetCommandLineA();
	Eq_2 eax_39 = GetModuleHandleA(0x00);
	if (RegOpenKeyA((struct HKEY__ *) 0x80000002, 0x004080BC, fp - 0x28) == 0x00)
	{
		struct Eq_168 * eax_103 = globals->ptr404000;
		word32 edx_106 = globals->dw404004;
		struct Eq_168 * dwLoc08_108 = null;
		while (dwLoc08_108 < eax_103)
		{
			dwLoc08_108[0x00080801] = (struct Eq_168) (dwLoc08_108[0x00080801] ^ 0x00891100);
			dwLoc08_108 = dwLoc08_108 + 0x01;
		}
		*(fp - 100) = edx_106;
		globals->dw4080E8 = fn00401960(dwArg00);
		*(fp - 100) = (struct Eq_168 **) eax_103;
		*(fp - 0x68) = globals->dw4080E8;
		*(fp - 0x6C) = 0x00404008;
		fn004010A0(dwArg00, dwArg04, dwArg08);
		globals->ptr4080EC = fs_30->ptr0018;
		globals->dw4080DC = edi_23;
		globals->dw4080D8 = esi_22;
		globals->dw4080E4 = ebx_21;
		globals->ptr4080E0 = fp - 0x04;
		*(fp - 100) = (union Eq_2 *) eax_39;
		word32 ecx_162 = 4199477 - eax_39;
		*(fp - 0x68) = ecx_162;
		ptr32 ebp_166 = fn00401480(dwArg00, dwArg04);
		word32 edx_169 = globals->dw4080E8;
		*(fp - 100) = edx_169;
		word32 eax_172 = fn004015F0(ebp_166, dwArg00);
		*(ebp_166 - 0x38) = 0x00;
		word32 esp_180;
		word32 ebp_181;
		byte SCZO_182;
		word32 ebx_183;
		word32 esi_184;
		word32 edi_185;
		Eq_128 eax_186;
		byte SZO_187;
		byte C_188;
		byte Z_189;
		word32 ecx_190;
		word32 edx_191;
		struct Eq_339 * fs_192;
		globals->ptr4080F0();
		return eax_186;
	}
	else
	{
		*(fp - 100) = 0x00;
		*(fp - 0x68) = 4199040;
		*(fp - 0x6C) = 0x00;
		*(fp - 0x70) = 1000;
		*(fp - 116) = (union Eq_2 *) eax_39;
		DialogBoxParamA(*(fp - 116), *(fp - 0x70), *(fp - 0x6C), *(fp - 0x68), *(fp - 100));
		return 0x00;
	}
}

// 00401480: Register word32 fn00401480(Stack Eq_3 dwArg04, Stack Eq_3 dwArg08)
word32 fn00401480(Eq_3 dwArg04, Eq_3 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem0[dwArg08 + 0x3C:word32];
	globals->t4080D4 = VirtualAlloc(0x00, edx_16->t0050, 0x3000, 0x40);
	if (globals->t4080D4 == 0x00)
		return ebp;
	Eq_2 edx_74 = globals->t4080D4;
	fn00401060(edx_74, dwArg08, edx_16->t0050);
	ui32 eax_79 = globals->t4080D4 - dwArg08;
	if (edx_16->dw00A4 != 0x00)
	{
		struct Eq_409 * dwLoc0C_109 = (word32) dwArg08 + edx_16->dw00A0;
		while (dwLoc0C_109->t0004 != 0x00)
		{
			uint32 eax_124 = dwLoc0C_109->t0004 - 0x08 >> 0x01;
			word16 ecx_127[] = (char *) &dwLoc0C_109->t0004 + 0x04;
			uint32 dwLoc08_130 = 0x00;
			while (dwLoc08_130 < eax_124)
			{
				if ((word32) ecx_127[dwLoc08_130] >> 0x0C == 0x03)
					(word32) globals->t4080D4 + dwLoc0C_109->dw0000 + ((word32) ecx_127[dwLoc08_130] & 0x0FFF) = (struct Eq_454 *) ((word32) globals->t4080D4 + dwLoc0C_109->dw0000 + ((word32) ecx_127[dwLoc08_130] & 0x0FFF) + eax_79);
				dwLoc08_130 = dwLoc08_130 + 0x01;
			}
			dwLoc0C_109 = dwLoc0C_109 + Mem29[dwLoc0C_109 + 0x04:word32];
		}
	}
	word32 eax_91 = dwArg04 + Mem29[0x004080D4:word32];
	word32 esp_95;
	word32 ebp_96;
	byte SCZO_97;
	word32 esi_98;
	word32 eax_99;
	word32 ecx_100;
	word32 edx_101;
	byte Z_102;
	byte SZO_103;
	byte C_104;
	eax_91();
	return ebp_96;
}

// 004015D0: Register Eq_476 fn004015D0(Stack Eq_2 dwArg04, Stack Eq_3 dwArg08, Register out ptr32 ebpOut)
FARPROC fn004015D0(Eq_2 dwArg04, Eq_3 dwArg08, ptr32 & ebpOut)
{
	Eq_476 eax_14 = GetProcAddress(dwArg04, dwArg08);
	word32 ebp_15;
	*ebpOut = dwArg04;
	return eax_14;
}

// 004015F0: Register word32 fn004015F0(Register ptr32 ebp, Stack Eq_3 dwArg04)
word32 fn004015F0(ptr32 ebp, Eq_3 dwArg04)
{
}

// 00401930: void fn00401930(Stack Eq_2 dwArg04)
void fn00401930(Eq_2 dwArg04)
{
	globals->ptr4080EC->ptr0030->t0008 = dwArg04;
}

// 00401960: Register Eq_2 fn00401960(Stack Eq_3 dwArg04)
Eq_2 fn00401960(Eq_3 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

