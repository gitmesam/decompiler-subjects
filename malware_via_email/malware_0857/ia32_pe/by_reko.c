// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401060: void fn00401060(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401060(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc08_16 = 0x00;
	while (dwLoc08_16 < dwArg0C)
	{
		Mem30[dwArg04 + dwLoc08_16:byte] = Mem0[dwArg08 + dwLoc08_16:byte];
		dwLoc08_16 = dwLoc08_16 + 0x01;
	}
}

// 004010A0: void fn004010A0(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn004010A0(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	if (RegOpenKeyA(0x80000002, 0x0040807C, fp - 0x20) != 0x00)
	{
		byte dl_55 = Mem0[dwArg04 + 0x00:byte];
		word32 dwLoc0C_113 = 0x01;
		word32 dwLoc18_111 = 0x00;
		do
		{
			word32 edx_74 = dwLoc0C_113 + 0x01;
			byte cl_71 = Mem0[dwArg04 + dwLoc0C_113:byte];
			dwLoc0C_113 = edx_74;
			if ((word32) cl_71 == (word32) dl_55)
			{
				if ((word32) Mem0[dwArg04 + edx_74:byte] == 0x00)
				{
					Mem122[dwArg08 + dwLoc18_111:byte] = dl_55;
					dwLoc18_111 = dwLoc18_111 + 0x01;
					dwLoc0C_113 = edx_74 + 0x01;
				}
				else
				{
					word32 eax_140 = fn004011D0(fp - 0x10, dwArg04 + edx_74) + edx_74;
					dwLoc0C_113 = fn004011D0(fp - 0x24, dwArg04 + eax_140) + eax_140;
					word32 dwLoc1C_157 = 0x00;
					while (dwLoc1C_157 <u dwLoc10)
					{
						Mem174[dwArg08 + dwLoc18_111:byte] = Mem0[dwArg08 + (dwLoc18_111 - dwLoc24):byte];
						dwLoc18_111 = dwLoc18_111 + 0x01;
						dwLoc1C_157 = dwLoc1C_157 + 0x01;
					}
				}
			}
			else
			{
				Mem186[dwArg08 + dwLoc18_111:byte] = cl_71;
				dwLoc18_111 = dwLoc18_111 + 0x01;
			}
		} while (dwLoc0C_113 <u dwArg0C);
	}
}

// 004011D0: Register word32 fn004011D0(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn004011D0(word32 dwArg04, word32 dwArg08)
{
	LoadIconA(0x00, 0x7F00);
	word32 dwLoc08_15 = 0x00;
	word32 dwLoc10_16 = 0x00;
	do
	{
		word32 ecx_23 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 eax_32 = dwLoc08_15 << 0x07 | ecx_23 & 0x7F;
		word32 edx_35 = dwLoc10_16 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_15 = eax_32;
		dwLoc10_16 = edx_35;
	} while ((ecx_23 & 0x80) != 0x00);
	Mem45[dwArg04 + 0x00:word32] = eax_32;
	return edx_35;
}

// 00401300: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 esp_18;
	word32 ebp_19;
	byte SCZO_20;
	word32 ebx_21;
	word32 esi_22;
	word32 edi_23;
	word32 eax_24;
	byte SZO_25;
	bool C_26;
	bool Z_27;
	word32 ecx_28;
	word32 edx_29;
	selector fs_30;
	COMCTL32.dll!Ordinal_17();
	LoadCursorA(0x00, 0x7F00);
	GetCommandLineA();
	word32 eax_40 = GetModuleHandleA(0x00);
	if (RegOpenKeyA(0x80000002, 0x004080BC, fp - 0x28) == 0x00)
	{
		word32 eax_107 = Mem0[0x00404000:word32];
		word32 edx_110 = Mem0[0x00404004:word32];
		word32 dwLoc08_112 = 0x00;
		while (dwLoc08_112 <u eax_107)
		{
			Mem126[dwLoc08_112 + 0x00404008:word32] = Mem0[dwLoc08_112 + 0x00404008:word32] ^ 0x00891100;
			dwLoc08_112 = dwLoc08_112 + 0x08;
		}
		Mem133[fp - 0x4C + 0x00:word32] = edx_110;
		Mem137[0x004080E8:word32] = fn00401960(dwArg00);
		Mem140[fp - 0x4C + 0x00:word32] = eax_107;
		Mem143[fp - 0x50 + 0x00:word32] = Mem140[0x004080E8:word32];
		Mem148[fp - 0x54 + 0x00:word32] = 0x00404008;
		fn004010A0(dwArg00, dwArg04, dwArg08);
		Mem156[0x004080EC:word32] = Mem148[fs_30:0x18:word32];
		Mem158[4227292:word32] = edi_23;
		Mem159[0x004080D8:word32] = esi_22;
		Mem160[0x004080E4:word32] = ebx_21;
		Mem161[0x004080E0:word32] = fp - 0x04;
		Mem164[fp - 0x4C + 0x00:word32] = eax_40;
		word32 ecx_166 = 4199477 - eax_40;
		Mem169[fp - 0x50 + 0x00:word32] = ecx_166;
		word32 ebp_170 = fn00401480(dwArg00, dwArg04);
		word32 edx_173 = Mem169[0x004080E8:word32];
		Mem175[fp - 0x4C + 0x00:word32] = edx_173;
		word32 eax_176 = fn004015F0(dwArg00);
		Mem177[ebp_170 - 0x38 + 0x00:word32] = 0x00;
		word32 esp_184;
		word32 ebp_185;
		byte SCZO_186;
		word32 ebx_187;
		word32 esi_188;
		word32 edi_189;
		word32 eax_190;
		byte SZO_191;
		bool C_192;
		bool Z_193;
		word32 ecx_194;
		word32 edx_195;
		selector fs_196;
		Mem177[0x004080F0:word32]();
		return eax_190;
	}
	else
	{
		Mem75[fp - 0x4C + 0x00:word32] = 0x00;
		Mem77[fp - 0x50 + 0x00:word32] = 4199040;
		Mem79[fp - 0x54 + 0x00:word32] = 0x00;
		Mem81[fp - 88 + 0x00:word32] = 1000;
		Mem84[fp - 0x5C + 0x00:word32] = eax_40;
		DialogBoxParamA(Mem84[fp - 0x5C + 0x00:HINSTANCE], Mem84[fp - 88 + 0x00:LPCSTR], Mem84[fp - 0x54 + 0x00:HWND], Mem84[fp - 0x50 + 0x00:DLGPROC], Mem84[fp - 0x4C + 0x00:LPARAM]);
		return 0x00;
	}
}

// 00401480: Register word32 fn00401480(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401480(word32 dwArg04, word32 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem0[dwArg08 + 0x3C:word32];
	Mem30[0x004080D4:word32] = VirtualAlloc(0x00, Mem0[edx_16 + 0x50:word32], 0x3000, 0x40);
	if (Mem30[0x004080D4:word32] == 0x00)
		return ebp;
	word32 edx_72 = Mem30[0x004080D4:word32];
	fn00401060(edx_72, dwArg08, Mem30[edx_16 + 0x50:word32]);
	word32 eax_77 = Mem30[0x004080D4:word32] - dwArg08;
	if (Mem30[edx_16 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_107 = dwArg08 + Mem30[edx_16 + 0xA0:word32];
		while (Mem30[dwLoc0C_107 + 0x04:word32] != 0x00)
		{
			word32 eax_122 = Mem30[dwLoc0C_107 + 0x04:word32] - 0x08 >>u 0x01;
			word32 ecx_125 = dwLoc0C_107 + 0x08;
			word32 dwLoc08_128 = 0x00;
			while (dwLoc08_128 <u eax_122)
			{
				if ((word32) ecx_125[dwLoc08_128 * 0x02] >> 0x0C == 0x03)
					Mem169[Mem30[0x004080D4:word32] + Mem30[dwLoc0C_107 + 0x00:word32] + ((word32) ecx_125[dwLoc08_128 * 0x02] & 0x0FFF):word32] = Mem30[Mem30[0x004080D4:word32] + Mem30[dwLoc0C_107 + 0x00:word32] + ((word32) ecx_125[dwLoc08_128 * 0x02] & 0x0FFF):word32] + eax_77;
				dwLoc08_128 = dwLoc08_128 + 0x01;
			}
			dwLoc0C_107 = dwLoc0C_107 + Mem30[dwLoc0C_107 + 0x04:word32];
		}
	}
	word32 eax_89 = dwArg04 + Mem30[0x004080D4:word32];
	word32 esp_93;
	word32 ebp_94;
	byte SCZO_95;
	word32 esi_96;
	word32 eax_97;
	word32 ecx_98;
	word32 edx_99;
	bool Z_100;
	byte SZO_101;
	bool C_102;
	eax_89();
	return ebp_94;
}

// 004015D0: Register word32 fn004015D0(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn004015D0(word32 dwArg04, word32 dwArg08)
{
	word32 eax_14 = GetProcAddress(dwArg04, dwArg08);
	return eax_14;
}

// 004015F0: Register word32 fn004015F0(Stack word32 dwArg04)
word32 fn004015F0(word32 dwArg04)
{
	word32 eax_182;
	word32 edx_13 = dwArg04 + Mem0[dwArg04 + 0x3C:word32];
	word32 dwLoc20_121 = edx_13 + 0x18 + (word32) Mem0[edx_13 + 0x14:word16];
	word32 eax_30 = VirtualAlloc(0x00, Mem0[edx_13 + 0x50:word32], 0x3000, 0x40);
	if (eax_30 != 0x00)
	{
		fn00401060(eax_30, dwArg04, Mem0[dwArg04 + 0x3C:word32] + 0x0138 + (word32) Mem0[edx_13 + 0x06:word16] *s 0x28);
		word32 dwLoc0C_100 = 0x00;
		while (dwLoc0C_100 <u (word32) Mem0[edx_13 + 0x06:word16])
		{
			if (Mem0[dwLoc20_121 + 0x14:word32] != 0x00 && Mem0[dwLoc20_121 + 0x10:word32] != 0x00)
				fn00401060(eax_30 + Mem0[dwLoc20_121 + 0x0C:word32], dwArg04 + Mem0[dwLoc20_121 + 0x14:word32], (uint32) ((uint64) (uint32) (Mem0[dwLoc20_121 + 0x10:word32] - 0x01 + Mem0[edx_13 + 0x3C:word32]) /u Mem0[edx_13 + 0x3C:word32]) *s Mem0[edx_13 + 0x3C:word32]);
			dwLoc20_121 = dwLoc20_121 + 0x28;
			dwLoc0C_100 = dwLoc0C_100 + 0x01;
		}
		word32 ecx_161 = eax_30 + Mem0[eax_30 + 0x3C:word32];
		word32 eax_177 = CreateFileMappingA(~0x00, 0x00, 0x04, 0x00, Mem0[ecx_161 + 0x50:word32], 0x00);
		if (eax_177 != 0x00)
		{
			word32 dwLoc40_190 = eax_30 + Mem0[ecx_161 + 0x80:word32];
			while (Mem0[dwLoc40_190 + 0x10:word32] != 0x00)
			{
				word32 dwLoc2C_219;
				word32 dwLoc1C_218;
				word32 eax_212 = LoadLibraryA(eax_30 + Mem0[dwLoc40_190 + 0x0C:word32]);
				if (Mem0[dwLoc40_190 + 0x00:word32] != 0x00)
				{
					dwLoc1C_218 = eax_30 + Mem0[dwLoc40_190 + 0x00:word32];
					dwLoc2C_219 = eax_30 + Mem0[dwLoc40_190 + 0x10:word32];
				}
				else
				{
					dwLoc1C_218 = eax_30 + Mem0[dwLoc40_190 + 0x10:word32];
					dwLoc2C_219 = eax_30 + Mem0[dwLoc40_190 + 0x00:word32];
				}
				word32 dwLoc10_222 = 0x00;
				if (Mem0[dwLoc40_190 + 0x10:word32] != 0x00 && Mem0[dwLoc40_190 + 0x00:word32] != 0x00)
					dwLoc10_222 = 0x01;
				while (Mem0[dwLoc1C_218 + 0x00:word32] != 0x00)
				{
					if ((Mem0[dwLoc1C_218 + 0x00:word32] & 0x80000000) != 0x00)
						Mem287[dwLoc1C_218 + 0x00:word32] = fn004015D0(eax_212, Mem0[dwLoc1C_218 + 0x00:word32] & 0x7FFFFFFF);
					else
						Mem301[dwLoc1C_218 + 0x00:word32] = fn004015D0(eax_212, Mem0[dwLoc1C_218 + 0x00:word32] + 0x02 + eax_30);
					if (Mem0[dwLoc1C_218 + 0x00:word32] == 0x00)
					{
						eax_182 = 0x00;
						return eax_182;
					}
					if (dwLoc10_222 != 0x00)
						Mem272[dwLoc2C_219 + 0x00:word32] = Mem0[dwLoc1C_218 + 0x00:word32];
					dwLoc1C_218 = dwLoc1C_218 + 0x04;
					dwLoc2C_219 = dwLoc2C_219 + 0x04;
				}
				dwLoc40_190 = dwLoc40_190 + 0x14;
			}
			Mem345[0x004080D4:word32] = MapViewOfFileEx(eax_177, 0x22, 0x00, 0x00, 0x00, Mem0[ecx_161 + 0x34:word32]);
			if (Mem345[0x004080D4:word32] == 0x00)
			{
				if (UnmapViewOfFile(Mem345[ecx_161 + 0x34:word32]) == 0x00 && VirtualFree(Mem345[ecx_161 + 0x34:word32], 0x00, 0x8000) == 0x00)
				{
					eax_182 = 0x00;
					return eax_182;
				}
				Mem408[0x004080D4:word32] = MapViewOfFileEx(eax_177, 0x22, 0x00, 0x00, 0x00, Mem345[ecx_161 + 0x34:word32]);
				if (Mem408[0x004080D4:word32] == 0x00)
				{
					Mem425[0x004080D4:word32] = VirtualAlloc(Mem408[ecx_161 + 0x34:word32], Mem408[ecx_161 + 0x50:word32], 0x3000, 0x40);
					if (Mem425[0x004080D4:word32] == 0x00)
					{
						eax_182 = 0x00;
						return eax_182;
					}
				}
			}
			fn00401060(Mem345[0x004080D4:word32], eax_30, Mem345[ecx_161 + 0x50:word32]);
			fn00401930(Mem345[0x004080D4:word32]);
			Mem374[0x004080F0:word32] = Mem345[0x004080D4:word32] + Mem345[ecx_161 + 0x28:word32];
			Mem377[ecx_161 + 0x28:word32] = Mem374[0x004080F0:word32];
			eax_182 = 0x01;
			return eax_182;
		}
		else
		{
			eax_182 = 0x00;
			return eax_182;
		}
	}
	else
	{
		eax_182 = 0x00;
		return eax_182;
	}
}

// 00401930: void fn00401930(Stack word32 dwArg04)
void fn00401930(word32 dwArg04)
{
	Mem17[Mem0[Mem0[0x004080EC:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 00401960: Register word32 fn00401960(Stack word32 dwArg04)
word32 fn00401960(word32 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

