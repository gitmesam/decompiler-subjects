// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401025: Register ui32 fn00401025(Register byte al, Register word32 ecx, Register byte dl, Register word32 ebx, Register word32 edi)
ui32 fn00401025(byte al, word32 ecx, byte dl, word32 ebx, word32 edi)
{
	byte al_10 = (byte) (eax | 4088512071);
	__outb(188, al_10);
	ptr32 esp_19;
	byte dl_20;
	word32 ecx_21;
	byte SZO_22;
	bool C_23;
	ui32 eax_24;
	word32 esi_25;
	byte ch_26;
	byte al_27;
	bool Z_28;
	byte bl_29;
	byte * ebx_30;
	byte SCZO_31;
	word16 dx_32;
	word32 * edi_33;
	fn00400FF7();
	return eax_24;
}

// 00415286: Register Eq_82 Win32CrtStartup()
Eq_82 Win32CrtStartup()
{
	GetCommandLineA();
	ptr32 esp_445 = fp - 0x48;
l00415292:
	word32 * esp_399;
	ptr32 esp_244;
	struct Eq_140 * esp_135;
	GetCommandLineA();
	GetLastError();
	union Eq_82 * esp_57 = esp_445 - 0x04;
	*esp_57 = 0x00;
	*(esp_57 - 0x04) = 0x01A5;
	*(esp_57 - 0x08) = 0x03;
	*(esp_57 - 0x0C) = 0x00;
	*(esp_57 - 0x10) = 0x05;
	*(esp_57 - 0x14) = 0x20000000;
	*(esp_57 - 0x18) = 4401666;
	Eq_82 eax_71 = CreateFileA(*(esp_57 - 0x18), *(esp_57 - 0x14), *(esp_57 - 0x10), *(esp_57 - 0x0C), *(esp_57 - 0x08), *(esp_57 - 0x04), *esp_57);
	ptr32 esp_276 = (char *) esp_57 + 0x04;
	if (eax_71 == ~0x00)
	{
		*esp_57 = 0x00;
		*(esp_57 - 0x04) = 0x00;
		*(esp_57 - 0x08) = 0x03;
		*(esp_57 - 0x0C) = 0x00;
		*(esp_57 - 0x10) = 0x00;
		ptr32 esp_540 = esp_57 - 0x10;
		do
		{
			struct Eq_273 * esp_543 = esp_540 - 0x04;
			esp_543->t0000.u0 = 0xE0000000;
			*(esp_543 - 0x04) = 4401747;
			dwLoc08 = CreateFileW(*(esp_543 - 0x04), esp_543->t0000, esp_543->t0004, esp_543->t0008, esp_543->t000C, esp_543->t0010, esp_543->t0014);
			esp_543->t0014.u0 = 0x00;
			esp_543->t0010.u0 = 0x00;
			esp_543->t000C.u0 = 0x03;
			esp_543->t0008 = null;
			esp_543->t0004.u0 = 0x06;
			esp_543->t0000.u0 = 0x40000000;
			*(esp_543 - 0x04) = 4401869;
			Eq_82 eax_564 = CreateFileA(*(esp_543 - 0x04), esp_543->t0000, esp_543->t0004, esp_543->t0008, esp_543->t000C, esp_543->t0010, esp_543->t0014);
			esp_540 = (char *) &esp_543->t0014 + 0x04;
			dwLoc18 = eax_564;
		} while (eax_564 != ~0x00);
		esp_543->t0014.u0 = 0x00;
		esp_399 = (word32 *) &esp_543->t0014;
l00415331:
		struct Eq_570 * esp_511 = esp_399 - 0x04;
		esp_511->t0000.u0 = 0x86;
		*(esp_511 - 0x04) = 0x03;
		*(esp_511 - 0x08) = 0x00;
		*(esp_511 - 0x0C) = 0x07;
		*(esp_511 - 0x10) = 0x00;
		*(esp_511 - 0x14) = 4401849;
		dwLoc3C = CreateFileA(*(esp_511 - 0x14), *(esp_511 - 0x10), *(esp_511 - 0x0C), *(esp_511 - 0x08), *(esp_511 - 0x04), esp_511->t0000, esp_511->t0004);
		GetLastError();
		esp_511->t0004 = dwLoc18;
		CloseHandle(esp_511->t0004);
		esp_244 = (char *) &esp_511->t0004 + 0x04;
		do
		{
			GetLastError();
			struct Eq_385 * esp_303 = esp_244 - 0x04;
			esp_303->t0000 = dwLoc08;
			CloseHandle(esp_303->t0000);
			esp_303->t0000 = dwLoc3C;
			CloseHandle(esp_303->t0000);
			esp_303->t0000 = dwLoc08;
			GetFileType(esp_303->t0000);
			esp_303->t0000.u0 = 0x00;
			*(esp_303 - 0x04) = (union Eq_82 *) dwLoc3C;
			GetFileSize(*(esp_303 - 0x04), esp_303->t0000);
			esp_303->t0000.u0 = 4401737;
			*(esp_303 - 0x04) = (union Eq_82 *) dwLoc08;
			GetFileType(*(esp_303 - 0x04));
			Eq_82 eax_331 = GetModuleHandleA(esp_303->t0000);
			esp_303->t0000.u0 = 0x00;
			*(esp_303 - 0x04) = 0x84;
			*(esp_303 - 0x08) = 0x03;
			*(esp_303 - 0x0C) = 0x00;
			*(esp_303 - 0x10) = 0x00;
			*(esp_303 - 0x14) = 0x60000000;
			*(esp_303 - 0x18) = 0x00432A0E;
			dwLoc20 = CreateFileW(*(esp_303 - 0x18), *(esp_303 - 0x14), *(esp_303 - 0x10), *(esp_303 - 0x0C), *(esp_303 - 0x08), *(esp_303 - 0x04), esp_303->t0000);
			esp_303->t0000.u0 = 4401878;
			struct Eq_385 * esp_351 = esp_303;
			do
			{
				struct Eq_385 * esp_355 = esp_351 - 0x04;
				esp_355->t0000 = dwLoc18;
				GetFileType(esp_355->t0000);
				esp_355->t0000 = eax_331;
				*(esp_355 - 0x04) = 0x00;
				*(esp_355 - 0x08) = 0x02;
				*(esp_355 - 0x0C) = 0x03;
				*(esp_355 - 0x10) = 0x00;
				*(esp_355 - 0x14) = 0x07;
				*(esp_355 - 0x18) = 0xE0000000;
				*(esp_355 - 0x1C) = 4401718;
				esp_351 = esp_355;
			} while (CreateFileW(*(esp_355 - 0x1C), *(esp_355 - 0x18), *(esp_355 - 0x14), *(esp_355 - 0x10), *(esp_355 - 0x0C), *(esp_355 - 0x08), *(esp_355 - 0x04)) != ~0x00);
			dwLoc2C = GetProcAddress(esp_355->t0000, esp_355->t0004);
			esp_355->t0004.u0 = 0x00;
			esp_355->t0000.u0 = 0x01;
			*(esp_355 - 0x04) = 0x03;
			*(esp_355 - 0x08) = 0x00;
			*(esp_355 - 0x0C) = 0x05;
			*(esp_355 - 0x10) = 0xE0000000;
			*(esp_355 - 0x14) = 4401646;
			Eq_82 eax_398 = CreateFileW(*(esp_355 - 0x14), *(esp_355 - 0x10), *(esp_355 - 0x0C), *(esp_355 - 0x08), *(esp_355 - 0x04), esp_355->t0000, esp_355->t0004);
			esp_399 = (word32 *) ((char *) &esp_355->t0004 + 0x04);
			dwLoc44 = eax_398;
			if (eax_398 != ~0x00)
				goto l00415331;
			esp_355->t0004 = dwLoc08;
			CloseHandle(esp_355->t0004);
			esp_355->t0004 = dwLoc3C;
			GetFileType(esp_355->t0004);
			esp_355->t0004.u0 = 0x00;
			esp_355->t0000.u0 = 0x03;
			*(esp_355 - 0x04) = 0x03;
			*(esp_355 - 0x08) = 0x00;
			*(esp_355 - 0x0C) = 0x05;
			*(esp_355 - 0x10) = 0x20000000;
			*(esp_355 - 0x14) = 4401818;
			CreateFileA(*(esp_355 - 0x14), *(esp_355 - 0x10), *(esp_355 - 0x0C), *(esp_355 - 0x08), *(esp_355 - 0x04), esp_355->t0000, esp_355->t0004);
			esp_355->t0004.u0 = 0x00;
			esp_355->t0000.u0 = 0x24;
			*(esp_355 - 0x04) = 0x03;
			*(esp_355 - 0x08) = 0x00;
			*(esp_355 - 0x0C) = 0x01;
			*(esp_355 - 0x10) = 0x80000000;
			*(esp_355 - 0x14) = 4401906;
			Eq_82 eax_444 = CreateFileA(*(esp_355 - 0x14), *(esp_355 - 0x10), *(esp_355 - 0x0C), *(esp_355 - 0x08), *(esp_355 - 0x04), esp_355->t0000, esp_355->t0004);
			esp_445 = (char *) &esp_355->t0004 + 0x04;
			dwLoc28 = eax_444;
			if (eax_444 != ~0x00)
				goto l00415292;
			esp_355->t0004.u0 = 0x00;
			esp_355->t0000.u0 = 0x00;
			*(esp_355 - 0x04) = 262;
			*(esp_355 - 0x08) = 0x03;
			*(esp_355 - 0x0C) = 0x00;
			*(esp_355 - 0x10) = 0x01;
			*(esp_355 - 0x14) = 0x20000000;
			*(esp_355 - 0x18) = 4401691;
			dwLoc10 = CreateFileA(*(esp_355 - 0x18), *(esp_355 - 0x14), *(esp_355 - 0x10), *(esp_355 - 0x0C), *(esp_355 - 0x08), *(esp_355 - 0x04), esp_355->t0000);
			esp_355->t0000.u0 = 0x00;
			*(esp_355 - 0x04) = 0x00;
			*(esp_355 - 0x08) = 0x00;
			*(esp_355 - 0x0C) = 0x0182;
			*(esp_355 - 0x10) = 0x03;
			*(esp_355 - 0x14) = 0x00;
			*(esp_355 - 0x18) = 0x03;
			*(esp_355 - 0x1C) = 0xE0000000;
			*(esp_355 - 0x20) = 4401766;
			esp_135 = esp_355 - 0x20;
l00415534:
			Eq_82 eax_242 = CreateFileA(esp_135->t0000, esp_135->t0004, esp_135->t0008, esp_135->t000C, esp_135->t0010, esp_135->t0014, esp_135[0x01]);
			esp_244 = (char *) &esp_135->t0018 + 0x04;
		} while (eax_242 != ~0x00);
		ptr32 esp_248;
		word32 ebp_249;
		byte SCZO_250;
		ptr32 eax_251;
		bool Z_252;
		byte SZO_253;
		bool C_254;
		byte al_255;
		word32 ecx_256;
		byte dl_257;
		word32 ebx_258;
		word32 edi_259;
		dwLoc2C();
		*(esp_248 - 0x04) = (union Eq_82 *) eax_242;
		GetFileType(*(esp_248 - 0x04));
		*(esp_248 - 0x04) = (union Eq_82 *) eax_71;
		CloseHandle(*(esp_248 - 0x04));
		dwLoc1C = eax_251;
		dwLoc14 = eax_251 ^ 0xC0000005;
		esp_276 = esp_248;
	}
	union Eq_82 * esp_91 = esp_276 - 0x04;
	*esp_91 = 0x00;
	*(esp_91 - 0x04) = (union Eq_82 *) dwLoc20;
	GetFileSize(*(esp_91 - 0x04), *esp_91);
	*esp_91 = 0x00;
	*(esp_91 - 0x04) = (union Eq_82 *) dwLoc44;
	<anonymous> * v23_98 = (char *) dwLoc14 + 0x004155B1;
	dwLoc14 = v23_98;
	Eq_82 eax_106 = GetFileSize(*(esp_91 - 0x04), *esp_91);
	struct Eq_140 * esp_108;
	word32 ebp_109;
	byte SCZO_110;
	word32 eax_111;
	bool Z_112;
	byte SZO_113;
	bool C_114;
	byte al_115;
	word32 ecx_116;
	byte dl_117;
	word32 ebx_118;
	word32 edi_119;
	v23_98();
	*(esp_108 - 0x04) = 0x00;
	*(esp_108 - 0x08) = 288;
	*(esp_108 - 0x0C) = 0x03;
	*(esp_108 - 0x10) = 0x00;
	*(esp_108 - 0x14) = 0x04;
	*(esp_108 - 0x18) = 0xA0000000;
	*(esp_108 - 0x1C) = 0x00432A80;
	esp_135 = esp_108;
	if (CreateFileW(*(esp_108 - 0x1C), *(esp_108 - 0x18), *(esp_108 - 0x14), *(esp_108 - 0x10), *(esp_108 - 0x0C), *(esp_108 - 0x08), *(esp_108 - 0x04)) == ~0x00)
	{
		GetCommandLineA();
		*(esp_108 - 0x04) = fp - 0x34;
		*(esp_108 - 0x08) = 0x40;
		*(esp_108 - 0x0C) = 0x00014281;
		*(esp_108 - 0x10) = 0x00401000;
		*(esp_108 - 0x14) = 0x00;
		*(esp_108 - 0x18) = (union Eq_82 *) eax_71;
		GetFileSize(*(esp_108 - 0x18), *(esp_108 - 0x14));
		GetLastError();
		VirtualProtect(*(esp_108 - 0x10), *(esp_108 - 0x0C), *(esp_108 - 0x08), *(esp_108 - 0x04));
		*(esp_108 - 0x04) = 0x00;
		*(esp_108 - 0x08) = (union Eq_82 *) dwLoc28;
		GetFileSize(*(esp_108 - 0x08), *(esp_108 - 0x04));
		*(esp_108 - 0x04) = 0x00401000;
		*(esp_108 - 0x08) = (union Eq_82 *) eax_71;
		CloseHandle(*(esp_108 - 0x08));
		*(esp_108 - 0x08) = dwLoc1C;
		*(esp_108 - 0x0C) = 0x00014281;
		GetLastError();
		*(esp_108 - 0x10) = (union Eq_82 *) dwLoc44;
		CloseHandle(*(esp_108 - 0x10));
		*(esp_108 - 0x10) = 0x00;
		*(esp_108 - 0x14) = (union Eq_82 *) dwLoc10;
		Eq_82 eax_193 = GetFileSize(*(esp_108 - 0x14), *(esp_108 - 0x10));
		ptr32 esp_198;
		word32 ebp_199;
		byte SCZO_200;
		word32 eax_201;
		bool Z_202;
		byte SZO_203;
		bool C_204;
		byte al_205;
		word32 ecx_206;
		byte dl_207;
		word32 ebx_208;
		word32 edi_209;
		(dwLoc1C - 3216943442)();
		*(esp_198 - 0x04) = (union Eq_82 *) eax_71;
		return fn00401025((byte) CloseHandle(*(esp_198 - 0x04)), ecx_206, dl_207, ebx_208, edi_209);
	}
	goto l00415534;
}

