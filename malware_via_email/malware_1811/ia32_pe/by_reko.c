// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 edx_69;
	word32 ebp_70;
	Eq_2 eax_71 = fn0040105F(0x00, ebp, edx, 2847393444, 0x00, eax, out edx_69, out ebp_70);
	*(fp - 44) = edx_69;
	word32 edx_80;
	word32 ebp_81;
	return fn0040105F(eax_71, ebp_70, dwLoc06, dwArg0E, dwArg12, dwArg1E, out edx_80, out ebp_81);
}

// 0040105F: Register Eq_2 fn0040105F(Register Eq_2 eax, Register word32 ebp, Stack word32 dwArg00, Stack word32 dwArg14, Stack word32 dwArg18, Stack word32 dwArg24, Register out ptr32 edxOut, Register out ptr32 ebpOut)
Eq_2 fn0040105F(Eq_2 eax, word32 ebp, word32 dwArg00, word32 dwArg14, word32 dwArg18, word32 dwArg24, ptr32 & edxOut, ptr32 & ebpOut)
{
	word32 eax_15 = dwArg00;
	cui16 ax_16 = (word16) dwArg00;
	while (true)
	{
		word16 * eax_28 = DPB(eax_15, ax_16 & 0x00, 0);
		word32 ecx_37 = DPB(ecx, *eax_28, 0);
		ecx = ecx_37 + 42418;
		if ((word16) (ecx_37 + 42418) == 0x01)
			break;
		eax_15 = eax_28 - 0x00010000;
		ax_16 = (word16) (eax_28 - 0x00010000);
	}
	word32 eax_88 = DPB(eax_15, 0x00, 0);
	struct Eq_67 * ebx_260;
	word32 ecx_261 = fn00401566(eax_88 + 77872, fp - 0x28, out ebx_260);
	<anonymous> * eax_294 = ebx_260->ptr0004;
	struct Eq_85 * esp_326;
	word32 eax_327;
	byte SZO_328;
	word32 edx_329;
	word32 ecx_330;
	word32 ebp_331;
	word16 ax_332;
	byte C_333;
	word16 cx_334;
	byte SCZO_335;
	byte Z_336;
	word32 * esi_337;
	struct Eq_97 * ebx_338;
	word32 edi_339;
	struct Eq_99 * fs_340;
	byte al_341;
	byte ah_342;
	byte dl_343;
	byte bh_344;
	byte CZ_345;
	byte cl_346;
	byte ch_347;
	eax_294();
	*(esp_326 - 0x04) = edx_329;
	word32 edx_350 = *(esp_326 - 0x04);
	word32 edi_353 = *esi_337;
	if (edi_353 != 0x57)
	{
		ptr32 esp_1053;
		Eq_2 eax_1054;
		byte SZO_1055;
		word32 edx_1056;
		word32 ecx_1057;
		word32 ebp_1058;
		word16 ax_1059;
		byte C_1060;
		word16 cx_1061;
		byte SCZO_1062;
		byte Z_1063;
		word32 esi_1064;
		word32 ebx_1065;
		word32 edi_1066;
		struct Eq_137 * fs_1067;
		byte al_1068;
		byte ah_1069;
		byte dl_1070;
		byte bh_1071;
		byte CZ_1072;
		byte cl_1073;
		byte ch_1074;
		ebx_338->ptr0008();
		*(esp_1053 - 0x04) = edx_1056;
		word32 edx_1077;
		*edxOut = *(esp_1053 - 0x04);
		return eax_1054;
	}
	else
	{
		*(esp_326 - 0x04) = edx_350;
		word32 edx_386 = *(esp_326 - 0x04);
		*(esp_326 - 0x04) = (struct Eq_97 **) ebx_338;
		*(esp_326 - 0x08) = edx_386;
		word32 edx_393 = *(esp_326 - 0x08);
		*(esp_326 - 0x04) = *(esp_326 - 0x04) - 0x04;
		*(esp_326 - 0x08) = edx_393;
		word32 * edi_402 = *(esp_326 - 0x04);
		*(esp_326 - 0x08) = *(esp_326 - 0x08);
		word32 edi_407 = *edi_402;
		*(esp_326 - 0x08) = *(esp_326 - 0x08);
		word32 edx_410 = *(esp_326 - 0x08);
		esp_326->dw003C = edi_407;
		*(esp_326 - 0x08) = edx_410;
		struct Eq_241 * edi_417 = *(esp_326 - 0x04);
		*(esp_326 - 0x04) = *(esp_326 - 0x08);
		word32 edx_421 = *(esp_326 - 0x04);
		*(esp_326 - 0x04) = eax_327;
		*(esp_326 - 0x08) = edx_421;
		word32 edx_427 = *(esp_326 - 0x08);
		*(esp_326 - 0x08) = ecx_330;
		*(esp_326 - 0x0C) = esp_326 - 0x08;
		*(esp_326 - 0x10) = 0x40;
		*(esp_326 - 0x14) = edx_427;
		word32 edx_439 = *(esp_326 - 0x14);
		*(esp_326 - 0x14) = esp_326->dw0020;
		*(esp_326 - 0x18) = edx_439;
		word32 edx_446 = *(esp_326 - 0x18);
		*(esp_326 - 0x18) = esp_326->dw0014;
		*(esp_326 - 0x1C) = edx_446;
		word32 edx_453 = *(esp_326 - 0x1C);
		*(esp_326 - 0x1C) = ~0x00;
		*(esp_326 - 0x20) = edx_453;
		word32 edx_459 = *(esp_326 - 0x20);
		esp_326->dw0018 = 0x00;
		*(esp_326 - 0x20) = edx_459;
		struct Eq_364 * esp_466;
		struct Eq_365 Eq_378::* eax_467;
		byte SZO_468;
		word32 edx_469;
		word32 ecx_470;
		word32 ebp_471;
		word16 ax_472;
		byte C_473;
		word16 cx_474;
		byte SCZO_475;
		byte Z_476;
		word32 esi_477;
		word32 ebx_478;
		word32 edi_479;
		struct Eq_378 * fs_480;
		byte al_481;
		byte ah_482;
		byte dl_483;
		byte bh_484;
		byte CZ_485;
		byte cl_486;
		byte ch_487;
		edi_417->ptr000C();
		*(esp_466 - 0x04) = edx_469;
		esp_466->t0000 = *(esp_466 - 0x04);
		esp_466->t0004 = esp_466->t0000;
		Eq_2 edi_504 = esp_466->t0008;
		esp_466->t0008 = esp_466->t0004;
		Eq_2 ebx_510 = esp_466->t000C;
		esp_466->t000C = esp_466->t0008;
		Eq_2 esi_517 = esp_466->t0010;
		esp_466->t0010 = esp_466->t000C;
		esp_466->t0010 = esp_466->t0010;
		Eq_2 edx_527 = esp_466->t0010;
		struct Eq_442 * eax_530 = (fs_480->*eax_467).ptr002F;
		word32 ecx_539 = eax_530->dw0004;
		esp_466->t003C = esp_466->t003C ^ ecx_539;
		word32 eax_549 = esp_466->dw001C;
		*(esp_466 - 0xF8) = (union Eq_2 *) edx_527;
		word32 ecx_554 = esp_466->dw002C;
		*(esp_466 - 0xF8) = *(esp_466 - 0xF8);
		word32 edx_557 = *(esp_466 - 0xF8);
		*(esp_466 - 244) = eax_549;
		*(esp_466 - 0xF8) = edx_557;
		word32 edx_562 = *(esp_466 - 0xF8);
		*(esp_466 - 0xF0) = ecx_554;
		*(esp_466 - 0xF8) = edx_562;
		*(esp_466 - 0xF8) = *(esp_466 - 0xF8);
		Eq_518 eax_569 = 0x00;
		byte al_571 = 0x00;
		word32 edx_577 = *(esp_466 - 0xF8);
		do
		{
			*((word32) eax_569 + (esp_466 - 0xEC)) = al_571;
			*(esp_466 - 0xF8) = edx_577;
			*(esp_466 - 0xF8) = *(esp_466 - 0xF8);
			*(esp_466 - 0xF8) = *(esp_466 - 0xF8);
			eax_569 = (word32) eax_569 + 0x01;
			al_571 = (byte) eax_569;
			edx_577 = *(esp_466 - 0xF8);
		} while (eax_569 < 0x0100);
		*(esp_466 - 0xF8) = edx_577;
		word32 edx_606 = *(esp_466 - 0xF8);
		*(esp_466 - 0xF8) = ebp_471;
		*(esp_466 - 252) = edx_606;
		word32 edx_612 = *(esp_466 - 252);
		*(esp_466 - 252) = (union Eq_2 *) esi_517;
		*(esp_466 - 0x0100) = edx_612;
		word32 edx_618 = *(esp_466 - 0x0100);
		*(esp_466 - 0x0100) = (union Eq_2 *) edi_504;
		ptr32 edi_624 = esp_466->ptr0024;
		*(esp_466 - 0x0104) = edx_618;
		word32 edx_627 = *(esp_466 - 0x0104);
		ptr32 ecx_1013 = 0x00;
		word32 esi_636 = 0x00;
		*(esp_466 - 0x0104) = edx_627;
		word32 edx_642 = *(esp_466 - 0x0104);
		*(esp_466 - 0x0104) = (union Eq_2 *) ebx_510;
		*(esp_466 - 0x0108) = edx_642;
		Eq_646 ebp_637 = 0x00;
		Eq_2 edx_648 = *(esp_466 - 0x0108);
		do
		{
			byte ah_663 = Mem647[esp_466 - 0xEC + ebp_637:byte];
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = edx_648;
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (esp_466 - (struct Eq_793 *) 0xF0)->t0000;
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (word32) *((word32) (esp_466 - (struct Eq_662 *) 0x0108)->t0000 + ecx_1013);
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (esp_466 - (struct Eq_662 *) 0x0108)->t0000;
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (esp_466 - (struct Eq_662 *) 0x0108)->t0000;
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (word32) (esp_466 - (struct Eq_662 *) 0x0108)->t0000 + ((word32) ah_663 + esi_636);
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (word32) (byte) (esp_466 - (struct Eq_662 *) 0x0108)->t0000;
			(esp_466 - (struct Eq_662 *) 0x0108)->t0000 = (esp_466 - (struct Eq_662 *) 0x0108)->t0000;
			ecx_1013 = ecx_1013 + 0x01;
			Eq_2 edx_709 = (esp_466 - (struct Eq_662 *) 0x0108)->t0000;
			Eq_2 edx_1044;
			edx_1044 = edx_709;
			if (ecx_1013 >= edi_624)
			{
				*(esp_466 - (struct Eq_662 *) 0x0108) = (union Eq_2 *) edx_709;
				edx_1044 = *(esp_466 - (struct Eq_662 *) 0x0108);
				ecx_1013 = 0x00;
			}
			byte al_727 = *((word32) edx_709 + (esp_466 - 0xEC));
			*(esp_466 - 0x0108) = (union Eq_2 *) edx_709;
			*(esp_466 - 0x010C) = (union Eq_2 *) edx_1044;
			*(esp_466 - 0x010C) = *(esp_466 - 0x010C);
			word32 edx_739 = *(esp_466 - 0x010C);
			*((word32) ebp_637 + (esp_466 - 0xEC)) = al_727;
			*(esp_466 - 0x010C) = edx_739;
			word32 esi_746 = *(esp_466 - 0x0108);
			*(esp_466 - 0x0108) = *(esp_466 - 0x010C);
			*(esp_466 - 0x0108) = *(esp_466 - 0x0108);
			*(esp_466 - 0x0108) = *(esp_466 - 0x0108);
			*(esp_466 - 0x0108) = *(esp_466 - 0x0108);
			*(esp_466 - 0x0108) = *(esp_466 - 0x0108);
			word32 edx_770 = *(esp_466 - 0x0108);
			esp_466 - 0x0104 + (esi_746 + 0x18) = (byte *) ah_663;
			*(esp_466 - 0x0108) = edx_770;
			*(esp_466 - 0x0108) = *(esp_466 - 0x0108);
			ebp_637 = (word32) ebp_637 + 0x01;
			edx_648 = *(esp_466 - 0x0108);
			esi_636 = esi_746;
		} while (ebp_637 < 0x0100);
		(esp_466 - (struct Eq_864 *) 0x0108)->t0000 = edx_648;
		(esp_466 - (struct Eq_874 *) 0x0108)->t0000 = (esp_466 - (struct Eq_869 *) 0x0108)->t0000;
		(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_879 *) 0x0108)->t0000;
		word32 ebp_1037 = esp_466->dw0028;
		(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
		Eq_2 edi_1031 = (esp_466 - (struct Eq_902 *) 244)->t0000;
		(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
		(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
		struct Eq_923 * esi_792 = null;
		struct Eq_925 * eax_797 = null;
		Eq_2 edx_1034 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
		if (true)
		{
			(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = edx_1034;
			edx_1034 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
			do
			{
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = edx_1034;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				word32 eax_907 = (word32) (byte) (eax_797 + 0x01);
				byte cl_915 = Mem912[esp_466 - 0xEC + eax_907:byte];
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (word32) cl_915;
				Mem930[esp_466 - 0x0104 + 0x00:word32] = Mem924[esp_466 - 0x0104 + 0x00:word32] + esi_792;
				ptr32 ecx_916 = DPB(ecx_1013, cl_915, 0);
				struct Eq_923 * edx_934 = (word32) (byte) (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				Mem940[esp_466 - 0x0104 + 0x00:word32] = DPB(edx_934, Mem930[esp_466 - 0xEC + edx_934:byte], 0);
				(esp_466 - (struct Eq_1025 *) 0xF0)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				Eq_2 edx_946 = (esp_466 - (struct Eq_1031 *) 0xF0)->t0000;
				Mem949[esp_466 - 0xEC + eax_907:byte] = (byte) edx_946;
				(esp_466 - (struct Eq_1042 *) 0xF0)->t0000 = edx_946;
				(esp_466 - (struct Eq_1052 *) 0xF0)->t0000 = (esp_466 - (struct Eq_1047 *) 0xF0)->t0000;
				(esp_466 - (struct Eq_1064 *) 0xF0)->t0000 = DPB((esp_466 - (struct Eq_1057 *) 0xF0)->t0000, cl_915, 0);
				(esp_466 - (struct Eq_1074 *) 0xF0)->t0000 = (esp_466 - (struct Eq_1069 *) 0xF0)->t0000;
				Eq_2 edx_970 = (esp_466 - (struct Eq_1080 *) 0xF0)->t0000;
				Mem973[esp_466 - 0xEC + edx_934:byte] = (byte) edx_970;
				(esp_466 - (struct Eq_1090 *) 0xF0)->t0000 = edx_970;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_1095 *) 0xF0)->t0000;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				eax_797 = eax_907;
				esi_792 = edx_934;
				word32 edx_993 = Mem990[esp_466 - 0xEC + eax_907:word32];
				byte dl_996 = (byte) ((word32) edx_993 + ecx_916);
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (word32) dl_996;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (word32) (esp_466 - (struct Eq_884 *) 0x0104)->t0000 + 0x0014;
				Eq_2 edx_1006 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				byte cl_1012 = Mem1005[esp_466 - 0x0100 + edx_1006:byte];
				ecx_1013 = (word32) cl_1012;
				byte ch_1015 = *edi_1031;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = edx_1006;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				Eq_2 edx_1024 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				*edi_1031 = ch_1015 ^ cl_1012;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = edx_1024;
				(esp_466 - (struct Eq_884 *) 0x0104)->t0000 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				edi_1031 = (word32) edi_1031 + 0x01;
				edx_1034 = (esp_466 - (struct Eq_884 *) 0x0104)->t0000;
				ebp_1037 = ebp_1037 - 0x01;
			} while (ebp_1037 != 0x00);
		}
		(esp_466 - (struct Eq_933 *) 0x0100)->t0000 = edx_1034;
		(esp_466 - (struct Eq_943 *) 252)->t0000 = (esp_466 - (struct Eq_938 *) 0x0100)->t0000;
		word32 ebp_850;
		*ebpOut = (esp_466 - (struct Eq_949 *) 0xF8)->t0000;
		(esp_466 - (struct Eq_959 *) 0xF8)->t0000 = (esp_466 - (struct Eq_943 *) 252)->t0000;
		esp_466->t0014 = (esp_466 - (struct Eq_964 *) 0xF8)->t0000;
		Eq_2 eax_861 = esp_466->t0018;
		esp_466->t0018 = esp_466->t0014;
		esp_466->t0040 = esp_466->t0018;
		Eq_2 edx_874 = esp_466->t0040;
		esp_466->t0040 = eax_861;
		esp_466->t003C = edx_874;
		word32 edx_880;
		*edxOut = esp_466->t003C;
		return eax_861;
	}
}

// 00401566: Register int32 fn00401566(Stack word32 dwArg00, Stack ptr32 dwArg04, Register out ptr32 ebxOut)
int32 fn00401566(word32 dwArg00, ptr32 dwArg04, ptr32 & ebxOut)
{
	word32 eax_22 = dwArg00;
	while (true)
	{
		word16 ax_31 = DPB(eax_22, 0x00, 0) + 0x00;
		word32 eax_37 = DPB(eax_22, ax_31 + 42421, 0);
		if (ax_31 == 42419)
			break;
		eax_22 = eax_37 - 0x00010000;
	}
	struct Eq_1245 * eax_58 = DPB(eax_22, 0x00, 0);
	struct Eq_1248 * ecx_70 = eax_58 + eax_58->dw003C / 0x0040;
	int32 ecx_76 = ecx_70->dw0080;
	int32 ecx_77 = eax_58[ecx_76 / 0x0040];
	word32 ebx_92;
	*ebxOut = (char *) (eax_58 + ecx_77 / 0x0040) + 0x04;
	return ecx_77;
}

