// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401000(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc08_15 = 0x00;
	while (dwLoc08_15 < dwArg0C)
	{
		Mem29[dwArg04 + dwLoc08_15:byte] = Mem0[dwArg08 + dwLoc08_15:byte];
		dwLoc08_15 = dwLoc08_15 + 0x01;
	}
}

// 00401040: void fn00401040(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401040(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	if (dwArg0C >=u 0x01)
	{
		byte cl_46 = Mem0[dwArg04 + 0x00:byte];
		word32 dwLoc0C_113 = 0x01;
		word32 dwLoc18_109 = 0x00;
		do
		{
			word32 ecx_64 = dwLoc0C_113 + 0x01;
			byte al_61 = Mem0[dwArg04 + dwLoc0C_113:byte];
			dwLoc0C_113 = ecx_64;
			if ((word32) al_61 == (word32) cl_46)
			{
				if ((word32) Mem0[dwArg04 + ecx_64:byte] == 0x00)
				{
					Mem106[dwArg08 + dwLoc18_109:byte] = cl_46;
					dwLoc18_109 = dwLoc18_109 + 0x01;
					dwLoc0C_113 = ecx_64 + 0x01;
				}
				else
				{
					word32 eax_124 = fn00401150(fp - 0x10, dwArg04 + ecx_64) + ecx_64;
					dwLoc0C_113 = fn00401150(fp - 0x24, dwArg04 + eax_124) + eax_124;
					word32 dwLoc1C_139 = 0x00;
					while (dwLoc1C_139 <u dwLoc10)
					{
						Mem156[dwArg08 + dwLoc18_109:byte] = Mem0[dwArg08 + (dwLoc18_109 - dwLoc24):byte];
						dwLoc18_109 = dwLoc18_109 + 0x01;
						dwLoc1C_139 = dwLoc1C_139 + 0x01;
					}
				}
			}
			else
			{
				Mem168[dwArg08 + dwLoc18_109:byte] = al_61;
				dwLoc18_109 = dwLoc18_109 + 0x01;
			}
		} while (dwLoc0C_113 <u dwArg0C);
	}
}

// 00401150: Register word32 fn00401150(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401150(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00;
	word32 dwLoc14_13 = 0x00;
	do
	{
		word32 ecx_16 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 eax_25 = dwLoc08_12 << 0x07 | ecx_16 & 0x7F;
		word32 edx_28 = dwLoc14_13 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_12 = eax_25;
		dwLoc14_13 = edx_28;
	} while ((ecx_16 & 0x80) != 0x00);
	Mem38[dwArg04 + 0x00:word32] = eax_25;
	return edx_28;
}

// 004011B0: Register word32 fn004011B0(Stack word32 dwArg04)
word32 fn004011B0(word32 dwArg04)
{
	word32 eax_27;
	word32 eax_23 = CreateFileA(dwArg04, 0x80000000, 0x01, 0x00, 0x03, 0x80, 0x00);
	if (eax_23 == ~0x00)
		eax_27 = 0x00;
	else
		eax_27 = eax_23;
	return eax_27;
}

// 004011F0: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetModuleHandleA(0x00);
	LoadIconA(GetModuleHandleA(0x00), 0x00);
	word32 eax_46 = DPB(LoadCursorA(0x00, 0x7F00), RegisterClassA(fp - 0x60), 0);
	if ((word32) RegisterClassA(fp - 0x60) == 0x00)
		return 0x00;
	if (dwArg08 != 0x01)
		Mem532[0x00403050:word32] = 0x00;
	else
	{
		Mem533[0x00403050:word32] = 0x01;
		Mem535[0x00403040:word32] = dwArg04;
	}
	word32 dwLoc20_225;
	byte cl_190 = (byte) (dwLoc10 + 1011809);
	Mem192[0x00403060:word32] = dwLoc10 - Mem0[0x00403038:word32] - 445099 << 0x33 >> cl_190;
	CreateWindowExA(0x00, 0x00403020, 0x00403018, 0x01, 0x00011779, 0x00024256, 0x05536774, 0x00044318, 0x00, 0x00, GetModuleHandleA(0x00), 0x00);
	word32 esp_218 = fp - 0xCC;
	if (Mem192[0x00403050:word32] == 0x00)
	{
		esp_218 = fp - 0xD0;
		dwLoc20_225 = GetModuleHandleA(0x00);
	}
	else
		dwLoc20_225 = dwArg04;
	word32 eax_231 = dwLoc20_225 + Mem192[dwLoc20_225 + 0x3C:word32];
	word32 eax_242 = ((word32) Mem192[eax_231 + 0x06:word16] - 0x01) *s 0x28 + ((eax_231 + 0x18) + (word32) Mem192[eax_231 + 0x14:word16]);
	word32 eax_258 = (uint32) ((uint64) (uint32) (Mem192[eax_242 + 0x10:word32] - 0x01 + Mem192[eax_231 + 0x3C:word32]) /u Mem192[eax_231 + 0x3C:word32]) *s Mem192[eax_231 + 0x3C:word32] + Mem192[eax_242 + 0x14:word32];
	word32 esp_261 = esp_218 - 0x04;
	Mem262[esp_261 + 0x00:word32] = 0x0200;
	word32 eax_264 = fn00401D40(dwArg00);
	if (eax_264 == 0x00)
		return 0x00;
	Mem275[esp_261 + 0x00:word32] = 0x0200;
	Mem278[esp_261 - 0x04 + 0x00:word32] = eax_264;
	Mem281[esp_261 - 0x08 + 0x00:word32] = dwLoc20_225;
	GetModuleFileNameA(Mem281[esp_261 - 0x08 + 0x00:HMODULE], Mem281[esp_261 - 0x04 + 0x00:LPSTR], Mem281[esp_261 + 0x00:DWORD]);
	Mem285[esp_261 - 0x0C + 0x00:word32] = eax_264;
	word32 eax_286 = fn004011B0(dwArg00);
	if (eax_286 == 0x00)
		return 0x00;
	Mem297[esp_261 - 0x0C + 0x00:word32] = 0x00;
	Mem300[esp_261 - 0x10 + 0x00:word32] = eax_286;
	word32 eax_302 = GetFileSize(Mem300[esp_261 - 0x10 + 0x00:HANDLE], Mem300[esp_261 - 0x0C + 0x00:LPDWORD]) - eax_258;
	if (eax_302 == 0x00)
		return 0x00;
	Mem315[esp_261 - 0x14 + 0x00:word32] = eax_302 + 0x10;
	word32 eax_316 = fn00401D40(dwArg00);
	if (eax_316 == 0x00)
		return 0x00;
	Mem327[esp_261 - 0x14 + 0x00:word32] = 0x00;
	Mem329[esp_261 - 0x18 + 0x00:word32] = 0x00;
	Mem332[esp_261 - 0x1C + 0x00:word32] = eax_258;
	Mem335[esp_261 - 0x20 + 0x00:word32] = eax_286;
	SetFilePointer(Mem335[esp_261 - 0x20 + 0x00:HANDLE], Mem335[esp_261 - 0x1C + 0x00:LONG], Mem335[esp_261 - 0x18 + 0x00:PLONG], Mem335[esp_261 - 0x14 + 0x00:DWORD]);
	Mem338[esp_261 - 0x24 + 0x00:word32] = 0x00;
	Mem341[esp_261 - 0x28 + 0x00:word32] = fp - 0x28;
	Mem344[esp_261 - 44 + 0x00:word32] = eax_302;
	Mem347[esp_261 - 0x30 + 0x00:word32] = eax_316;
	Mem350[esp_261 - 0x34 + 0x00:word32] = eax_286;
	if (ReadFile(Mem350[esp_261 - 0x34 + 0x00:HANDLE], Mem350[esp_261 - 0x30 + 0x00:LPVOID], Mem350[esp_261 - 44 + 0x00:DWORD], Mem350[esp_261 - 0x28 + 0x00:LPDWORD], Mem350[esp_261 - 0x24 + 0x00:LPOVERLAPPED]) == 0x00)
		return 0x00;
	Mem362[esp_261 - 0x38 + 0x00:word32] = eax_286;
	CloseHandle(Mem362[esp_261 - 0x38 + 0x00:HANDLE]);
	if (dwLoc28 != eax_302)
		return 0x00;
	word32 eax_373 = GetDesktopWindow();
	Mem376[esp_261 - 0x3C + 0x00:word32] = 200;
	word32 eax_377 = fn00401D40(dwArg00);
	Mem381[eax_377 + 0x00:byte] = 0x01;
	Mem383[esp_261 - 0x3C + 0x00:word32] = 200;
	Mem386[esp_261 - 0x40 + 0x00:word32] = eax_377;
	Mem389[esp_261 - 0x44 + 0x00:word32] = eax_373;
	GetWindowTextA(Mem389[esp_261 - 0x44 + 0x00:HWND], Mem389[esp_261 - 0x40 + 0x00:LPSTR], Mem389[esp_261 - 0x3C + 0x00:int32]);
	if ((word32) Mem389[eax_377 + 0x00:byte] != 0x00)
	{
		Mem519[esp_261 - 0x48 + 0x00:word32] = eax_377;
		fn00401D10(dwArg00);
		return 0x00;
	}
	else
	{
		Mem398[esp_261 - 0x48 + 0x00:word32] = eax_377;
		fn00401D10(dwArg00);
		Mem402[esp_261 - 0x48 + 0x00:word32] = 0x40;
		Mem407[esp_261 - 0x4C + 0x00:word32] = eax_316 - 0x40 + eax_302;
		Mem410[esp_261 - 0x50 + 0x00:word32] = eax_316;
		memcpy(Mem410[esp_261 - 0x50 + 0x00:(ptr void)], Mem410[esp_261 - 0x4C + 0x00:(ptr void)], Mem410[esp_261 - 0x48 + 0x00:size_t]);
		word32 eax_415 = Mem410[eax_316 + 0x00:word32];
		Mem422[esp_261 - 0x48 + 0x00:word32] = Mem410[eax_316 + 0x04:word32];
		Mem425[0x0040304C:word32] = fn00401D40(dwArg00);
		if (Mem425[0x0040304C:word32] != 0x00)
		{
			word32 esp_461;
			Mem432[esp_261 - 0x48 + 0x00:word32] = eax_415;
			Mem435[esp_261 - 0x4C + 0x00:word32] = Mem432[0x0040304C:word32];
			Mem440[esp_261 - 0x50 + 0x00:word32] = eax_316 + 0x08;
			fn00401040(dwArg00, dwArg04, dwArg08);
			Mem443[0x0040303C:word32] = edi;
			Mem444[0x00403034:word32] = esi;
			Mem445[0x00403048:word32] = ebx;
			Mem446[0x00403044:word32] = fp - 0x04;
			Mem449[esp_261 - 0x48 + 0x00:word32] = 4199793;
			word32 eax_450 = Mem449[esp_261 - 0x48 + 0x00:word32];
			Mem455[0x00403058:word32] = Mem449[fs:0x18:word32];
			if (Mem455[0x00403050:word32] != 0x00)
			{
				Mem504[esp_261 - 0x48 + 0x00:word32] = eax_450 - Mem455[0x00403040:word32];
				fn004015D0(fp - 0x04, dwArg00);
				esp_461 = esp_261 - 0x44;
			}
			else
			{
				Mem508[esp_261 - 0x48 + 0x00:word32] = 0x00;
				Mem514[esp_261 - 0x4C + 0x00:word32] = eax_450 - GetModuleHandleA(Mem508[(esp_261 - 0x48) + 0x00:LPCSTR]);
				fn004015D0(fp - 0x04, dwArg00);
				esp_461 = esp_261 - 0x48;
			}
			word32 esp_463 = esp_461 - 0x04;
			Mem464[esp_463 + 0x00:word32] = Mem455[0x0040304C:word32];
			word32 eax_465 = fn00401740(fp - 0x04, dwArg00);
			if (eax_465 != 0x00)
			{
				word32 esp_485;
				word32 ebp_486;
				byte SCZO_487;
				word32 ebx_488;
				word32 esi_489;
				word32 edi_490;
				word32 eax_491;
				word32 ecx_492;
				word32 edx_493;
				word16 ax_494;
				byte SZO_495;
				byte C_496;
				byte Z_497;
				byte cl_498;
				selector fs_499;
				Mem464[0x0040305C:word32]();
				return eax_491;
			}
			else
			{
				Mem474[esp_463 + 0x00:word32] = Mem464[0x0040304C:word32];
				fn00401D10(dwArg00);
				Mem478[esp_463 + 0x00:word32] = 0x6188;
				ExitProcess(Mem478[esp_463 + 0x00:UINT]);
			}
		}
		else
		{
			Mem429[esp_261 - 0x48 + 0x00:word32] = 0x0351;
			ExitProcess(Mem429[esp_261 - 0x48 + 0x00:UINT]);
		}
	}
}

// 004015D0: void fn004015D0(Register word32 ebp, Stack word32 dwArg04)
void fn004015D0(word32 ebp, word32 dwArg04)
{
	word32 dwLoc24_14;
	word32 esp_16 = fp - 0x28;
	if (Mem0[0x00403050:word32] != 0x00)
		dwLoc24_14 = Mem0[0x00403040:word32];
	else
	{
		esp_16 = fp - 44;
		dwLoc24_14 = GetModuleHandleA(0x00);
	}
	if (dwLoc24_14 == 0x00)
		return;
	word32 edx_61 = dwLoc24_14 + Mem0[dwLoc24_14 + 0x3C:word32];
	word32 esp_63 = esp_16 - 0x04;
	Mem64[esp_63 + 0x00:word32] = 0x40;
	Mem66[esp_63 - 0x04 + 0x00:word32] = 0x3000;
	Mem70[esp_63 - 0x08 + 0x00:word32] = Mem66[edx_61 + 0x50:word32];
	Mem72[esp_63 - 0x0C + 0x00:word32] = 0x00;
	Mem74[0x00403054:word32] = VirtualAlloc(Mem72[esp_63 - 0x0C + 0x00:LPVOID], Mem72[esp_63 - 0x08 + 0x00:SIZE_T], Mem72[esp_63 - 0x04 + 0x00:DWORD], Mem72[esp_63 + 0x00:DWORD]);
	if (Mem74[0x00403054:word32] == 0x00)
		return;
	Mem83[esp_63 - 0x10 + 0x00:word32] = Mem74[edx_61 + 0x50:word32];
	Mem86[esp_63 - 0x14 + 0x00:word32] = dwLoc24_14;
	word32 edx_87 = Mem86[0x00403054:word32];
	Mem89[esp_63 - 0x18 + 0x00:word32] = edx_87;
	fn00401000(dwArg00, dwArg04, dwArg08);
	word32 eax_95 = Mem89[0x00403054:word32] - dwLoc24_14;
	if (Mem89[edx_61 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_127 = dwLoc24_14 + Mem89[edx_61 + 0xA0:word32];
		while (Mem89[dwLoc0C_127 + 0x04:word32] != 0x00)
		{
			word32 eax_142 = Mem89[dwLoc0C_127 + 0x04:word32] - 0x08 >>u 0x01;
			word32 ecx_145 = dwLoc0C_127 + 0x08;
			word32 dwLoc08_148 = 0x00;
			while (dwLoc08_148 <u eax_142)
			{
				if ((word32) ecx_145[dwLoc08_148 * 0x02] >> 0x0C == 0x03)
					Mem189[Mem89[0x00403054:word32] + Mem89[dwLoc0C_127 + 0x00:word32] + ((word32) ecx_145[dwLoc08_148 * 0x02] & 0x0FFF):word32] = Mem89[Mem89[0x00403054:word32] + Mem89[dwLoc0C_127 + 0x00:word32] + ((word32) ecx_145[dwLoc08_148 * 0x02] & 0x0FFF):word32] + eax_95;
				dwLoc08_148 = dwLoc08_148 + 0x01;
			}
			dwLoc0C_127 = dwLoc0C_127 + Mem89[dwLoc0C_127 + 0x04:word32];
		}
	}
	Mem106[esp_63 - 0x10 + 0x00:word32] = dwArg04;
	word32 eax_109 = Mem106[esp_63 - 0x10 + 0x00:word32] + Mem106[0x00403054:word32];
	word32 esp_113;
	word32 ebp_114;
	byte SCZO_115;
	word32 esi_116;
	byte Z_117;
	word32 eax_118;
	byte SZO_119;
	byte C_120;
	word32 ecx_121;
	word32 edx_122;
	eax_109();
}

// 00401740: Register word32 fn00401740(Register word32 ebp, Stack word32 dwArg04)
word32 fn00401740(word32 ebp, word32 dwArg04)
{
}

// 00401C70: void fn00401C70(Stack word32 dwArg04, Stack word32 dwArg08)
void fn00401C70(word32 dwArg04, word32 dwArg08)
{
}

// 00401CE0: void fn00401CE0(Stack word32 dwArg04)
void fn00401CE0(word32 dwArg04)
{
	Mem22[Mem0[Mem0[0x00403058:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 00401D10: void fn00401D10(Stack word32 dwArg04)
void fn00401D10(word32 dwArg04)
{
	HeapFree(GetProcessHeap(), 0x00, dwArg04);
}

// 00401D40: Register word32 fn00401D40(Stack word32 dwArg04)
word32 fn00401D40(word32 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

