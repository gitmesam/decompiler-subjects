// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: Register word32 fn00401028(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi, Register out ptr32 ebpOut)
word32 fn00401028(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi, ptr32 & ebpOut)
{
	word32 esp_3;
	bool P_4;
	word32 ecx_5;
	word32 * esi_6;
	byte SCZO_7;
	bool C_8;
	ui32 edx_9;
	ui32 * ebx_10;
	word16 ax_11;
	byte al_12;
	word32 ebp_13;
	byte SZO_14;
	struct Eq_24 * edi_15;
	word32 eax_16;
	fn00400FD5();
	return eax_16;
}

// 0040FDA4: Register Eq_78 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetCurrentThreadId();
	GetCurrentProcessId();
	Eq_88 eax_14 = GetModuleHandleA(&globals->t434F30);
	GetProcessHeap();
	GetProcessHeap();
	GetCurrentThreadId();
	GetFileType(dwLoc0C);
	GetVersion();
	Eq_109 eax_33 = GetProcAddress(eax_14, &globals->t434F52);
	GetVersion();
	GetCurrentProcessId();
	GetCurrentThreadId();
	Eq_122 eax_47 = eax_33();
	GetFileSize(eax_14, null);
	<anonymous> * eax_67 = (eax_47 ^ 0xC0000005) + 4259419;
	ptr32 esp_69;
	word32 ebp_70;
	byte SCZO_71;
	word32 eax_72;
	byte SZO_73;
	bool C_74;
	bool Z_75;
	byte al_76;
	word32 ecx_77;
	word32 edx_78;
	word32 ebx_79;
	word32 esi_80;
	word32 edi_81;
	eax_67();
	GetVersion();
	*(esp_69 - 0x04) = (FARPROC *) eax_33;
	do
	{
		*(esp_69 - 0x08) = 0x00;
		SizeofResource(*(esp_69 - 0x08), *(esp_69 - 0x04));
		*(esp_69 - 0x04) = (FARPROC *) eax_33;
		*(esp_69 - 0x08) = 0x00;
		SizeofResource(*(esp_69 - 0x08), *(esp_69 - 0x04));
		*(esp_69 - 0x04) = fp - 0x24;
		GetVersion();
		*(esp_69 - 0x08) = (FARPROC *) eax_33;
		*(esp_69 - 0x0C) = 0x00;
		SizeofResource(*(esp_69 - 0x0C), *(esp_69 - 0x08));
		*(esp_69 - 0x08) = 0x40;
		GetCurrentThreadId();
		GetCurrentProcessId();
		*(esp_69 - 0x0C) = 60117;
		*(esp_69 - 0x10) = 0x00401000;
		*(esp_69 - 0x14) = 0x00;
		*(esp_69 - 0x18) = 0x0121;
		*(esp_69 - 0x1C) = 0x03;
		*(esp_69 - 0x20) = 0x00;
		*(esp_69 - 0x24) = 0x06;
		*(esp_69 - 0x28) = 0xC0000000;
		*(esp_69 - 44) = 4411194;
		CreateFileA(*(esp_69 - 44), *(esp_69 - 0x28), *(esp_69 - 0x24), *(esp_69 - 0x20), *(esp_69 - 0x1C), *(esp_69 - 0x18), *(esp_69 - 0x14));
		VirtualProtect(*(esp_69 - 0x10), *(esp_69 - 0x0C), *(esp_69 - 0x08), *(esp_69 - 0x04));
		GetCommandLineW();
		GetCurrentProcessId();
		*(esp_69 - 0x04) = (union Eq_122 *) eax_47;
		*(esp_69 - 0x08) = 0x00;
		*(esp_69 - 0x0C) = 388;
		*(esp_69 - 0x10) = 0x03;
		*(esp_69 - 0x14) = 0x00;
		*(esp_69 - 0x18) = 0x03;
		*(esp_69 - 0x1C) = 0x20000000;
		*(esp_69 - 0x20) = 4411178;
	} while (CreateFileA(*(esp_69 - 0x20), *(esp_69 - 0x1C), *(esp_69 - 0x18), *(esp_69 - 0x14), *(esp_69 - 0x10), *(esp_69 - 0x0C), *(esp_69 - 0x08)) != ~0x00);
	*(esp_69 - 0x08) = 60117;
	GetCurrentProcessId();
	*(esp_69 - 0x0C) = 0x00401000;
	GetCurrentThreadId();
	word32 esp_172;
	word32 ebp_173;
	byte SCZO_174;
	word32 eax_175;
	byte SZO_176;
	bool C_177;
	bool Z_178;
	byte al_179;
	word32 ecx_180;
	word32 edx_181;
	word32 ebx_182;
	word32 esi_183;
	word32 edi_184;
	(eax_47 - ~0x4040FF75)();
	GetCurrentProcessId();
	word32 ebp_189;
	return fn00401028((byte) GetCommandLineA(), ecx_180, edx_181, ebx_182, ebp_173, esi_183, edi_184, out ebp_189);
}

