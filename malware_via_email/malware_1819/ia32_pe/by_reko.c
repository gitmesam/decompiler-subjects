// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	__align(fp - 0x04);
	Eq_10 eax_9 = GetModuleHandleA(null);
	Eq_16 edi_13 = *((word32) eax_9 + 0x003C);
	word32 edx_14 = (word32) Mem0[eax_9 + 0x06 + edi_13:word16];
	word32 ebx_122 = edi_13 + 0xF8 + eax_9;
	if (edx_14 > 0x00)
	{
		int32 esi_119 = 0x00;
		while (fn004018F0(ebx_122, &globals->t402230, 0x06) != 0x00)
		{
			esi_119 = esi_119 + 0x01;
			ebx_122 = ebx_122 + 0x28;
			if (esi_119 >= edx_14)
				break;
		}
	}
	VirtualProtect(eax_9, 0x1000, 0x04, fp - 0x040C);
	*((word32) edi_13 + ((word32) eax_9 + 0x0088)) = ebx_122->dw000C;
	*((word32) edi_13 + ((word32) eax_9 + 0x008C)) = ebx_122->dw0008;
	Eq_57 eax_50 = FindResourceA(eax_9, (CHAR *) 311, &globals->t402240);
	LockResource(LoadResource(eax_9, eax_50));
	SizeofResource(eax_9, eax_50);
	Eq_57 eax_77 = FindResourceA(0x00, (CHAR *) 0x0138, &globals->t402240);
	SizeofResource(0x00, eax_77);
	LockResource(LoadResource(0x00, eax_77));
	fn00401550();
	GetModuleFileNameA(0x00, fp - 1400, 0x0104);
}

// 004014BC: void fn004014BC(Register Eq_13 edx)
void fn004014BC(LPCSTR edx)
{
	wsprintfA(fp - 0x98, &globals->t402150, tLocAC);
	if (RegCreateKeyExA((struct HKEY__ *) 0x80000001, fp - 0x98, 0x00, 0x00, 0x00, 0x000F003F, null, fp - 0x14, fp - 0x10) == 0x00)
	{
		RegSetValueExA(dwLoc14, edx, 0x00, 0x04, fp - 0x18, 0x04);
		RegCloseKey(dwLoc14);
	}
}

// 00401550: void fn00401550()
void fn00401550()
{
	__align(fp - 0x04);
	Eq_185 eax_13 = 0x30;
	do
	{
		Mem21[fp - 0x88 + eax_13:word32] = Mem0[eax_13 + 4202604:word32];
		Mem23[fp - 0x8C + eax_13:word32] = Mem21[eax_13 + 4202600:word32];
		Mem25[fp - 0x90 + eax_13:word32] = Mem23[eax_13 + 0x00402064:word32];
		Mem27[fp - 0x94 + eax_13:word32] = Mem25[eax_13 + 0x00402060:word32];
		eax_13 = eax_13 - 0x10;
	} while (eax_13 != 0x00);
	word128 xmm0_44 = globals->ow402140;
	Eq_222 eax_45 = 0x00;
	do
	{
		Mem53[fp - 0x84 + eax_45:word128] = __pxor(Mem27[fp - 0x84 + eax_45:word128], xmm0_44);
		eax_45 = eax_45 + 0x10;
	} while (eax_45 < 0x30);
	__pxor(owLocA4, xmm0_44);
	wsprintfA(fp - 0x0644, &globals->t402158, tLoc0668);
	int32 eax_106 = (int32) bLoc0644;
	byte al_107 = (byte) eax_106;
	Eq_255 ecx_108 = fp - 0x0130;
	if (eax_106 != 0x00)
	{
		Eq_289 ebx_191 = fp - 0x0644;
		do
		{
			ebx_191 = ebx_191 + 0x01;
			int32 edi_223 = (int32) (byte) globals->ow402100;
			Eq_295 esi_224 = fp - 0x44;
			if (edi_223 != 0x00)
			{
				do
				{
					if (edi_223 == eax_106)
						goto l004018D8;
					esi_224 = (word32) esi_224 + 0x01;
					edi_223 = (int32) *esi_224;
				} while (edi_223 != 0x00);
				if (edi_223 == eax_106)
					goto l0040176F;
				goto l00401797;
			}
			if (edi_223 != eax_106)
			{
l00401797:
				int32 edx_273 = (int32) bLoc24;
				Eq_310 esi_277 = fp - 0x24;
				if (edx_273 != 0x00)
				{
					do
					{
						if (edx_273 == eax_106)
							goto l004018C2;
						esi_277 = esi_277 + 0x01;
						edx_273 = (int32) *esi_277;
					} while (edx_273 != 0x00);
					if (edx_273 == eax_106)
						goto l004017C2;
				}
				else if (edx_273 == eax_106)
				{
l004018C2:
					if (esi_277 != 0x00)
					{
l004017C2:
						Eq_374 esi_291 = esi_277 - (fp - 0x24);
						al_107 = (byte) (int32) Mem53[esi_291 + 0x0D - ((SLICE((esi_291 + 0x0D) *s 0x4EC4EC4F, word32, 32) >> 0x03) - (esi_291 + 0x0D >> 0x1F)) *s 0x1A + (fp - 0x24):byte];
					}
				}
				goto l004017E8;
			}
l004018D8:
			if (esi_224 == 0x00)
				goto l00401797;
l0040176F:
			word32 esi_256 = esi_224 - (fp - 0x44);
			al_107 = (byte) (int32) *((word32) (fp - (struct Eq_548 *) 0x44) + ((esi_256 + 0x0D) - ((SLICE((esi_256 + 0x0D) *s 0x4EC4EC4F, word32, 32) >> 0x03) - (esi_256 + 0x0D >> 0x1F)) *s 0x1A));
l004017E8:
			*ecx_108 = al_107;
			eax_106 = (int32) *ebx_191;
			al_107 = (byte) eax_106;
			ecx_108 = ecx_108 + 0x01;
		} while (eax_106 != 0x00);
	}
	*ecx_108 = 0x00;
	fn004014BC(&globals->t402160);
	fn004014BC(&globals->t40216C);
	fn004014BC(&globals->t402160);
	fn004014BC(&globals->t402160);
	fn004014BC(&globals->t40216C);
	fn004014BC(&globals->t402160);
	fn004014BC(&globals->t40216C);
	fn004014BC(&globals->t402160);
}

// 004018F0: Register word32 fn004018F0(Stack Eq_26 dwArg04, Stack Eq_26 dwArg08, Stack uint32 dwArg0C)
word32 fn004018F0(HMODULE dwArg04, HMODULE dwArg08, uint32 dwArg0C)
{
	if (dwArg04 != dwArg08 && dwArg0C != 0x00)
	{
		if (!DPB(CZ, false, 0))
		{
			uint32 ebx_89 = 0x00;
			do
			{
				if (dwArg04[ebx_89 * 0x04 / 0x0028] != dwArg08[(ebx_89 * 0x04) / 0x0028])
				{
					int32 eax_100 = (word32) dwArg04[ebx_89 * 0x04 / 0x0028];
					int32 ecx_101 = (word32) dwArg08[ebx_89 * 0x04 / 0x0028];
					if (eax_100 != ecx_101)
					{
						word32 eax_107 = 0x01;
						if (eax_100 <= ecx_101)
							eax_107 = ~0x00;
						return eax_107;
					}
					int32 eax_116 = (word32) dwArg04->a0001[ebx_89].b0000;
					int32 ecx_117 = (word32) dwArg08->a0001[ebx_89].b0000;
					if (eax_116 != ecx_117)
					{
						word32 eax_123 = 0x01;
						if (eax_116 <= ecx_117)
							eax_123 = ~0x00;
						return eax_123;
					}
					int32 eax_132 = (word32) dwArg04->a0002[ebx_89].b0000;
					int32 ecx_133 = (word32) dwArg08->a0002[ebx_89].b0000;
					if (eax_132 == ecx_133)
					{
						word32 eax_150 = 0x01;
						if ((word32) dwArg04->a0003[ebx_89].b0000 <= (word32) ((dwArg08->a0003))[ebx_89].b0000)
							eax_150 = ~0x00;
						return eax_150;
					}
					else
					{
						word32 eax_139 = 0x01;
						if (eax_132 <= ecx_133)
							eax_139 = ~0x00;
						return eax_139;
					}
				}
				ebx_89 = ebx_89 + 0x01;
			} while (ebx_89 < dwArg0C >> 0x02);
		}
		int32 ebx_58 = dwArg04 + ((dwArg0C >> 0x02) * 0x04) / 0x0028;
		int32 edx_59 = dwArg08 + ((dwArg0C >> 0x02) * 0x04) / 0x0028;
		if ((dwArg0C & 0x03) != 0x00)
		{
			Eq_461 eax_63[] = null;
			do
			{
				if ((word32) (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&eax_63[ebx_58].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] != (word32) (&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&(eax_63)[edx_59].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000)[0x00])
				{
					word32 eax_78 = 0x01;
					if ((word32) (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&eax_63[ebx_58].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] <= (word32) (&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&((&(eax_63)[edx_59].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000))[0x00].a0000)[0x00])
						eax_78 = ~0x00;
					return eax_78;
				}
				eax_63 = (Eq_461 (*)[]) (eax_63 + 0x01)->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000->a0000;
			} while (eax_63 < (dwArg0C & 0x03));
		}
	}
	return 0x00;
}

