// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register ui32 fn00401024(Register byte al, Register (ptr32 Eq_4) ecx, Register byte dh, Register byte dl, Register (ptr32 Eq_7) ebx, Register ui32 ebp, Register (ptr32 Eq_9) esi, Register (ptr32 byte) edi, Stack word32 dwArg00, Stack word32 dwArg02, Stack word32 dwArg04, Stack word32 dwArg0C, Stack word32 dwArg10, Stack word32 dwArg14, Stack word32 dwArg18, Stack word32 dwArg1C, Stack word32 dwArg20, Stack word32 dwArg24, Stack word32 dwArg2C, Stack ptr32 dwArg30, Stack word32 dwArg34, Stack word32 dwArg38, Register out ptr32 ebpOut)
ui32 fn00401024(byte al, Eq_4 * ecx, byte dh, byte dl, Eq_7 * ebx, ui32 ebp, Eq_9 * esi, byte * edi, word32 dwArg00, word32 dwArg02, word32 dwArg04, word32 dwArg0C, word32 dwArg10, word32 dwArg14, word32 dwArg18, word32 dwArg1C, word32 dwArg20, word32 dwArg24, word32 dwArg2C, ptr32 dwArg30, word32 dwArg34, word32 dwArg38, ptr32 & ebpOut)
{
	*edi = esi->b0000;
	byte dh_8 = dh - al - C;
	byte al_28 = __inb(~0x34);
	struct Eq_42 * edx_10 = DPB(edx, dh_8, 8);
	word16 ax_32 = DPB(ax, al_28, 0);
	if (dh_8 == 0x00)
	{
		struct Eq_50 * edi_106 = edx_10->dw0000 *s 122;
		if (P)
		{
			byte al_192 = (byte) ebx;
			byte ah_195 = SLICE(ebx, byte, 8);
			struct Eq_265 ** esp_199 = (char *) fp + 0x04;
			if (&esi->b0000 + 0x01 + esi->dw554151A7 / 0x554151AB > 0x00)
			{
				ebx->a0028[ebx].w0000 = __fstcw();
				ui32 ecx_271 = ecx | ecx->dw2B150162;
				word32 eax_275 = (word32) (ebx[ebp * 0x08 / 0x0028] *s ebx);
				byte cl_272 = (byte) ecx_271;
				struct Eq_265 ** esp_285 = (char *) fp + 0x02;
				byte dh_288 = SLICE(eax_275 + 0x01, byte, 8);
				if (((byte) (eax_275 + 0x01) | 0x0F) < 0x00)
				{
					struct Eq_341 * ecx_330 = DPB(ecx_271, cl_272 - SLICE(dwArg00, byte, 8), 0);
					up32 v49_334 = ecx_330 + ecx_330->dw61DFB0D2 / 0x61DFB0D6;
					ecx_330->dw61DFB0D2 = v49_334;
					esp_285 = fp;
					if (dh_288 - ~0x02 - (v49_334 < 0x00) == 0x00)
						;
				}
				*(esp_285 - 0x04) = 0x04;
			}
			else
			{
				struct Eq_226 * ebp_202 = ebp - ((ebx->aB980B8BD))[ebx].dw0000;
				ebp_202->b0027 = ebp_202->b0027 & ~0x25;
				__cli();
				struct Eq_244 * ecx_201 = DPB(ecx, 0x41, 0);
				struct Eq_247 * edx_206 = DPB(edx_10, dl - ch, 0);
				struct Eq_251 * ebx_212 = DPB(ebx, ~0x62, 8);
				struct Eq_254 * eax_214 = DPB(ebx, ah_195 ^ 0x38, 8);
				if (!P)
				{
					esp_199 = fp;
					eax_214 = ecx_201 - 0x5A;
					al_192 = (byte) (ecx_201 - 0x5A);
				}
				edi_106->dw0000 = edx_206 + edi_106->dw0000 / 0x0068;
				struct Eq_265 * edx_233 = *esp_199;
				ebx_212->a0000[0x00].b0000 = (byte) (ebx_212->a0000[0x00].b0000 - 0x40);
				ptr32 esp_238 = (char *) esp_199 + 0x04;
				*(esp_238 - 0x04) = esp_238;
				word16 dx_237 = (word16) edx_233;
				if ((eax_214 & 1421994796) >= 0x00)
				{
					edx_233->dw0017 = edx_233->dw0017 ^ ebp_202;
					__outb(~0x0E, al_192);
				}
				else
				{
					struct Eq_308 * edx_248 = DPB(edx_233, 151, 0);
					edx_248->b0000 = edx_248->b0000 | ~0x62;
					edi_106->dw0000 = __in(DPB(dx_237, 151, 0));
					__syscall(0x19);
					__lock();
				}
			}
		}
		else
		{
			edi_106->dw95E37419 = edi_106->dw95E37419 ^ ebp;
			word16 ax_114 = __aad(ax_32);
			struct Eq_112 * esp_121;
			word32 ebx_122;
			bool C_123;
			byte dh_124;
			byte al_125;
			byte SCZO_126;
			word32 esi_127;
			word32 edi_128;
			bool Z_129;
			word32 ebp_130;
			word32 edx_131;
			word32 ecx_132;
			ui32 eax_133;
			struct Eq_125 * ds_134;
			byte SZO_135;
			bool P_136;
			word16 ax_137;
			struct Eq_129 * cs_138;
			byte cl_139;
			byte CZ_140;
			byte dl_141;
			byte ch_142;
			byte bh_143;
			byte ah_144;
			byte SO_145;
			word16 dx_146;
			struct Eq_138 * ss_147;
			bool S_148;
			word16 si_149;
			fn00400FFB();
			return eax_133;
		}
	}
	else
	{
		(word32 *) 3832116346 = dwArg38;
		*(dwArg30 - 0x6C) = __rcr(*(dwArg30 - 0x6C), 0x53, false);
		__lock();
	}
}

// 00415F31: Register Eq_360 Win32CrtStartup()
Eq_360 Win32CrtStartup()
{
	GetCommandLineA();
	GetLastError();
	Eq_360 eax_23 = CreateFileW(&globals->t43393D, 0x00, 0x00, null, 0x03, 0x0185, 0x00);
	if (eax_23 == ~0x00)
	{
		CloseHandle(eax_23);
		Eq_360 eax_106 = CreateFileW(&globals->t433971, 0x20000000, 0x00, null, 0x03, 0xA5, 0x00);
		struct Eq_435 * esp_107 = fp + ~0x2B;
		if (eax_106 == ~0x00)
		{
			GetFileSize(eax_23, null);
			GetLastError();
			do
			{
				GetCommandLineA();
				GetFileType(eax_106);
				GetLastError();
				GetLastError();
				GetFileType(eax_106);
				Eq_360 eax_375 = CreateFileA(&globals->t4338F4, 0x60000000, 0x01, null, 0x03, 0x01A3, 0x00);
				dwLoc28 = eax_375;
			} while (eax_375 != ~0x00);
			GetFileSize(eax_375, null);
			GetFileSize(eax_106, null);
			GetModuleHandleA(&globals->t433904);
			GetLastError();
			esp_107 = fp + ~0x33;
		}
		GetCommandLineA();
		Eq_443 eax_122 = GetProcAddress(esp_107->t0000, esp_107->t0004);
		ptr32 esp_123 = (char *) &esp_107->t0004 + 0x04;
		*(esp_123 - 0x04) = (union Eq_360 *) eax_23;
		CloseHandle(*(esp_123 - 0x04));
		GetLastError();
		*(esp_123 - 0x04) = (union Eq_360 *) eax_106;
		GetFileType(*(esp_123 - 0x04));
		*(esp_123 - 0x04) = (union Eq_360 *) eax_23;
		GetFileType(*(esp_123 - 0x04));
		*(esp_123 - 0x04) = 0x00;
		*(esp_123 - 0x08) = (union Eq_360 *) eax_23;
		GetFileSize(*(esp_123 - 0x08), *(esp_123 - 0x04));
		GetCommandLineA();
		GetCommandLineA();
		*(esp_123 - 0x04) = 0x00;
		*(esp_123 - 0x08) = 0x00;
		*(esp_123 - 0x0C) = 0x00;
		*(esp_123 - 0x10) = (union Eq_360 *) dwLoc28;
		GetFileSize(*(esp_123 - 0x10), *(esp_123 - 0x0C));
		*(esp_123 - 0x0C) = 0x00;
		*(esp_123 - 0x10) = (union Eq_360 *) dwLoc28;
		GetFileType(*(esp_123 - 0x10));
		*(esp_123 - 0x10) = 0x00;
		*(esp_123 - 0x14) = (union Eq_360 *) eax_23;
		GetFileSize(*(esp_123 - 0x14), *(esp_123 - 0x10));
		Eq_360 eax_184 = eax_122();
		GetCommandLineA();
		*(esp_123 - 0x10) = (union Eq_360 *) eax_23;
		CloseHandle(*(esp_123 - 0x10));
		GetCommandLineA();
		*(esp_123 - 0x10) = 0x00;
		*(esp_123 - 0x14) = 0x00;
		*(esp_123 - 0x18) = 0x03;
		*(esp_123 - 0x1C) = 0x00;
		*(esp_123 - 0x20) = 0x07;
		*(esp_123 - 0x24) = 0xA0000000;
		*(esp_123 - 0x28) = 4405549;
		Eq_360 eax_225 = CreateFileA(*(esp_123 - 0x28), *(esp_123 - 0x24), *(esp_123 - 0x20), *(esp_123 - 0x1C), *(esp_123 - 0x18), *(esp_123 - 0x14), *(esp_123 - 0x10));
		ptr32 esp_228;
		word32 ebp_229;
		byte SCZO_230;
		word32 eax_231;
		bool Z_232;
		byte SZO_233;
		bool C_234;
		byte al_235;
		word32 ecx_236;
		byte dh_237;
		byte dl_238;
		word32 ebx_239;
		word32 esi_240;
		word32 edi_241;
		(*((word32) (eax_184 ^ 0xC0000005) + 0x00416164))();
		GetLastError();
		*(esp_228 - 0x04) = 0x00;
		*(esp_228 - 0x08) = (union Eq_360 *) dwLoc28;
		GetFileSize(*(esp_228 - 0x08), *(esp_228 - 0x04));
		*(esp_228 - 0x04) = fp - 0x24;
		*(esp_228 - 0x08) = 0x00;
		*(esp_228 - 0x0C) = (union Eq_360 *) eax_106;
		GetFileSize(*(esp_228 - 0x0C), *(esp_228 - 0x08));
		*(esp_228 - 0x08) = 0x40;
		ptr32 esp_260 = esp_228 - 0x08;
		do
		{
			struct Eq_823 * esp_264 = esp_260 - 0x04;
			esp_264->t0000 = eax_225;
			CloseHandle(esp_264->t0000);
			esp_264->t0000.u0 = 0x00014EE4;
			*(esp_264 - 0x04) = (union Eq_360 *) eax_23;
			GetFileType(*(esp_264 - 0x04));
			*(esp_264 - 0x04) = 0x00401000;
			*(esp_264 - 0x08) = 0x00;
			*(esp_264 - 0x0C) = (union Eq_360 *) eax_106;
			GetFileSize(*(esp_264 - 0x0C), *(esp_264 - 0x08));
			VirtualProtect(*(esp_264 - 0x04), esp_264->t0000, esp_264->t0004, esp_264->t0008);
			esp_264->t0008.u0 = 0x00;
			esp_264->t0004.u0 = 0x23;
			esp_264->t0000.u0 = 0x03;
			*(esp_264 - 0x04) = 0x00;
			*(esp_264 - 0x08) = 0x06;
			*(esp_264 - 0x0C) = 0xE0000000;
			*(esp_264 - 0x10) = 0x0043390E;
			esp_260 = (char *) &esp_264->t0008 + 0x04;
		} while (CreateFileW(*(esp_264 - 0x10), *(esp_264 - 0x0C), *(esp_264 - 0x08), *(esp_264 - 0x04), esp_264->t0000, esp_264->t0004, esp_264->t0008) != ~0x00);
		esp_264->t0008.u0 = 0x00401000;
		esp_264->t0004 = eax_23;
		GetFileType(esp_264->t0004);
		esp_264->t0004 = eax_184;
		esp_264->t0000.u0 = 0x00014EE4;
		*(esp_264 - 0x04) = 0x00;
		*(esp_264 - 0x08) = (union Eq_360 *) eax_225;
		GetFileSize(*(esp_264 - 0x08), *(esp_264 - 0x04));
		*(esp_264 - 0x04) = (union Eq_360 *) eax_106;
		GetFileType(*(esp_264 - 0x04));
		dwLoc2C = eax_184 - ~0x40415EE4;
	}
	word32 esp_54;
	ui32 ebp_55;
	byte SCZO_56;
	word32 eax_57;
	bool Z_58;
	byte SZO_59;
	bool C_60;
	byte al_61;
	struct Eq_4 * ecx_62;
	byte dh_63;
	byte dl_64;
	struct Eq_7 * ebx_65;
	struct Eq_9 * esi_66;
	byte * edi_67;
	dwLoc2C();
	word32 ebp_81;
	return fn00401024(al_61, ecx_62, dh_63, dl_64, ebx_65, ebp_55, esi_66, edi_67, ebp, dwLoc02, dwArg00, dwArg08, dwArg0C, dwArg10, dwArg14, dwArg18, dwArg1C, dwArg20, dwArg28, dwArg2C, dwArg30, dwArg34, out ebp_81);
}

