// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 esp_13;
	byte SCZO_14;
	word32 esi_15;
	byte SZO_16;
	bool C_17;
	word32 eax_18;
	bool Z_19;
	word32 ebx_20;
	word32 ebp_21;
	word32 edi_22;
	byte cl_23;
	byte dl_24;
	word32 edx_25;
	word32 ecx_26;
	bool S_27;
	word16 ax_28;
	real64 rArg0_29;
	SHLWAPI.dll!StrChrA();
	if (eax_18 != 0x00)
		return 0x00;
	*(esp_13 - 0x04) = eax_18;
	*(esp_13 - 0x08) = 0x00404070;
	ptr32 esp_57;
	byte SCZO_58;
	word32 esi_59;
	byte SZO_60;
	bool C_61;
	word32 eax_62;
	bool Z_63;
	word32 ebx_64;
	word32 ebp_65;
	word32 edi_66;
	byte cl_67;
	byte dl_68;
	word32 edx_69;
	word32 ecx_70;
	bool S_71;
	word16 ax_72;
	real64 rArg0_73;
	SHLWAPI.dll!StrStrIA();
	if (eax_62 != 0x00)
		return 0x00;
	*(esp_57 - 0x04) = ebx_64;
	*(esp_57 - 0x08) = ebp_65;
	*(esp_57 - 0x0C) = edi_66;
	*(esp_57 - 0x10) = 0x0040407C;
	*(esp_57 - 0x14) = 0x00404084;
	*(esp_57 - 0x14) = (HMODULE *) LoadLibraryA(*(esp_57 - 0x14));
	Eq_97 eax_91 = GetProcAddress(*(esp_57 - 0x14), *(esp_57 - 0x10));
	*(esp_57 - 0x10) = 0x00;
	*(esp_57 - 0x14) = 0x00;
	*(esp_57 - 0x18) = 0x00;
	*(esp_57 - 0x1C) = 0x00;
	*(esp_57 - 0x20) = 0x00;
	int32 eax_108 = eax_91();
	*(esp_57 - 0x24) = ~0x00;
	*(esp_57 - 0x28) = ~0x00;
	Eq_156 rArg0_119 = <invalid>;
	word32 edx_115 = <invalid>;
	word32 ebx_110 = <invalid>;
	word32 esi_105 = <invalid>;
	Eq_156 edi_121 = eax_108 + 0x1C;
	if (AreAllAccessesGranted(*(esp_57 - 0x28), *(esp_57 - 0x24)) == 0x00)
		edi_121 = eax_108 + 0x1C ^ 0x0E;
	*(esp_57 - 0x24) = esp_57 - 0x10;
	*(esp_57 - 0x28) = 0x40;
	*(esp_57 - 44) = 0x3000;
	*(esp_57 - 0x30) = 0x00401000;
	VirtualProtect(*(esp_57 - 0x30), *(esp_57 - 44), *(esp_57 - 0x28), *(esp_57 - 0x24));
	struct Eq_231 * eax_143 = null;
	do
	{
		if (esi_105 == edi_121)
			esi_105.u0 = 0x00;
		eax_143[700564] = (struct Eq_231) (*((word32) esi_105 + 0x00405000) ^ eax_143[700564] ^ 0x5A);
		Eq_156 esi_163 = (word32) esi_105 + 0x01;
		if (esi_163 == edi_121)
			esi_163.u0 = 0x00;
		eax_143->b402379 = *((word64) esi_163 + 0x00405000) ^ eax_143->b402379 ^ 0x5A;
		Eq_156 esi_173 = (word64) esi_163 + 0x01;
		if (esi_173 == edi_121)
			esi_173.u0 = 0x00;
		eax_143->b40237A = *((word64) esi_173 + 0x00405000) ^ eax_143->b40237A ^ 0x5A;
		Eq_156 esi_183 = (word64) esi_173 + 0x01;
		if (esi_183 == edi_121)
			esi_183.u0 = 0x00;
		eax_143->b40237B = *((word64) esi_183 + 0x00405000) ^ eax_143->b40237B ^ 0x5A;
		Eq_156 esi_193 = (word64) esi_183 + 0x01;
		if (esi_193 == edi_121)
			esi_193.u0 = 0x00;
		eax_143->b40237C = *((word64) esi_193 + 0x00405000) ^ eax_143->b40237C ^ 0x5A;
		Eq_156 esi_203 = (word64) esi_193 + 0x01;
		if (esi_203 == edi_121)
			esi_203.u0 = 0x00;
		ui8 dl_212 = *((word64) esi_203 + 0x00405000) ^ eax_143->b40237D;
		eax_143 = eax_143 + 0x01;
		eax_143->b402377 = dl_212 ^ 0x5A;
		edx_115 = DPB(edx_115, dl_212 ^ 0x5A, 0);
		esi_105 = (word64) esi_203 + 0x01;
	} while (eax_143 < (struct Eq_231 *) 0x1440);
	*(esp_57 - 0x0C) = 4202744;
	*(esp_57 - 0x08) = 0x00;
	struct Eq_356 * esi_221 = &globals->t403678;
	word32 ebx_222 = ebx_110 + edx_115;
	word32 ebp_224 = 4202744;
	up32 ecx_232 = 0x00;
	do
	{
		Eq_366 eax_240 = esi_221->t0004;
		Eq_416 eax_242 = eax_240 - 0x08 >> 0x01;
		word16 ax_243 = (word16) eax_242;
		ebx_222 = (struct Eq_358 *) ((char *) ebx_222 - 0x0FBFDF08);
		word16 * edx_247 = (char *) &esi_221->t0004 + 0x04;
		if (eax_242 > 0x00)
		{
			ebx_222 = eax_240 - 0x08 >> 0x01;
			do
			{
				ui32 eax_417 = (word32) *edx_247;
				ax_243 = (word16) eax_417;
				if ((eax_417 & 0xF000) == 0x3000)
				{
					struct Eq_395 * eax_433 = (eax_417 & 0x0FFF) + esi_221->dw0000;
					eax_433->dw4020F8 = eax_433->dw4020F8 + 0xF04020F8;
					ax_243 = (word16) &eax_433->dw4020F8;
				}
				edx_247 = edx_247 + 0x01;
				ebx_222 = ebx_222 - 0x01;
			} while (ebx_222 != null);
			ecx_232 = *(esp_57 - 0x08);
		}
		ecx_232 = (word32) esi_221->t0004 + ecx_232;
		*(esp_57 - 0x08) = ecx_232;
		struct Eq_373 * edx_258 = esi_221 + edx_247;
		esi_221 = esi_221 + Mem257[esi_221 + 0x04:word32];
	} while (ecx_232 < 232);
	*(esp_57 - 0x08) = 0x00402E6C;
	struct Eq_432 * edi_263 = &globals->t402E6C;
	if (globals->dw402E7C != 0x00)
	{
		do
		{
			edx_258 = edi_263->dw000C + ebp_224;
			*(esp_57 - 0x24) = (struct Eq_373 **) edx_258;
			Eq_91 eax_302 = LoadLibraryA(*(esp_57 - 0x24));
			*(esp_57 - 0x04) = (HMODULE *) eax_302;
			ax_243 = (word16) eax_302;
			Eq_91 ecx_305 = eax_302;
			ebx_222 = ebx_222 * 0x05;
			if (eax_302 != null)
			{
				word32 eax_330 = edi_263->dw0000;
				if (eax_330 == 0x00)
					eax_330 = edi_263->dw0010;
				word32 * ebp_336 = ebp_224 + eax_330;
				int32 eax_339 = *ebp_336;
				esi_221 = (struct Eq_356 *) (ebx_222 + (esi_221 * 0x08) / 0x6ED3EB30);
				ax_243 = (word16) eax_339;
				word32 * edi_341 = edi_263->dw0010 + *(esp_57 - 0x0C);
				if (eax_339 != 0x00)
				{
					while (true)
					{
						Eq_97 eax_378;
						if (eax_339 < 0x00)
						{
							*(esp_57 - 0x24) = (word32) *ebp_336;
							*(esp_57 - 0x28) = (HMODULE *) ecx_305;
							eax_378 = GetProcAddress(*(esp_57 - 0x28), *(esp_57 - 0x24));
							ebx_222 = ebx_222 + ecx_305;
						}
						else
						{
							edx_258 = (struct Eq_373 *) *(esp_57 - 0x0C);
							*(esp_57 - 0x24) = edx_258 + (eax_339 + 0x02) / 0x0031;
							*(esp_57 - 0x28) = (HMODULE *) ecx_305;
							esi_221 = esi_221 * 0x09;
							eax_378 = GetProcAddress(*(esp_57 - 0x28), *(esp_57 - 0x24));
						}
						*edi_341 = (word32) eax_378;
						ebp_336 = ebp_336 + 0x01;
						eax_339 = *ebp_336;
						ax_243 = (word16) eax_339;
						edi_341 = edi_341 + 0x01;
						if (eax_339 == 0x00)
							break;
						ecx_305 = (Eq_91) *(esp_57 - 0x04);
					}
				}
				ebp_224 = *(esp_57 - 0x0C);
				edi_263 = (struct Eq_432 *) *(esp_57 - 0x08);
			}
			edi_263 = edi_263 + 0x01;
			*(esp_57 - 0x08) = (struct Eq_432 **) edi_263;
		} while (edi_263->dw0010 != 0x00);
	}
	fn00402B58(ax_243, 4205400, edx_258, ebx_222, ebp_224, esi_221, psegLoc04, rArg0_119);
	*(esp_57 - 0x24) = 0x00;
	ExitProcess(*(esp_57 - 0x24));
}

// 00402A93: void fn00402A93(Register (ptr32 Eq_637) eax, Register int32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Register (ptr32 Eq_637) edi)
void fn00402A93(Eq_637 * eax, int32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_637 * edi)
{
	struct Eq_373 * edx_7 = DPB(edx, edx - 0x02 + ecx + dh, 8);
	struct Eq_356 * esi_12 = esi ^ edi->dw0011;
	fn00402A9B(eax, ecx, edx_7, (char *) ebx + 0x01, ebp, esi_12, edi, psegArg00);
}

// 00402A9B: void fn00402A9B(Register (ptr32 Eq_637) eax, Register int32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Register (ptr32 Eq_637) edi, Stack (ptr16 Eq_666) psegArg00)
void fn00402A9B(Eq_637 * eax, int32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_637 * edi, Eq_666 * psegArg00)
{
	if (!P)
		return;
	(struct Eq_637 **) 27265 = (struct Eq_637 **) eax;
	fn00402AFB(eax, ecx, edx, ebx, ebp, esi, edi);
}

// 00402AF9: void fn00402AF9(Register (ptr32 Eq_637) eax, Register int32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Register (ptr32 Eq_637) edi)
void fn00402AF9(Eq_637 * eax, int32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_637 * edi)
{
	ptr32 fp;
	struct Eq_373 * edx;
	<type-error> Mem0;
	struct Eq_637 * eax;
	int32 ecx;
	struct Eq_358 * ebx;
	word32 ebp;
	struct Eq_356 * esi;
	struct Eq_637 * edi;
	esp_1 = fp;
	v4_4 = edx->dw002D - 0xE8A99704;
	edx->dw002D = v4_4;
	SCZO_6 = cond(v4_4);
	fn00402AFB(eax, ecx, edx, ebx, ebp, esi, edi);
}

// 00402AFB: void fn00402AFB(Register (ptr32 Eq_637) eax, Register int32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Register (ptr32 Eq_637) edi)
void fn00402AFB(Eq_637 * eax, int32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_637 * edi)
{
fn00402AFB_entry:
	esp = fp
	eax = eax - 0xE8A99704
	al = (byte) eax
	C = __das(al, &al)
	eax = eax | 4262715666
	al = (byte) eax
	ax = (word16) eax
	SZO = cond(eax)
	Z = (bool) SZO
	C = false
	SCZO = DPB(SCZO, C, 0)
	branch Test(PO,P) l00402B06_thunk_fn00402A9B
l00402AFB:
l00402AFB:
	C = __das(al, &al)
	eax = eax | 4262715666
	SZO = cond(eax)
	C = false
	branch Test(PO,P) l00402B06_thunk_fn00402A9B
l00402B06_thunk_fn00402A9B:
	fn00402A9B(eax, ecx, edx, ebx, ebp, esi, edi, psegArg00)
	return
l00402B06_thunk_fn00402B08:
	fn00402B08(eax, ecx, edx, ebx, ebp, esi, edi)
	return
fn00402AFB_exit:
}

// 00402B08: void fn00402B08(Register (ptr32 Eq_637) eax, Register int32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Register (ptr32 Eq_637) edi)
void fn00402B08(Eq_637 * eax, int32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_637 * edi)
{
	if (Z)
		fn00402A93(eax, ecx, edx, ebx, ebp, esi, edi);
	else
	{
		__lock();
		__outw(dx, DPB(ax, al - 0x14 - C, 0));
	}
}

// 00402B58: FpuStack Eq_156 fn00402B58(Register word16 ax, Register word32 ecx, Register (ptr32 Eq_373) edx, Register (ptr32 Eq_358) ebx, Register word32 ebp, Register (ptr32 Eq_356) esi, Stack (ptr16 Eq_446) psegArg00, FpuStack Eq_156 rArg0)
Eq_156 fn00402B58(word16 ax, word32 ecx, Eq_373 * edx, Eq_358 * ebx, word32 ebp, Eq_356 * esi, Eq_446 * psegArg00, Eq_156 rArg0)
{
	struct Eq_637 * eax_21 = (int32) ax;
	Eq_156 rArg0_5 = rArg0 - (real64) ebx->dw6ED3EB2C;
	struct Eq_637 * es_edi_11 = (&(edx - 0x53)[ebx].ptr0000.dwBBF66AF8)[285369666];
	__cli();
	byte al_23 = (byte) eax_21;
	do
	{
		edx = (struct Eq_373 *) ((char *) edx + 0x01);
		bh = bh - ch;
		word16 dx_28 = (word16) edx;
		struct Eq_801 * eax_30 = DPB(eax_21, al_23 ^ 188, 0);
		ebx = DPB(ebx, bh, 8);
		word32 ecx_39 = ecx - 0x01;
		if (bh != 0x00 && ecx_39 != 0x00)
		{
			es_edi_11->dwBBF66AF8 = es_edi_11->dwBBF66AF8 - eax_30 - (bh < 0x00);
			__inb(dx_28);
			__hlt();
		}
		eax_21 = es_edi_11;
		byte al_45 = (byte) es_edi_11;
		ecx = ecx_39 - 0x01;
		ch = SLICE(ecx_39 - 0x01, byte, 8);
		if (bh == 0x00 && ecx_39 != 0x01)
		{
			fn00402AF9(es_edi_11, ecx_39 - 0x01, edx, ebx, ebp, esi, es_edi_11);
			return rArg0_5;
		}
		__das(al_45, &al_23);
	} while (bh != 0x00);
}

