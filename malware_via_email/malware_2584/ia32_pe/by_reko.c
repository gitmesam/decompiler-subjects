// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: Register word32 fn00401027(Register byte ch, Register byte dl, Register (ptr32 int32) ebx, Register (ptr32 Eq_6) edi, FpuStack real64 rArg0, FpuStack out Eq_8 rArg0Out)
word32 fn00401027(byte ch, byte dl, int32 * ebx, Eq_6 * edi, real64 rArg0, Eq_8 & rArg0Out)
{
	ui32 edx_4 = DPB(edx, ~0x09, 8);
	null[edx_4].ptr0000 = gs;
	*ebx = (int32) rArg0;
	if (Z)
	{
		Mem38[edi + 0x00:byte] = Mem12[edi + 0x00:byte] + ch + C;
		edi->dw004D = edi->dw004D + ~0x38;
	}
	else
	{
		word32 esp_17;
		byte dh_18;
		word32 eax_19;
		word32 edx_20;
		struct Eq_44 * gs_21;
		word32 ebx_22;
		real64 rArg0_23;
		bool Z_24;
		byte al_25;
		bool C_26;
		word32 edi_27;
		byte ch_28;
		byte SCZO_29;
		byte SZO_30;
		struct Eq_54 * es_31;
		byte dl_32;
		fn00400FF1();
		return eax_19;
	}
}

// 00414671: Register Eq_58 Win32CrtStartup()
Eq_58 Win32CrtStartup()
{
	Eq_58 eax_22 = CreateFileW(&globals->t42EC89, 0x00, 0x00, 0x00, 0x03, 0x01A3, 0x00);
	GetCommandLineA();
	ptr32 esp_23 = fp - 0x4C;
l004146A6:
	union Eq_58 * esp_68 = esp_23 - 0x04;
	*esp_68 = 0x00;
	*(esp_68 - 0x04) = 0x01A4;
	*(esp_68 - 0x08) = 0x03;
	*(esp_68 - 0x0C) = 0x00;
	*(esp_68 - 0x10) = 0x04;
	*(esp_68 - 0x14) = 0x20000000;
	*(esp_68 - 0x18) = 4385754;
	Eq_58 eax_82 = CreateFileA(*(esp_68 - 0x18), *(esp_68 - 0x14), *(esp_68 - 0x10), *(esp_68 - 0x0C), *(esp_68 - 0x08), *(esp_68 - 0x04), *esp_68);
	DWORD * esp_126 = (char *) esp_68 + 0x04;
	if (eax_82 == ~0x00)
	{
		GetCommandLineA();
		*esp_68 = (union Eq_58 *) eax_22;
		GetFileType(*esp_68);
		*esp_68 = 0x00;
		*(esp_68 - 0x04) = 0x0105;
		*(esp_68 - 0x08) = 0x03;
		*(esp_68 - 0x0C) = 0x00;
		ptr32 esp_179 = esp_68 - 0x0C;
		do
		{
			struct Eq_372 * esp_205 = esp_179 - 0x04;
			esp_205->t0000.u0 = 0x04;
			*(esp_205 - 0x04) = 0x00;
			*(esp_205 - 0x08) = 0x0042EC4E;
			Eq_58 eax_211 = CreateFileW(*(esp_205 - 0x08), *(esp_205 - 0x04), esp_205->t0000, esp_205->t0004, esp_205->t0008, esp_205->t000C, esp_205->t0010);
			ptr32 esp_212 = (char *) &esp_205->t0010 + 0x04;
l0041470F:
			union Eq_58 * esp_235 = esp_212 - 0x04;
			*esp_235 = 0x00;
			*(esp_235 - 0x04) = (union Eq_58 *) eax_82;
			GetFileSize(*(esp_235 - 0x04), *esp_235);
			*esp_235 = 0x00;
			*(esp_235 - 0x04) = (union Eq_58 *) eax_569;
			GetFileSize(*(esp_235 - 0x04), *esp_235);
			*esp_235 = 0x00;
			*(esp_235 - 0x04) = (union Eq_58 *) eax_569;
			GetFileSize(*(esp_235 - 0x04), *esp_235);
			*esp_235 = 0x00;
			*(esp_235 - 0x04) = 0x23;
			*(esp_235 - 0x08) = 0x03;
			*(esp_235 - 0x0C) = 0x00;
			*(esp_235 - 0x10) = 0x06;
			*(esp_235 - 0x14) = 0x60000000;
			*(esp_235 - 0x18) = 0x0042EBB4;
			Eq_58 eax_270 = CreateFileW(*(esp_235 - 0x18), *(esp_235 - 0x14), *(esp_235 - 0x10), *(esp_235 - 0x0C), *(esp_235 - 0x08), *(esp_235 - 0x04), *esp_235);
			esp_23 = (char *) esp_235 + 0x04;
			if (eax_270 != ~0x00)
				goto l004146A6;
			GetLastError();
			*esp_235 = 0x00;
			*(esp_235 - 0x04) = 33;
			*(esp_235 - 0x08) = 0x03;
			*(esp_235 - 0x0C) = 0x00;
			*(esp_235 - 0x10) = 0x02;
			*(esp_235 - 0x14) = 0x80000000;
			*(esp_235 - 0x18) = 0x0042EC6E;
			Eq_58 eax_290 = CreateFileW(*(esp_235 - 0x18), *(esp_235 - 0x14), *(esp_235 - 0x10), *(esp_235 - 0x0C), *(esp_235 - 0x08), *(esp_235 - 0x04), *esp_235);
			esp_179 = (char *) esp_235 + 0x04;
			dwLoc3C = eax_290;
		} while (eax_290 != ~0x00);
		*esp_235 = (union Eq_58 *) eax_270;
		CloseHandle(*esp_235);
		GetCommandLineA();
		GetLastError();
		*esp_235 = 0x00;
		*(esp_235 - 0x04) = (union Eq_58 *) eax_569;
		GetFileSize(*(esp_235 - 0x04), *esp_235);
		*esp_235 = (union Eq_58 *) eax_290;
		CloseHandle(*esp_235);
		*esp_235 = 0x00;
		*(esp_235 - 0x04) = 0x80;
		*(esp_235 - 0x08) = 0x03;
		*(esp_235 - 0x0C) = 0x00;
		*(esp_235 - 0x10) = 0x05;
		*(esp_235 - 0x14) = 0x00;
		*(esp_235 - 0x18) = 4385837;
		Eq_58 eax_328 = CreateFileA(*(esp_235 - 0x18), *(esp_235 - 0x14), *(esp_235 - 0x10), *(esp_235 - 0x0C), *(esp_235 - 0x08), *(esp_235 - 0x04), *esp_235);
		dwLoc1C = eax_328;
		if (eax_328 != ~0x00)
		{
			*esp_235 = (union Eq_58 *) dwLoc44;
			*(esp_235 - 0x04) = 0x00013612;
			GetLastError();
			GetLastError();
			*(esp_235 - 0x08) = 0x00;
			*(esp_235 - 0x0C) = 0x26;
			*(esp_235 - 0x10) = 0x03;
			*(esp_235 - 0x14) = 0x00;
			*(esp_235 - 0x18) = 0x03;
			*(esp_235 - 0x1C) = 0x20000000;
			*(esp_235 - 0x20) = 0x0042EBAA;
			CreateFileA(*(esp_235 - 0x20), *(esp_235 - 0x1C), *(esp_235 - 0x18), *(esp_235 - 0x14), *(esp_235 - 0x10), *(esp_235 - 0x0C), *(esp_235 - 0x08));
			*(esp_235 - 0x08) = 0x00;
			*(esp_235 - 0x0C) = (union Eq_58 *) dwLoc34;
			Eq_58 eax_547 = GetFileSize(*(esp_235 - 0x0C), *(esp_235 - 0x08));
			word32 esp_552;
			word32 ebp_553;
			byte SCZO_554;
			word32 eax_555;
			bool Z_556;
			byte SZO_557;
			bool C_558;
			byte ch_559;
			byte dl_560;
			int32 * ebx_561;
			struct Eq_6 * edi_562;
			real64 rArg0_563;
			(dwLoc44 - 2143664684)();
			real64 rArg0_564;
			return fn00401027(ch_559, dl_560, ebx_561, edi_562, rArg0_563, out rArg0_564);
		}
		*esp_235 = 4385848;
		*(esp_235 - 0x04) = (union Eq_58 *) eax_569;
		CloseHandle(*(esp_235 - 0x04));
		Eq_58 eax_340 = LoadLibraryA(*esp_235);
		*esp_235 = 0x00;
		*(esp_235 - 0x04) = 0x01A5;
		*(esp_235 - 0x08) = 0x03;
		esp_126 = esp_235 - 0x08;
		do
		{
			struct Eq_849 * esp_362 = esp_126 - 0x04;
			esp_362->t0000.u0 = 0x00;
			*(esp_362 - 0x04) = 0x01;
			*(esp_362 - 0x08) = 0x80000000;
			*(esp_362 - 0x0C) = 0x0042EC76;
			Eq_58 eax_370 = CreateFileA(*(esp_362 - 0x0C), *(esp_362 - 0x08), *(esp_362 - 0x04), esp_362->t0000, esp_362->t0004, esp_362->t0008, esp_362->t000C);
			esp_362->t000C.u0 = 4385736;
			esp_362->t0008 = eax_340;
			esp_362->t0004 = eax_569;
			GetFileType(esp_362->t0004);
			Eq_980 eax_383 = GetProcAddress(esp_362->t0008, esp_362->t000C);
			GetCommandLineA();
			esp_362->t000C.u0 = 0x00;
			esp_362->t0008.u0 = 0x0122;
			esp_362->t0004.u0 = 0x03;
			esp_362->t0000.u0 = 0x00;
			*(esp_362 - 0x04) = 0x07;
			*(esp_362 - 0x08) = 0xA0000000;
			*(esp_362 - 0x0C) = 4385858;
			Eq_58 eax_401 = CreateFileW(*(esp_362 - 0x0C), *(esp_362 - 0x08), *(esp_362 - 0x04), esp_362->t0000, esp_362->t0004, esp_362->t0008, esp_362->t000C);
			esp_362->t000C.u0 = 0x00;
			esp_362->t0008.u0 = 0x0102;
			esp_362->t0004.u0 = 0x03;
			esp_362->t0000.u0 = 0x00;
			*(esp_362 - 0x04) = 0x05;
			*(esp_362 - 0x08) = 0xE0000000;
			*(esp_362 - 0x0C) = 0x0042EBBA;
			eax_211 = CreateFileA(*(esp_362 - 0x0C), *(esp_362 - 0x08), *(esp_362 - 0x04), esp_362->t0000, esp_362->t0004, esp_362->t0008, esp_362->t000C);
			esp_212 = (char *) &esp_362->t000C + 0x04;
			dwLoc18 = eax_211;
			Eq_58 eax_569 = eax_211;
			if (eax_211 != ~0x00)
				goto l0041470F;
			esp_362->t000C.u0 = 0x00;
			esp_362->t0008.u0 = 0x0123;
			esp_362->t0004.u0 = 0x03;
			esp_362->t0000.u0 = 0x00;
			*(esp_362 - 0x04) = 0x05;
			*(esp_362 - 0x08) = 0xE0000000;
			*(esp_362 - 0x0C) = 4385805;
			dwLoc34 = CreateFileW(*(esp_362 - 0x0C), *(esp_362 - 0x08), *(esp_362 - 0x04), esp_362->t0000, esp_362->t0004, esp_362->t0008, esp_362->t000C);
			esp_362->t000C = eax_290;
			CloseHandle(esp_362->t000C);
			GetCommandLineA();
			esp_362->t000C.u0 = 0x00;
			esp_362->t0008 = eax_270;
			GetFileSize(esp_362->t0008, esp_362->t000C);
			esp_362->t000C.u0 = 0x00;
			esp_362->t0008 = eax_401;
			GetFileType(esp_362->t0008);
			esp_362->t0008 = eax_328;
			CloseHandle(esp_362->t0008);
			esp_362->t0008.u0 = 0x00;
			GetCommandLineA();
			esp_362->t0004.u0 = 0x00;
			esp_362->t0000 = eax_370;
			GetFileSize(esp_362->t0000, esp_362->t0004);
			Eq_58 eax_478 = eax_383();
			esp_362->t0004 = eax_569;
			CloseHandle(esp_362->t0004);
			esp_362->t0004.u0 = 0x00;
			esp_362->t0000.u0 = 0x24;
			*(esp_362 - 0x04) = 0x03;
			*(esp_362 - 0x08) = 0x00;
			*(esp_362 - 0x0C) = 0x04;
			*(esp_362 - 0x10) = 0x00;
			*(esp_362 - 0x14) = 0x0042EBC0;
			dwLoc44 = eax_478;
			dwLoc48 = eax_478;
			esp_126 = (DWORD *) &esp_362->t0008;
		} while (CreateFileA(*(esp_362 - 0x14), *(esp_362 - 0x10), *(esp_362 - 0x0C), *(esp_362 - 0x08), *(esp_362 - 0x04), esp_362->t0000, esp_362->t0004) != ~0x00);
	}
	union Eq_58 * esp_128 = esp_126 - 0x04;
	*esp_128 = (union Eq_58 *) dwLoc1C;
	CloseHandle(*esp_128);
	GetCommandLineA();
	*esp_128 = 0x00;
	*(esp_128 - 0x04) = (union Eq_58 *) dwLoc18;
	GetFileSize(*(esp_128 - 0x04), *esp_128);
	*esp_128 = 0x00;
	*(esp_128 - 0x04) = (union Eq_58 *) dwLoc3C;
	GetFileSize(*(esp_128 - 0x04), *esp_128);
	Eq_58 eax_153 = GetLastError();
	word32 esp_155;
	word32 ebp_156;
	byte SCZO_157;
	Eq_58 eax_158;
	bool Z_159;
	byte SZO_160;
	bool C_161;
	byte ch_162;
	byte dl_163;
	word32 ebx_164;
	word32 edi_165;
	real64 rArg0_166;
	(*((word32) (dwLoc48 ^ 0x80070057) + 0x00414A04))();
	return eax_158;
}

