// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 esi_387 = AddAce(null, 0x00, 0x00, null, 0x00) + 0x25 + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00) + AddAce(0x00, 0x00, 0x00, 0x00, 0x00);
	Eq_3 ebx_15 = null;
	if (AreAnyAccessesGranted(~0x00, ~0x00) == 0x00)
		esi_387 = esi_387 - 0x22;
	struct Eq_246 * ecx_399 = null;
	do
	{
		if (ebx_15 == esi_387)
			ebx_15 = null;
		ecx_399[4199088] = (struct Eq_246) (ecx_399[4199088] ^ ebx_15[0x00101000]);
		ecx_399 = ecx_399 + 0x01;
		ebx_15 = (Eq_3) ((char *) &ebx_15->dw0000 + 0x01);
	} while (ecx_399 < (struct Eq_246 *) 5152);
	struct Eq_268 * edi_425 = &globals->t401030;
	struct Eq_270 * edx_427 = &globals->t402590;
	Eq_272 ebp_429 = 0xF0401030;
	Eq_274 dwLoc0C_430 = null;
	do
	{
		Eq_276 eax_438 = edx_427->t0004;
		cui16 * ecx_445 = (char *) &edx_427->t0004 + 0x04;
		if (eax_438 - 0x08 >> 0x01 > 0x00)
		{
			esi_387 = eax_438 - 0x08 >> 0x01;
			do
			{
				if ((*ecx_445 & 0xF000) == 0x3000)
				{
					struct Eq_297 * eax_630 = ((word32) *ecx_445 & 0x0FFF) + edx_427->dw0000;
					eax_630->dw401030 = eax_630->dw401030 + 0xF0401030;
				}
				ecx_445 = ecx_445 + 0x01;
				esi_387 = esi_387 - 0x01;
			} while (esi_387 != null);
		}
		Eq_276 eax_450 = edx_427->t0004;
		word32 ecx_452 = dwLoc0C_430 + eax_450;
		edx_427 = edx_427 + eax_450;
		dwLoc0C_430 = ecx_452;
	} while (ecx_452 < (int32 (*)()) 228);
	struct Eq_324 * ebx_457 = &globals->t401D8C;
	struct Eq_324 * dwLoc0C_458 = &globals->t401D8C;
	Eq_272 edx_459 = edx_427 * 0x09;
	if (globals->dw401D9C != 0x00)
	{
		do
		{
			word32 ecx_495 = ebx_457->dw000C;
			Eq_272 eax_499 = LoadLibraryA(ecx_495 + 0x00401030);
			CloseHandle((void *) 0x62);
			CloseHandle((void *) 0x62);
			ecx_452 = ecx_495 + 0x00401030;
			ebp_429 = eax_499;
			esi_387 = ecx_495 + 0x00401030 + CloseHandle * 0x04;
			if (eax_499 != 0x00)
			{
				word32 ebp_535 = ebx_457->dw0000;
				if (ebp_535 == 0x00)
					ebp_535 = ebx_457->dw0010;
				ebp_429 = ebp_535 + 0x00401030;
				word32 * ebx_542 = ebx_457->dw0010 + 0x00401030;
				if (*ebp_429 != 0x00)
				{
					do
					{
						int32 eax_574 = *ebp_429;
						esi_387 = (Eq_3) ((word32) edx_459 + esi_387 * 0x02);
						word16 ax_576 = (word16) eax_574;
						if (eax_574 < 0x00)
						{
							edx_459 = (word32) ax_576;
							Eq_274 eax_597 = GetProcAddress(eax_499, edx_459);
							*ebx_542 = (word32) eax_597;
							ecx_452 = eax_597;
						}
						else
						{
							*ebx_542 = (word32) GetProcAddress(eax_499, eax_574 + 0x00401032);
							edx_459 = eax_499;
							ecx_452 = eax_574 + 0x00401032;
						}
						ebp_429 = ebp_429 + 0x04;
						edi_425 = &globals->t401030;
						ebx_542 = ebx_542 + 0x01;
					} while (*ebp_429 != 0x00);
				}
				ebx_457 = dwLoc0C_458;
			}
			ebx_457 = ebx_457 + 0x01;
			dwLoc0C_458 = ebx_457;
		} while (ebx_457->dw0010 != 0x00);
	}
	fn00401A80(&globals->t401A80, ecx_452, ebx_457, ebp_429, esi_387, edi_425, rArg0, rArg4);
	ExitProcess(0x00);
}

// 00401A80: FpuStack real64 fn00401A80(Register (ptr32 Eq_458) eax, Register Eq_274 ecx, Register (ptr32 Eq_324) ebx, Register Eq_272 ebp, Register Eq_3 esi, Register (ptr32 Eq_268) edi, FpuStack real64 rArg0, FpuStack real64 rArg4)
real64 fn00401A80(Eq_458 * eax, FARPROC ecx, Eq_324 * ebx, Eq_272 ebp, BOOL esi, Eq_268 * edi, real64 rArg0, real64 rArg4)
{
	*eax = (union Eq_458 *) (*eax - 0x01);
	int64 edx_eax_15 = (int64) eax;
	union Eq_458 * eax_119 = DPB(eax, __aam((byte) edx_eax_15), 0);
	*eax_119 = (union Eq_458 *) (int16) rArg0;
	word16 dx_115 = SLICE(edx_eax_15, word16, 32);
	edi->b0001 = __in(dx_115);
	byte SZO_23 = cond(ecx + 0x01);
	struct Eq_490 * edx_18 = SLICE(edx_eax_15, word32, 32);
	bool Z_138 = (bool) SZO_23;
	byte CZ_139 = SZO_23;
	ptr32 esp_102 = fp - 0x02;
	union Eq_458 * edi_100 = &edi->dw0002;
	byte * di_39 = (word16) &edi->dw0002;
	if (ecx != (int32 (*)()) 0x01)
	{
		if (ecx == (int32 (*)()) 0x01)
		{
			esp_102 = (word32) ebp + 0x04;
			dx_115 = (word16) ((char *) edx_18 + 0x01);
			if (edx_18 <= (struct Eq_490 *) 0x01)
			{
				__shrd(ebx, (word32) ebp + 0x04, ~0x12);
				*(eax_119 - 0x78) = &edi->dw0002 + *(eax_119 - 0x78) / 0x06;
				*di_39 = __in(dx_115);
			}
			eax_119 = eax_119 | 2914158896;
			edi->dw0002 = __in(dx_115);
			edi_100 = (union Eq_458 *) (&edi->dw0002 + 0x01);
			esi = esi - ebx->dw000E;
		}
		else
		{
			edx_18->t2357A9AD = esi;
			ebx->dw0000 = ebx->dw0000 & 242428781;
		}
		(union Eq_458 **) 0x3B5FEDEF = (union Eq_458 **) eax_119;
l00401AA9:
		edi_100 = eax_119 - 0x01;
		byte SZO_136 = cond(edi_100);
		eax_119 = edi_100;
		Z_138 = (bool) SZO_136;
		CZ_139 = SZO_136;
	}
	__cvtps2pd(*(esi - 0x31));
	*edi_100 = esi->dw0000;
	ptr32 esp_71 = esp_102 + 0x04;
	*(esp_71 - 0x04) = (char *) edi_100 + 0x08;
	ui32 eax_83 = eax_119 & ebx->dw532EAB27;
	dx_115 = DPB(dx_115, 0x69, 0);
	esi = (Eq_3) (esi + 0x01);
	byte al_84 = (byte) eax_83;
	word16 ax_86 = (word16) eax_83;
	if (!DPB(CZ_139, false, 0))
		__outb(dx_115, al_84);
	__outw(dx_115, ax_86);
	eax_119 = __indw(dx_115);
	edi_100 = (union Eq_458 *) *(esp_71 - 0x04);
	esp_102 = esp_71;
	goto l00401AA9;
}

