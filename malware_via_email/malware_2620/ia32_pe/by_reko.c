// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401026: void fn00401026(Register byte al, Register word32 ecx, Register (ptr32 byte) edx, Register int32 ebx, Register (ptr32 Eq_6) ebp, Register (ptr32 Eq_7) esi)
void fn00401026(byte al, word32 ecx, byte * edx, int32 ebx, Eq_6 * ebp, Eq_7 * esi)
{
	bool v4_5 = (*edx & 0x01 << cl) != 0x00;
	*edx = __ror(*edx, cl);
	ptr32 esp_1 = fp;
	bool C_35 = v4_5;
l00401027:
	word32 * esp_43 = esp_1 - 0x04;
	*esp_43 = ecx;
	byte al_46 = (byte) __aam(al);
	ebp = ebp - esi->b0000 - C_35;
	byte al_49 = (byte) __aam(al_46);
	*(esp_43 - 0x04) = ecx;
	word16 ax_56 = __aad(__aam(al_49));
	esp_1 = esp_43 - 0x04;
	esi = esi + ebx;
	eax = DPB(eax, ax_56, 0);
	al = (byte) ax_56;
	do
	{
		ch = ch ^ dh;
		ecx = DPB(ecx_204, ch, 8);
		if (!P)
		{
			Eq_78 v19_82 = null[ebx * ~0x2A].dw0000 >> 0x01;
			null[ebx * ~0x2A].t0000 = v19_82;
			C_35 = (bool) cond(v19_82);
			if (v19_82 <= 0x00)
				goto l00401027;
			struct Eq_127 * eax_90 = DPB(eax, al & 0xB8, 0);
			struct Eq_127 ** esp_92 = esp_1 - 0x04;
			*esp_92 = (struct Eq_127 **) eax_90;
			*(esp_92 - 0x04) = ecx;
			*(esp_92 - 0x08) = (byte **) edx;
			*(esp_92 - 0x0C) = ebx;
			*(esp_92 - 0x10) = esp_1;
			*(esp_92 - 0x14) = (struct Eq_6 **) ebp;
			*(esp_92 - 0x18) = (struct Eq_7 **) esi;
			*(esp_92 - 0x1C) = ebx *s ~0x2A;
			eax_90->dw5D27D73B = ebp + eax_90->dw5D27D73B / 0x04;
		}
		struct Eq_6 * esp_114 = esp_1 - 0x04;
		esp_114->ptr0000 = ebp;
		__aam(al);
		esi = esi + 0x01;
		word32 eax_124 = DPB(eax, esi->b0000, 8);
		*(esp_114 - ~0x50A3) = ecx + 0x01;
		__sti();
		edx = edx - 0x01;
		eax = (eax_124 ^ 4193834734) + 2083339001;
		ebp = esp_114;
		ecx = ecx + 0x01;
		ch = SLICE(ecx + 0x01, byte, 8);
		esp_1 = esp_114 - ~0x50A3;
		dh = SLICE(edx, byte, 8);
		word16 dx_133 = (word16) edx;
		al = (byte) eax;
		if (eax <= 0x00)
			null[ebx * ~0x2A].b0000 = esi->b0000;
		word32 ecx_204 = ecx;
	} while (eax > 0x00);
	__outb(77, al);
	null[ebx * ~0x2A].b0000 = al;
	*(esp_114 - ~0x509F) = ecx;
	__outb(dx_133, al);
	byte * edi_146 = ebx *s ~0x2A + 0x01;
	int32 eax_156 = __indw(dx_133);
	if ((eax & 1036320273) < 0x00)
	{
		(int32 *) ~0x1CA81741 = eax_156;
		byte ch_170 = Mem166[esp_114 - ~0x509F + eax_156:byte] + ~0x11 + (bh <u Mem148[DPB(ecx_204, ~0x11, 8) + 0x4E:byte]);
		word32 eax_176 = esi[0x02];
		word16 dx_175 = DPB(dx_133, (byte) eax_156 + Mem166[DPB(ecx_204, ch_170, 8) + 0x00:byte] + (ch_170 <u 0x00), 0);
		byte al_177 = (byte) eax_176;
		__outb(dx_175, al_177);
		*edi_146 = __in(dx_175);
		__cli();
		byte al_191;
		byte ah_192;
		__aaa(al_177, SLICE(eax_176, byte, 8), &al_191, &ah_192);
	}
}

// 00413018: Register Eq_281 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetModuleHandleA(&globals->t435D1E);
	GetCommandLineA();
	ptr32 esp_173 = fp - 0x54;
l00413056:
	struct Eq_294 * esp_62 = esp_173 - 0x04;
	esp_62->t0000 = (Eq_297) &globals->t435CEF;
	Eq_286 eax_64 = CreateFileW(esp_62->t0000, esp_62->t0004, esp_62->t0008, esp_62->t000C, esp_62->t0010, esp_62->t0014, esp_62->t0018);
	Eq_333 eax_67 = GetProcAddress(esp_62->t001C, esp_62->t0020);
	GetCommandLineA();
	esp_62->t0020 = null;
	esp_62->t001C = eax_64;
	GetFileType(esp_62->t001C);
	esp_62->t001C.u0 = 0x00;
	esp_62->t0018 = eax_64;
	GetFileType(esp_62->t0018);
	esp_62->t0018.u0 = 0x00;
	HMODULE * esp_225 = &esp_62->t0018;
	do
	{
		union Eq_286 * esp_90 = esp_225 - 0x04;
		*esp_90 = (union Eq_286 *) 0x00;
		*(esp_90 - 0x04) = 0x0101;
		*(esp_90 - 0x08) = 0x03;
		*(esp_90 - 0x0C) = 0x00;
		*(esp_90 - 0x10) = 0x00;
		*(esp_90 - 0x14) = 0x40000000;
		*(esp_90 - 0x18) = 4414582;
		Eq_286 eax_104 = CreateFileA(*(esp_90 - 0x18), *(esp_90 - 0x14), *(esp_90 - 0x10), *(esp_90 - 0x0C), *(esp_90 - 0x08), *(esp_90 - 0x04), *esp_90);
		Eq_676 eax_110 = eax_67();
		GetLastError();
		*esp_90 = (union Eq_286 *) eax_64;
		GetFileType(*esp_90);
		*esp_90 = (union Eq_286 *) 0x00;
		*(esp_90 - 0x04) = (union Eq_286 *) eax_104;
		Eq_281 eax_139 = GetFileSize(*(esp_90 - 0x04), *esp_90);
		ptr32 esp_141;
		word32 ebp_142;
		byte SCZO_143;
		word32 eax_144;
		byte SZO_145;
		bool C_146;
		bool Z_147;
		byte al_148;
		word32 ecx_149;
		word32 edx_150;
		word32 ebx_151;
		word32 esi_152;
		(*((word32) (eax_110 ^ 0xC0000005) + 0x00413114))();
		*(esp_141 - 0x04) = (union Eq_286 *) eax_64;
		GetFileType(*(esp_141 - 0x04));
		*(esp_141 - 0x04) = 0x00;
		*(esp_141 - 0x08) = 0xA0;
		*(esp_141 - 0x0C) = 0x03;
		*(esp_141 - 0x10) = 0x00;
		*(esp_141 - 0x14) = 0x04;
		*(esp_141 - 0x18) = 0xC0000000;
		*(esp_141 - 0x1C) = 4414634;
		Eq_286 eax_172 = CreateFileW(*(esp_141 - 0x1C), *(esp_141 - 0x18), *(esp_141 - 0x14), *(esp_141 - 0x10), *(esp_141 - 0x0C), *(esp_141 - 0x08), *(esp_141 - 0x04));
		esp_173 = esp_141;
		if (eax_172 != ~0x00)
			goto l00413056;
		*(esp_141 - 0x04) = fp - 0x10;
		*(esp_141 - 0x08) = 0x00;
		*(esp_141 - 0x0C) = (union Eq_286 *) eax_172;
		GetFileSize(*(esp_141 - 0x0C), *(esp_141 - 0x08));
		*(esp_141 - 0x08) = 0x40;
		*(esp_141 - 0x0C) = 0x00011D22;
		*(esp_141 - 0x10) = 0x00;
		*(esp_141 - 0x14) = 0x20;
		*(esp_141 - 0x18) = 0x03;
		*(esp_141 - 0x1C) = 0x00;
		*(esp_141 - 0x20) = 0x06;
		*(esp_141 - 0x24) = 0x40000000;
		*(esp_141 - 0x28) = 4414722;
		CreateFileA(*(esp_141 - 0x28), *(esp_141 - 0x24), *(esp_141 - 0x20), *(esp_141 - 0x1C), *(esp_141 - 0x18), *(esp_141 - 0x14), *(esp_141 - 0x10));
		*(esp_141 - 0x10) = 0x00401000;
		*(esp_141 - 0x14) = 0x00;
		*(esp_141 - 0x18) = 0x0103;
		*(esp_141 - 0x1C) = 0x03;
		*(esp_141 - 0x20) = 0x00;
		*(esp_141 - 0x24) = 0x00;
		*(esp_141 - 0x28) = 0x40000000;
		*(esp_141 - 44) = 4414656;
		Eq_286 eax_224 = CreateFileW(*(esp_141 - 44), *(esp_141 - 0x28), *(esp_141 - 0x24), *(esp_141 - 0x20), *(esp_141 - 0x1C), *(esp_141 - 0x18), *(esp_141 - 0x14));
		esp_225 = esp_141 - 0x10;
	} while (eax_224 != ~0x00);
	*(esp_141 - 0x14) = (union Eq_286 *) eax_224;
	CloseHandle(*(esp_141 - 0x14));
	VirtualProtect(*(esp_141 - 0x10), *(esp_141 - 0x0C), *(esp_141 - 0x08), *(esp_141 - 0x04));
	*(esp_141 - 0x04) = 0x00;
	*(esp_141 - 0x08) = 0xA0;
	*(esp_141 - 0x0C) = 0x03;
	*(esp_141 - 0x10) = 0x00;
	*(esp_141 - 0x14) = 0x02;
	*(esp_141 - 0x18) = 0xE0000000;
	*(esp_141 - 0x1C) = 4414588;
	Eq_286 eax_250 = CreateFileW(*(esp_141 - 0x1C), *(esp_141 - 0x18), *(esp_141 - 0x14), *(esp_141 - 0x10), *(esp_141 - 0x0C), *(esp_141 - 0x08), *(esp_141 - 0x04));
	*(esp_141 - 0x04) = (union Eq_676 *) eax_110;
	*(esp_141 - 0x08) = 0x00011D22;
	*(esp_141 - 0x0C) = (union Eq_286 *) eax_64;
	GetFileType(*(esp_141 - 0x0C));
	*(esp_141 - 0x0C) = (union Eq_286 *) eax_250;
	GetFileType(*(esp_141 - 0x0C));
	*(esp_141 - 0x0C) = 0x00401000;
	*(esp_141 - 0x10) = (union Eq_286 *) eax_64;
	GetFileType(*(esp_141 - 0x10));
	*(esp_141 - 0x10) = (union Eq_286 *) eax_250;
	GetFileType(*(esp_141 - 0x10));
	*(esp_141 - 0x10) = 0x00;
	*(esp_141 - 0x14) = 0x0107;
	*(esp_141 - 0x18) = 0x03;
	*(esp_141 - 0x1C) = 0x00;
	*(esp_141 - 0x20) = 0x07;
	*(esp_141 - 0x24) = 0x60000000;
	*(esp_141 - 0x28) = 4414676;
	CreateFileW(*(esp_141 - 0x28), *(esp_141 - 0x24), *(esp_141 - 0x20), *(esp_141 - 0x1C), *(esp_141 - 0x18), *(esp_141 - 0x14), *(esp_141 - 0x10));
	GetLastError();
	*(esp_141 - 0x10) = 0x00;
	*(esp_141 - 0x14) = (union Eq_286 *) eax_104;
	Eq_281 eax_310 = GetFileSize(*(esp_141 - 0x14), *(esp_141 - 0x10));
	word32 esp_313;
	struct Eq_6 * ebp_314;
	byte SCZO_315;
	Eq_281 eax_316;
	byte SZO_317;
	bool C_318;
	bool Z_319;
	byte al_320;
	word32 ecx_321;
	byte * edx_322;
	int32 ebx_323;
	struct Eq_7 * esi_324;
	(eax_110 - ~0x40412FD7)();
	fn00401026(al_320, ecx_321, edx_322, ebx_323, ebp_314, esi_324);
	return eax_316;
}

