// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register word32 fn00401024(Register word32 eax, Register (ptr32 byte) ecx, Register word16 dx, Register word32 esi, Register (ptr32 word32) edi, Register out ptr32 ebpOut)
word32 fn00401024(word32 eax, byte * ecx, word16 dx, word32 esi, word32 * edi, ptr32 & ebpOut)
{
	*ecx = *ecx - ch - C;
	__outdw(dx, eax);
	*edi = __in(dx);
	word32 esp_27;
	bool C_28;
	word32 ecx_29;
	byte ch_30;
	byte SCZO_31;
	word16 dx_32;
	word32 eax_33;
	word32 esi_34;
	byte al_35;
	word32 edi_36;
	word32 ebp_37;
	fnAEC62F66();
	return eax_33;
}

// 004151C1: Register Eq_43 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetLastError();
	GetCommandLineA();
	ptr32 esp_176 = fp - 0x4C;
l004151D9:
	GetCommandLineA();
	union Eq_61 * esp_57 = esp_176 - 0x04;
	*esp_57 = (union Eq_61 *) 0x00;
	*(esp_57 - 0x04) = 0x20;
	*(esp_57 - 0x08) = 0x03;
	*(esp_57 - 0x0C) = 0x00;
	*(esp_57 - 0x10) = 0x04;
	*(esp_57 - 0x14) = 0x80000000;
	*(esp_57 - 0x18) = 4390029;
	Eq_61 eax_71 = CreateFileA(*(esp_57 - 0x18), *(esp_57 - 0x14), *(esp_57 - 0x10), *(esp_57 - 0x0C), *(esp_57 - 0x08), *(esp_57 - 0x04), *esp_57);
	*esp_57 = (union Eq_61 *) 0x00;
	*(esp_57 - 0x04) = (union Eq_61 *) eax_71;
	GetFileSize(*(esp_57 - 0x04), *esp_57);
	ptr32 esp_104 = (char *) esp_57 + 0x04;
	do
	{
		GetLastError();
		union Eq_61 * esp_107 = esp_104 - 0x04;
		*esp_107 = (union Eq_61 *) eax_71;
		CloseHandle(*esp_107);
		GetLastError();
		*esp_107 = (union Eq_61 *) eax_71;
		GetFileType(*esp_107);
		*esp_107 = (union Eq_61 *) 0x00;
		*(esp_107 - 0x04) = 0xA7;
		*(esp_107 - 0x08) = 0x03;
		*(esp_107 - 0x0C) = 0x00;
		*(esp_107 - 0x10) = 0x07;
		ptr32 esp_125 = esp_107 - 0x10;
l0041524D:
		struct Eq_1258 * esp_150 = esp_125 - 0x04;
		esp_150->t0000 = 0x80000000;
		*(esp_150 - 0x04) = 4389971;
		Eq_61 eax_154 = CreateFileA(*(esp_150 - 0x04), esp_150->t0000, esp_150->t0004, esp_150->t0008, esp_150->t000C, esp_150->t0010, esp_150->t0014);
		do
		{
			ptr32 esp_160 = esp_125 + 0x14;
			*(esp_160 - 0x04) = 0x00;
			*(esp_160 - 0x08) = 0x01A1;
			*(esp_160 - 0x0C) = 0x03;
			*(esp_160 - 0x10) = 0x00;
			*(esp_160 - 0x14) = 0x06;
			*(esp_160 - 0x18) = 0x00;
			*(esp_160 - 0x1C) = 4390121;
			esp_176 = esp_160;
			if (CreateFileA(*(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08), *(esp_160 - 0x04)) != ~0x00)
				goto l004151D9;
			GetCommandLineA();
			*(esp_160 - 0x04) = 0x00;
			*(esp_160 - 0x08) = 0xA3;
			*(esp_160 - 0x0C) = 0x03;
			*(esp_160 - 0x10) = 0x00;
			*(esp_160 - 0x14) = 0x07;
			*(esp_160 - 0x18) = 0x20000000;
			*(esp_160 - 0x1C) = 4389963;
			CreateFileW(*(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08), *(esp_160 - 0x04));
			*(esp_160 - 0x04) = 4389934;
			Eq_262 eax_200 = GetModuleHandleA(*(esp_160 - 0x04));
			*(esp_160 - 0x04) = 0x00;
			*(esp_160 - 0x08) = 0x82;
			*(esp_160 - 0x0C) = 0x03;
			*(esp_160 - 0x10) = 0x00;
			*(esp_160 - 0x14) = 0x04;
			*(esp_160 - 0x18) = 0xC0000000;
			*(esp_160 - 0x1C) = 4389991;
			Eq_61 eax_217 = CreateFileW(*(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08), *(esp_160 - 0x04));
		} while (eax_217 != ~0x00);
		*(esp_160 - 0x04) = 0x00;
		*(esp_160 - 0x08) = (union Eq_61 *) eax_154;
		GetFileSize(*(esp_160 - 0x08), *(esp_160 - 0x04));
		*(esp_160 - 0x04) = 0x0042FCF4;
		*(esp_160 - 0x08) = 0x00;
		*(esp_160 - 0x0C) = 0x0101;
		*(esp_160 - 0x10) = 0x03;
		*(esp_160 - 0x14) = 0x00;
		*(esp_160 - 0x18) = 0x03;
		*(esp_160 - 0x1C) = 0xC0000000;
		*(esp_160 - 0x20) = 4390002;
		Eq_61 eax_245 = CreateFileW(*(esp_160 - 0x20), *(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08));
		esp_104 = esp_160 - 0x04;
	} while (eax_245 != ~0x00);
	*(esp_160 - 0x08) = (union Eq_61 *) eax_154;
	CloseHandle(*(esp_160 - 0x08));
	*(esp_160 - 0x08) = (HMODULE *) eax_200;
	*(esp_160 - 0x0C) = (union Eq_61 *) eax_245;
	CloseHandle(*(esp_160 - 0x0C));
	Eq_631 eax_263 = GetProcAddress(*(esp_160 - 0x08), *(esp_160 - 0x04));
	*(esp_160 - 0x04) = 0x00;
	*(esp_160 - 0x08) = 0x05;
	*(esp_160 - 0x0C) = 0x03;
	*(esp_160 - 0x10) = 0x00;
	*(esp_160 - 0x14) = 0x02;
	*(esp_160 - 0x18) = 0x20000000;
	*(esp_160 - 0x1C) = 4390078;
	Eq_61 eax_280 = CreateFileW(*(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08), *(esp_160 - 0x04));
	ptr32 esp_281 = esp_160;
	if (eax_280 == ~0x00)
	{
		GetLastError();
		*(esp_160 - 0x04) = 0x00;
		*(esp_160 - 0x08) = 0x0127;
		*(esp_160 - 0x0C) = 0x03;
		*(esp_160 - 0x10) = 0x00;
		*(esp_160 - 0x14) = 0x07;
		*(esp_160 - 0x18) = 0xE0000000;
		*(esp_160 - 0x1C) = 4390107;
		Eq_61 eax_377 = CreateFileW(*(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08), *(esp_160 - 0x04));
		*(esp_160 - 0x04) = 0x00;
		*(esp_160 - 0x08) = (union Eq_61 *) eax_377;
		GetFileSize(*(esp_160 - 0x08), *(esp_160 - 0x04));
		*(esp_160 - 0x04) = (union Eq_61 *) eax_280;
		GetFileType(*(esp_160 - 0x04));
		*(esp_160 - 0x04) = 0x00;
		*(esp_160 - 0x08) = 0x00;
		*(esp_160 - 0x0C) = 0x0121;
		*(esp_160 - 0x10) = 0x03;
		*(esp_160 - 0x14) = 0x00;
		*(esp_160 - 0x18) = 0x06;
		*(esp_160 - 0x1C) = 0xE0000000;
		*(esp_160 - 0x20) = 4390034;
		Eq_61 eax_408 = CreateFileA(*(esp_160 - 0x20), *(esp_160 - 0x1C), *(esp_160 - 0x18), *(esp_160 - 0x14), *(esp_160 - 0x10), *(esp_160 - 0x0C), *(esp_160 - 0x08));
		ptr32 esp_409 = esp_160 - 0x04;
		if (eax_408 == ~0x00)
		{
			*(esp_160 - 0x08) = 0x00;
			*(esp_160 - 0x0C) = 0x00;
			*(esp_160 - 0x10) = (union Eq_61 *) eax_245;
			GetFileSize(*(esp_160 - 0x10), *(esp_160 - 0x0C));
			esp_409 = esp_160 - 0x08;
			dwLoc38 = eax_263();
		}
		GetCommandLineA();
		union Eq_61 * esp_431 = esp_409 - 0x04;
		*esp_431 = (union Eq_61 *) 0x00;
		*(esp_431 - 0x04) = 0x25;
		*(esp_431 - 0x08) = 0x03;
		*(esp_431 - 0x0C) = 0x00;
		*(esp_431 - 0x10) = 0x05;
		*(esp_431 - 0x14) = 0x40000000;
		*(esp_431 - 0x18) = 4389944;
		Eq_1186 v17_425 = dwLoc38 ^ 0xC0000008;
		Eq_61 eax_445 = CreateFileA(*(esp_431 - 0x18), *(esp_431 - 0x14), *(esp_431 - 0x10), *(esp_431 - 0x0C), *(esp_431 - 0x08), *(esp_431 - 0x04), *esp_431);
		esp_125 = (char *) esp_431 + 0x04;
		do
		{
			if (eax_445 != ~0x00)
				goto l0041524D;
			ptr32 esp_462;
			word32 ebp_463;
			byte SCZO_464;
			word32 eax_465;
			bool Z_466;
			byte SZO_467;
			bool C_468;
			word32 ecx_469;
			word16 dx_470;
			word32 esi_471;
			word32 edi_472;
			(*((word32) v17_425 + 4281515))();
			*(esp_462 - 0x04) = fp - 0x24;
			*(esp_462 - 0x08) = 0x00;
			*(esp_462 - 0x0C) = 0x0186;
			*(esp_462 - 0x10) = 0x03;
			*(esp_462 - 0x14) = 0x00;
			*(esp_462 - 0x18) = 0x02;
			*(esp_462 - 0x1C) = 0xE0000000;
			*(esp_462 - 0x20) = 4390048;
			eax_445 = CreateFileW(*(esp_462 - 0x20), *(esp_462 - 0x1C), *(esp_462 - 0x18), *(esp_462 - 0x14), *(esp_462 - 0x10), *(esp_462 - 0x0C), *(esp_462 - 0x08));
			esp_125 = esp_462 - 0x04;
		} while (eax_445 != ~0x00);
		*(esp_462 - 0x08) = 0x40;
		GetLastError();
		*(esp_462 - 0x0C) = 0x000141A9;
		*(esp_462 - 0x10) = 0x00401000;
		*(esp_462 - 0x14) = (union Eq_61 *) eax_408;
		GetFileType(*(esp_462 - 0x14));
		*(esp_462 - 0x14) = (union Eq_61 *) eax_377;
		CloseHandle(*(esp_462 - 0x14));
		VirtualProtect(*(esp_462 - 0x10), *(esp_462 - 0x0C), *(esp_462 - 0x08), *(esp_462 - 0x04));
		esp_281 = esp_462;
	}
	word32 * esp_291 = esp_281 - 0x04;
	*esp_291 = 0x00401000;
	*(esp_291 - 0x04) = (union Eq_735 *) dwLoc38;
	*(esp_291 - 0x08) = 0x000141A9;
	GetCommandLineA();
	*(esp_291 - 0x0C) = 0x00;
	*(esp_291 - 0x10) = 166;
	*(esp_291 - 0x14) = 0x03;
	*(esp_291 - 0x18) = 0x00;
	*(esp_291 - 0x1C) = 0x04;
	*(esp_291 - 0x20) = 0x20000000;
	*(esp_291 - 0x24) = 0x0042FD08;
	CreateFileA(*(esp_291 - 0x24), *(esp_291 - 0x20), *(esp_291 - 0x1C), *(esp_291 - 0x18), *(esp_291 - 0x14), *(esp_291 - 0x10), *(esp_291 - 0x0C));
	GetCommandLineA();
	*(esp_291 - 0x0C) = (union Eq_61 *) eax_217;
	CloseHandle(*(esp_291 - 0x0C));
	*(esp_291 - 0x0C) = 0x00;
	*(esp_291 - 0x10) = 0xA4;
	*(esp_291 - 0x14) = 0x03;
	*(esp_291 - 0x18) = 0x00;
	*(esp_291 - 0x1C) = 0x05;
	*(esp_291 - 0x20) = 0xC0000000;
	*(esp_291 - 0x24) = 4389977;
	Eq_61 eax_343 = CreateFileW(*(esp_291 - 0x24), *(esp_291 - 0x20), *(esp_291 - 0x1C), *(esp_291 - 0x18), *(esp_291 - 0x14), *(esp_291 - 0x10), *(esp_291 - 0x0C));
	word32 esp_346;
	word32 ebp_347;
	byte SCZO_348;
	word32 eax_349;
	bool Z_350;
	byte SZO_351;
	bool C_352;
	byte * ecx_353;
	word16 dx_354;
	word32 esi_355;
	word32 * edi_356;
	(dwLoc38 - ~0x404155DF)();
	word32 ebp_357;
	return fn00401024(eax_349, ecx_353, dx_354, esi_355, edi_356, out ebp_357);
}

