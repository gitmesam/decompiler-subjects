// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401023: void fn00401023(Register byte al, Register word16 dx, Register word32 esi)
void fn00401023(byte al, word16 dx, word32 esi)
{
	byte al_5;
	__daa(al, &al_5);
	__outb(dx, al_5);
}

// 0040F7A3: Register Eq_17 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_18 * esp_102 = fp - 0x40;
	bool Z_105 = (bool) cond(CreateFileA(&globals->t43388F, 0x80000000, 0x07, null, 0x03, 33, null) - (void *) ~0x00);
	do
	{
		ptr32 esp_128;
		ptr32 * esp_234;
		Eq_31 eax_232;
		<anonymous> * dwLoc18_176;
		struct Eq_457 * esp_149;
		struct Eq_18 * esp_270;
		if (!Z_423)
		{
			LPCSTR * esp_390 = esp_270 - 0x04;
			*esp_390 = (LPCSTR *) &globals->t433800;
			Eq_167 eax_392 = GetModuleHandleA(*esp_390);
			GetCommandLineA();
			GetCommandLineA();
			*esp_390 = (LPCSTR *) &globals->t43387D;
			GetCommandLineA();
			*(esp_390 - 0x04) = (HMODULE *) eax_392;
			GetLastError();
			dwLoc40 = GetProcAddress(*(esp_390 - 0x04), *esp_390);
			*esp_390 = (LPCSTR *) null;
			*(esp_390 - 0x04) = 0x00;
			*(esp_390 - 0x08) = 0x00;
			*(esp_390 - 0x0C) = 0x00;
			*(esp_390 - 0x10) = 288;
			*(esp_390 - 0x14) = 0x03;
			*(esp_390 - 0x18) = 0x00;
			*(esp_390 - 0x1C) = 0x06;
			esp_128 = esp_390 - 0x1C;
l0040F82F:
			struct Eq_551 * esp_371 = esp_128 - 0x04;
			esp_371->t0000 = 0x60000000;
			*(esp_371 - 0x04) = 0x0043383F;
			CreateFileA(*(esp_371 - 0x04), esp_371->t0000, esp_371->t0004, esp_371->t0008, esp_371->t000C, esp_371->t0010, esp_371->t0014);
			Eq_17 eax_378 = GetLastError();
			word32 ebp_381;
			byte SCZO_382;
			bool Z_384;
			byte SZO_385;
			bool C_386;
			byte al_387;
			word16 dx_388;
			word32 esi_389;
			dwLoc40();
l0040F84F:
			GetLastError();
			GetCommandLineA();
			HANDLE * esp_342 = esp_234 - 0x04;
			*esp_342 = (HANDLE *) null;
			*(esp_342 - 0x04) = 0x87;
			*(esp_342 - 0x08) = 0x03;
			*(esp_342 - 0x0C) = 0x00;
			*(esp_342 - 0x10) = 0x00;
			*(esp_342 - 0x14) = 0x60000000;
			*(esp_342 - 0x18) = 0x0043382D;
			CreateFileA(*(esp_342 - 0x18), *(esp_342 - 0x14), *(esp_342 - 0x10), *(esp_342 - 0x0C), *(esp_342 - 0x08), *(esp_342 - 0x04), *esp_342);
			dwLoc10 = eax_232;
			dwLoc18_176 = (eax_232 ^ 0xC0000005) + 0x0040F8B2;
l0040F8A1:
			Eq_177 eax_287 = GetCommandLineA();
			ptr32 esp_288;
			word32 ebp_289;
			byte SCZO_290;
			word32 eax_291;
			bool Z_292;
			byte SZO_293;
			bool C_294;
			byte al_295;
			word16 dx_296;
			word32 esi_297;
			dwLoc18_176();
			*(esp_288 - 0x04) = 0x00;
			*(esp_288 - 0x08) = 0x0182;
			*(esp_288 - 0x0C) = 0x03;
			*(esp_288 - 0x10) = 0x00;
			*(esp_288 - 0x14) = 0x01;
			*(esp_288 - 0x18) = 0xC0000000;
			*(esp_288 - 0x1C) = 4405334;
			esp_149 = esp_288 - 0x1C;
l0040F8CF:
			eax_232 = CreateFileA(esp_149->t0000, esp_149->t0004, esp_149->t0008, esp_149->t000C, esp_149->t0010, esp_149->t0014, esp_149->t0018);
			esp_234 = (ptr32 *) ((char *) &esp_149->t0018 + 0x04);
			do
			{
				if (eax_232 != (void *) ~0x00)
					goto l0040F84F;
				ptr32 * esp_243 = esp_234 - 0x04;
				*esp_243 = fp - 0x34;
				*(esp_243 - 0x04) = 0x00;
				*(esp_243 - 0x08) = 0x22;
				*(esp_243 - 0x0C) = 0x03;
				*(esp_243 - 0x10) = 0x00;
				*(esp_243 - 0x14) = 0x07;
				*(esp_243 - 0x18) = 0x00;
				*(esp_243 - 0x1C) = 0x0043380A;
				eax_232 = CreateFileA(*(esp_243 - 0x1C), *(esp_243 - 0x18), *(esp_243 - 0x14), *(esp_243 - 0x10), *(esp_243 - 0x0C), *(esp_243 - 0x08), *(esp_243 - 0x04));
				esp_234 = esp_243;
			} while (eax_232 != (void *) ~0x00);
			*(esp_243 - 0x04) = 0x40;
			GetLastError();
			*(esp_243 - 0x08) = 58535;
			*(esp_243 - 0x0C) = 0x00401000;
			GetCommandLineA();
			esp_270 = esp_243 - 0x0C;
		}
		VirtualProtect(esp_270->t0000, esp_270->t0004, esp_270->t0008, esp_270->t000C);
		struct Eq_18 * esp_86 = (char *) &esp_270->t000C + 0x04;
		*(esp_86 - 0x04) = 0x00;
		*(esp_86 - 0x08) = 0x01A2;
		*(esp_86 - 0x0C) = 0x03;
		*(esp_86 - 0x10) = 0x00;
		*(esp_86 - 0x14) = 0x01;
		*(esp_86 - 0x18) = 0xC0000000;
		*(esp_86 - 0x1C) = 0x004337EE;
		Eq_31 eax_101 = CreateFileW(*(esp_86 - 0x1C), *(esp_86 - 0x18), *(esp_86 - 0x14), *(esp_86 - 0x10), *(esp_86 - 0x0C), *(esp_86 - 0x08), *(esp_86 - 0x04));
		esp_102 = esp_86;
		Z_105 = (bool) cond(eax_101 - (void *) ~0x00);
		bool Z_423 = Z_105;
		esp_270 = esp_102;
	} while (eax_101 != (void *) ~0x00);
	*(esp_86 - 0x04) = (HANDLE *) dwLoc10;
	*(esp_86 - 0x08) = 58535;
	*(esp_86 - 0x0C) = 0x00;
	*(esp_86 - 0x10) = 0x0123;
	*(esp_86 - 0x14) = 0x03;
	*(esp_86 - 0x18) = 0x00;
	*(esp_86 - 0x1C) = 0x05;
	*(esp_86 - 0x20) = 0x00;
	*(esp_86 - 0x24) = 0x0043381C;
	esp_128 = esp_86 - 0x08;
	if (CreateFileA(*(esp_86 - 0x24), *(esp_86 - 0x20), *(esp_86 - 0x1C), *(esp_86 - 0x18), *(esp_86 - 0x14), *(esp_86 - 0x10), *(esp_86 - 0x0C)) == (void *) ~0x00)
	{
		*(esp_86 - 0x0C) = 0x00401000;
		*(esp_86 - 0x10) = 0x00;
		*(esp_86 - 0x14) = 0x0185;
		*(esp_86 - 0x18) = 0x03;
		*(esp_86 - 0x1C) = 0x00;
		*(esp_86 - 0x20) = 0x02;
		*(esp_86 - 0x24) = 0x80000000;
		*(esp_86 - 0x28) = 4405204;
		esp_149 = esp_86 - 0x0C;
		if (CreateFileW(*(esp_86 - 0x28), *(esp_86 - 0x24), *(esp_86 - 0x20), *(esp_86 - 0x1C), *(esp_86 - 0x18), *(esp_86 - 0x14), *(esp_86 - 0x10)) == (void *) ~0x00)
		{
			GetLastError();
			*(esp_86 - 0x10) = 0x00;
			*(esp_86 - 0x14) = 0x01A1;
			*(esp_86 - 0x18) = 0x03;
			*(esp_86 - 0x1C) = 0x00;
			*(esp_86 - 0x20) = 0x04;
			*(esp_86 - 0x24) = 0x40000000;
			*(esp_86 - 0x28) = 4405353;
			CreateFileW(*(esp_86 - 0x28), *(esp_86 - 0x24), *(esp_86 - 0x20), *(esp_86 - 0x1C), *(esp_86 - 0x18), *(esp_86 - 0x14), *(esp_86 - 0x10));
			*(esp_86 - 0x10) = 0x00;
			*(esp_86 - 0x14) = 161;
			*(esp_86 - 0x18) = 0x03;
			*(esp_86 - 0x1C) = 0x00;
			*(esp_86 - 0x20) = 0x05;
			*(esp_86 - 0x24) = 0xC0000000;
			*(esp_86 - 0x28) = 0x00433872;
			ptr32 v13_156 = dwLoc10 - 0xC0000005;
			dwLoc18_176 = v13_156 + 0x0040F76B;
			if (CreateFileW(*(esp_86 - 0x28), *(esp_86 - 0x24), *(esp_86 - 0x20), *(esp_86 - 0x1C), *(esp_86 - 0x18), *(esp_86 - 0x14), *(esp_86 - 0x10)) == (void *) ~0x00)
			{
				Eq_177 eax_196 = GetCommandLineA();
				word32 esp_198;
				word32 ebp_199;
				byte SCZO_200;
				Eq_17 eax_201;
				bool Z_202;
				byte SZO_203;
				bool C_204;
				byte al_205;
				word16 dx_206;
				word32 esi_207;
				(v13_156 + 0x0040F76B)();
				fn00401023(al_205, dx_206, esi_207);
				return eax_201;
			}
			goto l0040F8A1;
		}
		goto l0040F8CF;
	}
	goto l0040F82F;
}

