// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 003E1000: Register word32 fn003E1000(Stack ptr32 dwArg00, Stack (ptr32 Eq_4) dwArg04, Register out ptr32 ebpOut)
word32 fn003E1000(ptr32 dwArg00, Eq_4 * dwArg04, ptr32 & ebpOut)
{
	word32 ebp_34;
	*ebpOut = dwArg00;
	return dwArg04 + Mem0[dwArg04 + 0x3C:word32];
}

// 003E1021: void fn003E1021(Stack (ptr32 Eq_4) dwArg04, Stack Eq_13 dwArg08, Stack Eq_14 dwArg0C)
void fn003E1021(Eq_4 * dwArg04, Eq_13 dwArg08, SIZE_T dwArg0C)
{
	fn003E18F3(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x02, fp - 0x08);
}

// 003E1060: Register byte fn003E1060(Stack ui32 dwArg04)
byte fn003E1060(ui32 dwArg04)
{
	return (byte) (-(dwArg04 & 0x80000000) == 0x00);
}

// 003E1073: Register ptr32 fn003E1073(Stack ptr32 dwArg00, Stack (ptr32 Eq_4) dwArg04, Stack Eq_13 dwArg08)
ptr32 fn003E1073(ptr32 dwArg00, Eq_4 * dwArg04, Eq_13 dwArg08)
{
	word32 dwLoc08_205 = dwArg08 + Mem0[dwArg04 + 0x80:word32];
	while (dwLoc08_205->dw000C != 0x00)
	{
		ui32 * dwLoc10_101;
		Eq_50 eax_71 = LoadLibraryA((word32) dwArg08 + dwLoc08_205->dw000C);
		if (dwLoc08_205->dw0004 == 0x00)
			dwLoc10_101 = (word32) dwArg08 + dwLoc08_205->dw0010;
		else
			dwLoc10_101 = (word32) dwArg08 + dwLoc08_205->dw0000;
		word32 * dwLoc18_150 = (word32) dwArg08 + dwLoc08_205->dw0010;
		while (*dwLoc10_101 != 0x00)
		{
			Eq_79 dwLoc14_136;
			if ((word32) fn003E1060(*dwLoc10_101) != 0x00)
				dwLoc14_136 = GetProcAddress(eax_71, (word32) (word16) (*dwLoc10_101 & 0xFFFF));
			else
				dwLoc14_136 = GetProcAddress(eax_71, (word32) dwArg08 + *dwLoc10_101 + 0x02);
			*dwLoc18_150 = (word32) dwLoc14_136;
			dwLoc18_150 = dwLoc18_150 + 0x01;
			dwLoc10_101 = dwLoc10_101 + 0x01;
		}
		dwLoc08_205 = dwLoc08_205 + 0x01;
	}
	return dwArg00;
}

// 003E1197: void fn003E1197()
void fn003E1197()
{
}

// 003E11A0: Register word32 fn003E11A0(Stack word32 dwArg00, Stack (ptr32 Eq_128) dwArg04, Stack word32 dwArg08, Stack uint32 dwArg0C)
word32 fn003E11A0(word32 dwArg00, Eq_128 * dwArg04, word32 dwArg08, uint32 dwArg0C)
{
	uint32 dwLoc10_21 = 0x00;
	while (dwLoc10_21 < dwArg0C)
	{
		WriteFile(dwArg04->t0004, dwArg08 + dwLoc10_21 * 0x04, 0x08, fp - 0x08, null);
		ReadFile(dwArg04->t0000, dwArg08 + dwLoc10_21 * 0x04, 0x08, fp - 0x0C, null);
		dwLoc10_21 = dwLoc10_21 + 0x02;
	}
	return dwArg00;
}

// 003E1300: void fn003E1300(Stack (ptr32 Eq_4) dwArg04)
void fn003E1300(Eq_4 * dwArg04)
{
	CloseHandle(dwArg04->b0000);
	CloseHandle(dwArg04[0x04]);
}

// 003E1320: Register word32 fn003E1320(Register ptr32 ebp, Register out ptr32 ebpOut)
word32 fn003E1320(ptr32 ebp, ptr32 & ebpOut)
{
	struct Eq_189 * ebp_153 = fp - 0x04;
	ptr32 esp_155 = fp - 0x34;
	if ((word32) fn003E14F0()->ptr0030->b0002 == 0x00)
	{
		globals->dw4199B2 = 4824;
		globals->dw4199B2 = globals->dw4199B2 + 0x4BEC;
		globals->dw4199B6 = 8696;
		globals->dw4199B6 = globals->dw4199B6 + 11017;
		globals->dw4199BA = 21231;
		globals->dw4199BE = 0x0626;
		globals->dw4199BE = globals->dw4199BE + 0x17FA;
		esp_155 = fp - 0x34;
		if (CreatePipe(fp - 0x24, fp - 0x14, null, 0x10) != 0x00)
		{
			esp_155 = fp - 0x34;
			if (CreatePipe(fp - 0x18, fp - 0x20, null, 0x10) != 0x00)
			{
				CreateThread(null, 0x00, &globals->t3E1207, fp - 0x24, 0x00, fp - 0x0C);
				ptr32 ebp_132 = fn003E11A0(4067847, fp - 0x18, 0x003E3000, globals->dw3ED40B >> 0x02);
				*(fp - 0x38) = ebp_132 - 0x14;
				fn003E1300(dwArg00);
				*(fp - 0x38) = ebp_132 - 0x20;
				fn003E1300(dwArg00);
				*(fp - 0x38) = *(ebp_132 - 0x24);
				CloseHandle(*(fp - 0x38));
				*(fp - 0x38) = 0x003E3000;
				word32 eax_154 = fn003E1000(ebp, dwArg00, out ebp_153);
				*(ebp_153 - 0x0C) = eax_154;
				esp_155 = fp - 0x34;
				if (*(ebp_153 - 0x0C) != 0x00)
				{
					*(ebp_153 - 44) = *((char *) *(ebp_153 - 0x0C) + 0x0034);
					*(fp - 0x38) = *(ebp_153 - 0x0C);
					*(fp - 0x38) = *((char *) *(fp - 0x38) + 0x0054);
					*(fp - 0x38) = *(fp - 0x38);
					*(fp - 0x3C) = *(ebp_153 - 44);
					*(fp - 0x40) = 0x003E3000;
					fn003E1021(dwArg00, dwArg04, dwArg08);
					*(fp - 0x38) = *(ebp_153 - 44);
					*(fp - 0x38) = *(fp - 0x38);
					*(fp - 0x3C) = 0x003E3000;
					*(fp - 0x40) = *(ebp_153 - 0x0C);
					fn003E1500(dwArg00, dwArg04, dwArg08);
					*(fp - 0x38) = *(ebp_153 - 44);
					*(fp - 0x38) = *(fp - 0x38);
					word32 eax_214 = fn003E1000(ebp, dwArg00, out ebp_153);
					*(ebp_153 - 0x28) = eax_214;
					esp_155 = fp - 0x34;
					if (*(ebp_153 - 0x28) != 0x00)
					{
						*(fp - 0x38) = *(ebp_153 - 44);
						*(fp - 0x3C) = *(ebp_153 - 0x28);
						ptr32 ebp_225 = fn003E1073(ebp, dwArg00, dwArg04);
						*(fp - 0x38) = *(ebp_225 - 44);
						*(fp - 0x38) = *(fp - 0x38);
						*(fp - 0x3C) = *(ebp_225 - 0x28);
						*(fp - 0x3C) = *(fp - 0x3C);
						fn003E16A9(ebp_225, dwArg00);
						word32 ecx_244 = *(ebp_225 - 44);
						*((char *) *(ebp_225 - 0x18) + 0x08) = ecx_244;
						struct Eq_596 * edx_246 = *(ebp_225 - 0x0C);
						*(fp - 0x38) = *(ebp_225 - 44);
						word32 eax_252 = *(fp - 0x38) + edx_246->dw0028;
						*(ebp_225 - 0x30) = eax_252;
						byte SCZO_257;
						word32 eax_258;
						word32 ecx_259;
						word32 edx_260;
						byte SZO_261;
						bool C_262;
						bool Z_263;
						(*(ebp_225 - 0x30))();
					}
				}
				fn003E1197();
			}
		}
	}
	struct Eq_189 ** esp_43 = esp_155 - 0x04;
	*esp_43 = (struct Eq_189 **) ebp_153;
	word32 ebp_47;
	*ebpOut = *((char *) *esp_43 + 0x04);
	return 0x00;
}

// 003E14D3: Register Eq_25 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 ebp_9;
	word32 eax_10 = fn003E1320(fp - 0x04, out ebp_9);
	*(ebp_9 - 0x04) = eax_10;
	*(fp - 0x0C) = *(ebp_9 - 0x04);
	*(fp - 0x0C) = *(fp - 0x0C);
	ExitProcess(*(fp - 0x0C));
}

// 003E14F0: Register word32 fn003E14F0()
word32 fn003E14F0()
{
	return fs->dw0018;
}

// 003E1500: void fn003E1500(Stack (ptr32 Eq_4) dwArg04, Stack Eq_13 dwArg08, Stack Eq_14 dwArg0C)
void fn003E1500(Eq_4 * dwArg04, Eq_13 dwArg08, SIZE_T dwArg0C)
{
	word16 dx_18 = dwArg04[0x06];
	word16 wLoc14_120 = 0x00;
	while ((word32) wLoc14_120 < (word32) dx_18)
	{
		Eq_14 dwLoc2C_122;
		Eq_14 v12_58 = (dwArg04 + 0x00F8)[(word32) wLoc14_120 *s 0x28 + 0x08];
		Eq_14 eax_67 = (dwArg04 + 0x00F8)[(word32) wLoc14_120 *s 0x28 + 0x10];
		if (v12_58 < eax_67)
			dwLoc2C_122 = v12_58;
		else
			dwLoc2C_122 = eax_67;
		fn003E18F3(dwArg0C + Mem0[((word32) wLoc14_120 *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], dwArg08 + Mem0[((word32) wLoc14_120 *s 0x28 + 0x14) + (dwArg04 + 0xF8):word32], dwLoc2C_122);
		wLoc14_120 = wLoc14_120 + 0x01;
	}
}

// 003E15D1: Register ui32 fn003E15D1(Stack ptr32 dwArg00, Stack ui32 dwArg04, Register out (ptr32 Eq_739) ebpOut)
ui32 fn003E15D1(ptr32 dwArg00, ui32 dwArg04, Eq_739 * & ebpOut)
{
	ui32 dwLoc08_13 = 0x00;
	if ((dwArg04 & 0x04000000) != 0x00)
		dwLoc08_13 = 0x0200;
	ui32 dwLoc08_101;
	if ((dwArg04 & 0x20000000) != 0x00)
	{
		if ((dwArg04 & 0x40000000) != 0x00)
		{
			if ((dwArg04 & 0x80000000) != 0x00)
				dwLoc08_101 = dwLoc08_13 | 0x40;
			else
				dwLoc08_101 = dwLoc08_13 | 0x20;
		}
		else if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_101 = dwLoc08_13 | 0x80;
		else
			dwLoc08_101 = dwLoc08_13 | 0x10;
	}
	else if ((dwArg04 & 0x40000000) != 0x00)
	{
		if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_101 = dwLoc08_13 | 0x04;
		else
			dwLoc08_101 = dwLoc08_13 | 0x02;
	}
	else if ((dwArg04 & 0x80000000) != 0x00)
		dwLoc08_101 = dwLoc08_13 | 0x08;
	else
		dwLoc08_101 = dwLoc08_13 | 0x01;
	word32 ebp_47;
	*ebpOut = dwArg00;
	return dwLoc08_101;
}

// 003E16A9: void fn003E16A9(Register ptr32 ebp, Stack (ptr32 Eq_4) dwArg04)
void fn003E16A9(ptr32 ebp, Eq_4 * dwArg04)
{
	struct Eq_794 * ebp_25 = fp - 0x04;
	while ((word32) *(ebp_25 - 0x10) < (word32) (*(ebp_25 - 0x08)))
	{
		int32 ecx_32 = (word32) *(ebp_25 - 0x10);
		*(fp - 0x24) = *(ebp_25 - 0x04);
		*(ebp_25 - 0x18) = (word32) (ecx_32 *s 0x28) + 0x0C + *(fp - 0x24) + ebp_25->dw000C;
		int32 ecx_42 = (word32) *(ebp_25 - 0x10);
		*(fp - 0x24) = *(ebp_25 - 0x04);
		*(ebp_25 - 0x1C) = (word32) (ecx_42 *s 0x28) + 0x08 + *(fp - 0x24);
		*(fp - 0x24) = ebp_25 - 0x14;
		*(fp - 0x28) = (word32) ((word32) *(ebp_25 - 0x10) *s 0x28) + 0x0024 + *(ebp_25 - 0x04);
		*(fp - 0x28) = *(fp - 0x28);
		*(fp - 0x28) = fn003E15D1(ebp, dwArg00, out ebp_25);
		*(fp - 44) = *(ebp_25 - 0x1C);
		*(fp - 0x30) = *(ebp_25 - 0x18);
		VirtualProtect(*(fp - 0x30), *(fp - 44), *(fp - 0x28), *(fp - 0x24));
		*(ebp_25 - 0x10) = *(ebp_25 - 0x10) + 0x01;
	}
}

// 003E18F3: void fn003E18F3(Stack Eq_13 dwArg04, Stack (ptr32 Eq_4) dwArg08, Stack Eq_14 dwArg0C)
void fn003E18F3(Eq_13 dwArg04, Eq_4 * dwArg08, SIZE_T dwArg0C)
{
	while (true)
	{
		dwArg0C = dwArg0C - 0x01;
		if (dwArg0C == 0x00)
			break;
		*dwArg04 = dwArg08->b0000;
		dwArg04 = (word32) dwArg04 + 0x01;
		dwArg08 = dwArg08 + 0x01;
	}
}

