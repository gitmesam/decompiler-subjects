// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Register word64 mm0, Register word64 mm1, Register word64 mm2, Register word64 mm3, Register word64 mm4, Register word64 mm7, Stack (ptr32 Eq_8) dwArg04, Stack (arr word32) dwArg08, Stack int32 dwArg0C)
void fn00401000(word64 mm0, word64 mm1, word64 mm2, word64 mm3, word64 mm4, word64 mm7, Eq_8 * dwArg04, word32 dwArg08[], int32 dwArg0C)
{
	__emms();
	uint32 esi_101 = dwArg04->a0000[0x00];
	if (dwArg0C <= 0x01)
	{
		if (dwArg0C < ~0x00 && (word32) (((uint32) (0x34 /u -((word32) mm2)) + 0x06) * ~0x61C88646) != 0x00)
		{
			do
			{
				int32 ecx_110 = (word32) mm4;
				if (ecx_110 <= 0x00)
					return;
				do
				{
					uint32 edi_126 = dwArg04[ecx_110 - 0x01];
					int32 ecx_153 = (word32) mm3;
					uint32 eax_156 = dwArg04[ecx_153] - ((edi_126 >> 0x05 ^ esi_101 << 0x02) + (esi_101 >> 0x03 ^ edi_126 << 0x04) ^ ((word32) mm7 ^ esi_101) + (dwArg08[(word32) mm3 & 0x03 ^ (word32) mm1] ^ edi_126));
					dwArg04[ecx_153] = (struct Eq_8) eax_156;
					esi_101 = eax_156;
					ecx_110 = ecx_153 - 0x01;
				} while (ecx_153 > 0x01);
				uint32 edi_165 = dwArg04[(word32) mm4];
				uint32 eax_190 = dwArg04->a0000[0x00] - ((edi_165 >> 0x05 ^ eax_156 << 0x02) + (eax_156 >> 0x03 ^ edi_165 << 0x04) ^ ((word32) mm7 ^ eax_156) + (dwArg08[(word32) mm3 & 0x03 ^ (word32) mm1] ^ edi_165));
				dwArg04->a0000[0x00] = eax_190;
				esi_101 = eax_190;
			} while ((word32) mm7 != ~0x61C88646);
		}
	}
	else
	{
		uint32 edi_203 = dwArg04[dwArg0C - 0x01];
		do
		{
			ui32 eax_229 = 0x00;
			do
			{
				uint32 esi_238 = dwArg04->a0004[eax_229];
				ui32 eax_261 = (word32) mm3;
				uint32 ebx_263 = dwArg04[eax_261].a0000 + ((edi_203 >> 0x05 ^ esi_238 << 0x02) + (esi_238 >> 0x03 ^ edi_203 << 0x04) ^ ((word32) mm7 ^ esi_238) + (dwArg08[(word32) mm3 & 0x03 ^ (word32) mm1] ^ edi_203)) / 0x04;
				dwArg04[eax_261] = (struct Eq_8) ebx_263;
				edi_203 = ebx_263;
				eax_229 = eax_261 + 0x01;
			} while (eax_261 + 0x01 != (word32) mm4);
			uint32 esi_272 = dwArg04->a0000[0x00];
			ui32 ecx_295 = (word32) mm4;
			uint32 ebx_297 = dwArg04[ecx_295].a0000 + ((ebx_263 >> 0x05 ^ esi_272 << 0x02) + (esi_272 >> 0x03 ^ ebx_263 << 0x04) ^ ((word32) mm7 ^ esi_272) + (dwArg08[(word32) mm3 & 0x03 ^ (word32) mm1] ^ ebx_263)) / 0x04;
			dwArg04[ecx_295] = (struct Eq_8) ebx_297;
			edi_203 = ebx_297;
		} while ((word32) mm0 != 0x00);
	}
}

// 00401201: void fn00401201(Register cui16 ax, Register word32 ebp)
void fn00401201(cui16 ax, word32 ebp)
{
	ptr32 v9_13 = fs->ptr0000;
	fs->ptr0000 = fp - 0x08;
	struct Eq_227 * edi_19 = DPB(eax, ax & 0x1000, 0);
	while (true)
	{
		globals->ptr403749 = fp - 0x08;
		globals->dw40374D = ebp;
		globals->ptr403751 = edi_19;
		if (edi_19->w0000 == 23117)
		{
			edi_19 = edi_19 + edi_19->dw003C / 0x00001000;
			if (edi_19->w0000 == 0x4550)
			{
				fs->ptr0000 = v9_13;
				return;
			}
		}
		edi_19 = edi_19 - 0x1000;
	}
}

// 0040126F: Register word32 fn0040126F(Register (ptr32 byte) esi, Register (ptr32 byte) edi)
word32 fn0040126F(byte * esi, byte * edi)
{
	word32 edx_15 = 0x00;
	while (true)
	{
		byte * esi_14 = esi;
		do
		{
			if (*esi_41 == 0x00)
				return edx_15;
			esi_14 = esi_41 + 0x01;
			edi = edi_40 + 0x01;
			byte * edi_40 = edi;
			byte * esi_41 = esi_14;
		} while (*esi_41 == *edi_40);
		do
		{
			edi = edi_42 + 0x01;
			byte * edi_42 = edi;
		} while (0x00 != *edi_42);
		edx_15 = edx_15 + 0x01;
	}
}

// 00401287: Register byte fn00401287(Register word32 eax, Register word32 ebx)
byte fn00401287(word32 eax, word32 ebx)
{
	ptr32 esp_6;
	word32 ebp_7;
	word32 eax_8;
	byte SCZO_9;
	bool Z_10;
	word32 esi_12;
	word32 edi_13;
	word32 edx_14;
	word32 ecx_15;
	word16 ax_16;
	byte SZO_17;
	bool C_18;
	byte al_19;
	Eq_308 ebx_11;
	globals->t4081C6();
	if (eax_8 == ~0x01)
		ebx_11 = globals->t4020F5;
	*(esp_6 - 0x04) = 0x004020F5;
	word32 ebp_30 = Mem26[ebx_11 + Mem26[ebx_11 + 0x3C:word32] + 0x78:word32] + ebx_11;
	word32 edi_34 = Mem26[Mem26[ebp_30 + 0x20:word32] + ebx_11:word32] + ebx_11;
	*(esp_6 - 0x04) = *(esp_6 - 0x04);
	word16 * eax_46 = (word32) ebx_11 + ebp_30->dw0024 + 0x02 + fn0040126F(&globals->t4020F5, edi_34) * 0x02 - ebp_30->dw0010 * 0x02;
	word32 eax_53 = (word32) ebx_11 + *((word32) ((word32) ebx_11 + ebp_30->dw001C) + (DPB(eax_46, *eax_46, 0) & 0xFFFF) * 0x04);
	**(esp_6 - 0x04) = eax_53;
	return (byte) eax_53;
}

// 004012E7: Register Eq_389 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	globals->t4020F5 = LoadLibraryA(0x00402072);
	globals->t4081C6 = GetProcAddress(globals->t4020F5, 0x00402048);
	Eq_308 eax_15 = globals->t4081C6;
	cui16 ax_17 = (word16) eax_15;
	fn00401201(ax_17, ebp);
	globals->t4020F5 = eax_15;
	ptr32 esp_20;
	word32 eax_21;
	byte SCZO_22;
	bool Z_23;
	word32 ecx_24;
	byte al_25;
	word32 ebp_26;
	byte SZO_27;
	bool C_28;
	word32 ebx_29;
	word32 edi_30;
	word32 esi_31;
	word16 ax_32;
	word64 mm0_33;
	word64 mm1_34;
	word64 mm2_35;
	word64 mm3_36;
	word64 mm4_37;
	word64 mm7_38;
	globals->t4081C6();
	do
		;
	while (eax_21 != ~0x01);
	fn00401287(eax_21, ebx_29);
	*(esp_20 - 0x04) = 0x00;
	*(esp_20 - 0x08) = ~0x02;
	*(esp_20 - 0x0C) = 0xE0380F01;
	*(esp_20 - 0x10) = 0x5294A508;
	word32 ecx_56 = 15751731;
	do
	{
		__wait();
		__fninit();
		ecx_56 = ecx_56 - 0x01;
	} while (ecx_56 != 0x00);
	*(esp_20 - 0x14) = 0x004020A5;
	*(esp_20 - 0x18) = (union Eq_308 *) globals->t4020F5;
	ExitProcess = GetProcAddress(*(esp_20 - 0x18), *(esp_20 - 0x14));
	*(esp_20 - 0x14) = 0x00402072;
	globals->t4020F5 = LoadLibraryA(*(esp_20 - 0x14));
	*(esp_20 - 0x14) = (union Eq_308 *) globals->t4020F5;
	*(esp_20 - 0x18) = ~0x08BF;
	*(esp_20 - 0x1C) = 4226744;
	*(esp_20 - 0x20) = 0x00405BB8;
	fn00401000(mm0_33, mm1_34, mm2_35, mm3_36, mm4_37, mm7_38, dwArg00, dwArg04, dwArg08);
	globals->dw405BBA = *(esp_20 - 0x14);
	*(esp_20 - 0x14) = 0x00402048;
	*(esp_20 - 0x18) = (union Eq_308 *) globals->t4020F5;
	globals->t4081C6 = GetProcAddress(*(esp_20 - 0x18), *(esp_20 - 0x14));
	globals->b40205A = 0x4C;
	*(esp_20 - 0x14) = 0x0040207F;
	*(esp_20 - 0x18) = (union Eq_308 *) globals->t4020F5;
	globals->t4020F9 = GetProcAddress(*(esp_20 - 0x18), *(esp_20 - 0x14));
	*(esp_20 - 0x14) = 4202555;
	*(esp_20 - 0x18) = (union Eq_308 *) globals->t4020F5;
	globals->t4020FD = GetProcAddress(*(esp_20 - 0x18), *(esp_20 - 0x14));
	*(esp_20 - 0x14) = 0x00402067;
	Eq_308 eax_122 = LoadLibraryA(*(esp_20 - 0x14));
	if (eax_122 == 0x00)
	{
		globals->dw405BBE = 0x01;
		eax_122 = 0x01;
	}
	*(esp_20 - 0x14) = 0x00402023;
	*(esp_20 - 0x18) = (union Eq_308 *) eax_122;
	Eq_308 eax_138 = GetProcAddress(*(esp_20 - 0x18), *(esp_20 - 0x14));
	if (eax_138 == 0x00)
	{
		globals->dw405BBE = 0x01;
		eax_138 = 0x01;
	}
	globals->t403EB7 = eax_138;
	*(esp_20 - 0x14) = 0x00;
	ptr32 esp_149;
	word32 eax_150;
	byte SCZO_151;
	bool Z_152;
	word32 ecx_153;
	byte al_154;
	word32 ebp_155;
	byte SZO_156;
	bool C_157;
	word32 ebx_158;
	word32 edi_159;
	word32 esi_160;
	word16 ax_161;
	word64 mm0_162;
	word64 mm1_163;
	word64 mm2_164;
	word64 mm3_165;
	word64 mm4_166;
	word64 mm7_167;
	globals->t4020F9();
	globals->dw4020C1 = eax_150;
	*(esp_149 - 0x04) = 0x0040209A;
	word32 eax_176 = fn00401547(LoadLibraryA(*(esp_149 - 0x04)), &globals->ptr402187, 0x00402105);
	*(esp_149 - 0x04) = 0x7F00;
	*(esp_149 - 0x08) = 0x00;
	ptr32 esp_183;
	word32 eax_184;
	byte SCZO_185;
	bool Z_186;
	word32 ecx_187;
	byte al_188;
	word32 ebp_189;
	byte SZO_190;
	bool C_191;
	word32 ebx_192;
	word32 edi_193;
	word32 esi_194;
	word16 ax_195;
	word64 mm0_196;
	word64 mm1_197;
	word64 mm2_198;
	word64 mm3_199;
	word64 mm4_200;
	word64 mm7_201;
	globals->ptr40218B();
	globals->dw4020C5 = eax_184;
	*(esp_183 - 0x04) = 0x7F00;
	*(esp_183 - 0x08) = 0x00;
	ptr32 esp_207;
	word32 eax_208;
	byte SCZO_209;
	bool Z_210;
	word32 ecx_211;
	byte al_212;
	word32 ebp_213;
	byte SZO_214;
	bool C_215;
	word32 ebx_216;
	word32 edi_217;
	word32 esi_218;
	word16 ax_219;
	word64 mm0_220;
	word64 mm1_221;
	word64 mm2_222;
	word64 mm3_223;
	word64 mm4_224;
	word64 mm7_225;
	globals->ptr40218F();
	globals->dw4020C9 = eax_208;
	*(esp_207 - 0x04) = 0x004020B1;
	ptr32 esp_229;
	word32 eax_230;
	byte SCZO_231;
	bool Z_232;
	word32 ecx_233;
	byte al_234;
	word32 ebp_235;
	byte SZO_236;
	bool C_237;
	word32 ebx_238;
	word32 edi_239;
	word32 esi_240;
	word16 ax_241;
	word64 mm0_242;
	word64 mm1_243;
	word64 mm2_244;
	word64 mm3_245;
	word64 mm4_246;
	word64 mm7_247;
	globals->ptr402193();
	*(esp_229 - 0x04) = 0x00;
	*(esp_229 - 0x08) = globals->dw4020C1;
	*(esp_229 - 0x0C) = 0x00;
	*(esp_229 - 0x10) = 0x00;
	*(esp_229 - 0x14) = 0xC0;
	*(esp_229 - 0x18) = 0x0100;
	*(esp_229 - 0x1C) = ~0x03E7;
	*(esp_229 - 0x20) = ~0x03E7;
	*(esp_229 - 0x24) = 0x00480000;
	*(esp_229 - 0x28) = 0x00402005;
	*(esp_229 - 44) = 0x00402015;
	*(esp_229 - 0x30) = 0x00;
	ptr32 esp_273;
	word32 eax_274;
	byte SCZO_275;
	bool Z_276;
	word32 ecx_277;
	byte al_278;
	word32 ebp_279;
	byte SZO_280;
	bool C_281;
	word32 ebx_282;
	word32 edi_283;
	word32 esi_284;
	word16 ax_285;
	word64 mm0_286;
	word64 mm1_287;
	word64 mm2_288;
	word64 mm3_289;
	word64 mm4_290;
	word64 mm7_291;
	globals->ptr402187();
	*(esp_273 - 0x04) = 0x80;
	*(esp_273 - 0x08) = ~0x13;
	*(esp_273 - 0x0C) = eax_274;
	word32 eax_299;
	byte SCZO_300;
	bool Z_301;
	word32 ecx_302;
	byte al_303;
	word32 ebp_304;
	byte SZO_305;
	bool C_306;
	word32 ebx_307;
	word32 edi_308;
	word32 esi_309;
	word16 ax_310;
	word64 mm0_311;
	word64 mm1_312;
	word64 mm2_313;
	word64 mm3_314;
	word64 mm4_315;
	word64 mm7_316;
	word32 esp_298;
	globals->ptr4021A7();
	while (true)
	{
		word32 * esp_318 = esp_298 - 0x04;
		*esp_318 = 0x00;
		*(esp_318 - 0x04) = 0x00;
		*(esp_318 - 0x08) = 0x00;
		*(esp_318 - 0x0C) = 0x004020D9;
		ptr32 esp_326;
		word32 eax_327;
		byte SCZO_328;
		bool Z_329;
		word32 ecx_330;
		byte al_331;
		word32 ebp_332;
		byte SZO_333;
		bool C_334;
		word32 ebx_335;
		word32 edi_336;
		word32 esi_337;
		word16 ax_338;
		word64 mm0_339;
		word64 mm1_340;
		word64 mm2_341;
		word64 mm3_342;
		word64 mm4_343;
		word64 mm7_344;
		globals->ptr402197();
		*(esp_326 - 0x04) = 0x004020D9;
		word32 eax_348;
		byte SCZO_349;
		bool Z_350;
		word32 ecx_351;
		byte al_352;
		word32 ebp_353;
		byte SZO_354;
		bool C_355;
		word32 ebx_356;
		word32 edi_357;
		word32 esi_358;
		word16 ax_359;
		word64 mm0_360;
		word64 mm1_361;
		word64 mm2_362;
		word64 mm3_363;
		word64 mm4_364;
		word64 mm7_365;
		globals->ptr40219F();
	}
}

// 00401547: Register word32 fn00401547(Register Eq_308 ebx, Register (ptr32 word32) esi, Register Eq_392 edi)
word32 fn00401547(Eq_308 ebx, word32 * esi, Eq_392 edi)
{
	do
	{
		*esi = (word32) GetProcAddress(ebx, edi);
		word32 ecx_22 = ~0x00;
		while (ecx_22 != 0x00)
		{
			edi = edi + 0x01;
			ecx_22 = ecx_22 - 0x01;
			if (0x00 != *edi)
				break;
		}
		esi = esi + 0x01;
	} while (*edi != 0x00);
	return 0x00;
}

