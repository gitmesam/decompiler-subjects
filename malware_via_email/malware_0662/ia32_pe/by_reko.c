// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_3 ebx_15 = null;
	Eq_3 ebp_21 = (struct <anonymous> *) 0x28;
	DWORD eax_22 = AddUsersToEncryptedFile(&globals->t403020, null);
	if (eax_22 == 0x00)
		return eax_22;
	uint32 esi_27 = (word32) eax_22 + esi * 0x04;
	Eq_22 eax_32 = AreAllAccessesGranted(~0x00, ~0x00);
	if (eax_32 == 0x00)
		ebp_21 = eax_32 + 0x26;
	VirtualProtect(&globals->v401000, 0x3000, 0x40, fp - 0x10);
	Eq_45 dwLoc28_119 = fp - 0x10;
	struct Eq_47 * edi_111 = esi_27 + edi * 0x02;
	Eq_52 eax_110 = null;
	do
	{
		if (ebx_15 == ebp_21)
			ebx_15 = null;
		(&eax_110->unused)[1049974] = (int32) (ebx_15[0x00404000] ^ (&eax_110->unused)[1049974] ^ 0x54);
		eax_110 = (Eq_52) ((char *) &eax_110->unused + 0x01);
		ebx_15 = (Eq_3) (ebx_15 + 0x01);
	} while (eax_110 < (struct HINSTANCE__ *) 0x1440);
	word32 esi_108 = 0x00401358;
	struct Eq_78 * ecx_246 = &globals->t4028D8;
	word32 * ebp_109 = (word32 *) 0xF0401358;
	up32 dwLoc0C_245 = 0x00;
	if (true)
	{
		do
		{
			Eq_93 eax_249 = ecx_246->t0004 - 0x08 >> 0x01;
			word16 * edx_252 = (char *) &ecx_246->t0004 + 0x04;
			if (eax_249 > 0x00)
			{
				Eq_93 ebx_264 = eax_249;
				do
				{
					ui32 eax_267 = (word32) *edx_252;
					edi_111 = eax_267 & 0xF000;
					if ((eax_267 & 0xF000) == 0x3000)
					{
						struct Eq_181 * eax_278 = (eax_267 & 0x0FFF) + ecx_246->dw0000;
						eax_278->dw401358 = eax_278->dw401358 + 0xF0401358;
					}
					edx_252 = edx_252 + 0x01;
					ebx_264 = ebx_264 - 0x01;
				} while (ebx_264 != 0x00);
			}
			eax_110 = ecx_246->t0004;
			up32 edx_258 = eax_110 + dwLoc0C_245 / 0x04;
			ecx_246 = ecx_246 + eax_110;
			dwLoc0C_245 = edx_258;
		} while (edx_258 < 228);
	}
	struct Eq_85 * ebx_100 = &globals->t4020C4;
	struct Eq_85 * dwLoc0C_101 = globals->a4020D4;
	if (globals->a4020D4 != 0x00)
	{
		do
		{
			word32 edx_133 = ebx_100->dw000C;
			dwLoc28_119 = edx_133 + 0x00401358;
			eax_110 = LoadLibraryA(edx_133 + 0x00401358);
			edi_111 = (struct Eq_47 *) (ebx_100 + (edi_111 * 0x02) / 0x0014);
			if (eax_110 != null)
			{
				word32 ebp_163 = ebx_100->dw0000;
				if (ebp_163 == 0x00)
					ebp_163 = ebx_100->dw0010;
				ebp_109 = ebp_163 + 0x00401358;
				eax_110 = (Eq_52) *ebp_109;
				edi_111 = dwLoc0C_101->dw0000 + 0x00401358;
				if (eax_110 != null)
				{
					do
					{
						Eq_196 eax_209;
						if (eax_110 < null)
						{
							Eq_45 ecx_221 = (word32) *ebp_109;
							dwLoc28_119 = ecx_221;
							eax_209 = GetProcAddress(eax_110, ecx_221);
							esi_108 = 0x00401358;
						}
						else
						{
							word32 eax_232 = eax_110 + 0x0040135A;
							dwLoc28_119 = eax_232;
							eax_209 = GetProcAddress(eax_110, eax_232);
						}
						edi_111->dw0000 = (word32) eax_209;
						ebp_109 = ebp_109 + 0x01;
						eax_110 = (Eq_52) *ebp_109;
						edi_111 = edi_111 + 0x04;
					} while (eax_110 != null);
				}
				ebx_100 = dwLoc0C_101;
			}
			ebx_100 = ebx_100 + 0x01;
			dwLoc0C_101 = ebx_100;
		} while (ebx_100->dw0010 != 0x00);
	}
	fn00401DB8(eax_110, 4201912, ebx_100, ebp_109, esi_108, edi_111, dwLoc28_119);
	ExitProcess(0x00);
}

// 00401D80: void fn00401D80(Register int32 eax)
void fn00401D80(int32 eax)
{
}

// 00401D81: void fn00401D81(Register word32 eax, Register word32 ecx, Register byte dl)
void fn00401D81(word32 eax, word32 ecx, byte dl)
{
	word32 esp_15;
	bool C_16;
	byte dl_17;
	byte ch_18;
	byte SCZO_19;
	word32 edx_20;
	word32 ecx_21;
	byte SZO_22;
	word32 ebp_23;
	word32 eax_24;
	fnB07AD3A5();
	__lsl(wLoc63);
}

// 00401DB8: void fn00401DB8(Register Eq_52 eax, Register word32 ecx, Register (ptr32 Eq_85) ebx, Register (ptr32 word32) ebp, Register word32 esi, Register (ptr32 Eq_47) edi, Stack Eq_45 dwArg00)
void fn00401DB8(HMODULE eax, word32 ecx, Eq_85 * ebx, word32 * ebp, word32 esi, Eq_47 * edi, Eq_45 dwArg00)
{
	up32 v5_4 = (up32 *) 76762104 - ecx;
	(up32 *) 76762104 = v5_4;
	int64 edx_eax_16 = (int64) eax;
	word32 esi_9 = esi + Mem5[495271018:word32] + (v5_4 <u 0x00);
	edi[0x01] = (struct Eq_47) __in(SLICE(edx_eax_16, word16, 32));
	struct Eq_279 * edx_19 = SLICE(edx_eax_16, word32, 32);
	*(edx_19 - 122) = *(edx_19 - 122) - 0x1C196E0C - (esi_9->dw0000 < edi->dw0000);
	int32 eax_17 = (word32) edx_eax_16;
	byte dl_20 = SLICE(edx_eax_16, byte, 32);
	byte ch_30 = SLICE(ecx - 0x01, byte, 8);
	if (eax_17 > 3635669918)
		fn00401D80(eax_17 - 3635669918);
	else
	{
		(word32 *) 1544750227 = (word32 *) ((char *) ebp + 0x01);
		cu8 ch_56 = ch_30 - (byte *) 2617928581;
		word32 ecx_57 = DPB(ecx - 0x01, ch_56, 8);
		if (ch_56 > 0x00)
			fn00401D81((char *) ebp + 0x01, ecx_57, dl_20);
		else
		{
			edx_19->b98C6E64 = edx_19->b98C6E64 ^ dl_20;
			edx_19->b98C6E64 != 0x00;
			esi_9->b2312BF89 = __ror(esi_9->b2312BF89, 0x01);
		}
	}
}

