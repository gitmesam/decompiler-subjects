// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401000(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc08_15 = 0x00;
	while (dwLoc08_15 < dwArg0C)
	{
		Mem29[dwArg04 + dwLoc08_15:byte] = Mem0[dwArg08 + dwLoc08_15:byte];
		dwLoc08_15 = dwLoc08_15 + 0x01;
	}
}

// 00401040: void fn00401040(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401040(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	if (dwArg0C >=u 0x01)
	{
		byte cl_46 = Mem0[dwArg04 + 0x00:byte];
		word32 dwLoc0C_113 = 0x01;
		word32 dwLoc18_109 = 0x00;
		do
		{
			word32 ecx_64 = dwLoc0C_113 + 0x01;
			byte al_61 = Mem0[dwArg04 + dwLoc0C_113:byte];
			dwLoc0C_113 = ecx_64;
			if ((word32) al_61 == (word32) cl_46)
			{
				if ((word32) Mem0[dwArg04 + ecx_64:byte] == 0x00)
				{
					Mem106[dwArg08 + dwLoc18_109:byte] = cl_46;
					dwLoc18_109 = dwLoc18_109 + 0x01;
					dwLoc0C_113 = ecx_64 + 0x01;
				}
				else
				{
					word32 eax_124 = fn00401150(fp - 0x10, dwArg04 + ecx_64) + ecx_64;
					dwLoc0C_113 = fn00401150(fp - 0x24, dwArg04 + eax_124) + eax_124;
					word32 dwLoc1C_139 = 0x00;
					while (dwLoc1C_139 <u dwLoc10)
					{
						Mem156[dwArg08 + dwLoc18_109:byte] = Mem0[dwArg08 + (dwLoc18_109 - dwLoc24):byte];
						dwLoc18_109 = dwLoc18_109 + 0x01;
						dwLoc1C_139 = dwLoc1C_139 + 0x01;
					}
				}
			}
			else
			{
				Mem168[dwArg08 + dwLoc18_109:byte] = al_61;
				dwLoc18_109 = dwLoc18_109 + 0x01;
			}
		} while (dwLoc0C_113 <u dwArg0C);
	}
}

// 00401150: Register word32 fn00401150(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401150(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00;
	word32 dwLoc14_13 = 0x00;
	do
	{
		word32 ecx_16 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 eax_25 = dwLoc08_12 << 0x07 | ecx_16 & 0x7F;
		word32 edx_28 = dwLoc14_13 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_12 = eax_25;
		dwLoc14_13 = edx_28;
	} while ((ecx_16 & 0x80) != 0x00);
	Mem38[dwArg04 + 0x00:word32] = eax_25;
	return edx_28;
}

// 004011B0: Register word32 fn004011B0(Stack word32 dwArg04)
word32 fn004011B0(word32 dwArg04)
{
	word32 eax_28;
	word32 eax_23 = CreateFileA(dwArg04, 0x80000000, 0x01, 0x00, 0x03, 0x80, 0x00);
	if (eax_23 == ~0x00)
		eax_28 = 0x00;
	else
		eax_28 = eax_23;
	return eax_28;
}

// 004011F0: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetModuleHandleA(0x00);
	LoadIconA(GetModuleHandleA(0x00), 0x00403000);
	LoadCursorA(0x00, 0x7F00);
	if ((word32) RegisterClassA(fp - 0x60) == 0x00)
		return 0x00;
	if (dwArg08 != 0x01)
		Mem586[0x00403068:word32] = 0x00;
	else
	{
		Mem587[0x00403068:word32] = 0x01;
		Mem589[0x00403058:word32] = dwArg04;
	}
	word32 dwLoc20_227;
	CreateWindowExA(0x00, 0x0040302C, 0x00403018, 0x01, 0x9942, 0x05622121, 1127991, 108151449, 0x00, 0x00, GetModuleHandleA(0x00), 0x00);
	word32 dwLoc10_192 = 0x00 >> (byte) (dwLoc10 - 133361) << (byte) dwLoc10 >> (byte) (dwLoc10 + 308593);
	if (Mem0[0x00403068:word32] == 0x00)
		dwLoc20_227 = GetModuleHandleA(0x00);
	else
		dwLoc20_227 = dwArg04;
	word32 eax_232 = dwLoc20_227 + Mem0[dwLoc20_227 + 0x3C:word32];
	word32 eax_243 = ((word32) Mem0[eax_232 + 0x06:word16] - 0x01) *s 0x28 + ((eax_232 + 0x18) + (word32) Mem0[eax_232 + 0x14:word16]);
	word32 eax_259 = (uint32) ((uint64) (uint32) (Mem0[eax_243 + 0x10:word32] - 0x01 + Mem0[eax_232 + 0x3C:word32]) /u Mem0[eax_232 + 0x3C:word32]) *s Mem0[eax_232 + 0x3C:word32] + Mem0[eax_243 + 0x14:word32];
	word32 eax_264 = fn00401DC0(0x0200);
	if (eax_264 == 0x00)
		return 0x00;
	GetModuleFileNameA(dwLoc20_227, eax_264, 0x0200);
	word32 eax_287 = fn004011B0(eax_264);
	if (eax_287 == 0x00)
		return 0x00;
	word32 eax_304 = GetFileSize(eax_287, 0x00) - eax_259;
	if (eax_304 == 0x00)
		return 0x00;
	word32 eax_318 = fn00401DC0(eax_304 + 0x10);
	if (eax_318 == 0x00)
		return 0x00;
	SetFilePointer(eax_287, eax_259, 0x00, 0x00);
	if (ReadFile(eax_287, eax_318, eax_304, fp - 0x28, 0x00) == 0x00)
		return 0x00;
	CloseHandle(eax_287);
	if (dwLoc28 != eax_304)
		return 0x00;
	word32 eax_378 = GetDesktopWindow();
	word32 eax_382 = fn00401DC0(200);
	Mem386[eax_382 + 0x00:byte] = 0x01;
	GetWindowTextA(eax_378, eax_382, 200);
	if ((word32) Mem386[eax_382 + 0x00:byte] != 0x00)
	{
		fn00401D90(eax_382);
		return 0x00;
	}
	else
	{
		fn00401D90(eax_382);
		fn00401000(eax_318, eax_318 - 0x40 + eax_304, 0x40);
		word32 eax_420 = Mem386[eax_318 + 0x00:word32];
		word32 edx_423 = Mem386[eax_318 + 0x04:word32];
		word32 dwLoc0C_425 = 0x00;
		while (dwLoc0C_425 <u eax_420)
		{
			word32 edx_443 = dwLoc10_192 - Mem386[0x00403080:word32] << (byte) ((Mem386[0x0040306C:word32] *s Mem386[0x00403050:word32] + Mem386[0x00403080:word32]) - dwLoc10_192 *s dwLoc10_192);
			Mem452[eax_318 + dwLoc0C_425 + 0x08:word32] = Mem386[eax_318 + dwLoc0C_425 + 0x08:word32] ^ 11;
			Mem468[0x00403070:word32] = 0xEB70 >> (byte) Mem452[0x0040304C:word32] << (byte) (959564 - (edx_443 << ~0x1D)) >> (byte) (edx_443 << ~0x1D) << (byte) Mem452[0x00403050:word32];
			dwLoc10_192 = edx_443 << ~0x1D;
			dwLoc0C_425 = dwLoc0C_425 + 0x08;
		}
		Mem478[0x00403064:word32] = fn00401DC0(edx_423);
		if (Mem478[0x00403064:word32] != 0x00)
		{
			fn00401040(eax_318 + 0x08, Mem478[0x00403064:word32], eax_420);
			Mem495[0x00403054:word32] = edi;
			Mem496[0x00403048:word32] = esi;
			Mem497[0x00403060:word32] = ebx;
			Mem498[0x0040305C:word32] = fp - 0x04;
			Mem507[0x00403078:word32] = Mem498[fs:0x18:word32];
			if (Mem507[0x00403068:word32] != 0x00)
				fn00401650(4199926 - Mem507[0x00403058:word32]);
			else
				fn00401650(4199926 - GetModuleHandleA(0x00));
			word32 eax_516 = fn004017C0(Mem507[0x00403064:word32]);
			if (eax_516 != 0x00)
			{
				word32 esp_536;
				word32 ebp_537;
				byte SCZO_538;
				word32 ebx_539;
				word32 esi_540;
				word32 edi_541;
				word32 eax_542;
				word32 ecx_543;
				word16 ax_544;
				word32 edx_545;
				byte SZO_546;
				bool C_547;
				bool Z_548;
				byte cl_549;
				selector fs_550;
				Mem507[0x0040307C:word32]();
				return eax_542;
			}
			else
			{
				fn00401D90(Mem507[0x00403064:word32]);
				ExitProcess(0x0446);
			}
		}
		else
			ExitProcess(0x07783872);
	}
}

// 00401650: void fn00401650(Stack word32 dwArg04)
void fn00401650(word32 dwArg04)
{
	word32 dwLoc24_13;
	if (Mem0[0x00403068:word32] != 0x00)
		dwLoc24_13 = Mem0[0x00403058:word32];
	else
		dwLoc24_13 = GetModuleHandleA(0x00);
	if (dwLoc24_13 == 0x00)
		return;
	word32 edx_71 = dwLoc24_13 + Mem0[dwLoc24_13 + 0x3C:word32];
	Mem85[0x00403074:word32] = VirtualAlloc(0x00, Mem0[edx_71 + 0x50:word32], 0x3000, 0x40);
	if (Mem85[0x00403074:word32] == 0x00)
		return;
	word32 edx_98 = Mem85[0x00403074:word32];
	fn00401000(edx_98, dwLoc24_13, Mem85[edx_71 + 0x50:word32]);
	word32 eax_103 = Mem85[0x00403074:word32] - dwLoc24_13;
	if (Mem85[edx_71 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_136 = dwLoc24_13 + Mem85[edx_71 + 0xA0:word32];
		while (Mem85[dwLoc0C_136 + 0x04:word32] != 0x00)
		{
			word32 eax_151 = Mem85[dwLoc0C_136 + 0x04:word32] - 0x08 >>u 0x01;
			word32 ecx_154 = dwLoc0C_136 + 0x08;
			word32 dwLoc08_157 = 0x00;
			while (dwLoc08_157 <u eax_151)
			{
				if ((word32) ecx_154[dwLoc08_157 * 0x02] >> 0x0C == 0x03)
					Mem198[Mem85[0x00403074:word32] + Mem85[dwLoc0C_136 + 0x00:word32] + ((word32) ecx_154[dwLoc08_157 * 0x02] & 0x0FFF):word32] = Mem85[Mem85[0x00403074:word32] + Mem85[dwLoc0C_136 + 0x00:word32] + ((word32) ecx_154[dwLoc08_157 * 0x02] & 0x0FFF):word32] + eax_103;
				dwLoc08_157 = dwLoc08_157 + 0x01;
			}
			dwLoc0C_136 = dwLoc0C_136 + Mem85[dwLoc0C_136 + 0x04:word32];
		}
	}
	word32 eax_118 = dwArg04 + Mem85[0x00403074:word32];
	word32 esp_122;
	word32 ebp_123;
	byte SCZO_124;
	word32 esi_125;
	bool Z_126;
	word32 eax_127;
	byte SZO_128;
	bool C_129;
	word32 ecx_130;
	word32 edx_131;
	eax_118();
}

// 004017C0: Register word32 fn004017C0(Stack word32 dwArg04)
word32 fn004017C0(word32 dwArg04)
{
	word32 eax_251;
	word32 edx_16 = dwArg04 + Mem0[dwArg04 + 0x3C:word32];
	word32 dwLoc24_110 = edx_16 + 0x18 + (word32) Mem0[edx_16 + 0x14:word16];
	word32 eax_33 = VirtualAlloc(0x00, Mem0[edx_16 + 0x50:word32], 0x3000, 0x40);
	if (eax_33 != 0x00)
	{
		fn00401000(eax_33, dwArg04, Mem0[dwArg04 + 0x3C:word32] + 0x0138 + (word32) Mem0[edx_16 + 0x06:word16] *s 0x28);
		word32 dwLoc0C_104 = 0x00;
		while (dwLoc0C_104 <u (word32) Mem0[edx_16 + 0x06:word16])
		{
			if (Mem0[dwLoc24_110 + 0x14:word32] != 0x00 && Mem0[dwLoc24_110 + 0x10:word32] != 0x00)
				fn00401000(eax_33 + Mem0[dwLoc24_110 + 0x0C:word32], dwArg04 + Mem0[dwLoc24_110 + 0x14:word32], (uint32) ((uint64) (uint32) (Mem0[dwLoc24_110 + 0x10:word32] - 0x01 + Mem0[edx_16 + 0x3C:word32]) /u Mem0[edx_16 + 0x3C:word32]) *s Mem0[edx_16 + 0x3C:word32]);
			dwLoc24_110 = dwLoc24_110 + 0x28;
			dwLoc0C_104 = dwLoc0C_104 + 0x01;
		}
		word32 ecx_173 = eax_33 + Mem0[eax_33 + 0x3C:word32];
		word32 dwLoc44_179 = eax_33 + Mem0[ecx_173 + 0x80:word32];
		while (Mem0[dwLoc44_179 + 0x10:word32] != 0x00)
		{
			word32 eax_201 = GetModuleHandleA(eax_33 + Mem0[dwLoc44_179 + 0x0C:word32]);
			word32 dwLoc14_203 = eax_201;
			if (eax_201 == 0x00)
			{
				if (Mem0[0x00403068:word32] != 0x00)
				{
					eax_251 = 0x00;
					return eax_251;
				}
				word32 eax_329 = LoadLibraryA(eax_33 + Mem0[dwLoc44_179 + 0x0C:word32]);
				dwLoc14_203 = eax_329;
				if (eax_329 == 0x00)
				{
					eax_251 = 0x00;
					return eax_251;
				}
			}
			word32 dwLoc30_215;
			word32 dwLoc20_214;
			if (Mem0[dwLoc44_179 + 0x00:word32] != 0x00)
			{
				dwLoc20_214 = eax_33 + Mem0[dwLoc44_179 + 0x00:word32];
				dwLoc30_215 = eax_33 + Mem0[dwLoc44_179 + 0x10:word32];
			}
			else
			{
				dwLoc20_214 = eax_33 + Mem0[dwLoc44_179 + 0x10:word32];
				dwLoc30_215 = eax_33 + Mem0[dwLoc44_179 + 0x00:word32];
			}
			word32 dwLoc10_218 = 0x00;
			if (Mem0[dwLoc44_179 + 0x10:word32] != 0x00 && Mem0[dwLoc44_179 + 0x00:word32] != 0x00)
				dwLoc10_218 = 0x01;
			while (Mem0[dwLoc20_214 + 0x00:word32] != 0x00)
			{
				if ((Mem0[dwLoc20_214 + 0x00:word32] & 0x80000000) != 0x00)
					Mem282[dwLoc20_214 + 0x00:word32] = GetProcAddress(dwLoc14_203, Mem0[dwLoc20_214 + 0x00:word32] & 0x7FFFFFFF);
				else
					Mem295[dwLoc20_214 + 0x00:word32] = GetProcAddress(dwLoc14_203, Mem0[dwLoc20_214 + 0x00:word32] + 0x02 + eax_33);
				if (Mem0[dwLoc20_214 + 0x00:word32] == 0x00)
				{
					eax_251 = 0x00;
					return eax_251;
				}
				if (dwLoc10_218 != 0x00)
					Mem268[dwLoc30_215 + 0x00:word32] = Mem0[dwLoc20_214 + 0x00:word32];
				dwLoc20_214 = dwLoc20_214 + 0x04;
				dwLoc30_215 = dwLoc30_215 + 0x04;
			}
			dwLoc44_179 = dwLoc44_179 + 0x14;
		}
		if (Mem0[0x00403068:word32] != 0x00)
		{
			word32 edx_637 = Mem0[0x00403058:word32] - Mem0[ecx_173 + 0x34:word32];
			if (Mem0[ecx_173 + 0xA4:word32] != 0x00)
			{
				word32 dwLoc18_646 = eax_33 + Mem0[ecx_173 + 0xA0:word32];
				while (Mem0[dwLoc18_646 + 0x04:word32] != 0x00)
				{
					word32 edx_661 = Mem0[dwLoc18_646 + 0x04:word32] - 0x08 >>u 0x01;
					word32 eax_664 = dwLoc18_646 + 0x08;
					word32 dwLoc0C_667 = 0x00;
					while (dwLoc0C_667 <u edx_661)
					{
						if ((word32) eax_664[dwLoc0C_667 * 0x02] >> 0x0C == 0x03)
							Mem708[eax_33 + Mem0[dwLoc18_646 + 0x00:word32] + ((word32) eax_664[dwLoc0C_667 * 0x02] & 0x0FFF):word32] = Mem0[eax_33 + Mem0[dwLoc18_646 + 0x00:word32] + ((word32) eax_664[dwLoc0C_667 * 0x02] & 0x0FFF):word32] + edx_637;
						dwLoc0C_667 = dwLoc0C_667 + 0x01;
					}
					dwLoc18_646 = dwLoc18_646 + Mem0[dwLoc18_646 + 0x04:word32];
				}
			}
		}
		word32 eax_366 = CreateFileMappingA(~0x00, 0x00, 0x04, 0x00, Mem0[ecx_173 + 0x50:word32], 0x00);
		if (eax_366 != 0x00)
		{
			if (Mem0[0x00403068:word32] != 0x00)
				Mem616[0x00403074:word32] = MapViewOfFileEx(eax_366, 0x22, 0x00, 0x00, 0x00, Mem0[0x00403058:word32]);
			else
				Mem634[0x00403074:word32] = MapViewOfFileEx(eax_366, 0x22, 0x00, 0x00, 0x00, Mem0[ecx_173 + 0x34:word32]);
			if (Mem0[0x00403074:word32] == 0x00)
			{
				if (Mem0[0x00403068:word32] != 0x00)
				{
					if (UnmapViewOfFile(Mem0[0x00403058:word32]) == 0x00 && VirtualFree(Mem0[0x00403058:word32], 0x00, 0x8000) == 0x00)
					{
						eax_251 = 0x00;
						return eax_251;
					}
				}
				else if (UnmapViewOfFile(Mem0[ecx_173 + 0x34:word32]) == 0x00 && VirtualFree(Mem0[ecx_173 + 0x34:word32], 0x00, 0x8000) == 0x00)
				{
					eax_251 = 0x00;
					return eax_251;
				}
				if (Mem0[0x00403068:word32] != 0x00)
					Mem522[0x00403074:word32] = MapViewOfFileEx(eax_366, 0x22, 0x00, 0x00, 0x00, Mem0[0x00403058:word32]);
				else
					Mem540[0x00403074:word32] = MapViewOfFileEx(eax_366, 0x22, 0x00, 0x00, 0x00, Mem0[ecx_173 + 0x34:word32]);
				if (Mem0[0x00403074:word32] == 0x00)
				{
					if (Mem0[0x00403068:word32] != 0x00)
						Mem490[0x00403074:word32] = VirtualAlloc(Mem0[0x00403058:word32], Mem0[ecx_173 + 0x50:word32], 0x3000, 0x40);
					else
						Mem505[0x00403074:word32] = VirtualAlloc(Mem0[ecx_173 + 0x34:word32], Mem0[ecx_173 + 0x50:word32], 0x3000, 0x40);
					if (Mem0[0x00403074:word32] == 0x00)
					{
						eax_251 = 0x00;
						return eax_251;
					}
				}
			}
			fn00401000(Mem0[0x00403074:word32], eax_33, Mem0[ecx_173 + 0x50:word32]);
			if (Mem0[0x00403068:word32] != 0x00)
				fn00401CF0(Mem0[0x00403058:word32], Mem0[0x00403074:word32] + Mem0[ecx_173 + 0x28:word32]);
			else
				fn00401D60(Mem0[0x00403074:word32]);
			Mem414[0x0040307C:word32] = Mem0[0x00403074:word32] + Mem0[ecx_173 + 0x28:word32];
			Mem417[ecx_173 + 0x28:word32] = Mem414[0x0040307C:word32];
			eax_251 = 0x01;
			return eax_251;
		}
		else
		{
			eax_251 = 0x00;
			return eax_251;
		}
	}
	else
	{
		eax_251 = 0x00;
		return eax_251;
	}
}

// 00401CF0: void fn00401CF0(Stack word32 dwArg04, Stack word32 dwArg08)
void fn00401CF0(word32 dwArg04, word32 dwArg08)
{
	word32 ecx_14 = Mem0[Mem0[Mem0[Mem0[0x00403078:word32] + 0x30:word32] + 0x0C:word32] + 0x0C:word32];
	word32 dwLoc10_15 = ecx_14;
	while (0x01 != 0x00 && dwLoc10_15 != 0x00)
	{
		if (Mem0[dwLoc10_15 + 0x18:word32] == dwArg04)
		{
			Mem50[dwLoc10_15 + 0x1C:word32] = dwArg08;
			return;
		}
		word32 eax_53 = Mem0[dwLoc10_15 + 0x00:word32];
		dwLoc10_15 = eax_53;
		if (eax_53 == ecx_14)
			return;
	}
}

// 00401D60: void fn00401D60(Stack word32 dwArg04)
void fn00401D60(word32 dwArg04)
{
	Mem22[Mem0[Mem0[0x00403078:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 00401D90: void fn00401D90(Stack word32 dwArg04)
void fn00401D90(word32 dwArg04)
{
	HeapFree(GetProcessHeap(), 0x00, dwArg04);
}

// 00401DC0: Register word32 fn00401DC0(Stack word32 dwArg04)
word32 fn00401DC0(word32 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

