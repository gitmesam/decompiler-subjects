// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00429AA1: void fn00429AA1(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C)
void fn00429AA1(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C)
{
	word32 * esi_16 = dwArg04;
	uint32 edi_19 = dwArg08 >> 0x02;
	do
	{
		*esi_16 = *esi_16 - dwArg0C;
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = __ror(*esi_16, 0x14);
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = __ror(*esi_16, 122);
		*esi_16 = -*esi_16;
		*esi_16 = *esi_16 - dwArg0C;
		*esi_16 = *esi_16 - dwArg0C;
		esi_16 = esi_16 + 0x01;
		edi_19 = edi_19 - 0x01;
	} while (edi_19 != 0x00);
}

// 00429AF4: Register Eq_78 Win32CrtStartup()
Eq_78 Win32CrtStartup()
{
	ptr32 esp_102;
	ptr32 ebp_126;
	Eq_78 eax_103;
	Eq_82 SO_159;
	GetCommandLineW();
	Eq_78 eax_31 = CreateFileA(&globals->t42D000, 0xE0000000, 0x00, null, 0x03, 0xA2, 0x00);
	if (eax_31 == ~0x00)
	{
		struct Eq_126 * esp_183 = fp - 0x30;
		if (LoadResource(null, eax_31) != 0x00)
		{
l00429BB1:
			fn00429AA1(dwArg00, dwArg04, dwArg08);
			GetCommandLineA();
			GetCommandLineA();
			struct Eq_148 * edi_229 = esp_183->ptr0010;
			GetACP();
			GetCommandLineW();
			Eq_78 eax_241 = GetFileType(*(ebp - 0x10));
			ptr32 esp_245;
			word32 ebp_246;
			byte SCZO_247;
			struct Eq_365 * ebx_248;
			struct Eq_366 * edi_249;
			struct Eq_367 * esi_250;
			struct Eq_368 * eax_251;
			bool Z_252;
			byte SZO_253;
			bool C_254;
			byte SO_255;
			byte cl_256;
			int32 ecx_257;
			word32 edx_258;
			bool S_259;
			byte al_260;
			byte bh_261;
			byte dl_262;
			bool D_263;
			struct Eq_381 * ss_264;
			byte ch_265;
			byte ah_266;
			edi_229->ptrA053F989();
			ebx_248->dwF9D39FFF = __rol(ebx_248->dwF9D39FFF, cl_256);
			int32 ecx_275 = ecx_257 >> cl_256;
			*(esp_245 - 0x04) = &(eax_251->a99FB3386 + 0x06DFD400)->b0000 + 0x03;
			*(esp_245 - 0x08) = ecx_275;
			*(esp_245 - 0x0C) = edx_258;
			*(esp_245 - 0x10) = (struct Eq_365 **) ebx_248;
			*(esp_245 - 0x14) = esp_245;
			*(esp_245 - 0x18) = ebp_246;
			*(esp_245 - 0x1C) = &esi_250->dw0001;
			*(esp_245 - 0x20) = &edi_249->dw0001;
			byte ch_277 = SLICE(ecx_275, byte, 8);
			if (ecx_275 >= 0x00)
			{
				if (ecx_275 < 0x00)
					return &(eax_251->a99FB3386 + 0x06DFD400)->b0000 + 0x03;
				eax_251->a99FB3386[&esi_250->dw0001].b0000 = ch_277;
				*(esp_245 - 0x24) = esp_245 - 0x20;
				edi_249->dw0001 = esi_250->dw0001;
			}
		}
		GetCurrentProcessId();
		GetOEMCP();
		Eq_131 eax_338 = GetModuleHandleA(&globals->t42D025);
		CloseHandle(eax_31);
		GetProcAddress(eax_338, &globals->t42D02F)();
		eax_103 = LoadResource(null, eax_31);
		esi = <invalid>;
		edi = <invalid>;
		ebx = <invalid>;
		ebp_126 = <invalid>;
		esp_102 = fp - 0x3C;
		SO_159 = cond(eax_103);
		if (eax_103 == 0x00)
		{
			esp_183 = fp - 0x44;
			goto l00429BB1;
		}
l00429C8F:
		if (SO_159)
		{
l00429C3D:
			*(ebp_126 - 0x04) = (union Eq_78 *) eax_103;
			ptr32 * esp_67 = esp_102 - 0x04;
			*esp_67 = esi;
			GetOEMCP();
			*(esp_67 - 0x04) = edi;
			*(esp_67 - 0x08) = ebx;
			do
			{
				ptr32 esp_75 = esp_102 - 0x0C;
				*(esp_75 - 0x04) = *(ebp_126 - 0x10);
				CloseHandle(*(esp_75 - 0x04));
				*(esp_75 - 0x04) = *(ebp_126 - 0x10);
				*(esp_75 - 0x08) = 0x00;
				Eq_78 eax_86 = LoadResource(*(esp_75 - 0x08), *(esp_75 - 0x04));
				*(ebp_126 - 0x1C) = (union Eq_78 *) eax_86;
				SO_159 = cond(eax_86);
			} while (eax_86 != 0x00);
			*(esp_75 - 0x04) = 0x00;
			*(esp_75 - 0x08) = *(ebp_126 - 0x04);
			GetFileSize(*(esp_75 - 0x08), *(esp_75 - 0x04));
			esp_102 = esp_75;
			eax_103 = GetCurrentProcessId();
			goto l00429C8F;
		}
		if (!SO_159)
			;
	}
	else
	{
		GetFileType(eax_31);
		GetFileSize(eax_31, null);
		GetFileType(eax_31);
		GetOEMCP();
		ebp_126 = fp - 0x30;
		esp_102 = fp - 0x3C;
	}
	struct Eq_307 * esp_133 = esp_102 - 0x04;
	esp_133->t0000 = null;
	*(esp_133 - 0x04) = 0x03;
	*(esp_133 - 0x08) = 0xE0000000;
	*(esp_133 - 0x0C) = 0x0042D01C;
	eax_103 = CreateFileA(*(esp_133 - 0x0C), *(esp_133 - 0x08), *(esp_133 - 0x04), esp_133->t0000, esp_133->t0004, esp_133->t0008, esp_133->t000C);
	esp_102 = (char *) &esp_133->t000C + 0x04;
	goto l00429C3D;
}

