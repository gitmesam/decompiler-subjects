// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00429AA1: void fn00429AA1(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C)
void fn00429AA1(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C)
{
	word32 * esi_16 = dwArg04;
	uint32 edi_19 = dwArg08 >> 0x02;
	do
	{
		*esi_16 = *esi_16 - dwArg0C;
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = __ror(*esi_16, 0x14);
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = __ror(*esi_16, 122);
		*esi_16 = -*esi_16;
		*esi_16 = *esi_16 - dwArg0C;
		*esi_16 = *esi_16 - dwArg0C;
		esi_16 = esi_16 + 0x01;
		edi_19 = edi_19 - 0x01;
	} while (edi_19 != 0x00);
}

// 00429AF4: Register Eq_78 Win32CrtStartup()
Eq_78 Win32CrtStartup()
{
	ptr32 esp_133;
	ptr32 ebp_127;
	Eq_78 eax_101;
	bool SO_162;
	GetCommandLineW();
	Eq_78 eax_31 = CreateFileA(0x0042D000, 0xE0000000, 0x00, null, 0x03, 0xA2, 0x00);
	if (eax_31 == ~0x00)
	{
		struct Eq_126 * esp_183 = fp - 0x54;
		if (LoadResource(0x00, eax_31) != 0x00)
		{
l00429BB1:
			fn00429AA1(dwArg00, dwArg04, dwArg08);
			GetCommandLineA();
			GetCommandLineA();
			struct Eq_148 * edi_238 = esp_183->ptr0010;
			GetACP();
			GetCommandLineW();
			Eq_78 eax_250 = GetFileType(*(ebp - 0x10));
			ptr32 esp_253;
			word32 ebp_254;
			byte SCZO_255;
			struct Eq_365 * ebx_256;
			struct Eq_366 * edi_257;
			struct Eq_367 * esi_258;
			struct Eq_368 * eax_259;
			byte Z_260;
			byte SZO_261;
			byte C_262;
			byte SO_263;
			byte cl_264;
			int32 ecx_265;
			word32 edx_266;
			byte S_267;
			byte al_268;
			byte bh_269;
			byte dl_270;
			byte D_271;
			struct Eq_381 * ss_272;
			byte ch_273;
			byte ah_274;
			edi_238->ptrA053F989();
			ebx_256->dwF9D39FFF = __rol(ebx_256->dwF9D39FFF, cl_264);
			int32 ecx_283 = ecx_265 >> cl_264;
			*(esp_253 - 0x04) = &(eax_259->a99FB3386 + 0x06DFD400)->b0000 + 0x03;
			*(esp_253 - 0x08) = ecx_283;
			*(esp_253 - 0x0C) = edx_266;
			*(esp_253 - 0x10) = (struct Eq_365 **) ebx_256;
			*(esp_253 - 0x14) = esp_253;
			*(esp_253 - 0x18) = ebp_254;
			*(esp_253 - 0x1C) = &esi_258->dw0001;
			*(esp_253 - 0x20) = &edi_257->dw0001;
			byte ch_285 = SLICE(ecx_283, byte, 8);
			if (ecx_283 >= 0x00)
			{
				if (ecx_283 < 0x00)
					return &(eax_259->a99FB3386 + 0x06DFD400)->b0000 + 0x03;
				eax_259->a99FB3386[&esi_258->dw0001].b0000 = ch_285;
				*(esp_253 - 0x24) = esp_253 - 0x20;
				edi_257->dw0001 = esi_258->dw0001;
			}
		}
		GetCurrentProcessId();
		GetOEMCP();
		Eq_78 eax_346 = GetModuleHandleA(0x0042D025);
		CloseHandle(eax_31);
		GetProcAddress(eax_31, eax_346)();
		eax_101 = LoadResource(0x00, eax_31);
		esp_133 = fp - 0x78;
		SO_162 = cond(eax_101);
		if (eax_101 == 0x00)
		{
			esp_183 = fp - 0x80;
			goto l00429BB1;
		}
l00429C8F:
		if (SO_162)
		{
l00429C3D:
			*(ebp_127 - 0x04) = (union Eq_78 *) eax_101;
			word32 * esp_69 = esp_133 - 0x04;
			*esp_69 = esi;
			GetOEMCP();
			*(esp_69 - 0x04) = edi;
			*(esp_69 - 0x08) = ebx;
			ptr32 esp_74 = esp_69 - 0x08;
			do
			{
				union Eq_78 * esp_78 = esp_74 - 0x04;
				*esp_78 = *(ebp_127 - 0x10);
				CloseHandle(*esp_78);
				*(esp_78 - 0x04) = *(ebp_127 - 0x10);
				*(esp_78 - 0x08) = 0x00;
				Eq_78 eax_86 = LoadResource(*(esp_78 - 0x08), *(esp_78 - 0x04));
				*(ebp_127 - 0x1C) = (union Eq_78 *) eax_86;
				esp_74 = esp_78 - 0x08;
				SO_162 = cond(eax_86);
			} while (eax_86 != 0x00);
			*(esp_78 - 0x0C) = 0x00;
			*(esp_78 - 0x10) = *(ebp_127 - 0x04);
			GetFileSize(*(esp_78 - 0x10), *(esp_78 - 0x0C));
			esp_133 = esp_78 - 0x10;
			eax_101 = GetCurrentProcessId();
			goto l00429C8F;
		}
		if (!SO_162)
			;
	}
	else
	{
		GetFileType(eax_31);
		GetFileSize(eax_31, null);
		GetFileType(eax_31);
		GetOEMCP();
		ebp_127 = fp - 0x5C;
		esp_133 = fp - 0x68;
	}
	struct Eq_308 * esp_134 = esp_133 - 0x04;
	esp_134->t0000 = null;
	*(esp_134 - 0x04) = 0x03;
	*(esp_134 - 0x08) = 0xE0000000;
	*(esp_134 - 0x0C) = 0x0042D01C;
	esp_133 = esp_134 - 0x0C;
	eax_101 = CreateFileA(*(esp_134 - 0x0C), *(esp_134 - 0x08), *(esp_134 - 0x04), esp_134->t0000, esp_134->t0004, esp_134->t0008, esp_134->t000C);
	goto l00429C3D;
}

