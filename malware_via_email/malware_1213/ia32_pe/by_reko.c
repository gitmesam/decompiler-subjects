// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401020: void fn00401020(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401020(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	Mem6[0x004092AC:word32] = 0x00;
	while (Mem6[0x004092AC:word32] <u dwArg0C)
	{
		Mem25[dwArg04 + Mem6[0x004092AC:word32]:byte] = Mem6[dwArg08 + Mem6[0x004092AC:word32]:byte];
		Mem29[0x004092AC:word32] = Mem25[0x004092AC:word32] + 0x01;
	}
}

// 004010B0: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 eax_18 = GetModuleHandleA(0x00);
	if ((dwArg04 & 0xFFFF) != 0x00)
		Mem215[0x004092C4:word32] = 0x00;
	else
		Mem216[0x004092C4:word32] = 0x01;
	if (dwArg04 == 0x00)
		Mem214[0x004092C4:word32] = 0x00;
	if (Mem0[0x004092C4:word32] != 0x00)
		Mem213[0x004092B4:word32] = dwArg04;
	word32 eax_42 = fn00401270(LoadLibraryA(0x004091F8), 0x004091EC);
	word32 esp_53;
	word32 ebp_54;
	byte SCZO_55;
	word32 ebx_56;
	word32 esi_57;
	word32 edi_58;
	word32 eax_59;
	byte SZO_60;
	bool C_61;
	bool Z_62;
	word32 ecx_63;
	word32 edx_64;
	selector fs_65;
	eax_42();
	if (eax_59 != 0x00)
		return 0x00;
	word32 ecx_105 = Mem0[0x00405000:word32];
	word32 eax_108 = Mem0[0x00405004:word32];
	word32 dwLoc08_110 = 0x00;
	while (dwLoc08_110 <u ecx_105)
	{
		Mem130[dwLoc08_110 + 0x00405008:word32] = (word32) (int64) Mem0[dwLoc08_110 + 0x00405008:word32] ^ 0x380B5A5F;
		dwLoc08_110 = dwLoc08_110 + 0x08;
	}
	word32 ebp_165;
	Mem137[esp_53 - 0x04 + 0x00:word32] = eax_108;
	Mem141[0x004092C0:word32] = fn004018B0(dwArg00);
	Mem144[esp_53 - 0x04 + 0x00:word32] = ecx_105;
	Mem147[esp_53 - 0x08 + 0x00:word32] = Mem144[0x004092C0:word32];
	Mem152[esp_53 - 0x0C + 0x00:word32] = 0x00405008;
	fn00401A70(dwArg00, dwArg04, dwArg08);
	Mem155[0x004092B0:word32] = edi_58;
	Mem156[4231848:word32] = esi_57;
	Mem157[0x004092BC:word32] = ebx_56;
	Mem159[0x004092C8:word32] = Mem157[fs_65:0x18:word32];
	Mem162[0x004092B8:word32] = fp - 0x04;
	if (Mem162[0x004092C4:word32] != 0x00)
	{
		Mem192[esp_53 - 0x04 + 0x00:word32] = dwArg04;
		Mem197[esp_53 - 0x08 + 0x00:word32] = 0x00401237 - dwArg04;
		ebp_165 = fn004018E0(dwArg00, dwArg04);
	}
	else
	{
		Mem203[esp_53 - 0x04 + 0x00:word32] = eax_18;
		Mem208[esp_53 - 0x08 + 0x00:word32] = 0x00401237 - eax_18;
		ebp_165 = fn004018E0(dwArg00, dwArg04);
	}
	word32 ecx_167 = Mem162[0x004092C0:word32];
	Mem169[esp_53 - 0x04 + 0x00:word32] = ecx_167;
	word32 eax_170 = fn004012A0(ebp_165, dwArg00);
	word32 esp_177;
	word32 ebp_178;
	byte SCZO_179;
	word32 ebx_180;
	word32 esi_181;
	word32 edi_182;
	word32 eax_183;
	byte SZO_184;
	bool C_185;
	bool Z_186;
	word32 ecx_187;
	word32 edx_188;
	selector fs_189;
	Mem169[0x004092CC:word32]();
	return eax_183;
}

// 00401270: Register word32 fn00401270(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401270(word32 dwArg04, word32 dwArg08)
{
	GetCommandLineA();
	return GetProcAddress(dwArg04, dwArg08);
}

// 004012A0: Register word32 fn004012A0(Register word32 ebp, Stack word32 dwArg04)
word32 fn004012A0(word32 ebp, word32 dwArg04)
{
	word32 eax_242;
	lstrcpyA(fp - 0xB4, 0x00409210);
	word32 eax_23 = dwArg04 + Mem0[dwArg04 + 0x3C:word32];
	word32 dwLoc2C_148 = eax_23 + 0x18 + (word32) Mem0[eax_23 + 0x14:word16];
	word32 eax_40 = VirtualAlloc(0x00, Mem0[eax_23 + 0x50:word32], 0x3000, 0x40);
	if (eax_40 != 0x00)
	{
		fn00401020(eax_40, dwArg04, Mem0[dwArg04 + 0x3C:word32] + 0x0138 + (word32) Mem0[eax_23 + 0x06:word16] *s 0x28);
		word32 eax_128 = GetProcAddress(GetModuleHandleA(0x00409234), 0x00409224);
		word32 eax_139 = GetProcAddress(GetModuleHandleA(0x00409258), 0x00409244);
		word32 dwLoc10_142 = 0x00;
		while (dwLoc10_142 <u (word32) Mem0[eax_23 + 0x06:word16])
		{
			if (Mem0[dwLoc2C_148 + 0x14:word32] != 0x00 && Mem0[dwLoc2C_148 + 0x10:word32] != 0x00)
				fn00401020(eax_40 + Mem0[dwLoc2C_148 + 0x0C:word32], dwArg04 + Mem0[dwLoc2C_148 + 0x14:word32], (uint32) ((uint64) (uint32) (Mem0[dwLoc2C_148 + 0x10:word32] - 0x01 + Mem0[eax_23 + 0x3C:word32]) /u Mem0[eax_23 + 0x3C:word32]) *s Mem0[eax_23 + 0x3C:word32]);
			dwLoc2C_148 = dwLoc2C_148 + 0x28;
			dwLoc10_142 = dwLoc10_142 + 0x01;
		}
		word32 ecx_211 = eax_40 + Mem0[eax_40 + 0x3C:word32];
		word32 eax_233 = eax_139();
		if (eax_233 != 0x00)
		{
			GetModuleHandleA(0x00409274);
			word32 eax_255 = fn00401270(dwArg00, dwArg04);
			word32 dwLocC0_262 = eax_40 + Mem253[ecx_211 + 0x80:word32];
			while (Mem253[dwLocC0_262 + 0x10:word32] != 0x00)
			{
				word32 dwLoc38_288;
				word32 dwLoc28_287;
				LoadLibraryA(eax_40 + Mem253[dwLocC0_262 + 0x0C:word32]);
				if (Mem280[dwLocC0_262 + 0x00:word32] != 0x00)
				{
					dwLoc28_287 = eax_40 + Mem280[dwLocC0_262 + 0x00:word32];
					dwLoc38_288 = eax_40 + Mem280[dwLocC0_262 + 0x10:word32];
				}
				else
				{
					dwLoc28_287 = eax_40 + Mem280[dwLocC0_262 + 0x10:word32];
					dwLoc38_288 = eax_40 + Mem280[dwLocC0_262 + 0x00:word32];
				}
				word32 dwLoc1C_291 = 0x00;
				if (Mem280[dwLocC0_262 + 0x10:word32] != 0x00 && Mem280[dwLocC0_262 + 0x00:word32] != 0x00)
					dwLoc1C_291 = 0x01;
				while (Mem280[dwLoc28_287 + 0x00:word32] != 0x00)
				{
					if ((Mem280[dwLoc28_287 + 0x00:word32] & 0x80000000) != 0x00)
						Mem352[dwLoc28_287 + 0x00:word32] = fn00401270(dwArg00, dwArg04);
					else
						Mem366[dwLoc28_287 + 0x00:word32] = fn00401270(dwArg00, dwArg04);
					if (Mem280[dwLoc28_287 + 0x00:word32] == 0x00)
					{
						eax_242 = 0x00;
						return eax_242;
					}
					if (dwLoc1C_291 != 0x00)
						Mem337[dwLoc38_288 + 0x00:word32] = Mem280[dwLoc28_287 + 0x00:word32];
					dwLoc28_287 = dwLoc28_287 + 0x04;
					dwLoc38_288 = dwLoc38_288 + 0x04;
				}
				dwLocC0_262 = dwLocC0_262 + 0x14;
			}
			if (Mem253[0x004092C4:word32] != 0x00)
			{
				word32 edx_736 = Mem253[0x004092B4:word32] - Mem253[ecx_211 + 0x34:word32];
				if (Mem253[ecx_211 + 0xA4:word32] != 0x00)
				{
					word32 dwLoc24_745 = eax_40 + Mem253[ecx_211 + 0xA0:word32];
					while (Mem253[dwLoc24_745 + 0x04:word32] != 0x00)
					{
						word32 edx_760 = Mem253[dwLoc24_745 + 0x04:word32] - 0x08 >>u 0x01;
						word32 eax_763 = dwLoc24_745 + 0x08;
						word32 dwLoc10_766 = 0x00;
						while (dwLoc10_766 <u edx_760)
						{
							if ((word32) eax_763[dwLoc10_766 * 0x02] >> 0x0C == 0x03)
								Mem807[eax_40 + Mem253[dwLoc24_745 + 0x00:word32] + ((word32) eax_763[dwLoc10_766 * 0x02] & 0x0FFF):word32] = Mem253[eax_40 + Mem253[dwLoc24_745 + 0x00:word32] + ((word32) eax_763[dwLoc10_766 * 0x02] & 0x0FFF):word32] + edx_736;
							dwLoc10_766 = dwLoc10_766 + 0x01;
						}
						dwLoc24_745 = dwLoc24_745 + Mem253[dwLoc24_745 + 0x04:word32];
					}
				}
			}
			word32 eax_412 = GetProcAddress(GetModuleHandleA(0x00409294), 0x00409284);
			if (Mem411[0x004092C4:word32] != 0x00)
				Mem706[4231844:word32] = eax_412();
			else
				Mem733[4231844:word32] = eax_412();
			word32 esp_425 = fp - 244;
			if (Mem411[4231844:word32] == 0x00)
			{
				word32 esp_490;
				if (Mem411[0x004092C4:word32] != 0x00)
				{
					word32 eax_592 = eax_128();
					esp_490 = fp - 0xF8;
					if (eax_592 == 0x00)
					{
						word32 ebp_621;
						byte SCZO_622;
						word32 esi_623;
						word32 eax_624;
						word32 ecx_625;
						word32 edx_626;
						bool Z_627;
						byte SZO_628;
						bool C_629;
						eax_255();
						if (eax_624 == 0x00)
						{
							eax_242 = 0x00;
							return eax_242;
						}
					}
				}
				else
				{
					esp_490 = fp - 0xF8;
					if (eax_128() == 0x00)
					{
						word32 ebp_665;
						byte SCZO_666;
						word32 esi_667;
						word32 eax_668;
						word32 ecx_669;
						word32 edx_670;
						bool Z_671;
						byte SZO_672;
						bool C_673;
						eax_255();
						if (eax_668 == 0x00)
						{
							eax_242 = 0x00;
							return eax_242;
						}
					}
				}
				if (Mem411[0x004092C4:word32] != 0x00)
				{
					word32 esp_535 = esp_490 - 0x04;
					Mem536[esp_535 + 0x00:word32] = Mem411[0x004092B4:word32];
					Mem538[esp_535 - 0x04 + 0x00:word32] = 0x00;
					Mem540[esp_535 - 0x08 + 0x00:word32] = 0x00;
					Mem542[esp_535 - 0x0C + 0x00:word32] = 0x00;
					Mem544[esp_535 - 0x10 + 0x00:word32] = 0x22;
					Mem547[esp_535 - 0x14 + 0x00:word32] = eax_233;
					Mem558[4231844:word32] = eax_412();
				}
				else
				{
					word32 esp_561 = esp_490 - 0x04;
					Mem562[esp_561 + 0x00:word32] = Mem411[ecx_211 + 0x34:word32];
					Mem564[esp_561 - 0x04 + 0x00:word32] = 0x00;
					Mem566[esp_561 - 0x08 + 0x00:word32] = 0x00;
					Mem568[esp_561 - 0x0C + 0x00:word32] = 0x00;
					Mem570[esp_561 - 0x10 + 0x00:word32] = 0x22;
					Mem573[esp_561 - 0x14 + 0x00:word32] = eax_233;
					Mem584[4231844:word32] = eax_412();
				}
				esp_425 = esp_490 - 0x18;
				if (Mem411[4231844:word32] == 0x00)
				{
					if (Mem411[0x004092C4:word32] == 0x00)
					{
						Mem506[esp_425 - 0x04 + 0x00:word32] = 0x40;
						Mem508[esp_425 - 0x08 + 0x00:word32] = 0x3000;
						Mem512[esp_425 - 0x0C + 0x00:word32] = Mem508[ecx_211 + 0x50:word32];
						Mem516[esp_425 - 0x10 + 0x00:word32] = Mem512[ecx_211 + 0x34:word32];
						Mem519[4231844:word32] = VirtualAlloc(Mem516[esp_425 - 0x10 + 0x00:LPVOID], Mem516[esp_425 - 0x0C + 0x00:SIZE_T], Mem516[esp_425 - 0x08 + 0x00:DWORD], Mem516[esp_425 - 0x04 + 0x00:DWORD]);
					}
					else
					{
						Mem521[esp_425 - 0x04 + 0x00:word32] = 0x40;
						Mem523[esp_425 - 0x08 + 0x00:word32] = 0x3000;
						Mem527[esp_425 - 0x0C + 0x00:word32] = Mem523[ecx_211 + 0x50:word32];
						Mem530[esp_425 - 0x10 + 0x00:word32] = Mem527[0x004092B4:word32];
						Mem533[4231844:word32] = VirtualAlloc(Mem530[esp_425 - 0x10 + 0x00:LPVOID], Mem530[esp_425 - 0x0C + 0x00:SIZE_T], Mem530[esp_425 - 0x08 + 0x00:DWORD], Mem530[esp_425 - 0x04 + 0x00:DWORD]);
					}
				}
			}
			word32 esp_435 = esp_425 - 0x04;
			Mem436[esp_435 + 0x00:word32] = eax_233;
			CloseHandle(Mem436[esp_435 + 0x00:HANDLE]);
			Mem442[esp_435 + 0x00:word32] = Mem436[ecx_211 + 0x50:word32];
			Mem445[esp_435 - 0x04 + 0x00:word32] = eax_40;
			Mem448[esp_435 - 0x08 + 0x00:word32] = Mem445[4231844:word32];
			fn00401020(dwArg00, dwArg04, dwArg08);
			if (Mem448[0x004092C4:word32] != 0x00)
			{
				Mem469[esp_435 + 0x00:word32] = Mem448[4231844:word32] + Mem448[ecx_211 + 0x28:word32];
				Mem472[esp_435 - 0x04 + 0x00:word32] = Mem469[0x004092B4:word32];
				fn00401840(dwArg00, dwArg04);
			}
			else
			{
				Mem477[esp_435 + 0x00:word32] = Mem448[4231844:word32];
				fn00401A40(dwArg00);
			}
			Mem458[0x004092CC:word32] = Mem448[4231844:word32] + Mem448[ecx_211 + 0x28:word32];
			Mem461[ecx_211 + 0x28:word32] = Mem458[0x004092CC:word32];
			eax_242 = 0x01;
			return eax_242;
		}
		else
		{
			eax_242 = 0x00;
			return eax_242;
		}
	}
	else
	{
		eax_242 = 0x00;
		return eax_242;
	}
}

// 00401840: void fn00401840(Stack word32 dwArg04, Stack word32 dwArg08)
void fn00401840(word32 dwArg04, word32 dwArg08)
{
	word32 ecx_14 = Mem0[Mem0[Mem0[Mem0[0x004092C8:word32] + 0x30:word32] + 0x0C:word32] + 0x0C:word32];
	word32 dwLoc0C_15 = ecx_14;
	while (0x01 != 0x00 && dwLoc0C_15 != 0x00)
	{
		if (Mem0[dwLoc0C_15 + 0x18:word32] == dwArg04)
		{
			Mem50[dwLoc0C_15 + 0x1C:word32] = dwArg08;
			return;
		}
		word32 eax_53 = Mem0[dwLoc0C_15 + 0x00:word32];
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			return;
	}
}

// 004018B0: Register word32 fn004018B0(Stack word32 dwArg04)
word32 fn004018B0(word32 dwArg04)
{
	return VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 004018E0: Register word32 fn004018E0(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn004018E0(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc24_13;
	if (Mem0[0x004092C4:word32] != 0x00)
		dwLoc24_13 = Mem0[0x004092B4:word32];
	else
		dwLoc24_13 = dwArg08;
	word32 ecx_18 = dwLoc24_13 + Mem0[dwLoc24_13 + 0x3C:word32];
	Mem32[4231844:word32] = VirtualAlloc(0x00, Mem0[ecx_18 + 0x50:word32], 0x3000, 0x40);
	if (Mem32[4231844:word32] == 0x00)
		return ebp;
	word32 ecx_72 = Mem32[4231844:word32];
	fn00401020(ecx_72, dwLoc24_13, Mem32[ecx_18 + 0x50:word32]);
	word32 edx_77 = Mem32[4231844:word32] - dwLoc24_13;
	if (Mem32[ecx_18 + 0xA4:word32] != 0x00)
	{
		word32 dwLoc0C_104 = dwLoc24_13 + Mem32[ecx_18 + 0xA0:word32];
		while (Mem32[dwLoc0C_104 + 0x04:word32] != 0x00)
		{
			word32 edx_119 = Mem32[dwLoc0C_104 + 0x04:word32] - 0x08 >>u 0x01;
			word32 eax_122 = dwLoc0C_104 + 0x08;
			word32 dwLoc08_125 = 0x00;
			while (dwLoc08_125 <u edx_119)
			{
				if ((word32) eax_122[dwLoc08_125 * 0x02] >> 0x0C == 0x03)
					Mem166[Mem32[4231844:word32] + Mem32[dwLoc0C_104 + 0x00:word32] + ((word32) eax_122[dwLoc08_125 * 0x02] & 0x0FFF):word32] = Mem32[Mem32[4231844:word32] + Mem32[dwLoc0C_104 + 0x00:word32] + ((word32) eax_122[dwLoc08_125 * 0x02] & 0x0FFF):word32] + edx_77;
				dwLoc08_125 = dwLoc08_125 + 0x01;
			}
			dwLoc0C_104 = dwLoc0C_104 + Mem32[dwLoc0C_104 + 0x04:word32];
		}
	}
	word32 edx_88 = dwArg04 + Mem32[4231844:word32];
	word32 esp_90;
	word32 ebp_91;
	byte SCZO_92;
	word32 esi_93;
	bool Z_94;
	word32 eax_95;
	word32 ecx_96;
	word32 edx_97;
	bool C_98;
	byte SZO_99;
	edx_88();
	return ebp_91;
}

// 00401A40: void fn00401A40(Stack word32 dwArg04)
void fn00401A40(word32 dwArg04)
{
	Mem12[Mem0[Mem0[0x004092C8:word32] + 0x30:word32] + 0x08:word32] = dwArg04;
}

// 00401A70: void fn00401A70(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401A70(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc0C_112 = 0x01;
	byte cl_12 = Mem0[dwArg04 + 0x00:byte];
	word32 dwLoc18_118 = 0x00;
	do
	{
		word32 ecx_34 = dwLoc0C_112 + 0x01;
		byte al_31 = Mem0[dwArg04 + dwLoc0C_112:byte];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 == (word32) cl_12)
		{
			if ((word32) Mem0[dwArg04 + ecx_34:byte] == 0x00)
			{
				Mem80[dwArg08 + dwLoc18_118:byte] = cl_12;
				dwLoc18_118 = dwLoc18_118 + 0x01;
				dwLoc0C_112 = ecx_34 + 0x01;
			}
			else
			{
				word32 eax_98 = fn00401B70(fp - 0x10, dwArg04 + ecx_34) + ecx_34;
				dwLoc0C_112 = fn00401B70(fp - 0x20, dwArg04 + eax_98) + eax_98;
				word32 dwLoc1C_113 = 0x00;
				while (dwLoc1C_113 <u dwLoc10)
				{
					Mem130[dwArg08 + dwLoc18_118:byte] = Mem0[dwArg08 + (dwLoc18_118 - dwLoc20):byte];
					dwLoc18_118 = dwLoc18_118 + 0x01;
					dwLoc1C_113 = dwLoc1C_113 + 0x01;
				}
			}
		}
		else
		{
			Mem142[dwArg08 + dwLoc18_118:byte] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x01;
		}
	} while (dwLoc0C_112 <u dwArg0C);
}

// 00401B70: Register word32 fn00401B70(Stack word32 dwArg04, Stack word32 dwArg08)
word32 fn00401B70(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00;
	word32 dwLoc10_13 = 0x00;
	do
	{
		word32 ecx_16 = (word32) Mem0[dwArg08 + 0x00:byte];
		word32 ecx_26 = ecx_16 & 0x7F | dwLoc08_12 << 0x07;
		word32 edx_29 = dwLoc10_13 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x80) != 0x00);
	Mem39[dwArg04 + 0x00:word32] = ecx_26;
	return edx_29;
}

