// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: Register word32 fn00401027(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register (ptr32 byte) edi, Stack (ptr32 byte) dwArg00, Register out ptr32 ebpOut)
word32 fn00401027(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, byte * edi, byte * dwArg00, ptr32 & ebpOut)
{
	while (SZO)
	{
		SZO = cond(SLICE(dwArg00, byte, 8) & *dwArg00);
		__cli();
		dwArg00 = edi;
	}
	bool O_38 = (bool) dwArg00;
	ptr32 esp_42;
	byte SZO_43;
	byte SCZO_45;
	byte SCZDOP_46;
	bool O_47;
	Eq_28 C_48;
	byte bl_50;
	word32 ebx_52;
	byte ah_53;
	ui32 edx_54;
	byte dh_55;
	word32 edi_56;
	byte bh_57;
	bool D_58;
	byte ch_59;
	struct Eq_38 * ecx_60;
	byte cl_61;
	word32 esi_62;
	struct Eq_41 * ebp_49;
	byte al_44;
	word32 eax_51;
	fn00400FCB();
	return eax_51;
}

// 004117BE: Register Eq_131 Win32CrtStartup()
Eq_131 Win32CrtStartup()
{
	Eq_131 eax_21 = CreateFileA(4397538, 0x40000000, 0x02, null, 0x03, 133, 0x00);
	if (eax_21 == ~0x00)
	{
		GetLastError();
		dwLoc20 = CreateFileW(&globals->t431A3E, 0x40000000, 0x01, null, 0x03, 0xA2, 0x00);
		GetLastError();
	}
	do
	{
		ptr32 esp_199;
		ptr32 esp_245;
		Eq_131 eax_311;
		CloseHandle(eax_21);
		GetCommandLineA();
		Eq_131 eax_50 = CreateFileW(&globals->t431A31, 0x80000000, 0x03, null, 0x03, 0x0122, 0x00);
		ptr32 esp_107 = fp + ~0x43;
		if (eax_50 != ~0x00)
			goto l004119C5;
		GetCommandLineA();
		GetFileType(dwLoc20);
		Eq_131 eax_465 = CreateFileA(4397579, 0x80000000, 0x00, null, 0x03, 0x82, 0x00);
		dwLoc44 = eax_465;
	} while (eax_465 != ~0x00);
	CloseHandle(dwLoc20);
	GetFileSize(eax_50, 0x00);
	GetFileType(dwLoc20);
	GetFileSize(eax_21, 0x00);
	GetLastError();
	GetFileType(dwLoc20);
	esp_199 = fp + ~0x43;
	dwLoc3C = GetModuleHandleA(4397557);
l00411910:
	union Eq_131 * esp_438 = esp_199 - 0x04;
	*esp_438 = 0x00;
	*(esp_438 - 0x04) = (union Eq_131 *) eax_50;
	GetFileSize(*(esp_438 - 0x04), *esp_438);
	esp_245 = (char *) esp_438 + 0x04;
	do
	{
		union Eq_131 * esp_337 = esp_245 - 0x04;
		*esp_337 = 4397661;
		GetLastError();
		GetLastError();
		*(esp_337 - 0x04) = (HMODULE *) dwLoc3C;
		*(esp_337 - 0x08) = 0x00;
		*(esp_337 - 0x0C) = (union Eq_131 *) dwLoc44;
		GetFileSize(*(esp_337 - 0x0C), *(esp_337 - 0x08));
		Eq_562 eax_351 = GetProcAddress(*(esp_337 - 0x04), *esp_337);
		*esp_337 = (union Eq_131 *) dwLoc44;
		CloseHandle(*esp_337);
		*esp_337 = (union Eq_131 *) dwLoc20;
		CloseHandle(*esp_337);
		*esp_337 = 0x00;
		*(esp_337 - 0x04) = 0x87;
		*(esp_337 - 0x08) = 0x03;
		*(esp_337 - 0x0C) = 0x00;
		*(esp_337 - 0x10) = 0x05;
		*(esp_337 - 0x14) = 0x60000000;
		*(esp_337 - 0x18) = 0x004319C8;
		eax_311 = CreateFileA(*(esp_337 - 0x18), *(esp_337 - 0x14), *(esp_337 - 0x10), *(esp_337 - 0x0C), *(esp_337 - 0x08), *(esp_337 - 0x04), *esp_337);
		dwLoc38 = eax_311;
		if (eax_311 != ~0x00)
			return eax_311;
		GetCommandLineA();
		*esp_337 = 0x00;
		*(esp_337 - 0x04) = (union Eq_131 *) dwLoc20;
		GetFileSize(*(esp_337 - 0x04), *esp_337);
		*esp_337 = 0x00;
		GetLastError();
		*(esp_337 - 0x04) = 0x00;
		esp_107 = esp_337 - 0x04;
		dwLoc2C = eax_351();
l004119C5:
		union Eq_131 * esp_114 = esp_107 - 0x04;
		*esp_114 = (union Eq_131 *) eax_21;
		GetFileType(*esp_114);
		*esp_114 = 0x00;
		*(esp_114 - 0x04) = 161;
		*(esp_114 - 0x08) = 0x03;
		*(esp_114 - 0x0C) = 0x00;
		*(esp_114 - 0x10) = 0x00;
		*(esp_114 - 0x14) = 0x80000000;
		*(esp_114 - 0x18) = 4397489;
		Eq_131 eax_135 = CreateFileW(*(esp_114 - 0x18), *(esp_114 - 0x14), *(esp_114 - 0x10), *(esp_114 - 0x0C), *(esp_114 - 0x08), *(esp_114 - 0x04), *esp_114);
		ptr32 esp_148;
		word32 ebp_149;
		byte SCZO_150;
		word32 eax_151;
		bool Z_152;
		byte SZO_153;
		bool C_154;
		byte al_155;
		word32 ecx_156;
		word32 edx_157;
		word32 ebx_158;
		word32 edi_159;
		(*((word32) (dwLoc2C ^ 0xC0000008) + 4266528))();
		*(esp_148 - 0x04) = 0x00;
		*(esp_148 - 0x08) = 0x0103;
		*(esp_148 - 0x0C) = 0x03;
		*(esp_148 - 0x10) = 0x00;
		*(esp_148 - 0x14) = 0x01;
		*(esp_148 - 0x18) = 0x20000000;
		*(esp_148 - 0x1C) = 4397500;
		Eq_131 eax_174 = CreateFileA(*(esp_148 - 0x1C), *(esp_148 - 0x18), *(esp_148 - 0x14), *(esp_148 - 0x10), *(esp_148 - 0x0C), *(esp_148 - 0x08), *(esp_148 - 0x04));
		*(esp_148 - 0x04) = fp - 0x08;
		GetLastError();
		*(esp_148 - 0x08) = 0x40;
		GetLastError();
		*(esp_148 - 0x0C) = 0x00;
		*(esp_148 - 0x10) = 0x27;
		*(esp_148 - 0x14) = 0x03;
		*(esp_148 - 0x18) = 0x00;
		*(esp_148 - 0x1C) = 0x04;
		*(esp_148 - 0x20) = 0xA0000000;
		*(esp_148 - 0x24) = 0x004319A9;
		esp_199 = esp_148 - 0x08;
		if (CreateFileW(*(esp_148 - 0x24), *(esp_148 - 0x20), *(esp_148 - 0x1C), *(esp_148 - 0x18), *(esp_148 - 0x14), *(esp_148 - 0x10), *(esp_148 - 0x0C)) != ~0x00)
			goto l00411910;
		*(esp_148 - 0x0C) = 67500;
		*(esp_148 - 0x10) = 0x00401000;
		*(esp_148 - 0x14) = 0x00;
		*(esp_148 - 0x18) = (union Eq_131 *) dwLoc44;
		GetFileSize(*(esp_148 - 0x18), *(esp_148 - 0x14));
		*(esp_148 - 0x14) = 0x00;
		*(esp_148 - 0x18) = (union Eq_131 *) dwLoc38;
		GetFileSize(*(esp_148 - 0x18), *(esp_148 - 0x14));
		VirtualProtect(*(esp_148 - 0x10), *(esp_148 - 0x0C), *(esp_148 - 0x08), *(esp_148 - 0x04));
		*(esp_148 - 0x04) = 0x00401000;
		*(esp_148 - 0x08) = (union Eq_131 *) eax_174;
		CloseHandle(*(esp_148 - 0x08));
		*(esp_148 - 0x08) = 0x00;
		*(esp_148 - 0x0C) = 0x0180;
		*(esp_148 - 0x10) = 0x03;
		*(esp_148 - 0x14) = 0x00;
		*(esp_148 - 0x18) = 0x06;
		*(esp_148 - 0x1C) = 0x40000000;
		*(esp_148 - 0x20) = 0x00431A25;
		esp_245 = esp_148 - 0x04;
	} while (CreateFileA(*(esp_148 - 0x20), *(esp_148 - 0x1C), *(esp_148 - 0x18), *(esp_148 - 0x14), *(esp_148 - 0x10), *(esp_148 - 0x0C), *(esp_148 - 0x08)) != ~0x00);
	*(esp_148 - 0x08) = (union Eq_301 *) dwLoc2C;
	*(esp_148 - 0x0C) = 67500;
	*(esp_148 - 0x10) = 0x00;
	*(esp_148 - 0x14) = 0x0103;
	*(esp_148 - 0x18) = 0x03;
	*(esp_148 - 0x1C) = 0x00;
	*(esp_148 - 0x20) = 0x06;
	*(esp_148 - 0x24) = 0xA0000000;
	*(esp_148 - 0x28) = 4397451;
	CreateFileA(*(esp_148 - 0x28), *(esp_148 - 0x24), *(esp_148 - 0x20), *(esp_148 - 0x1C), *(esp_148 - 0x18), *(esp_148 - 0x14), *(esp_148 - 0x10));
	*(esp_148 - 0x10) = 0x00;
	*(esp_148 - 0x14) = 0x23;
	*(esp_148 - 0x18) = 0x03;
	*(esp_148 - 0x1C) = 0x00;
	*(esp_148 - 0x20) = 0x06;
	*(esp_148 - 0x24) = 0x80000000;
	*(esp_148 - 0x28) = 0x004319FF;
	CreateFileW(*(esp_148 - 0x28), *(esp_148 - 0x24), *(esp_148 - 0x20), *(esp_148 - 0x1C), *(esp_148 - 0x18), *(esp_148 - 0x14), *(esp_148 - 0x10));
	Eq_161 eax_295 = GetCommandLineA();
	word32 esp_296;
	word32 ebp_297;
	byte SCZO_298;
	word32 eax_299;
	bool Z_300;
	byte SZO_301;
	bool C_302;
	byte al_303;
	word32 ecx_304;
	word32 edx_305;
	word32 ebx_306;
	byte * edi_307;
	(dwLoc2C - ~0x40411B98)();
	word32 ebp_310;
	eax_311 = fn00401027((byte) GetCommandLineA(), ecx_304, edx_305, ebx_306, ebp_297, edi_307, ebp, out ebp_310);
	return eax_311;
}

