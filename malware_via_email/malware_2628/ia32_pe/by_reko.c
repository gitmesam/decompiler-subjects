// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401026: void fn00401026(Register byte al, Register (ptr32 Eq_3) ecx, Register byte dl, Register byte bl, Register (ptr32 ui8) esi, Register (ptr32 Eq_7) edi)
void fn00401026(byte al, Eq_3 * ecx, byte dl, byte bl, ui8 * esi, Eq_7 * edi)
{
	byte bl_5 = bl + *(edi - 77);
	*esi = *esi ^ ~0x06;
	__lock();
	struct Eq_26 * ebx_7 = DPB(ebx, bl_5, 0);
	__arpl(ebx_7->w74F93680, DPB(bx, bl_5, 0), &ebx_7->w74F93680);
	up32 v18_30 = ebx_7 + ecx->dw0062 / 1962489474;
	ecx->dw0062 = v18_30;
	word32 v19_34 = Mem31[ebx_7 + 0x00:word32] + 543567075 + (v18_30 <u 0x00);
	ebx_7->dw0000 = v19_34;
	edi->b0000 = al + ~0x60;
	word16 dx_22 = DPB(dx, 0x3B, 8);
	word32 eax_26 = DPB(eax, al + ~0x60, 0);
	if (v19_34 >= 0x00)
		(word32 *) 513561048 = eax_26;
	edi->b0001 = __in(dx_22);
	__hlt();
}

// 004110A8: Register Eq_91 Win32CrtStartup()
Eq_91 Win32CrtStartup()
{
	GetACP();
	GetProcessHeap();
	Eq_97 eax_12 = GetModuleHandleA(&globals->t436605);
	GetFileType(eax_12);
	GetCurrentProcessId();
	GetACP();
	GetCommandLineA();
	Eq_116 eax_29 = GetProcAddress(eax_12, &globals->t4365DA);
	ptr32 esp_30 = fp - 0x20;
	do
	{
		LPDWORD * esp_33 = esp_30 - 0x04;
		*esp_33 = (LPDWORD *) null;
		*(esp_33 - 0x04) = (union Eq_97 *) eax_12;
		GetFileSize(*(esp_33 - 0x04), *esp_33);
		*esp_33 = (LPDWORD *) null;
		GetCurrentThreadId();
		*(esp_33 - 0x04) = 0x00;
		*(esp_33 - 0x08) = 0x00;
		*(esp_33 - 0x0C) = 0x00;
		*(esp_33 - 0x10) = 0x03;
		*(esp_33 - 0x14) = 0x00;
		*(esp_33 - 0x18) = 0x02;
		*(esp_33 - 0x1C) = 0x80000000;
		*(esp_33 - 0x20) = 4417008;
		Eq_97 eax_59 = CreateFileA(*(esp_33 - 0x20), *(esp_33 - 0x1C), *(esp_33 - 0x18), *(esp_33 - 0x14), *(esp_33 - 0x10), *(esp_33 - 0x0C), *(esp_33 - 0x08));
		esp_30 = esp_33 - 0x04;
	} while (eax_59 != ~0x00);
	Eq_255 eax_68 = eax_29();
	*(esp_33 - 0x08) = 0x00;
	*(esp_33 - 0x0C) = (union Eq_97 *) eax_59;
	GetFileSize(*(esp_33 - 0x0C), *(esp_33 - 0x08));
	<anonymous> * eax_88 = (eax_68 ^ 0xC0000005) + 0x00411174;
	ptr32 esp_90;
	word32 ebp_91;
	byte SCZO_92;
	word32 eax_93;
	bool Z_94;
	byte SZO_95;
	bool C_96;
	byte al_97;
	word32 ecx_98;
	byte dl_99;
	byte bl_100;
	word32 esi_101;
	word32 edi_102;
	eax_88();
	GetOEMCP();
	*(esp_90 - 0x04) = fp - 0x14;
	*(esp_90 - 0x08) = (union Eq_97 *) eax_59;
	CloseHandle(*(esp_90 - 0x08));
	*(esp_90 - 0x08) = 0x40;
	GetCurrentProcessId();
	*(esp_90 - 0x0C) = 64898;
	*(esp_90 - 0x10) = (union Eq_97 *) eax_59;
	CloseHandle(*(esp_90 - 0x10));
	*(esp_90 - 0x10) = 0x00401000;
	*(esp_90 - 0x14) = (union Eq_97 *) eax_12;
	*(esp_90 - 0x18) = 0x00;
	SizeofResource(*(esp_90 - 0x18), *(esp_90 - 0x14));
	VirtualProtect(*(esp_90 - 0x10), *(esp_90 - 0x0C), *(esp_90 - 0x08), *(esp_90 - 0x04));
	GetCurrentThreadId();
	GetProcessHeap();
	*(esp_90 - 0x04) = (union Eq_255 *) eax_68;
	*(esp_90 - 0x08) = (union Eq_97 *) eax_12;
	GetFileType(*(esp_90 - 0x08));
	GetProcessHeap();
	*(esp_90 - 0x08) = 64898;
	GetCommandLineA();
	*(esp_90 - 0x0C) = 0x00401000;
	GetACP();
	word32 esp_155;
	word32 ebp_156;
	byte SCZO_157;
	word32 eax_158;
	bool Z_159;
	byte SZO_160;
	bool C_161;
	byte al_162;
	struct Eq_3 * ecx_163;
	byte dl_164;
	byte bl_165;
	ui8 * esi_166;
	struct Eq_7 * edi_167;
	(eax_68 - ~0x4041104C)();
	Eq_91 eax_168 = GetCommandLineW();
	fn00401026((byte) eax_168, ecx_163, dl_164, bl_165, esi_166, edi_167);
	return eax_168;
}

