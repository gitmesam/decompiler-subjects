// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00413110: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	Eq_3 edi_3 = edi;
	Eq_5 ebp_33 = dwArg04;
	Eq_7 eax_12 = IsWindow(dwArg04);
	ptr32 esp_16 = fp - 0x04;
	if ((eax_12 | 0x01) == 0x01)
	{
		eax_12 = fn00413178(GetProfileIntW(fp - 0x08, fp - 0x08, 0xF7), out ecx, out edx, out ebp_33, out esi, out edi_3);
		esp_16 = fp + 0x24;
	}
	word32 * esp_37 = esp_16 - 0x04;
	*esp_37 = ecx;
	*(esp_37 - 0x04) = (int32) eax_12;
	Eq_3 ebx_41 = *(esp_37 - 0x04);
	*(esp_37 - 0x04) = (union Eq_3 *) edi_3;
	word32 ecx_45 = ecx - 266694;
	if (edi_3 == esi)
		return esp_37 - 0x04;
	word32 ecx_56;
	word32 edx_57;
	word32 ebp_58;
	word32 esi_59;
	word32 edi_60;
	return fn004131AC(ecx_45 + 0x00042662, edx, ebx_41, ebp_33, esi, edi_3, out ecx_56, out edx_57, out ebp_58, out esi_59, out edi_60);
}

// 00413178: Register Eq_2 fn00413178(Register Eq_3 ebx, Register out ptr32 ecxOut, Register out ptr32 edxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
Eq_2 fn00413178(Eq_3 ebx, ptr32 & ecxOut, ptr32 & edxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
	Eq_3 eax_10 = VirtualAlloc(0x00, 0x00015265, 0x3000, 0x40);
	Eq_5 edx_30 = DPB(0xD010CA19, bl + 0x19, 0);
	word32 ecx_43;
	word32 edx_44;
	word32 ebp_45;
	word32 esi_46;
	word32 edi_47;
	return fn004131AC(0x01F6, edx_30, ebx, 0x00, 0xC3, eax_10, out ecx_43, out edx_44, out ebp_45, out esi_46, out edi_47);
}

// 004131AC: Register Eq_3 fn004131AC(Register Eq_5 ecx, Register Eq_5 edx, Register Eq_3 ebx, Register Eq_5 ebp, Register Eq_3 esi, Register Eq_3 edi, Register out ptr32 ecxOut, Register out ptr32 edxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
Eq_3 fn004131AC(Eq_5 ecx, Eq_5 edx, Eq_3 ebx, Eq_5 ebp, Eq_3 esi, Eq_3 edi, ptr32 & ecxOut, ptr32 & edxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
	do
	{
		esp = v3;
		esp = esp - 0x04;
		*esp = edx;
		esp = esp - 0x04;
		*esp = ecx;
		ecx = esp;
		ecx = (word32) ecx + 0x00A3;
		ecx = *(ecx - 0x9F);
		ecx = ecx + Mem0[esi + 0x00:word32];
		v10 = (word32) *edi + cl;
		*edi = v10;
		ecx = *esp;
		esp = (word32) esp + 0x04;
		edx = *esp;
		esp = (word32) esp + 0x04;
		esi = esi - 0x000B0E3C;
		esi = (word32) esi + 724541;
		edi = edi - 0x000AA8FA;
		edi = (word32) edi + 698619;
		eax.u0 = 0x00;
		eax.u0 = 0xFFFA4800;
		eax.u0 = 0x04;
		ah = SLICE(eax, byte, 8);
		al = (byte) eax;
		ax = (word16) eax;
		ebp = (word32) ebp + 0x01;
		edx = edx >> 0x08;
		dl = (byte) edx;
		dx = (word16) edx;
		SCZO = cond(0x04 - ebp);
		Z = SCZO;
		SZO = SCZO;
		SO = SCZO;
		C = SCZO;
		S = SCZO;
		SCZDOP = SCZO;
		O = SCZO;
		if (Test(EQ,Z))
		{
			esp = esp - 0x04;
			esp->u0 = 0xD010CA19;
			edx = *esp;
			esp = (word32) esp + 0x04;
			ebp.u0 = 0x00;
			SZO = cond(0x00);
			C.u0 = false;
		}
		dl = dl + bl;
		ecx = ecx - 0x01;
		SZO = cond(ecx & ecx);
		C.u0 = false;
	} while (Test(NE,Z));
	edx = *esp;
	esp = (word32) esp + 0x04;
	edx();
	SCZO = cond(ecx - eax);
	if (Test(EQ,Z))
		return eax;
	if (Test(NS,S))
	{
		C = __aas(al, ah, &al, &ah);
		SCZO = cond(*ebx - ebp);
		ebx.u0 = 0x5065411D;
		esp = esp - 0x04;
		esp->u0 = 0x00354006;
		C = __aas(al, ah, &al, &ah);
		SCZO = cond(eax - 0x5065411D);
		esp = esp - 0x04;
		*esp = SCZDOP;
		bh = bh - ah;
		SCZO = cond(bh);
		esp.u0 = 2105820086;
		al = (byte) C.u0 + (al + 0x47);
		SCZO = cond(al);
		dl = 0x3D;
		__lock();
		C = __aas(al, ah, &al, &ah);
		C.u0 = true;
		ah = FPUF;
		if (Test(NS,S))
		{
			C = __aas(al, ah, &al, &ah);
			__outb(dx, al);
			esi = (word32) esi + 0x01;
			ecx.u0 = 563316778;
			v34 = *((byte) ebx.u0 - 0x7E96DD98) | al;
			((byte) ebx.u0 - 0x7E96DD98)->u0 = v34;
			SZO = cond(*((byte) ebx.u0 - 0x7E96DD98));
			C.u0 = false;
			esp.u0 = 2105820082;
			(word32 *) 2105820082 = 0xB93B00EE;
			fn217FA0EF();
			return eax;
		}
		else
		{
			(*((byte) eax.u0 + 0x39F984D8))();
			__lock();
			v27 = *ecx ^ 0x29;
			*ecx = v27;
			SZO = cond(*ecx);
			v29 = (byte) ((word32) *((byte) ebp.u0 + (ecx * 0x02 + 0x007B)) + ch);
			*((byte) ebp.u0 + (ecx * 0x02 + 0x007B)) = v29;
			SCZO = cond(v29);
			eax.u0 = 1663843333;
			do
			{
				edx = edx - 0x01;
				SZO = cond(edx);
				eax = ebx;
			} while (Test(OV,O));
			SCZO = cond(eax - esi);
			v31 = eax;
			eax = edi;
			edi = v31;
			esp = esp - 0x04;
			*esp.u0 = edx;
			*edi = eax;
			edi = (word32) edi + 0x04;
			esp = ebp;
			ebp = *esp.u0;
			esp = (byte) esp.u0 + 0x04;
			dh = 0x39;
			__lock();
		}
	}
	else
	{
		__lock();
		ah = 0x0F;
		return eax;
	}
}

