// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425597: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	GetOEMCP();
	GetACP();
	Eq_9 eax_27 = LoadLibraryA(&globals->t43400E);
	GetCommandLineA();
	GetOEMCP();
	GetProcAddress(eax_27, &globals->t43403B)();
	CreateFileA(&globals->t434018, 0xC0000000, 0x01, null, 0x03, 0xA3, 0x00);
	CreateFileA(&globals->t434021, 0xE0000000, 0x06, null, 0x03, 0x26, 0x00);
	GetCommandLineW();
	ptr32 * ebp_90;
	word16 dx_91 = fn004257CC(dwArg00, dwArg04, dwArg08, out ebp_90);
	*(ebp_90 - 0x20) = (LPSTR *) GetCommandLineA();
	SizeofResource(null, *(ebp_90 - 0x1C));
	CloseHandle(*(ebp_90 - 0x1C));
	GetCurrentProcessId();
	Eq_2 v11_111 = *(ebp_90 - 0x1C);
	GetFileType(v11_111);
	GetCurrentProcessId();
	*(ebp_90 - 0x18) = (LPSTR *) GetCommandLineA();
	VirtualProtect(&globals->v42A000, 0x9401, v11_111, (DWORD *) 0x40);
	GetOEMCP();
	Eq_2 v12_128 = *(ebp_90 - 0x1C);
	GetFileSize(v12_128, null);
	SizeofResource(null, *(ebp_90 - 0x1C));
	GetOEMCP();
	GetCommandLineW();
	GetFileSize(*(ebp_90 - 0x10), null);
	ptr32 ebp_151 = *ebp_90;
	Eq_2 eax_153 = GetCurrentThreadId();
	byte al_154 = (byte) eax_153;
	byte al_155;
	__daa(al_154, &al_155);
	__outb(dx_91, al_155);
	*v12_128 = __in(dx_91);
	*((word32) v12_128 + 0x04) = __in(dx_91);
	__outb(dx_91, al_155);
	word32 esp_171;
	word32 ebp_172;
	byte SCZO_173;
	word32 ebx_174;
	word32 edi_175;
	word32 esi_176;
	Eq_2 eax_177;
	byte C_178;
	byte al_179;
	word16 dx_180;
	byte SZO_181;
	real64 rLoc1_182;
	(*(ebp_151 - 0x52))();
	return eax_177;
}

// 004257CC: Register word16 fn004257CC(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebpOut)
word16 fn004257CC(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & ebpOut)
{
	word32 * edx_17 = dwArg04;
	uint32 esi_21 = dwArg08 >> 0x02;
	do
	{
		*edx_17 = *edx_17 - dwArg0C;
		*edx_17 = *edx_17 - ~0x323E3816;
		*edx_17 = __ror(*edx_17, 171);
		*edx_17 = __rol(*edx_17, 0x03);
		*edx_17 = -*edx_17;
		*edx_17 = __rol(*edx_17, 0xAA);
		*edx_17 = *edx_17 ^ 2140726636;
		edx_17 = edx_17 + 0x01;
		word16 dx_44 = (word16) edx_17;
		esi_21 = esi_21 - 0x01;
	} while (esi_21 != 0x00);
	word32 ebp_55;
	*ebpOut = ebp;
	return dx_44;
}

