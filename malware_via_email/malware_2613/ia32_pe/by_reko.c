// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425597: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetOEMCP();
	GetACP();
	Eq_9 eax_27 = LoadLibraryA(&globals->t43400E);
	GetCommandLineA();
	GetOEMCP();
	GetProcAddress(eax_27, &globals->t43403B)();
	CreateFileA(&globals->t434018, 0xC0000000, 0x01, null, 0x03, 0xA3, null);
	CreateFileA(&globals->t434021, 0xE0000000, 0x06, null, 0x03, 0x26, null);
	GetCommandLineW();
	ptr32 * ebp_94;
	word16 dx_95 = fn004257CC(dwArg00, dwArg04, dwArg08, out ebp_94);
	*(ebp_94 - 0x20) = (LPSTR *) GetCommandLineA();
	SizeofResource(null, *(ebp_94 - 0x1C));
	CloseHandle(*(ebp_94 - 0x1C));
	GetCurrentProcessId();
	GetFileType(*(ebp_94 - 0x1C));
	GetCurrentProcessId();
	*(ebp_94 - 0x18) = (LPSTR *) GetCommandLineA();
	VirtualProtect(&globals->v42A000, 0x9401, 0x40, ebp_94 - 0x0C);
	GetOEMCP();
	GetFileSize(*(ebp_94 - 0x1C), null);
	SizeofResource(null, *(ebp_94 - 0x1C));
	GetOEMCP();
	GetCommandLineW();
	GetFileSize(*(ebp_94 - 0x10), null);
	ptr32 ebp_161 = *ebp_94;
	Eq_2 eax_163 = GetCurrentThreadId();
	byte al_164 = (byte) eax_163;
	byte al_165;
	__daa(al_164, &al_165);
	__outb(dx_95, al_165);
	null = __in(dx_95);
	(word32 *) 0x04 = __in(dx_95);
	__outb(dx_95, al_165);
	word32 esp_181;
	word32 ebp_182;
	byte SCZO_183;
	word32 ebx_184;
	word32 edi_185;
	word32 esi_186;
	Eq_2 eax_187;
	bool C_188;
	byte al_189;
	word16 dx_190;
	byte SZO_191;
	real64 rLoc1_192;
	(*(ebp_161 - 0x52))();
	return eax_187;
}

// 004257CC: Register word16 fn004257CC(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebpOut)
word16 fn004257CC(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & ebpOut)
{
	word32 * edx_17 = dwArg04;
	uint32 esi_21 = dwArg08 >> 0x02;
	do
	{
		*edx_17 = *edx_17 - dwArg0C;
		*edx_17 = *edx_17 - ~0x323E3816;
		*edx_17 = __ror(*edx_17, 171);
		*edx_17 = __rol(*edx_17, 0x03);
		*edx_17 = -*edx_17;
		*edx_17 = __rol(*edx_17, 0xAA);
		*edx_17 = *edx_17 ^ 2140726636;
		edx_17 = edx_17 + 0x01;
		word16 dx_44 = (word16) edx_17;
		esi_21 = esi_21 - 0x01;
	} while (esi_21 != 0x00);
	word32 ebp_55;
	*ebpOut = ebp;
	return dx_44;
}

