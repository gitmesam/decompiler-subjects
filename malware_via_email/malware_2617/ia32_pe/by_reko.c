// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00428387: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineW();
	GetCurrentThreadId();
	GetCurrentProcessId();
	do
	{
		Eq_2 eax_17 = GetCurrentThreadId();
		ptr32 esp_18;
		word32 ebp_19;
		byte SCZO_20;
		word32 eax_21;
		bool Z_22;
		<anonymous> ** edi_23;
		NTDLL.DLL!ZwFindAtom();
		*(esp_18 - 0x04) = eax_21;
		GetCurrentThreadId();
		*(esp_18 - 0x08) = 0x710B;
		GetCurrentThreadId();
		*(esp_18 - 0x0C) = 0x00533058;
		fn00428538(dwArg00, dwArg04, dwArg08);
		*(esp_18 - 0x04) = 0x00;
		*(esp_18 - 0x08) = 0x0102;
		*(esp_18 - 0x0C) = 0x03;
		*(esp_18 - 0x10) = 0x00;
		*(esp_18 - 0x14) = 0x04;
		*(esp_18 - 0x18) = 0xA0000000;
		*(esp_18 - 0x1C) = 0x0042D000;
	} while (CreateFileA(*(esp_18 - 0x1C), *(esp_18 - 0x18), *(esp_18 - 0x14), *(esp_18 - 0x10), *(esp_18 - 0x0C), *(esp_18 - 0x08), *(esp_18 - 0x04)) != (void *) ~0x00);
	*(esp_18 - 0x04) = fp - 0x10;
	*(esp_18 - 0x08) = 0x40;
	GetOEMCP();
	GetCurrentProcessId();
	*(esp_18 - 0x0C) = 0x710B;
	GetCommandLineA();
	*(esp_18 - 0x10) = 0x00533058;
	*(esp_18 - 0x14) = 0x00;
	*(esp_18 - 0x18) = 0x0123;
	*(esp_18 - 0x1C) = 0x03;
	*(esp_18 - 0x20) = 0x00;
	*(esp_18 - 0x24) = 0x02;
	*(esp_18 - 0x28) = 0x80000000;
	*(esp_18 - 44) = 4378644;
	CreateFileA(*(esp_18 - 44), *(esp_18 - 0x28), *(esp_18 - 0x24), *(esp_18 - 0x20), *(esp_18 - 0x1C), *(esp_18 - 0x18), *(esp_18 - 0x14));
	GetOEMCP();
	VirtualProtect(*(esp_18 - 0x10), *(esp_18 - 0x0C), *(esp_18 - 0x08), *(esp_18 - 0x04));
	GetCurrentThreadId();
	Eq_157 eax_91 = GetOEMCP();
	word32 esp_94;
	word32 ebp_95;
	byte SCZO_96;
	Eq_2 eax_97;
	bool Z_98;
	word32 edi_99;
	(*edi_23)();
	return eax_97;
}

// 00428538: void fn00428538(Stack (ptr32 word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C)
void fn00428538(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C)
{
	word32 * esi_16 = dwArg04;
	uint32 edx_19 = dwArg08 >> 0x02;
	do
	{
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = -*esi_16;
		*esi_16 = *esi_16 ^ dwArg0C;
		*esi_16 = *esi_16 - dwArg0C;
		*esi_16 = *esi_16 + ~0x001A8FD2;
		*esi_16 = *esi_16 + dwArg0C;
		esi_16 = esi_16 + 0x01;
		edx_19 = edx_19 - 0x01;
	} while (edx_19 != 0x00);
}

