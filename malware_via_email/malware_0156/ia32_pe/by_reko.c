// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: Register word32 fn00401030(Stack Eq_3 dwArg04, Stack (ptr32 Eq_4) dwArg08, Stack word32 dwArg0C)
word32 fn00401030(Eq_3 dwArg04, Eq_4 * dwArg08, word32 dwArg0C)
{
	struct Eq_4 * eax_10 = dwArg08;
	Eq_3 edx_12 = dwArg04;
	word32 ecx_14 = dwArg0C;
	if (dwArg0C != 0x00)
	{
		do
		{
			*edx_12 = eax_10->b0000;
			eax_10 = eax_10 + 0x01;
			edx_12 = (word32) edx_12 + 0x01;
			ecx_14 = ecx_14 - 0x01;
		} while (ecx_14 != 0x00);
	}
	return ecx_14;
}

// 0040105A: Register word32 fn0040105A(Register out ptr32 ebxOut)
word32 fn0040105A(ptr32 & ebxOut)
{
	struct Eq_4 * ebx_17 = globals->ptr402100;
	word32 edx_22 = ebx_17 + Mem0[ebx_17 + 0x3C:word32];
	globals->t402128 = edx_22->t0034;
	word32 dwLoc08_30 = (word32) edx_22->b0006;
	Eq_3 eax_42 = VirtualAlloc(edx_22->t0034, edx_22->t0050, 0x3000, 0x40);
	fn00401030(eax_42, globals->ptr402100, edx_22->dw0054);
	struct Eq_69 * edi_55 = &edx_22->dw0054 + 0x0029;
	do
	{
		word32 v18_76 = dwLoc08_30 - 0x01;
		word32 ecx_72 = fn00401030((word32) eax_42 + edi_55->t000C, globals->ptr402100 + edi_55->dw0014, edi_55->dw0010);
		edi_55 = edi_55 + 0x01;
		dwLoc08_30 = v18_76;
	} while (v18_76 != 0x00);
	word32 esp_83;
	word32 ebp_84;
	byte SCZO_85;
	word32 ebx_86;
	word32 esi_87;
	word32 edi_88;
	word32 edx_89;
	word32 eax_90;
	word32 ecx_91;
	byte SZO_92;
	bool C_93;
	bool Z_94;
	globals->t40104F();
	return ecx_91;
}

// 004010D8: void fn004010D8(Stack Eq_3 dwArg04, Stack (ptr32 Eq_4) dwArg08)
void fn004010D8(Eq_3 dwArg04, Eq_4 * dwArg08)
{
	Eq_3 ecx_10 = dwArg04;
	struct Eq_4 * edx_11 = dwArg08;
	do
	{
		*ecx_10 = (word32) *ecx_10 + 0x04;
		*ecx_10 = *ecx_10 - 0x01;
		*ecx_10 = (word32) *ecx_10 + 0x002F;
		*ecx_10 = (word32) *ecx_10 + 0x01;
		ecx_10 = (word32) ecx_10 + 0x01;
		edx_11 = edx_11 - 0x01;
	} while (edx_11 != null);
	globals->dw402008 = globals->dw402008 + 0x04;
}

// 004010FD: void fn004010FD(Register ptr32 ebp)
void fn004010FD(ptr32 ebp)
{
	ui32 ecx_17 = globals->dw405074;
	globals->dw402000 = ecx_17;
	globals->dw402004 = 0x00;
	globals->dw402004 = globals->dw402004 + (ecx_17 << 0x03);
	word32 esp_35;
	word32 ebp_36;
	word32 esi_37;
	word32 ebx_38;
	word32 eax_39;
	byte SZO_40;
	bool C_41;
	byte SCZO_42;
	word32 ecx_43;
	word32 edx_44;
	fn000016C2();
	word32 esp_64;
	word32 ebp_65;
	word32 ebx_67;
	ui32 eax_68;
	byte SZO_69;
	bool C_70;
	byte SCZO_71;
	word32 ecx_72;
	word32 edx_73;
	ui32 esi_102;
	fn000016C2();
	ui32 ecx_79 = globals->dw402000 + globals->dw40200C;
	do
	{
		globals->dw40200C = globals->dw40200C + 0x01;
		ecx_79 = ecx_79 - 0x01;
	} while (ecx_79 != 0x00);
	globals->dw402008 = ecx_79 | eax_68;
	*(fp - 0x30) = globals->dw402000;
	struct Eq_220 * esp_100 = fp - 0x30;
	word32 ecx_103 = 0x02;
	do
	{
		esp_100 = esp_100 - 0x04;
		esp_100->dw0000 = esi_102;
		esi_102 = globals->dw402008;
		ecx_103 = ecx_103 - 0x01;
	} while (ecx_103 != 0x00);
	fn00401030(dwArg00, dwArg04, dwArg08);
	esp_100[0x02] = (struct Eq_220) globals->dw402000;
	esp_100[0x01] = (struct Eq_220) globals->dw402008;
	fn004010D8(dwArg00, dwArg04);
}

// 004011EC: Register int32 fn004011EC(Register int32 eax, Register uint32 ecx, Register word32 edx, Register ui32 ebx, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 esiOut)
int32 fn004011EC(int32 eax, uint32 ecx, word32 edx, ui32 ebx, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & esiOut)
{
	word32 edx_5;
	*edxOut = (uint32) (edx_eax % ecx);
	word32 ebx_9;
	*ebxOut = ebx + ((uint32) (edx_eax /u ecx) << 0x02);
	word32 esi_11;
	*esiOut = globals->dw402108;
	return 0x00;
}

// 004011FC: void fn004011FC()
void fn004011FC()
{
	Eq_3 esi_31 = globals->t402128;
	word32 ebx_38 = Mem0[Mem0[esi_31 + 0x3C:word32] + esi_31 + 0x80:word32] + esi_31;
	do
	{
		word32 eax_50 = LoadLibraryA(Mem0[ebx_38 + 0x0C:word32] + Mem0[4202792:word32]);
		word32 * esi_54 = (word32) globals->t402128 + ebx_38->dw0000;
		word32 edi_56 = Mem0[ebx_38 + 0x10:word32] + Mem0[4202792:word32];
		do
		{
			*edi_56 = (word32) GetProcAddress(eax_50, (word32) globals->t402128 + *esi_54 + 0x02);
			edi_56 = edi_56 + 0x01;
			esi_54 = esi_54 + 0x01;
		} while (*esi_54 != 0x00);
		struct Eq_318 * ebx_76 = ebx_38 - 0x02;
		ebx_38 = (struct Eq_281 *) ((char *) ebx_76 + 22);
	} while (ebx_76->dw0022 != 0x00);
}

// 00401276: Register word32 fn00401276(Register (ptr32 Eq_351) ecx, Register (ptr32 Eq_352) ebx)
word32 fn00401276(Eq_351 * ecx, Eq_352 * ebx)
{
	if (0x00 == 0x00)
	{
		struct Eq_356 * ecx_54 = fs->ptr0018;
		struct Eq_388 * ecx_56 = ecx_54->ptr0030;
		Eq_3 ebx_58 = globals->t402128;
		ecx_56->t0008 = ebx_58;
		return 0x00;
	}
	else
	{
		word32 esp_27;
		struct Eq_352 * ebx_28;
		byte * eax_29;
		byte SZO_30;
		bool C_31;
		bool Z_32;
		struct Eq_351 * ecx_33;
		struct Eq_367 * fs_34;
		byte al_35;
		byte SCZO_36;
		byte cl_37;
		byte ah_38;
		fn184D9DE4();
		*eax_29 = *eax_29 + al_35;
		ebx_28->b1D8B3049 = ebx_28->b1D8B3049 + cl_37;
		ecx_33->b0000 = ecx_33->b0000 - ah_38;
		ecx_33->bC35B0859 = ecx_33->bC35B0859 + cl_37;
		return fn00401291(ecx_33, ebx_28);
	}
}

// 00401291: Register word32 fn00401291(Register (ptr32 Eq_351) ecx, Register (ptr32 Eq_352) ebx)
word32 fn00401291(Eq_351 * ecx, Eq_352 * ebx)
{
	fn004011FC();
	return fn00401276(ecx, ebx);
}

// 004012A6: void fn004012A6(Stack word32 dwArg04, Stack (ptr32 Eq_304) dwArg08)
void fn004012A6(word32 dwArg04, FARPROC * dwArg08)
{
	Eq_293 dwLoc08_13;
	Eq_292 eax_8 = LoadLibraryA(&globals->t40129C);
	if (dwArg04 == 0x00)
		dwLoc08_13 = (Eq_293) &globals->t4012D6;
	else
		dwLoc08_13 = (Eq_293) &globals->t4012E9;
	*dwArg08 = (FARPROC *) GetProcAddress(eax_8, dwLoc08_13);
}

// 004012FC: void fn004012FC(Stack (ptr32 Eq_3) dwArg04, Stack Eq_49 dwArg08)
void fn004012FC(Eq_3 * dwArg04, SIZE_T dwArg08)
{
	*dwArg04 = (union Eq_3 *) HeapAlloc(HeapCreate(0x01, 0x00, 0x00), 0x08, dwArg08);
}

// 00401320: void fn00401320()
void fn00401320()
{
	struct Eq_462 * ebx_20 = globals->dw402104 + 0x01;
	byte dl_12 = 0x00;
	Eq_469 edx_17 = 0x0100;
	do
	{
		ebx_20->b0000 = 0x01;
		ebx_20->b0000 = dl_12;
		dl_12 = dl_12 + 0x01;
		ebx_20 = ebx_20 + 0x01;
		edx_17 = DPB(edx_17, dl_12, 0);
	} while (dl_12 != 0x00);
	globals->t402110 = edx_17;
}

// 00401344: Register word32 fn00401344()
word32 fn00401344()
{
	byte dl_16 = 0x00;
	word32 esi_30;
	word32 edx_28;
	word32 * ebx_29;
	word32 eax_31 = fn004011EC(globals->dw40210C, 0x20, 0x00, globals->dw402008, out edx_28, out ebx_29, out esi_30);
	esi_40 = esi_30;
	do
	{
		word32 esi_40;
		esi_40 = esi_40 - 0x01;
		uint32 edi_45 = __bswap(*ebx_29) << dl_16;
		if (edi_45 >> 0x1F != 0x00)
			eax_31 = eax_31 + ((edi_45 >> 0x1F) << (byte) esi_40);
		edx_28 = edx_28 + 0x01;
		dl_16 = (byte) edx_28;
		if (edx_28 == 0x20)
		{
			ebx_29 = ebx_29 + 0x01;
			edx_28 = 0x00;
			dl_16 = 0x00;
		}
	} while (esi_40 != 0x00);
	globals->dw40210C = globals->dw40210C + esi_30;
	return eax_31;
}

// 004013A0: void fn004013A0(Stack Eq_541 dwArg04)
void fn004013A0(Eq_541 dwArg04)
{
	byte * ebx_38 = globals->dw402104 + (word32) (dwArg04 * 0xA0);
	byte * edi_29 = globals->a402010;
	word32 ecx_41 = (word32) *ebx_38 + 0x01;
	byte * esi_43 = ebx_38;
	while (ecx_41 != 0x00)
	{
		*edi_29 = *esi_43;
		esi_43 = esi_43 + 0x01;
		edi_29 = edi_29 + 0x01;
		ecx_41 = ecx_41 - 0x01;
	}
}

// 004013CA: void fn004013CA()
void fn004013CA()
{
	globals->a402010 = globals->a402010 + 0x01;
	((word32) globals->a402010)->b402010 = globals->b40211C;
}

// 004013E4: void fn004013E4()
void fn004013E4()
{
	word32 ecx_33 = (word32) globals->a402010;
	byte * edi_31 = globals->ptr402100 + globals->dw402114;
	globals->dw402114 = globals->dw402114 + ecx_33;
	byte * esi_37 = globals->a402011;
	while (ecx_33 != 0x00)
	{
		*edi_31 = *esi_37;
		esi_37 = esi_37 + 0x01;
		edi_31 = edi_31 + 0x01;
		ecx_33 = ecx_33 - 0x01;
	}
	globals->ptr402118 = edi_31;
}

// 0040140E: void fn0040140E()
void fn0040140E()
{
	globals->b40211C = globals->a402011;
}

// 0040141F: void fn0040141F()
void fn0040141F()
{
	if (globals->t402110 == 0x0200)
	{
		globals->t402110.u0 = 0x0100;
		globals->dw402108 = 0x09;
	}
}

// 00401442: void fn00401442()
void fn00401442()
{
	word32 ecx_22 = (word32) globals->a402010;
	byte * ebx_19 = globals->dw402104 + (word32) (globals->t402110 * 0xA0);
	*ebx_19 = (byte) ecx_22;
	byte * esi_24 = globals->a402011;
	byte * edi_28 = ebx_19 + 0x01;
	while (ecx_22 != 0x00)
	{
		*edi_28 = *esi_24;
		esi_24 = esi_24 + 0x01;
		edi_28 = edi_28 + 0x01;
		ecx_22 = ecx_22 - 0x01;
	}
	globals->t402110 = (word32) globals->t402110 + 0x01;
	fn0040141F();
}

// 00401486: void fn00401486()
void fn00401486()
{
	fn004012FC(&globals->ptr402100, 60000);
	fn004012FC(&globals->dw402104, 0x00C35000);
	fn00401320();
	globals->dw402108 = 0x09;
	Eq_541 eax_25 = fn00401344();
	fn004013A0(eax_25);
	fn004013E4();
	fn0040140E();
	Eq_541 dwLoc0C_26 = eax_25;
	while (globals->dw402004 - globals->dw40210C >= globals->dw402108)
	{
		Eq_541 eax_44 = fn00401344();
		if (eax_44 > globals->t402110 - 0x01)
		{
			fn004013A0(dwLoc0C_26);
			fn004013CA();
		}
		else
			fn004013A0(eax_44);
		fn004013E4();
		fn0040140E();
		fn004013A0(dwLoc0C_26);
		fn004013CA();
		fn00401442();
		dwLoc0C_26 = eax_44;
	}
}

// 0040153D: Register word32 fn0040153D()
word32 fn0040153D()
{
	struct Eq_352 * ebx_2;
	struct Eq_351 * ecx_3 = fn0040105A(out ebx_2);
	return fn00401291(ecx_3, ebx_2);
}

// 00401549: void fn00401549(Register (ptr32 Eq_749) ebp)
void fn00401549(Eq_749 * ebp)
{
	*(ebp - 0x08) = (HANDLE *) GetCurrentThread();
	*(ebp - 0x04) = (HANDLE *) CreateThread(null, 0x00, ebp->dw000C + 0x01, 0x00, 0x04, null);
}

// 00401575: void fn00401575(Register ptr32 ebp)
void fn00401575(ptr32 ebp)
{
	ResumeThread(*(ebp - 0x04));
	SuspendThread(*(ebp - 0x08));
}

// 00401588: void fn00401588(Register (ptr32 Eq_801) ebp)
void fn00401588(Eq_801 * ebp)
{
	*(ebp - 0x02D4) = 0x00010002;
	GetThreadContext(*(ebp - 0x04), ebp - 0x02D4);
	*(ebp - 0x0224) = ebp->dw000C;
	fn004012A6(0x01, &globals->ptr402124);
	globals->ptr402124 = (<anonymous> *) ((char *) globals->ptr402124 + 0x05);
	word32 esp_35;
	word32 ebp_36;
	word32 esi_37;
	word32 eax_38;
	word32 ecx_39;
	byte SCZO_40;
	byte SZO_41;
	bool C_42;
	byte al_43;
	globals->ptr402124();
}

// 004015D6: void fn004015D6()
void fn004015D6()
{
	fn00401549(fp - 0x04);
	fn00401588(fp - 0x04);
	fn00401575(fp - 0x04);
}

// 004015F5: Register Eq_50 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	fn004015D6();
	fn004010FD(fp - 0x04);
	fn00401486();
	return fn0040153D();
}

