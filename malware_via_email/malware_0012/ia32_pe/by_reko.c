// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401010: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	fn0040115C(fp - 0x04, dwLoc24, dwLoc20, dwLoc1C);
	ui32 eax_31 = (dwLoc20 << 0x08) + 0x003FA900;
	Eq_21 v9_36 = *(eax_31 + 0x20CB - dwLoc20);
	Eq_28 eax_42 = eax_31 + 0x20DF - dwLoc20;
	VirtualProtect(eax_42, v9_36, 0x04, fp - 0x08);
	Eq_21 ecx_57 = v9_36;
	Eq_28 ebx_58 = eax_42;
	word32 eax_60 = dwLoc20 + 0x10E3F1CF;
	Eq_47 dwLoc08_63 = (struct _JOB_SET_ARRAY *) 0x01;
	while (true)
	{
		*ebx_58 = *ebx_58 ^ eax_60;
		ecx_57 = ecx_57 - ~0x52 - dwLoc20;
		if (ecx_57 < 0x00)
			break;
		eax_60 = eax_60 + 263671972 + dwLoc08_63;
		ebx_58 = ebx_58 + 0x5B - dwLoc20;
		dwLoc08_63 = -*(fp - 0x08);
	}
	word32 ebx_92 = Mem72[eax_42 + 0x93 - dwLoc20 + 0x00:word32] + eax_42;
	word32 dwLoc1C_124 = (word32) ebx_92->b0006;
	Eq_28 eax_109 = VirtualAlloc(ebx_92->t0034, ebx_92->t0050, 0x3000, 0x40);
	fn0040113F(ebx_92->dw0054, eax_42, eax_109);
	struct Eq_87 * esi_122 = &ebx_92->dw0054 + 0x0029;
	do
	{
		fn0040113F(esi_122->dw0010, eax_42 + Mem72[esi_122 + 0x14:word32], eax_109 + Mem72[esi_122 + 0x0C:word32]);
		word32 v25_142 = dwLoc1C_124 - 0x01;
		esi_122 = esi_122 + 0x01;
		dwLoc1C_124 = v25_142;
	} while (v25_142 != 0x00);
	Eq_28 eax_152 = eax_109;
	do
		eax_152 = eax_152 + 0x04;
	while (*eax_152 != ~0x55443322);
	return fn0040113F(0x38, 0x00401174, eax_152);
}

// 0040113F: Register word32 fn0040113F(Stack word32 dwArg04, Stack Eq_28 dwArg08, Stack Eq_28 dwArg0C)
word32 fn0040113F(word32 dwArg04, Eq_28 dwArg08, Eq_28 dwArg0C)
{
	Eq_28 esi_13 = dwArg08;
	Eq_28 edi_15 = dwArg0C;
	word32 ecx_17 = dwArg04;
	do
	{
		byte al_24 = *esi_13;
		*edi_15 = al_24;
		eax = DPB(eax, al_24, 0);
		esi_13 = (word32) esi_13 + 0x01;
		edi_15 = (word32) edi_15 + 0x01;
		ecx_17 = ecx_17 - 0x01;
	} while (ecx_17 != 0x00);
	return eax;
}

// 0040115C: void fn0040115C(Register ptr32 ebp, Stack Eq_6 tArg00, Stack Eq_7 tArg04, Stack Eq_6 tArg08)
void fn0040115C(ptr32 ebp, ULONG tArg00, Eq_7 tArg04, ULONG tArg08)
{
	CreateJobSet(tArg00, tArg04, tArg08);
	*(ebp - 0x1C) = fs->ptr0018->dw0034;
}

