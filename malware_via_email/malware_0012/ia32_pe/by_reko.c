// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401010: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	fn0040115C(fp - 0x04, tLoc24, dwLoc20, dwLoc1C);
	*(fp - 0x24) = 0x2000;
	word32 dwLoc18_15 = *(fp - 0x24);
	*(fp - 0x24) = 0x10E3F1CF;
	word32 dwLoc10_19 = *(fp - 0x24);
	*(fp - 0x24) = 263671972;
	ui32 eax_32 = (dwLoc20 << 0x08) + 0x003FA900 + dwLoc18_15;
	word32 dwLoc0C_23 = *(fp - 0x24);
	Mem37[fp - 0x24 + 0x00:word32] = Mem22[eax_32 + 0xCB - dwLoc20 + 0x00:word32];
	int32 dwLoc14_38 = *(fp - 0x24);
	*(fp - 0x24) = fp - 0x08;
	*(fp - 0x28) = 0x04;
	*(fp - 44) = dwLoc14_38;
	ui32 * eax_41 = eax_32 + 223 - dwLoc20;
	*(fp - 0x30) = eax_41;
	VirtualProtect(*(fp - 0x30), *(fp - 44), *(fp - 0x28), *(fp - 0x24));
	int32 ecx_55 = dwLoc14_38;
	ui32 * ebx_56 = eax_41;
	word32 eax_58 = dwLoc20 + dwLoc10_19 / 0x0C;
	word32 dwLoc08_61 = 0x01;
	while (true)
	{
		*ebx_56 = *ebx_56 ^ eax_58;
		ecx_55 = ecx_55 - ~0x52 - dwLoc20;
		if (ecx_55 < 0x00)
			break;
		eax_58 = eax_58 + dwLoc0C_23 + dwLoc08_61;
		ebx_56 = (char *) ebx_56 + 0x005B - dwLoc20;
		dwLoc08_61 = -*(fp - 0x08);
	}
	struct Eq_130 * ebx_90 = eax_41 + *(((char *) eax_41 + 0x0093) - dwLoc20);
	word32 dwLoc1C_124 = (word32) ebx_90->b0006;
	*(fp - 0x34) = 0x40;
	*(fp - 0x38) = 0x3000;
	*(fp - 0x3C) = ebx_90->dw0050;
	*(fp - 0x40) = ebx_90->dw0034;
	Eq_100 eax_107 = VirtualAlloc(*(fp - 0x40), *(fp - 0x3C), *(fp - 0x38), *(fp - 0x34));
	*(fp - 0x44) = (union Eq_100 *) eax_107;
	*(fp - 0x48) = eax_41;
	*(fp - 0x4C) = ebx_90->dw0054;
	fn0040113F(dwArg00, dwArg04, dwArg08);
	struct Eq_225 * esi_122 = &ebx_90->dw0054 + 0x0029;
	do
	{
		*(fp - 0x44) = (word32) eax_107 + esi_122->t000C;
		*(fp - 0x48) = eax_41 + esi_122->dw0014;
		*(fp - 0x4C) = esi_122->dw0010;
		fn0040113F(dwArg00, dwArg04, dwArg08);
		word32 v25_143 = dwLoc1C_124 - 0x01;
		esi_122 = esi_122 + 0x01;
		dwLoc1C_124 = v25_143;
	} while (v25_143 != 0x00);
	word32 eax_148 = (word32) eax_107 + ebx_90->dw0028;
	Eq_100 eax_153 = eax_107;
	do
		eax_153 = eax_153 + 0x04;
	while (*eax_153 != ~0x55443322);
	*(fp - 0x44) = (union Eq_100 *) eax_153;
	*(fp - 0x48) = 0x00401174;
	*(fp - 0x4C) = 0x38;
	return fn0040113F(eax_148, dwArg04, dwArg08);
}

// 0040113F: Register word32 fn0040113F(Stack word32 dwArg04, Stack (ptr byte) dwArg08, Stack (ptr byte) dwArg0C)
word32 fn0040113F(word32 dwArg04, byte * dwArg08, byte * dwArg0C)
{
	byte * esi_13 = dwArg08;
	byte * edi_15 = dwArg0C;
	word32 ecx_17 = dwArg04;
	do
	{
		byte al_24 = *esi_13;
		*edi_15 = al_24;
		eax = DPB(eax, al_24, 0);
		esi_13 = esi_13 + 0x01;
		edi_15 = edi_15 + 0x01;
		ecx_17 = ecx_17 - 0x01;
	} while (ecx_17 != 0x00);
	return eax;
}

// 0040115C: void fn0040115C(Register ptr32 ebp, Stack Eq_6 tArg00, Stack Eq_7 tArg04, Stack Eq_6 tArg08)
void fn0040115C(ptr32 ebp, ULONG tArg00, PJOB_SET_ARRAY tArg04, ULONG tArg08)
{
	CreateJobSet(tArg00, tArg04, tArg08);
	*(ebp - 0x1C) = fs->ptr0018->dw0034;
}

