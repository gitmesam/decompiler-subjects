//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) Retargetable Decompiler <info@retdec.com>
//

#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------- Function Prototypes --------------------

void move(uint32_t n, uint32_t from, int32_t to, int32_t via);

// --------------------- Global Variables ---------------------

char * g1 = "\x1b[%d;%dH"; // 0x400d70
char * g2 = "\x1b[H\x1b[J"; // 0x400d82
struct _IO_FILE * g3 = NULL; // 0x411058
int64_t g4 = 0; // 0x411070
int64_t g5 = 0; // 0x411078
int32_t height = 0; // 0x411080
int64_t t = 0; // 0x411068

// ------------------------ Functions -------------------------

// From module:   /mnt/from_holdec/./movfuscator/hanoi/source.c
// Address range: 0x4009b0 - 0x400b30
// Line range:    40 - 47
void move(uint32_t n, uint32_t from, int32_t to, int32_t via) {
    if (n == 0) {
        // 0x400b10
        return;
    }
    // 0x4009dc
    __asm_bfi(1, to, 1, 31);
    int64_t v1 = from; // 0x400a08
    int64_t v2 = via;
    int64_t v3 = (int64_t)n + 0xffffffff; // 0x400a14
    int32_t v4 = v3; // 0x400a18
    int32_t v5 = v1; // 0x400a1c
    move(v4, v5, (int32_t)v2, to);
    int64_t v6 = *(int64_t *)((8 * v1 & 0xfffffff8) + (int64_t)&t); // 0x400a28
    __asm_bfi(1, v5, 1, 31);
    int32_t * v7 = (int32_t *)(v6 + 8); // 0x400a38
    int64_t v8 = (int64_t)*v7 - 1; // 0x400a44
    *v7 = (int32_t)v8;
    uint32_t v9 = *(int32_t *)(4 * v8 + *(int64_t *)v6); // 0x400a54
    int64_t v10 = v9; // 0x400a54
    printf((char *)&g1);
    int64_t v11 = v10; // 0x400a70
    int64_t v12; // 0x400a7c
    if (v9 != 0) {
        v12 = v11 + 0xffffffff;
        printf("%s", "  ");
        v11 = v12 & 0xffffffff;
        while ((int32_t)v12 != 0) {
            // 0x400a74
            v12 = v11 + 0xffffffff;
            printf("%s", "  ");
            v11 = v12 & 0xffffffff;
        }
    }
    int64_t v13 = *(int64_t *)(8 * (int64_t)to + (int64_t)&t); // 0x400a94
    int32_t * v14 = (int32_t *)(v13 + 8); // 0x400a98
    int32_t v15 = *v14; // 0x400a98
    *v14 = v15 + 1;
    *(int32_t *)(4 * (int64_t)v15 + *(int64_t *)v13) = v9;
    printf((char *)&g1);
    int64_t v16 = v10; // 0x400ad4
    int64_t v17; // 0x400ae0
    if (v9 != 0) {
        v17 = v16 + 0xffffffff;
        printf("%s", "==");
        v16 = v17 & 0xffffffff;
        while ((int32_t)v17 != 0) {
            // 0x400ad8
            v17 = v16 + 0xffffffff;
            printf("%s", "==");
            v16 = v17 & 0xffffffff;
        }
    }
    // 0x400aec
    usleep(0x186a0);
    fflush(g3);
    int64_t v18 = v1; // 0x400b0c
    v1 = v2 & 0xffffffff;
    int64_t v19 = v3 & 0xffffffff; // 0x400b0c
    while (v4 != 0) {
        // 0x400a0c
        v2 = v18;
        v3 = v19 + 0xffffffff;
        v4 = v3;
        v5 = v1;
        move(v4, v5, (int32_t)v2, to);
        v6 = *(int64_t *)((8 * v1 & 0xfffffff8) + (int64_t)&t);
        __asm_bfi(1, v5, 1, 31);
        v7 = (int32_t *)(v6 + 8);
        v8 = (int64_t)*v7 - 1;
        *v7 = (int32_t)v8;
        v9 = *(int32_t *)(4 * v8 + *(int64_t *)v6);
        v10 = v9;
        printf((char *)&g1);
        v11 = v10;
        if (v9 != 0) {
            v12 = v11 + 0xffffffff;
            printf("%s", "  ");
            v11 = v12 & 0xffffffff;
            while ((int32_t)v12 != 0) {
                // 0x400a74
                v12 = v11 + 0xffffffff;
                printf("%s", "  ");
                v11 = v12 & 0xffffffff;
            }
        }
        // 0x400a88
        v13 = *(int64_t *)(8 * (int64_t)to + (int64_t)&t);
        v14 = (int32_t *)(v13 + 8);
        v15 = *v14;
        *v14 = v15 + 1;
        *(int32_t *)(4 * (int64_t)v15 + *(int64_t *)v13) = v9;
        printf((char *)&g1);
        v16 = v10;
        if (v9 != 0) {
            v17 = v16 + 0xffffffff;
            printf("%s", "==");
            v16 = v17 & 0xffffffff;
            while ((int32_t)v17 != 0) {
                // 0x400ad8
                v17 = v16 + 0xffffffff;
                printf("%s", "==");
                v16 = v17 & 0xffffffff;
            }
        }
        // 0x400aec
        usleep(0x186a0);
        fflush(g3);
        v18 = v1;
        v1 = v2 & 0xffffffff;
        v19 = v3 & 0xffffffff;
    }
}

// From module:   /mnt/from_holdec/./movfuscator/hanoi/source.c
// Address range: 0x400b30 - 0x400ce0
// Line range:    49 - 61
int main(int c, char ** v) {
    // 0x400b30
    puts((char *)&g2);
    int64_t v1; // 0x400b30
    if (c < 2) {
        // 0x400b84
        v1 = 8;
        goto lab_0x400b88;
    } else {
        int32_t str_as_l = strtol((char *)*(int64_t *)((int64_t)v + 8), NULL, 10); // 0x400b74
        v1 = str_as_l;
        if (str_as_l > 0) {
            goto lab_0x400b88;
        } else {
            // 0x400b84
            v1 = 8;
            goto lab_0x400b88;
        }
    }
  lab_0x400b88:;
    // 0x400b88
    int64_t v2; // 0x400b30
    int64_t v3 = __asm_sbfiz(v2, v1, 2, 32); // 0x400b88
    height = v1;
    int32_t size = (int32_t)v3 + 16; // 0x400ba4
    int64_t * mem = calloc(1, size); // 0x400ba4
    int64_t v4 = (int64_t)mem; // 0x400ba4
    *mem = v4 + 16;
    t = v4;
    int64_t * mem2 = calloc(1, size); // 0x400bc8
    int64_t v5 = (int64_t)mem2; // 0x400bc8
    *mem2 = v5 + 16;
    g4 = v5;
    int64_t * mem3 = calloc(1, size); // 0x400be0
    int64_t v6 = (int64_t)mem3; // 0x400be0
    g5 = v6;
    *mem3 = v6 + 16;
    int32_t * v7 = (int32_t *)(v4 + 8); // 0x400c18
    int32_t v8 = *v7; // 0x400c18
    int64_t v9 = *(int64_t *)v4; // 0x400c1c
    *v7 = v8 + 1;
    *(int32_t *)(4 * (int64_t)v8 + v9) = (int32_t)v1;
    printf((char *)&g1);
    int64_t v10 = 0; // 0x400c4c
    printf("%s", "==");
    while ((v10 + 1 & 0xffffffff) != v1) {
        // 0x400c50
        v10 = v10 + 1 & 0xffffffff;
        printf("%s", "==");
    }
    // 0x400c68
    usleep(0x186a0);
    fflush(g3);
    int64_t v11 = v1 + 0xffffffff; // 0x400c7c
    while ((int32_t)v11 != 0) {
        int64_t v12 = v11 & 0xffffffff; // 0x400c14
        v7 = (int32_t *)(t + 8);
        v8 = *v7;
        v9 = *(int64_t *)t;
        *v7 = v8 + 1;
        *(int32_t *)(4 * (int64_t)v8 + v9) = (int32_t)v12;
        printf((char *)&g1);
        v10 = 0;
        printf("%s", "==");
        while ((v10 + 1 & 0xffffffff) != v12) {
            // 0x400c50
            v10 = v10 + 1 & 0xffffffff;
            printf("%s", "==");
        }
        // 0x400c68
        usleep(0x186a0);
        fflush(g3);
        v11 = v12 + 0xffffffff;
    }
    // 0x400c84
    move(height, 0, 2, 1);
    printf((char *)&g1);
    printf("%s", (char *)0x400d89);
    return 0;
}

// --------------- Dynamically Linked Functions ---------------

// void * calloc(size_t nmemb, size_t size);
// int fflush(FILE * stream);
// int printf(const char * restrict format, ...);
// int puts(const char * s);
// long int strtol(const char * restrict nptr, char ** restrict endptr, int base);
// int usleep(__useconds_t useconds);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: llvm (3.8.1)
// Detected functions: 2

